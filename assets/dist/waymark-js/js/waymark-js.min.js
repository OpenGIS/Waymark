!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.L={})}(this,function(t){var e=Object.freeze;function n(t){var e,n,a,s;for(n=1,a=arguments.length;n<a;n++)for(e in s=arguments[n])t[e]=s[e];return t}Object.freeze=function(t){return t};var a=Object.create||function(t){return s.prototype=t,new s};function s(){}function r(t,e){var n=Array.prototype.slice;if(t.bind)return t.bind.apply(t,n.call(arguments,1));var a=n.call(arguments,2);return function(){return t.apply(e,a.length?a.concat(n.call(arguments)):arguments)}}var l=0;function h(t){return t._leaflet_id=t._leaflet_id||++l,t._leaflet_id}function c(t,e,n){var a,s,r,l;return l=function(){a=!1,s&&(r.apply(n,s),s=!1)},r=function(){a?s=arguments:(t.apply(n,arguments),setTimeout(l,e),a=!0)}}function d(t,e,n){var a=e[1],s=e[0],r=a-s;return t===a&&n?t:((t-s)%r+r)%r+s}function u(){return!1}function p(t,e){return+(Math.round(t+"e+"+(e=void 0===e?6:e))+"e-"+e)}function m(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function f(t){return m(t).split(/\s+/)}function g(t,e){for(var n in t.hasOwnProperty("options")||(t.options=t.options?a(t.options):{}),e)t.options[n]=e[n];return t.options}function y(t,e,n){var a=[];for(var s in t)a.push(encodeURIComponent(n?s.toUpperCase():s)+"="+encodeURIComponent(t[s]));return(e&&-1!==e.indexOf("?")?"&":"?")+a.join("&")}var v=/\{ *([\w_-]+) *\}/g;function k(t,e){return t.replace(v,function(t,n){var a=e[n];if(void 0===a)throw Error("No value provided for variable "+t);return"function"==typeof a&&(a=a(e)),a})}var w=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function x(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return -1}var $="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function b(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var C=0;function P(t){var e=+new Date,n=Math.max(0,16-(e-C));return C=e+n,window.setTimeout(t,n)}var _=window.requestAnimationFrame||b("RequestAnimationFrame")||P,T=window.cancelAnimationFrame||b("CancelAnimationFrame")||b("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function E(t,e,n){if(!n||_!==P)return _.call(window,r(t,e));t.call(e)}function M(t){t&&T.call(window,t)}var S=(Object.freeze||Object)({freeze:e,extend:n,create:a,bind:r,lastId:l,stamp:h,throttle:c,wrapNum:d,falseFn:u,formatNum:p,trim:m,splitWords:f,setOptions:g,getParamString:y,template:k,isArray:w,indexOf:x,emptyImageUrl:$,requestFn:_,cancelFn:T,requestAnimFrame:E,cancelAnimFrame:M});function z(){}z.extend=function(t){function e(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()}var s=e.__super__=this.prototype,r=a(s);for(var l in(r.constructor=e).prototype=r,this)this.hasOwnProperty(l)&&"prototype"!==l&&"__super__"!==l&&(e[l]=this[l]);return t.statics&&(n(e,t.statics),delete t.statics),t.includes&&(function(t){if("undefined"!=typeof L&&L&&L.Mixin){t=w(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",Error().stack)}}(t.includes),n.apply(null,[r].concat(t.includes)),delete t.includes),r.options&&(t.options=n(a(r.options),t.options)),n(r,t),r._initHooks=[],r.callInitHooks=function(){if(!this._initHooksCalled){s.callInitHooks&&s.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=r._initHooks.length;t<e;t++)r._initHooks[t].call(this)}},e},z.include=function(t){return n(this.prototype,t),this},z.mergeOptions=function(t){return n(this.prototype.options,t),this},z.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1);return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push("function"==typeof t?t:function(){this[t].apply(this,e)}),this};var D={on:function(t,e,n){if("object"==typeof t)for(var a in t)this._on(a,t[a],e);else for(var s=0,r=(t=f(t)).length;s<r;s++)this._on(t[s],e,n);return this},off:function(t,e,n){if(t){if("object"==typeof t)for(var a in t)this._off(a,t[a],e);else for(var s=0,r=(t=f(t)).length;s<r;s++)this._off(t[s],e,n)}else delete this._events;return this},_on:function(t,e,n){this._events=this._events||{};var a=this._events[t];a||(a=[],this._events[t]=a),n===this&&(n=void 0);for(var s={fn:e,ctx:n},r=a,l=0,h=r.length;l<h;l++)if(r[l].fn===e&&r[l].ctx===n)return;r.push(s)},_off:function(t,e,n){var a,s,r;if(this._events&&(a=this._events[t])){if(e){if(n===this&&(n=void 0),a)for(s=0,r=a.length;s<r;s++){var l=a[s];if(l.ctx===n&&l.fn===e)return l.fn=u,this._firingCount&&(this._events[t]=a=a.slice()),void a.splice(s,1)}}else{for(s=0,r=a.length;s<r;s++)a[s].fn=u;delete this._events[t]}}},fire:function(t,e,a){if(!this.listens(t,a))return this;var s=n({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var r=this._events[t];if(r){this._firingCount=this._firingCount+1||1;for(var l=0,h=r.length;l<h;l++){var c=r[l];c.fn.call(c.ctx||this,s)}this._firingCount--}}return a&&this._propagateEvent(s),this},listens:function(t,e){var n=this._events&&this._events[t];if(n&&n.length)return!0;if(e){for(var a in this._eventParents)if(this._eventParents[a].listens(t,e))return!0}return!1},once:function(t,e,n){if("object"==typeof t){for(var a in t)this.once(a,t[a],e);return this}var s=r(function(){this.off(t,e,n).off(t,s,n)},this);return this.on(t,e,n).on(t,s,n)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[h(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[h(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,n({layer:t.target,propagatedFrom:t.target},t),!0)}};D.addEventListener=D.on,D.removeEventListener=D.clearAllEventListeners=D.off,D.addOneTimeEventListener=D.once,D.fireEvent=D.fire,D.hasEventListeners=D.listens;var W=z.extend(D);function A(t,e,n){this.x=n?Math.round(t):t,this.y=n?Math.round(e):e}var O=Math.trunc||function(t){return 0<t?Math.floor(t):Math.ceil(t)};function B(t,e,n){return t instanceof A?t:w(t)?new A(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new A(t.x,t.y):new A(t,e,n)}function I(t,e){if(t)for(var n=e?[t,e]:t,a=0,s=n.length;a<s;a++)this.extend(n[a])}function Z(t,e){return!t||t instanceof I?t:new I(t,e)}function F(t,e){if(t)for(var n=e?[t,e]:t,a=0,s=n.length;a<s;a++)this.extend(n[a])}function j(t,e){return t instanceof F?t:new F(t,e)}function R(t,e,n){if(isNaN(t)||isNaN(e))throw Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==n&&(this.alt=+n)}function N(t,e,n){return t instanceof R?t:w(t)&&"object"!=typeof t[0]?3===t.length?new R(t[0],t[1],t[2]):2===t.length?new R(t[0],t[1]):null:null==t?t:"object"==typeof t&&"lat"in t?new R(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new R(t,e,n)}A.prototype={clone:function(){return new A(this.x,this.y)},add:function(t){return this.clone()._add(B(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(B(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new A(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new A(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=O(this.x),this.y=O(this.y),this},distanceTo:function(t){var e=(t=B(t)).x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)},equals:function(t){return(t=B(t)).x===this.x&&t.y===this.y},contains:function(t){return Math.abs((t=B(t)).x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}},I.prototype={extend:function(t){return t=B(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new A((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new A(this.min.x,this.max.y)},getTopRight:function(){return new A(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,n;return(t="number"==typeof t[0]||t instanceof A?B(t):Z(t))instanceof I?(e=t.min,n=t.max):e=n=t,e.x>=this.min.x&&n.x<=this.max.x&&e.y>=this.min.y&&n.y<=this.max.y},intersects:function(t){t=Z(t);var e=this.min,n=this.max,a=t.min,s=t.max,r=s.x>=e.x&&a.x<=n.x,l=s.y>=e.y&&a.y<=n.y;return r&&l},overlaps:function(t){t=Z(t);var e=this.min,n=this.max,a=t.min,s=t.max,r=s.x>e.x&&a.x<n.x,l=s.y>e.y&&a.y<n.y;return r&&l},isValid:function(){return!(!this.min||!this.max)}},F.prototype={extend:function(t){var e,n,a=this._southWest,s=this._northEast;if(t instanceof R)n=e=t;else{if(!(t instanceof F))return t?this.extend(N(t)||j(t)):this;if(e=t._southWest,n=t._northEast,!e||!n)return this}return a||s?(a.lat=Math.min(e.lat,a.lat),a.lng=Math.min(e.lng,a.lng),s.lat=Math.max(n.lat,s.lat),s.lng=Math.max(n.lng,s.lng)):(this._southWest=new R(e.lat,e.lng),this._northEast=new R(n.lat,n.lng)),this},pad:function(t){var e=this._southWest,n=this._northEast,a=Math.abs(e.lat-n.lat)*t,s=Math.abs(e.lng-n.lng)*t;return new F(new R(e.lat-a,e.lng-s),new R(n.lat+a,n.lng+s))},getCenter:function(){return new R((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new R(this.getNorth(),this.getWest())},getSouthEast:function(){return new R(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof R||"lat"in t?N(t):j(t);var e,n,a=this._southWest,s=this._northEast;return t instanceof F?(e=t.getSouthWest(),n=t.getNorthEast()):e=n=t,e.lat>=a.lat&&n.lat<=s.lat&&e.lng>=a.lng&&n.lng<=s.lng},intersects:function(t){t=j(t);var e=this._southWest,n=this._northEast,a=t.getSouthWest(),s=t.getNorthEast(),r=s.lat>=e.lat&&a.lat<=n.lat,l=s.lng>=e.lng&&a.lng<=n.lng;return r&&l},overlaps:function(t){t=j(t);var e=this._southWest,n=this._northEast,a=t.getSouthWest(),s=t.getNorthEast(),r=s.lat>e.lat&&a.lat<n.lat,l=s.lng>e.lng&&a.lng<n.lng;return r&&l},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=j(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}};var G,U={latLngToPoint:function(t,e){var n=this.projection.project(t),a=this.scale(e);return this.transformation._transform(n,a)},pointToLatLng:function(t,e){var n=this.scale(e),a=this.transformation.untransform(t,n);return this.projection.unproject(a)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,n=this.scale(t);return new I(this.transformation.transform(e.min,n),this.transformation.transform(e.max,n))},infinite:(R.prototype={equals:function(t,e){return!!t&&(t=N(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+p(this.lat,t)+", "+p(this.lng,t)+")"},distanceTo:function(t){return H.distance(this,N(t))},wrap:function(){return H.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return j([this.lat-e,this.lng-n],[this.lat+e,this.lng+n])},clone:function(){return new R(this.lat,this.lng,this.alt)}},!1),wrapLatLng:function(t){var e=this.wrapLng?d(t.lng,this.wrapLng,!0):t.lng;return new R(this.wrapLat?d(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),n=this.wrapLatLng(e),a=e.lat-n.lat,s=e.lng-n.lng;if(0==a&&0==s)return t;var r=t.getSouthWest(),l=t.getNorthEast();return new F(new R(r.lat-a,r.lng-s),new R(l.lat-a,l.lng-s))}},H=n({},U,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var n=Math.PI/180,a=t.lat*n,s=e.lat*n,r=Math.sin((e.lat-t.lat)*n/2),l=Math.sin((e.lng-t.lng)*n/2),h=r*r+Math.cos(a)*Math.cos(s)*l*l;return this.R*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}}),V={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,n=this.MAX_LATITUDE,a=Math.sin(Math.max(Math.min(n,t.lat),-n)*e);return new A(this.R*t.lng*e,this.R*Math.log((1+a)/(1-a))/2)},unproject:function(t){var e=180/Math.PI;return new R((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:(G=6378137*Math.PI,new I([-G,-G],[G,G]))};function q(t,e,n,a){if(w(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=n,this._d=a}function X(t,e,n,a){return new q(t,e,n,a)}q.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new A((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var K,J=n({},H,{code:"EPSG:3857",projection:V,transformation:X(K=.5/(Math.PI*V.R),.5,-K,.5)}),Y=n({},J,{code:"EPSG:900913"});function Q(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function tt(t,e){var n,a,s,r,l,h,c="";for(n=0,s=t.length;n<s;n++){for(a=0,r=(l=t[n]).length;a<r;a++)c+=(a?"L":"M")+(h=l[a]).x+" "+h.y;c+=e?t_?"z":"x":""}return c||"M0 0"}var te=document.documentElement.style,ti="ActiveXObject"in window,tn=ti&&!document.addEventListener,to="msLaunchUri"in navigator&&!("documentMode"in document),ta=tE("webkit"),ts=tE("android"),tr=tE("android 2")||tE("android 3"),tl=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),th=ts&&tE("Google")&&tl<537&&!("AudioNode"in window),tc=!!window.opera,td=tE("chrome"),tu=tE("gecko")&&!ta&&!tc&&!ti,t8=!td&&tE("safari"),tp=tE("phantom"),tm="OTransition"in te,tf=0===navigator.platform.indexOf("Win"),tg=ti&&"transition"in te,ty="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!tr,tv="MozPerspective"in te,tL=!window.L_DISABLE_3D&&(tg||ty||tv)&&!tm&&!tp,tk="undefined"!=typeof orientation||tE("mobile"),tw=!window.PointerEvent&&window.MSPointerEvent,tx=!(!window.PointerEvent&&!tw),t$=!window.L_NO_TOUCH&&(tx||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),tb=tk&&tc,tC=1<(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI),tP=!!document.createElement("canvas").getContext,t_=!(!document.createElementNS||!Q("svg").createSVGRect),tT=!t_&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(n){return!1}}();function tE(t){return 0<=navigator.userAgent.toLowerCase().indexOf(t)}var tM=(Object.freeze||Object)({ie:ti,ielt9:tn,edge:to,webkit:ta,android:ts,android23:tr,androidStock:th,opera:tc,chrome:td,gecko:tu,safari:t8,phantom:tp,opera12:tm,win:tf,ie3d:tg,webkit3d:ty,gecko3d:tv,any3d:tL,mobile:tk,mobileWebkit:tk&&ta,mobileWebkit3d:tk&&ty,msPointer:tw,pointer:tx,touch:t$,mobileOpera:tb,mobileGecko:tk&&tu,retina:tC,canvas:tP,svg:t_,vml:tT}),tS=tw?"MSPointerDown":"pointerdown",tz=tw?"MSPointerMove":"pointermove",tD=tw?"MSPointerUp":"pointerup",tW=tw?"MSPointerCancel":"pointercancel",tA=["INPUT","SELECT","OPTION"],tO={},tB=!1,tI=0;function tZ(t){tO[t.pointerId]=t,tI++}function tF(t){tO[t.pointerId]&&(tO[t.pointerId]=t)}function tj(t){delete tO[t.pointerId],tI--}function tR(t,e){for(var n in t.touches=[],tO)t.touches.push(tO[n]);t.changedTouches=[t],e(t)}var tN,tG,t0,tU,tH,tV=tw?"MSPointerDown":tx?"pointerdown":"touchstart",t1=tw?"MSPointerUp":tx?"pointerup":"touchend",t3="_leaflet_",tq=eo(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),t4=eo(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),t2="webkitTransition"===t4||"OTransition"===t4?t4+"End":"transitionend";function t6(t){return"string"==typeof t?document.getElementById(t):t}function tX(t,e){var n=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!n||"auto"===n)&&document.defaultView){var a=document.defaultView.getComputedStyle(t,null);n=a?a[e]:null}return"auto"===n?null:n}function tK(t,e,n){var a=document.createElement(t);return a.className=e||"",n&&n.appendChild(a),a}function t5(t){var e=t.parentNode;e&&e.removeChild(t)}function tJ(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function tY(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function t7(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function tQ(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=ei(t);return 0<n.length&&RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function t9(t,e){if(void 0!==t.classList)for(var n=f(e),a=0,s=n.length;a<s;a++)t.classList.add(n[a]);else if(!tQ(t,e)){var r=ei(t);ee(t,(r?r+" ":"")+e)}}function et(t,e){void 0!==t.classList?t.classList.remove(e):ee(t,m((" "+ei(t)+" ").replace(" "+e+" "," ")))}function ee(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function ei(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function en(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&function(t,e){var n=!1,a="DXImageTransform.Microsoft.Alpha";try{n=t.filters.item(a)}catch(s){if(1===e)return}e=Math.round(100*e),n?(n.Enabled=100!==e,n.Opacity=e):t.style.filter+=" progid:"+a+"(opacity="+e+")"}(t,e)}function eo(t){for(var e=document.documentElement.style,n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1}function ea(t,e,n){var a=e||new A(0,0);t.style[tq]=(tg?"translate("+a.x+"px,"+a.y+"px)":"translate3d("+a.x+"px,"+a.y+"px,0)")+(n?" scale("+n+")":"")}function es(t,e){t._leaflet_pos=e,tL?ea(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function er(t){return t._leaflet_pos||new A(0,0)}if("onselectstart"in document)tN=function(){ef(window,"selectstart",e$)},tG=function(){ey(window,"selectstart",e$)};else{var el=eo(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);tN=function(){if(el){var t=document.documentElement.style;t0=t[el],t[el]="none"}},tG=function(){el&&(document.documentElement.style[el]=t0,t0=void 0)}}function eh(){ef(window,"dragstart",e$)}function ec(){ey(window,"dragstart",e$)}function ed(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(eu(),tH=(tU=t).style.outline,t.style.outline="none",ef(window,"keydown",eu))}function eu(){tU&&(tU.style.outline=tH,tH=tU=void 0,ey(window,"keydown",eu))}function e8(t){for(;!((t=t.parentNode).offsetWidth&&t.offsetHeight||t===document.body););return t}function ep(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var em=(Object.freeze||Object)({TRANSFORM:tq,TRANSITION:t4,TRANSITION_END:t2,get:t6,getStyle:tX,create:tK,remove:t5,empty:tJ,toFront:tY,toBack:t7,hasClass:tQ,addClass:t9,removeClass:et,setClass:ee,getClass:ei,setOpacity:en,testProp:eo,setTransform:ea,setPosition:es,getPosition:er,disableTextSelection:tN,enableTextSelection:tG,disableImageDrag:eh,enableImageDrag:ec,preventOutline:ed,restoreOutline:eu,getSizedParentNode:e8,getScale:ep});function ef(t,e,n,a){if("object"==typeof e)for(var s in e)ev(t,s,e[s],n);else for(var r=0,l=(e=f(e)).length;r<l;r++)ev(t,e[r],n,a);return this}var eg="_leaflet_events";function ey(t,e,n,a){if("object"==typeof e)for(var s in e)eL(t,s,e[s],n);else if(e)for(var r=0,l=(e=f(e)).length;r<l;r++)eL(t,e[r],n,a);else{for(var h in t[eg])eL(t,h,t[eg][h]);delete t[eg]}return this}function ev(t,e,n,a){var s=e+h(n)+(a?"_"+h(a):"");if(t[eg]&&t[eg][s])return this;var l=function(e){return n.call(a||t,e||window.event)},c=l;tx&&0===e.indexOf("touch")?function t(e,n,a,s){var l,h,c,d,u,p,m,f,g,y,v,k;return"touchstart"===n?(l=e,h=a,c=s,d=r(function(t){if("mouse"!==t.pointerType&&t.MSPOINTER_TYPE_MOUSE&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE){if(!(0>tA.indexOf(t.target.tagName)))return;e$(t)}tR(t,h)}),l["_leaflet_touchstart"+c]=d,l.addEventListener(tS,d,!1),tB||(document.documentElement.addEventListener(tS,tZ,!0),document.documentElement.addEventListener(tz,tF,!0),document.documentElement.addEventListener(tD,tj,!0),document.documentElement.addEventListener(tW,tj,!0),tB=!0)):"touchmove"===n?(u=e,p=a,m=s,f=function(t){(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons)&&tR(t,p)},u["_leaflet_touchmove"+m]=f,u.addEventListener(tz,f,!1)):"touchend"===n&&(g=e,y=a,v=s,k=function(t){tR(t,y)},g["_leaflet_touchend"+v]=k,g.addEventListener(tD,k,!1),g.addEventListener(tW,k,!1)),this}(t,e,l,s):!t$||"dblclick"!==e||tx&&td?"addEventListener"in t?"mousewheel"===e?t.addEventListener("onwheel"in t?"wheel":"mousewheel",l,!1):"mouseenter"===e||"mouseleave"===e?(l=function(e){ez(t,e=e||window.event)&&c(e)},t.addEventListener("mouseenter"===e?"mouseover":"mouseout",l,!1)):("click"===e&&ts&&(l=function(t){!function(t,e){var n=t.timeStamp||t.originalEvent&&t.originalEvent.timeStamp,a=eT&&n-eT;if(a&&100<a&&a<500||t.target._simulatedClick&&!t._simulated)return eb(t);eT=n,e(t)}(t,c)}),t.addEventListener(e,l,!1)):"attachEvent"in t&&t.attachEvent("on"+e,l):function t(e,n,a){var s,r,l=!1;function h(t){var e;if(tx){if(!to||"mouse"===t.pointerType)return;e=tI}else e=t.touches.length;if(!(1<e)){var n=Date.now(),a=n-(s||n);r=t.touches?t.touches[0]:t,l=0<a&&a<=250,s=n}}function c(t){if(l&&!r.cancelBubble){if(tx){if(!to||"mouse"===t.pointerType)return;var e,a,h={};for(a in r)e=r[a],h[a]=e&&e.bind?e.bind(r):e;r=h}r.type="dblclick",r.button=0,n(r),s=null}}return e[t3+tV+a]=h,e[t3+t1+a]=c,e[t3+"dblclick"+a]=n,e.addEventListener(tV,h,!1),e.addEventListener(t1,c,!1),e.addEventListener("dblclick",n,!1),this}(t,l,s),t[eg]=t[eg]||{},t[eg][s]=l}function eL(t,e,n,a){var s,r,l,c,d=e+h(n)+(a?"_"+h(a):""),u=t[eg]&&t[eg][d];if(!u)return this;tx&&0===e.indexOf("touch")?(s=t,r=e,l=d,c=s["_leaflet_"+r+l],"touchstart"===r?s.removeEventListener(tS,c,!1):"touchmove"===r?s.removeEventListener(tz,c,!1):"touchend"===r&&(s.removeEventListener(tD,c,!1),s.removeEventListener(tW,c,!1))):!t$||"dblclick"!==e||tx&&td?"removeEventListener"in t?"mousewheel"===e?t.removeEventListener("onwheel"in t?"wheel":"mousewheel",u,!1):t.removeEventListener("mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,u,!1):"detachEvent"in t&&t.detachEvent("on"+e,u):function t(e,n){var a=e[t3+tV+n],s=e[t3+t1+n],r=e[t3+"dblclick"+n];return e.removeEventListener(tV,a,!1),e.removeEventListener(t1,s,!1),to||e.removeEventListener("dblclick",r,!1),this}(t,d),t[eg][d]=null}function ek(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,eS(t),this}function ew(t){return ev(t,"mousewheel",ek),this}function ex(t){return ef(t,"mousedown touchstart dblclick",ek),ev(t,"click",eM),this}function e$(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function eb(t){return e$(t),ek(t),this}function eC(t,e){if(!e)return new A(t.clientX,t.clientY);var n=ep(e),a=n.boundingClientRect;return new A((t.clientX-a.left)/n.x-e.clientLeft,(t.clientY-a.top)/n.y-e.clientTop)}var eP=tf&&td?2*window.devicePixelRatio:tu?window.devicePixelRatio:1;function e_(t){return to?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/eP:t.deltaY&&1===t.deltaMode?-(20*t.deltaY):t.deltaY&&2===t.deltaMode?-(60*t.deltaY):t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&32765>Math.abs(t.detail)?-(20*t.detail):t.detail?-(60*(t.detail/32765)):0}var eT,eE={};function eM(t){eE[t.type]=!0}function eS(t){var e=eE[t.type];return eE[t.type]=!1,e}function ez(t,e){var n=e.relatedTarget;if(!n)return!0;try{for(;n&&n!==t;)n=n.parentNode}catch(a){return!1}return n!==t}var eD=(Object.freeze||Object)({on:ef,off:ey,stopPropagation:ek,disableScrollPropagation:ew,disableClickPropagation:ex,preventDefault:e$,stop:eb,getMousePosition:eC,getWheelDelta:e_,fakeStop:eM,skipped:eS,isExternalTarget:ez,addListener:ef,removeListener:ey}),eW=W.extend({run:function(t,e,n,a){this.stop(),this._el=t,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(a||.5,.2),this._startPos=er(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=E(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,n=1e3*this._duration;e<n?this._runFrame(this._easeOut(e/n),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var n=this._startPos.add(this._offset.multiplyBy(t));e&&n._round(),es(this._el,n),this.fire("step")},_complete:function(){M(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),eA=W.extend({options:{crs:J,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=g(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=r(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(N(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=t4&&tL&&!tb&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ef(this._proxy,t2,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,a){return(e=void 0===e?this._zoom:this._limitZoom(e),t=this._limitCenter(N(t),e,this.options.maxBounds),a=a||{},this._stop(),this._loaded&&!a.reset&&!0!==a&&(void 0!==a.animate&&(a.zoom=n({animate:a.animate},a.zoom),a.pan=n({animate:a.animate,duration:a.duration},a.pan)),this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,a.zoom):this._tryAnimatedPan(t,a.pan)))?(clearTimeout(this._sizeTimer),this):(this._resetView(t,e),this)},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(tL?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(tL?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,n){var a=this.getZoomScale(e),s=this.getSize().divideBy(2),r=(t instanceof A?t:this.latLngToContainerPoint(t)).subtract(s).multiplyBy(1-1/a),l=this.containerPointToLatLng(s.add(r));return this.setView(l,e,{zoom:n})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():j(t);var n=B(e.paddingTopLeft||e.padding||[0,0]),a=B(e.paddingBottomRight||e.padding||[0,0]),s=this.getBoundsZoom(t,!1,n.add(a));if((s="number"==typeof e.maxZoom?Math.min(e.maxZoom,s):s)===1/0)return{center:t.getCenter(),zoom:s};var r=a.subtract(n).divideBy(2),l=this.project(t.getSouthWest(),s),h=this.project(t.getNorthEast(),s);return{center:this.unproject(l.add(h).divideBy(2).add(r),s),zoom:s}},fitBounds:function(t,e){if(!(t=j(t)).isValid())throw Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(t,e);return this.setView(n.center,n.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=B(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new eW,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){t9(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,n,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,n){if(!1===(n=n||{}).animate||!tL)return this.setView(t,e,n);this._stop();var a=this.project(this.getCenter()),s=this.project(t),r=this.getSize(),l=this._zoom;t=N(t),e=void 0===e?l:e;var h=Math.max(r.x,r.y),c=h*this.getZoomScale(l,e),d=s.distanceTo(a)||1;function u(t){var e=(c*c-h*h+(t?-1:1)*2.0164*2.0164*d*d)/(2*(t?c:h)*2.0164*d),n=Math.sqrt(e*e+1)-e;return n<1e-9?-18:Math.log(n)}function p(t){return(Math.exp(t)-Math.exp(-t))/2}function m(t){return(Math.exp(t)+Math.exp(-t))/2}var f=u(0),g=Date.now(),y=(u(1)-f)/1.42,v=n.duration?1e3*n.duration:1e3*y*.8;return this._moveStart(!0,n.noMoveStart),(function n(){var r,c,u,k,w=(Date.now()-g)/v,x=(1-Math.pow(1-(r=w),1.5))*y;w<=1?(this._flyToFrame=E(n,this),this._move(this.unproject(a.add(s.subtract(a).multiplyBy((c=x,h*(m(f)*(p(u=f+1.42*c)/m(u))-p(f))/2.0164/d))),l),this.getScaleZoom(h/(k=x,h*(m(f)/m(f+1.42*k))),l),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}).call(this),this},flyToBounds:function(t,e){var n=this._getBoundsCenterZoom(t,e);return this.flyTo(n.center,n.zoom,e)},setMaxBounds:function(t){return(t=j(t)).isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var n=this.getCenter(),a=this._limitCenter(n,this._zoom,j(t));return n.equals(a)||this.panTo(a,e),this._enforcingBounds=!1,this},panInside:function(t,e){var n=B((e=e||{}).paddingTopLeft||e.padding||[0,0]),a=B(e.paddingBottomRight||e.padding||[0,0]),s=this.getCenter(),r=this.project(s),l=this.project(t),h=this.getPixelBounds(),c=h.getSize().divideBy(2),d=Z([h.min.add(n),h.max.subtract(a)]);if(!d.contains(l)){this._enforcingBounds=!0;var u=r.subtract(l),p=B(l.x+u.x,l.y+u.y);(l.x<d.min.x||l.x>d.max.x)&&(p.x=r.x-u.x,0<u.x?p.x+=c.x-n.x:p.x-=c.x-a.x),(l.y<d.min.y||l.y>d.max.y)&&(p.y=r.y-u.y,0<u.y?p.y+=c.y-n.y:p.y-=c.y-a.y),this.panTo(this.unproject(p),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=n({animate:!1,pan:!0},!0===t?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var a=this.getSize(),s=e.divideBy(2).round(),l=a.divideBy(2).round(),h=s.subtract(l);return h.x||h.y?(t.animate&&t.pan?this.panBy(h):(t.pan&&this._rawPanBy(h),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(r(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:a})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=n({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=r(this._handleGeolocationResponse,this),a=r(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,a,t):navigator.geolocation.getCurrentPosition(e,a,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,n=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+n+"."})},_handleGeolocationResponse:function(t){var e=new R(t.coords.latitude,t.coords.longitude),n=e.toBounds(2*t.coords.accuracy),a=this._locateOptions;if(a.setView){var s=this.getBoundsZoom(n);this.setView(e,a.maxZoom?Math.min(s,a.maxZoom):s)}var r={latlng:e,bounds:n,timestamp:t.timestamp};for(var l in t.coords)"number"==typeof t.coords[l]&&(r[l]=t.coords[l]);this.fire("locationfound",r)},addHandler:function(t,e){if(!e)return this;var n=this[t]=new e(this);return this._handlers.push(n),this.options[t]&&n.enable(),this},remove:function(){var t;if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(e){this._container._leaflet_id=void 0,this._containerId=void 0}for(t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),t5(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(M(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)t5(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var n=tK("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new F(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,n){t=j(t),n=B(n||[0,0]);var a=this.getZoom()||0,s=this.getMinZoom(),r=this.getMaxZoom(),l=t.getNorthWest(),h=t.getSouthEast(),c=this.getSize().subtract(n),d=Z(this.project(h,a),this.project(l,a)).getSize(),u=tL?this.options.zoomSnap:1,p=c.x/d.x,m=c.y/d.y;return a=this.getScaleZoom(e?Math.max(p,m):Math.min(p,m),a),u&&(a=Math.round(a/(u/100))*(u/100),a=e?Math.ceil(a/u)*u:Math.floor(a/u)*u),Math.max(s,Math.min(r,a))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new A(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var n=this._getTopLeftPoint(t,e);return new I(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var n=this.options.crs;return e=void 0===e?this._zoom:e,n.scale(t)/n.scale(e)},getScaleZoom:function(t,e){var n=this.options.crs;e=void 0===e?this._zoom:e;var a=n.zoom(t*n.scale(e));return isNaN(a)?1/0:a},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(N(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(B(t),e)},layerPointToLatLng:function(t){var e=B(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(N(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(N(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(j(t))},distance:function(t,e){return this.options.crs.distance(N(t),N(e))},containerPointToLayerPoint:function(t){return B(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return B(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(B(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(N(t)))},mouseEventToContainerPoint:function(t){return eC(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=t6(t);if(!e)throw Error("Map container not found.");if(e._leaflet_id)throw Error("Map container is already initialized.");ef(e,"scroll",this._onScroll,this),this._containerId=h(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&tL,t9(t,"leaflet-container"+(t$?" leaflet-touch":"")+(tC?" leaflet-retina":"")+(tn?" leaflet-oldie":"")+(t8?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=tX(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),es(this._mapPane,new A(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(t9(t.markerPane,"leaflet-zoom-hide"),t9(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e){es(this._mapPane,new A(0,0));var n=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var a=this._zoom!==e;this._moveStart(a,!1)._move(t,e)._moveEnd(a),this.fire("viewreset"),n&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,n){void 0===e&&(e=this._zoom);var a=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),(a||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return M(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){es(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={};var e=t?ey:ef;e((this._targets[h(this._container)]=this)._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),tL&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){M(this._resizeRequest),this._resizeRequest=E(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var n,a=[],s="mouseout"===e||"mouseover"===e,r=t.target||t.srcElement,l=!1;r;){if((n=this._targets[h(r)])&&("click"===e||"preclick"===e)&&!t._simulated&&this._draggableMoved(n)){l=!0;break}if(n&&n.listens(e,!0)&&(s&&!ez(r,t)||(a.push(n),s))||r===this._container)break;r=r.parentNode}return a.length||l||s||!ez(r,t)||(a=[this]),a},_handleDOMEvent:function(t){if(this._loaded&&!eS(t)){var e=t.type;"mousedown"!==e&&"keypress"!==e&&"keyup"!==e&&"keydown"!==e||ed(t.target||t.srcElement),this._fireDOMEvent(t,e)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,a){if("click"===t.type){var s=n({},t);s.type="preclick",this._fireDOMEvent(s,s.type,a)}if(!t._stopped&&(a=(a||[]).concat(this._findEventTargets(t,e))).length){var r=a[0];"contextmenu"===e&&r.listens(e,!0)&&e$(t);var l={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var h=r.getLatLng&&(!r._radius||r._radius<=10);l.containerPoint=h?this.latLngToContainerPoint(r.getLatLng()):this.mouseEventToContainerPoint(t),l.layerPoint=this.containerPointToLayerPoint(l.containerPoint),l.latlng=h?r.getLatLng():this.layerPointToLatLng(l.layerPoint)}for(var c=0;c<a.length;c++)if(a[c].fire(e,l,!0),l.originalEvent._stopped||!1===a[c].options.bubblingMouseEvents&&-1!==x(this._mouseEvents,e))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return er(this._mapPane)||new A(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var n=this.getSize()._divideBy(2);return this.project(t,e)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,n){var a=this._getNewPixelOrigin(n,e);return this.project(t,e)._subtract(a)},_latLngBoundsToNewLayerBounds:function(t,e,n){var a=this._getNewPixelOrigin(n,e);return Z([this.project(t.getSouthWest(),e)._subtract(a),this.project(t.getNorthWest(),e)._subtract(a),this.project(t.getSouthEast(),e)._subtract(a),this.project(t.getNorthEast(),e)._subtract(a)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,n){if(!n)return t;var a=this.project(t,e),s=this.getSize().divideBy(2),r=new I(a.subtract(s),a.add(s)),l=this._getBoundsOffset(r,n,e);return l.round().equals([0,0])?t:this.unproject(a.add(l),e)},_limitOffset:function(t,e){if(!e)return t;var n=this.getPixelBounds(),a=new I(n.min.add(t),n.max.add(t));return t.add(this._getBoundsOffset(a,e))},_getBoundsOffset:function(t,e,n){var a=Z(this.project(e.getNorthEast(),n),this.project(e.getSouthWest(),n)),s=a.min.subtract(t.min),r=a.max.subtract(t.max);return new A(this._rebound(s.x,-r.x),this._rebound(s.y,-r.y))},_rebound:function(t,e){return 0<t+e?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),n=this.getMaxZoom(),a=tL?this.options.zoomSnap:1;return a&&(t=Math.round(t/a)*a),Math.max(e,Math.min(n,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){et(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var n=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(n))&&(this.panBy(n,e),!0)},_createAnimProxy:function(){var t=this._proxy=tK("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(t){var e=tq,n=this._proxy.style[e];ea(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),n===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",function(){var t=this.getCenter(),e=this.getZoom();ea(this._proxy,this.project(t,e),this.getZoomScale(e,1))},this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){t5(this._proxy),delete this._proxy},_catchTransitionEnd:function(t){this._animatingZoom&&0<=t.propertyName.indexOf("transform")&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||!1===n.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var a=this.getZoomScale(e),s=this._getCenterOffset(t)._divideBy(1-1/a);return!(!0!==n.animate&&!this.getSize().contains(s))&&(E(function(){this._moveStart(!0,!1)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,n,a){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,t9(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:a}),setTimeout(r(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&et(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),E(function(){this._moveEnd(!0)},this))}});function eO(t){return new eB(t)}var eB=z.extend({options:{position:"topright"},initialize:function(t){g(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),n=this.getPosition(),a=t._controlCorners[n];return t9(e,"leaflet-control"),-1!==n.indexOf("bottom")?a.insertBefore(e,a.firstChild):a.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map&&(t5(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null),this},_refocusOnMap:function(t){this._map&&t&&0<t.screenX&&0<t.screenY&&this._map.getContainer().focus()}});eA.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",n=this._controlContainer=tK("div",e+"control-container",this._container);function a(a,s){t[a+s]=tK("div",e+a+" "+e+s,n)}a("top","left"),a("top","right"),a("bottom","left"),a("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)t5(this._controlCorners[t]);t5(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var eI=eB.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,n,a){return n<a?-1:a<n?1:0}},initialize:function(t,e,n){for(var a in g(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,t)this._addLayer(t[a],a);for(a in e)this._addLayer(e[a],a,!0)},onAdd:function(t){this._initLayout(),this._update(),(this._map=t).on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return eB.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(h(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){t9(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(t9(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):et(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return et(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=tK("div",t),n=this.options.collapsed;e.setAttribute("aria-haspopup",!0),ex(e),ew(e);var a=this._section=tK("section",t+"-list");n&&(this._map.on("click",this.collapse,this),ts||ef(e,{mouseenter:this.expand,mouseleave:this.collapse},this));var s=this._layersLink=tK("a",t+"-toggle",e);s.href="#",s.title="Layers",t$?(ef(s,"click",eb),ef(s,"click",this.expand,this)):ef(s,"focus",this.expand,this),n||this.expand(),this._baseLayersList=tK("div",t+"-base",a),this._separator=tK("div",t+"-separator",a),this._overlaysList=tK("div",t+"-overlays",a),e.appendChild(a)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&h(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,n){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:n}),this.options.sortLayers&&this._layers.sort(r(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;tJ(this._baseLayersList),tJ(this._overlaysList),this._layerControlInputs=[];var t,e,n,a,s=0;for(n=0;n<this._layers.length;n++)a=this._layers[n],this._addItem(a),e=e||a.overlay,t=t||!a.overlay,s+=a.overlay?0:1;return this.options.hideSingleBase&&(t=t&&1<s,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(h(t.target)),n=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;n&&this._map.fire(n,e)},_createRadioElement:function(t,e){var n=document.createElement("div");return n.innerHTML='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",n.firstChild},_addItem:function(t){var e,n=document.createElement("label"),a=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=a):e=this._createRadioElement("leaflet-base-layers_"+h(this),a),this._layerControlInputs.push(e),e.layerId=h(t.layer),ef(e,"click",this._onInputClick,this);var s=document.createElement("span");s.innerHTML=" "+t.name;var r=document.createElement("div");return n.appendChild(r),r.appendChild(e),r.appendChild(s),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){var t,e,n=this._layerControlInputs,a=[],s=[];this._handlingClick=!0;for(var r=n.length-1;0<=r;r--)t=n[r],e=this._getLayer(t.layerId).layer,t.checked?a.push(e):t.checked||s.push(e);for(r=0;r<s.length;r++)this._map.hasLayer(s[r])&&this._map.removeLayer(s[r]);for(r=0;r<a.length;r++)this._map.hasLayer(a[r])||this._map.addLayer(a[r]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,e,n=this._layerControlInputs,a=this._map.getZoom(),s=n.length-1;0<=s;s--)t=n[s],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&a<e.options.minZoom||void 0!==e.options.maxZoom&&a>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),eZ=eB.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",n=tK("div",e+" leaflet-bar"),a=this.options;return this._zoomInButton=this._createButton(a.zoomInText,a.zoomInTitle,e+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(a.zoomOutText,a.zoomOutTitle,e+"-out",n,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,n,a,s){var r=tK("a",n,a);return r.innerHTML=t,r.href="#",r.title=e,r.setAttribute("role","button"),r.setAttribute("aria-label",e),ex(r),ef(r,"click",eb),ef(r,"click",s,this),ef(r,"click",this._refocusOnMap,this),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";et(this._zoomInButton,e),et(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMinZoom())&&t9(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMaxZoom())&&t9(this._zoomInButton,e)}});eA.mergeOptions({zoomControl:!0}),eA.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new eZ,this.addControl(this.zoomControl))});var eF=eB.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",n=tK("div",e),a=this.options;return this._addScales(a,e+"-line",n),t.on(a.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),n},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,n){t.metric&&(this._mScale=tK("div",e,n)),t.imperial&&(this._iScale=tK("div",e,n))},_update:function(){var t=this._map,e=t.getSize().y/2,n=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(n)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t);this._updateScale(this._mScale,e<1e3?e+" m":e/1e3+" km",e/t)},_updateImperial:function(t){var e,n,a,s=3.2808399*t;5280<s?(e=s/5280,n=this._getRoundNum(e),this._updateScale(this._iScale,n+" mi",n/e)):(a=this._getRoundNum(s),this._updateScale(this._iScale,a+" ft",a/s))},_updateScale:function(t,e,n){t.style.width=Math.round(this.options.maxWidth*n)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n=10<=n?10:5<=n?5:3<=n?3:2<=n?2:1)}}),ej=eB.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){g(this,t),this._attributions={}},onAdd:function(t){for(var e in(t.attributionControl=this)._container=tK("div","leaflet-control-attribution"),ex(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),this._container},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t&&(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update()),this},removeAttribution:function(t){return t&&this._attributions[t]&&(this._attributions[t]--,this._update()),this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var n=[];this.options.prefix&&n.push(this.options.prefix),t.length&&n.push(t.join(", ")),this._container.innerHTML=n.join(" | ")}}});eA.mergeOptions({attributionControl:!0}),eA.addInitHook(function(){this.options.attributionControl&&(new ej).addTo(this)}),eB.Layers=eI,eB.Zoom=eZ,eB.Scale=eF,eB.Attribution=ej,eO.layers=function(t,e,n){return new eI(t,e,n)},eO.zoom=function(t){return new eZ(t)},eO.scale=function(t){return new eF(t)},eO.attribution=function(t){return new ej(t)};var eR=z.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled&&(this._enabled=!1,this.removeHooks()),this},enabled:function(){return!!this._enabled}});eR.addTo=function(t,e){return t.addHandler(e,this),this};var eN,eG=t$?"touchstart mousedown":"mousedown",e0={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},eU={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},eH=W.extend({options:{clickTolerance:3},initialize:function(t,e,n,a){g(this,a),this._element=t,this._dragStartTarget=e||t,this._preventOutline=n},enable:function(){this._enabled||(ef(this._dragStartTarget,eG,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(eH._dragging===this&&this.finishDrag(),ey(this._dragStartTarget,eG,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(!t._simulated&&this._enabled&&(this._moved=!1,!tQ(this._element,"leaflet-zoom-anim")&&!(eH._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||((eH._dragging=this)._preventOutline&&ed(this._element),eh(),tN(),this._moving)))){this.fire("down");var e=t.touches?t.touches[0]:t,n=e8(this._element);this._startPoint=new A(e.clientX,e.clientY),this._parentScale=ep(n),ef(document,eU[t.type],this._onMove,this),ef(document,e0[t.type],this._onUp,this)}},_onMove:function(t){if(!t._simulated&&this._enabled){if(t.touches&&1<t.touches.length)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,n=new A(e.clientX,e.clientY)._subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,e$(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=er(this._element).subtract(n),t9(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),t9(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,M(this._animRequest),this._lastEvent=t,this._animRequest=E(this._updatePosition,this,!0)))}}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),es(this._element,this._newPos),this.fire("drag",t)},_onUp:function(t){!t._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){for(var t in et(document.body,"leaflet-dragging"),this._lastTarget&&(et(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),eU)ey(document,eU[t],this._onMove,this),ey(document,e0[t],this._onUp,this);ec(),tG(),this._moved&&this._moving&&(M(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,eH._dragging=!1}});function eV(t,e){if(!e||!t.length)return t.slice();var n=e*e;return t=function(t,e){var n=t.length,a=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(n);a[0]=a[n-1]=1,function t(e,n,a,s,r){var l,h,c,d=0;for(h=s+1;h<=r-1;h++)c=e2(e[h],e[s],e[r],!0),d<c&&(l=h,d=c);a<d&&(n[l]=1,t(e,n,a,s,l),t(e,n,a,l,r))}(t,a,e,0,n-1);var s,r=[];for(s=0;s<n;s++)a[s]&&r.push(t[s]);return r}(t=function(t,e){for(var n,a,s,r,l=[t[0]],h=1,c=0,d=t.length;h<d;h++)n=t[h],e<(s=(a=t[c]).x-n.x)*s+(r=a.y-n.y)*r&&(l.push(t[h]),c=h);return c<d-1&&l.push(t[d-1]),l}(t,n),n)}function e1(t,e,n){return Math.sqrt(e2(t,e,n,!0))}function e3(t,e,n,a,s){var r,l,h,c=a?eN:e4(t,n),d=e4(e,n);for(eN=d;;){if(!(c|d))return[t,e];if(c&d)return!1;h=e4(l=eq(t,e,r=c||d,n,s),n),r===c?(t=l,c=h):(e=l,d=h)}}function eq(t,e,n,a,s){var r,l,h=e.x-t.x,c=e.y-t.y,d=a.min,u=a.max;return 8&n?(r=t.x+h*(u.y-t.y)/c,l=u.y):4&n?(r=t.x+h*(d.y-t.y)/c,l=d.y):2&n?(r=u.x,l=t.y+c*(u.x-t.x)/h):1&n&&(r=d.x,l=t.y+c*(d.x-t.x)/h),new A(r,l,s)}function e4(t,e){var n=0;return t.x<e.min.x?n|=1:t.x>e.max.x&&(n|=2),t.y<e.min.y?n|=4:t.y>e.max.y&&(n|=8),n}function e2(t,e,n,a){var s,r=e.x,l=e.y,h=n.x-r,c=n.y-l,d=h*h+c*c;return 0<d&&(1<(s=((t.x-r)*h+(t.y-l)*c)/d)?(r=n.x,l=n.y):0<s&&(r+=h*s,l+=c*s)),h=t.x-r,c=t.y-l,a?h*h+c*c:new A(r,l)}function e6(t){return!w(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function eX(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),e6(t)}var eK=(Object.freeze||Object)({simplify:eV,pointToSegmentDistance:e1,closestPointOnSegment:function(t,e,n){return e2(t,e,n)},clipSegment:e3,_getEdgeIntersection:eq,_getBitCode:e4,_sqClosestPointOnSegment:e2,isFlat:e6,_flat:eX});function e5(t,e,n){var a,s,r,l,h,c,d,u,p,m=[1,4,2,8];for(s=0,d=t.length;s<d;s++)t[s]._code=e4(t[s],e);for(l=0;l<4;l++){for(u=m[l],a=[],s=0,r=(d=t.length)-1;s<d;r=s++)h=t[s],c=t[r],h._code&u?c._code&u||((p=eq(c,h,u,e,n))._code=e4(p,e),a.push(p)):(c._code&u&&((p=eq(c,h,u,e,n))._code=e4(p,e),a.push(p)),a.push(h));t=a}return t}var eJ,eY=(Object.freeze||Object)({clipPolygon:e5}),e7={project:function(t){return new A(t.lng,t.lat)},unproject:function(t){return new R(t.y,t.x)},bounds:new I([-180,-90],[180,90])},eQ={R:6378137,R_MINOR:6356752.314245179,bounds:new I([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,n=this.R,a=t.lat*e,s=this.R_MINOR/n,r=Math.sqrt(1-s*s),l=r*Math.sin(a);return a=-n*Math.log(Math.max(Math.tan(Math.PI/4-a/2)/Math.pow((1-l)/(1+l),r/2),1e-10)),new A(t.lng*e*n,a)},unproject:function(t){for(var e,n=180/Math.PI,a=this.R,s=this.R_MINOR/a,r=Math.sqrt(1-s*s),l=Math.exp(-t.y/a),h=Math.PI/2-2*Math.atan(l),c=0,d=.1;c<15&&1e-7<Math.abs(d);c++)e=Math.pow((1-(e=r*Math.sin(h)))/(1+e),r/2),h+=d=Math.PI/2-2*Math.atan(l*e)-h;return new R(h*n,t.x*n/a)}},e9=(Object.freeze||Object)({LonLat:e7,Mercator:eQ,SphericalMercator:V}),it=n({},H,{code:"EPSG:3395",projection:eQ,transformation:X(eJ=.5/(Math.PI*eQ.R),.5,-eJ,.5)}),ie=n({},H,{code:"EPSG:4326",projection:e7,transformation:X(1/180,1,-1/180,.5)}),ii=n({},U,{projection:e7,transformation:X(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var n=e.lng-t.lng,a=e.lat-t.lat;return Math.sqrt(n*n+a*a)},infinite:!0});U.Earth=H,U.EPSG3395=it,U.EPSG3857=J,U.EPSG900913=Y,U.EPSG4326=ie,U.Simple=ii;var io=W.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[h(t)]=this},removeInteractiveTarget:function(t){return delete this._map._targets[h(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var n=this.getEvents();e.on(n,this),this.once("remove",function(){e.off(n,this)},this)}this.onAdd(e),this.getAttribution&&e.attributionControl&&e.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),e.fire("layeradd",{layer:this})}}});eA.include({addLayer:function(t){if(!t._layerAdd)throw Error("The provided object is not a Layer.");var e=h(t);return this._layers[e]||((this._layers[e]=t)._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=h(t);return this._layers[e]&&(this._loaded&&t.onRemove(this),t.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(t.getAttribution()),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null),this},hasLayer:function(t){return!!t&&h(t) in this._layers},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},_addLayers:function(t){for(var e=0,n=(t=t?w(t)?t:[t]:[]).length;e<n;e++)this.addLayer(t[e])},_addZoomLimit:function(t){!isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[h(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=h(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,n=this._getZoomSpan();for(var a in this._zoomBoundLayers){var s=this._zoomBoundLayers[a].options;t=void 0===s.minZoom?t:Math.min(t,s.minZoom),e=void 0===s.maxZoom?e:Math.max(e,s.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var ia=io.extend({initialize:function(t,e){var n,a;if(g(this,e),this._layers={},t)for(n=0,a=t.length;n<a;n++)this.addLayer(t[n])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t) in this._layers)},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,n,a=Array.prototype.slice.call(arguments,1);for(e in this._layers)(n=this._layers[e])[t]&&n[t].apply(n,a);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return h(t)}}),is=ia.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),ia.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),ia.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new F;for(var e in this._layers){var n=this._layers[e];t.extend(n.getBounds?n.getBounds():n.getLatLng())}return t}}),ir=z.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0]},initialize:function(t){g(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var n=this._getIconUrl(t);if(!n){if("icon"===t)throw Error("iconUrl not set in Icon options (see the docs).");return null}var a=this._createImg(n,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(a,t),a},_setIconStyles:function(t,e){var n=this.options,a=n[e+"Size"];"number"==typeof a&&(a=[a,a]);var s=B(a),r=B("shadow"===e&&n.shadowAnchor||n.iconAnchor||s&&s.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(n.className||""),r&&(t.style.marginLeft=-r.x+"px",t.style.marginTop=-r.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return tC&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),il=ir.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return il.imagePath||(il.imagePath=this._detectIconPath()),(this.options.imagePath||il.imagePath)+ir.prototype._getIconUrl.call(this,t)},_detectIconPath:function(){var t=tK("div","leaflet-default-icon-path",document.body),e=tX(t,"background-image")||tX(t,"backgroundImage");return document.body.removeChild(t),e=null===e||0!==e.indexOf("url")?"":e.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")}}),ih=eR.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new eH(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),t9(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&et(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,n=e._map,a=this._marker.options.autoPanSpeed,s=this._marker.options.autoPanPadding,r=er(e._icon),l=n.getPixelBounds(),h=n.getPixelOrigin(),c=Z(l.min._subtract(h).add(s),l.max._subtract(h).subtract(s));if(!c.contains(r)){var d=B((Math.max(c.max.x,r.x)-c.max.x)/(l.max.x-c.max.x)-(Math.min(c.min.x,r.x)-c.min.x)/(l.min.x-c.min.x),(Math.max(c.max.y,r.y)-c.max.y)/(l.max.y-c.max.y)-(Math.min(c.min.y,r.y)-c.min.y)/(l.min.y-c.min.y)).multiplyBy(a);n.panBy(d,{animate:!1}),this._draggable._newPos._add(d),this._draggable._startPos._add(d),es(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=E(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(M(this._panRequest),this._panRequest=E(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,n=e._shadow,a=er(e._icon),s=e._map.layerPointToLatLng(a);n&&es(n,a),e._latlng=s,t.latlng=s,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){M(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),ic=io.extend({options:{icon:new il,interactive:!0,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){g(this,e),this._latlng=N(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=N(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=t.icon.createIcon(this._icon),a=!1;n!==this._icon&&(this._icon&&this._removeIcon(),a=!0,t.title&&(n.title=t.title),"IMG"===n.tagName&&(n.alt=t.alt||"")),t9(n,e),t.keyboard&&(n.tabIndex="0"),this._icon=n,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var s=t.icon.createShadow(this._shadow),r=!1;s!==this._shadow&&(this._removeShadow(),r=!0),s&&(t9(s,e),s.alt=""),this._shadow=s,t.opacity<1&&this._updateOpacity(),a&&this.getPane().appendChild(this._icon),this._initInteraction(),s&&r&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),t5(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&t5(this._shadow),this._shadow=null},_setPos:function(t){es(this._icon,t),this._shadow&&es(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(t9(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),ih)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new ih(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&en(this._icon,t),this._shadow&&en(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}}),id=io.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return g(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t.hasOwnProperty("weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+this._renderer.options.tolerance}}),iu=id.extend({options:{fill:!0,radius:10},initialize:function(t,e){g(this,e),this._latlng=N(t),this._radius=this.options.radius},setLatLng:function(t){return this._latlng=N(t),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return id.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,n=this._clickTolerance(),a=[t+n,e+n];this._pxBounds=new I(this._point.subtract(a),this._point.add(a))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}}),i8=iu.extend({initialize:function(t,e,a){if("number"==typeof e&&(e=n({},a,{radius:e})),g(this,e),this._latlng=N(t),isNaN(this.options.radius))throw Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new F(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:id.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,n=this._map,a=n.options.crs;if(a.distance===H.distance){var s=Math.PI/180,r=this._mRadius/H.R/s,l=n.project([e+r,t]),h=n.project([e-r,t]),c=l.add(h).divideBy(2),d=n.unproject(c).lat,u=Math.acos((Math.cos(r*s)-Math.sin(e*s)*Math.sin(d*s))/(Math.cos(e*s)*Math.cos(d*s)))/s;(isNaN(u)||0===u)&&(u=r/Math.cos(Math.PI/180*e)),this._point=c.subtract(n.getPixelOrigin()),this._radius=isNaN(u)?0:c.x-n.project([d,t-u]).x,this._radiusY=c.y-l.y}else{var p=a.unproject(a.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(p).x}this._updateBounds()}}),ip=id.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){g(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,n,a=1/0,s=null,r=e2,l=0,h=this._parts.length;l<h;l++)for(var c=this._parts[l],d=1,u=c.length;d<u;d++){var p=r(t,e=c[d-1],n=c[d],!0);p<a&&(a=p,s=r(t,e,n))}return s&&(s.distance=Math.sqrt(a)),s},getCenter:function(){if(!this._map)throw Error("Must add layer to map before using getCenter()");var t,e,n,a,s,r,l,h=this._rings[0],c=h.length;if(!c)return null;for(e=t=0;t<c-1;t++)e+=h[t].distanceTo(h[t+1])/2;if(0===e)return this._map.layerPointToLatLng(h[0]);for(a=t=0;t<c-1;t++)if(s=h[t],r=h[t+1],e<(a+=n=s.distanceTo(r)))return l=(a-e)/n,this._map.layerPointToLatLng([r.x-l*(r.x-s.x),r.y-l*(r.y-s.y)])},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=N(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new F,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return e6(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],n=e6(t),a=0,s=t.length;a<s;a++)n?(e[a]=N(t[a]),this._bounds.extend(e[a])):e[a]=this._convertLatLngs(t[a]);return e},_project:function(){var t=new I;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new A(t,t);this._pxBounds=new I([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)])},_projectLatlngs:function(t,e,n){var a,s,r=t[0]instanceof R,l=t.length;if(r){for(s=[],a=0;a<l;a++)s[a]=this._map.latLngToLayerPoint(t[a]),n.extend(s[a]);e.push(s)}else for(a=0;a<l;a++)this._projectLatlngs(t[a],e,n)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)this._parts=this._rings;else{var e,n,a,s,r,l,h,c=this._parts;for(a=e=0,s=this._rings.length;e<s;e++)for(n=0,r=(h=this._rings[e]).length;n<r-1;n++)(l=e3(h[n],h[n+1],t,n,!0))&&(c[a]=c[a]||[],c[a].push(l[0]),l[1]===h[n+1]&&n!==r-2||(c[a].push(l[1]),a++))}}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,n=0,a=t.length;n<a;n++)t[n]=eV(t[n],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var n,a,s,r,l,h,c=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(n=0,r=this._parts.length;n<r;n++)for(a=0,s=(l=(h=this._parts[n]).length)-1;a<l;s=a++)if((e||0!==a)&&e1(t,h[s],h[a])<=c)return!0;return!1}});ip._flat=eX;var im=ip.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw Error("Must add layer to map before using getCenter()");var t,e,n,a,s,r,l,h,c,d=this._rings[0],u=d.length;if(!u)return null;for(r=l=h=0,t=0,e=u-1;t<u;e=t++)n=d[t],a=d[e],s=n.y*a.x-a.y*n.x,l+=(n.x+a.x)*s,h+=(n.y+a.y)*s,r+=3*s;return c=0===r?d[0]:[l/r,h/r],this._map.layerPointToLatLng(c)},_convertLatLngs:function(t){var e=ip.prototype._convertLatLngs.call(this,t),n=e.length;return 2<=n&&e[0]instanceof R&&e[0].equals(e[n-1])&&e.pop(),e},_setLatLngs:function(t){ip.prototype._setLatLngs.call(this,t),e6(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return e6(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,n=new A(e,e);if(t=new I(t.min.subtract(n),t.max.add(n)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)this._parts=this._rings;else for(var a,s=0,r=this._rings.length;s<r;s++)(a=e5(this._rings[s],t,!0)).length&&this._parts.push(a)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,n,a,s,r,l,h,c,d=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(s=0,h=this._parts.length;s<h;s++)for(r=0,l=(c=(e=this._parts[s]).length)-1;r<c;l=r++)n=e[r],a=e[l],n.y>t.y!=a.y>t.y&&t.x<(a.x-n.x)*(t.y-n.y)/(a.y-n.y)+n.x&&(d=!d);return d||ip.prototype._containsPoint.call(this,t,!0)}}),ig=is.extend({initialize:function(t,e){g(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,n,a,s=w(t)?t:t.features;if(s){for(e=0,n=s.length;e<n;e++)((a=s[e]).geometries||a.geometry||a.features||a.coordinates)&&this.addData(a);return this}var r=this.options;if(r.filter&&!r.filter(t))return this;var l=iy(t,r);return l?(l.feature=i$(t),l.defaultOptions=l.options,this.resetStyle(l),r.onEachFeature&&r.onEachFeature(t,l),this.addLayer(l)):this},resetStyle:function(t){return t.options=n({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){t.setStyle&&("function"==typeof e&&(e=e(t.feature)),t.setStyle(e))}});function iy(t,e){var n,a,s,r,l="Feature"===t.type?t.geometry:t,h=l?l.coordinates:null,c=[],d=e&&e.pointToLayer,u=e&&e.coordsToLatLng||iv;if(!h&&!l)return null;switch(l.type){case"Point":return n=u(h),d?d(t,n):new ic(n);case"MultiPoint":for(s=0,r=h.length;s<r;s++)n=u(h[s]),c.push(d?d(t,n):new ic(n));return new is(c);case"LineString":case"MultiLineString":return a=iL(h,"LineString"===l.type?0:1,u),new ip(a,e);case"Polygon":case"MultiPolygon":return a=iL(h,"Polygon"===l.type?1:2,u),new im(a,e);case"GeometryCollection":for(s=0,r=l.geometries.length;s<r;s++){var p=iy({geometry:l.geometries[s],type:"Feature",properties:t.properties},e);p&&c.push(p)}return new is(c);default:throw Error("Invalid GeoJSON object.")}}function iv(t){return new R(t[1],t[0],t[2])}function iL(t,e,n){for(var a,s=[],r=0,l=t.length;r<l;r++)a=e?iL(t[r],e-1,n):(n||iv)(t[r]),s.push(a);return s}function ik(t,e){return e="number"==typeof e?e:6,void 0!==t.alt?[p(t.lng,e),p(t.lat,e),p(t.alt,e)]:[p(t.lng,e),p(t.lat,e)]}function iw(t,e,n,a){for(var s=[],r=0,l=t.length;r<l;r++)s.push(e?iw(t[r],e-1,n,a):ik(t[r],a));return!e&&n&&s.push(s[0]),s}function ix(t,e){return t.feature?n({},t.feature,{geometry:e}):i$(e)}function i$(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}var ib={toGeoJSON:function(t){return ix(this,{type:"Point",coordinates:ik(this.getLatLng(),t)})}};function iC(t,e){return new ig(t,e)}ic.include(ib),i8.include(ib),iu.include(ib),ip.include({toGeoJSON:function(t){var e=!e6(this._latlngs);return ix(this,{type:(e?"Multi":"")+"LineString",coordinates:iw(this._latlngs,e?1:0,!1,t)})}}),im.include({toGeoJSON:function(t){var e=!e6(this._latlngs),n=e&&!e6(this._latlngs[0]),a=iw(this._latlngs,n?2:e?1:0,!0,t);return e||(a=[a]),ix(this,{type:(n?"Multi":"")+"Polygon",coordinates:a})}}),ia.include({toMultiPoint:function(t){var e=[];return this.eachLayer(function(n){e.push(n.toGeoJSON(t).geometry.coordinates)}),ix(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var n="GeometryCollection"===e,a=[];return this.eachLayer(function(e){if(e.toGeoJSON){var s=e.toGeoJSON(t);if(n)a.push(s.geometry);else{var r=i$(s);"FeatureCollection"===r.type?a.push.apply(a,r.features):a.push(r)}}}),n?ix(this,{geometries:a,type:"GeometryCollection"}):{type:"FeatureCollection",features:a}}});var iP=io.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,n){this._url=t,this._bounds=j(e),g(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(t9(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){t5(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&tY(this._image),this},bringToBack:function(){return this._map&&t7(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=j(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:tK("img");t9(e,"leaflet-image-layer"),this._zoomAnimated&&t9(e,"leaflet-zoom-animated"),this.options.className&&t9(e,this.options.className),e.onselectstart=u,e.onmousemove=u,e.onload=r(this.fire,this,"load"),e.onerror=r(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;ea(this._image,n,e)},_reset:function(){var t=this._image,e=new I(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=e.getSize();es(t,e.min),t.style.width=n.x+"px",t.style.height=n.y+"px"},_updateOpacity:function(){en(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)}}),i_=iP.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:tK("video");if(t9(e,"leaflet-image-layer"),this._zoomAnimated&&t9(e,"leaflet-zoom-animated"),e.onselectstart=u,e.onmousemove=u,e.onloadeddata=r(this.fire,this,"load"),t){for(var n=e.getElementsByTagName("source"),a=[],s=0;s<n.length;s++)a.push(n[s].src);this._url=0<n.length?a:[e.src]}else{w(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&e.style.hasOwnProperty("objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop;for(var l=0;l<this._url.length;l++){var h=tK("source");h.src=this._url[l],e.appendChild(h)}}}}),iT=iP.extend({_initImage:function(){var t=this._image=this._url;t9(t,"leaflet-image-layer"),this._zoomAnimated&&t9(t,"leaflet-zoom-animated"),t.onselectstart=u,t.onmousemove=u}}),iE=io.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(t,e){g(this,t),this._source=e},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&en(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&en(this._container,1),this.bringToFront()},onRemove:function(t){t._fadeAnimated?(en(this._container,0),this._removeTimeout=setTimeout(r(t5,void 0,this._container),200)):t5(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=N(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&tY(this._container),this},bringToBack:function(){return this._map&&t7(this._container),this},_prepareOpen:function(t,e,n){if(e instanceof io||(n=e,e=t),e instanceof is)for(var a in t._layers){e=t._layers[a];break}if(!n){if(e.getCenter)n=e.getCenter();else{if(!e.getLatLng)throw Error("Unable to get source layer LatLng.");n=e.getLatLng()}}return this._source=e,this.update(),n},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=B(this.options.offset),n=this._getAnchor();this._zoomAnimated?es(this._container,t.add(n)):e=e.add(t).add(n);var a=this._containerBottom=-e.y,s=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=a+"px",this._container.style.left=s+"px"}},_getAnchor:function(){return[0,0]}}),iM=iE.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t.openPopup(this),this},onAdd:function(t){iE.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof id||this._source.on("preclick",ek))},onRemove:function(t){iE.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof id||this._source.off("preclick",ek))},getEvents:function(){var t=iE.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t="leaflet-popup",e=this._container=tK("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=tK("div",t+"-content-wrapper",e);if(this._contentNode=tK("div",t+"-content",n),ex(n),ew(this._contentNode),ef(n,"contextmenu",ek),this._tipContainer=tK("div",t+"-tip-container",e),this._tip=tK("div",t+"-tip",this._tipContainer),this.options.closeButton){var a=this._closeButton=tK("a",t+"-close-button",e);a.href="#close",a.innerHTML="&#215;",ef(a,"click",this._onCloseButtonClick,this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var n=t.offsetWidth;n=Math.max(n=Math.min(n,this.options.maxWidth),this.options.minWidth),e.width=n+1+"px",e.whiteSpace="",e.height="";var a=t.offsetHeight,s=this.options.maxHeight,r="leaflet-popup-scrolled";s&&s<a?(e.height=s+"px",t9(t,r)):et(t,r),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),n=this._getAnchor();es(this._container,e.add(n))},_adjustPan:function(){if(this.options.autoPan){this._map._panAnim&&this._map._panAnim.stop();var t=this._map,e=parseInt(tX(this._container,"marginBottom"),10)||0,n=this._container.offsetHeight+e,a=this._containerWidth,s=new A(this._containerLeft,-n-this._containerBottom);s._add(er(this._container));var r=t.layerPointToContainerPoint(s),l=B(this.options.autoPanPadding),h=B(this.options.autoPanPaddingTopLeft||l),c=B(this.options.autoPanPaddingBottomRight||l),d=t.getSize(),u=0,p=0;r.x+a+c.x>d.x&&(u=r.x+a-d.x+c.x),r.x-u-h.x<0&&(u=r.x-h.x),r.y+n+c.y>d.y&&(p=r.y+n-d.y+c.y),r.y-p-h.y<0&&(p=r.y-h.y),(u||p)&&t.fire("autopanstart").panBy([u,p])}},_onCloseButtonClick:function(t){this._close(),eb(t)},_getAnchor:function(){return B(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});eA.mergeOptions({closePopupOnClick:!0}),eA.include({openPopup:function(t,e,n){return t instanceof iM||(t=new iM(n).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=t,this.addLayer(t))},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&this.removeLayer(t),this}}),io.include({bindPopup:function(t,e){return t instanceof iM?(g(t,e),(this._popup=t)._source=this):(this._popup&&!e||(this._popup=new iM(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t,e){return this._popup&&this._map&&(e=this._popup._prepareOpen(this,t,e),this._map.openPopup(this._popup,e)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(t){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(t)),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){var e=t.layer||t.target;this._popup&&this._map&&(eb(t),e instanceof id?this.openPopup(t.layer||t.target,t.latlng):this._map.hasLayer(this._popup)&&this._popup._source===e?this.closePopup():this.openPopup(e,t.latlng))},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var iS=iE.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(t){iE.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(t){iE.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=iE.prototype.getEvents.call(this);return t$&&!this.options.permanent&&(t.preclick=this._close),t},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=tK("div",t)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e=this._map,n=this._container,a=e.latLngToContainerPoint(e.getCenter()),s=e.layerPointToContainerPoint(t),r=this.options.direction,l=n.offsetWidth,h=n.offsetHeight,c=B(this.options.offset),d=this._getAnchor();t="top"===r?t.add(B(-l/2+c.x,-h+c.y+d.y,!0)):"bottom"===r?t.subtract(B(l/2-c.x,-c.y,!0)):"center"===r?t.subtract(B(l/2+c.x,h/2-d.y+c.y,!0)):"right"===r||"auto"===r&&s.x<a.x?(r="right",t.add(B(c.x+d.x,d.y-h/2+c.y,!0))):(r="left",t.subtract(B(l+d.x-c.x,h/2-d.y-c.y,!0))),et(n,"leaflet-tooltip-right"),et(n,"leaflet-tooltip-left"),et(n,"leaflet-tooltip-top"),et(n,"leaflet-tooltip-bottom"),t9(n,"leaflet-tooltip-"+r),es(n,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&en(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return B(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});eA.include({openTooltip:function(t,e,n){return t instanceof iS||(t=new iS(n).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&&this.removeLayer(t),this}}),io.include({bindTooltip:function(t,e){return t instanceof iS?(g(t,e),(this._tooltip=t)._source=this):(this._tooltip&&!e||(this._tooltip=new iS(e,this)),this._tooltip.setContent(t)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?e.add=this._openTooltip:(e.mouseover=this._openTooltip,e.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(e.mousemove=this._moveTooltip),t$&&(e.click=this._openTooltip)),this[t?"off":"on"](e),this._tooltipHandlersAdded=!t}},openTooltip:function(t,e){return this._tooltip&&this._map&&(e=this._tooltip._prepareOpen(this,t,e),this._map.openTooltip(this._tooltip,e),this._tooltip.options.interactive&&this._tooltip._container&&(t9(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(et(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var e=t.layer||t.target;this._tooltip&&this._map&&this.openTooltip(e,this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,n,a=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),n=this._map.containerPointToLayerPoint(e),a=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(a)}});var iz=ir.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),n=this.options;if(n.html instanceof Element?(tJ(e),e.appendChild(n.html)):e.innerHTML=!1!==n.html?n.html:"",n.bgPos){var a=B(n.bgPos);e.style.backgroundPosition=-a.x+"px "+-a.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});ir.Default=il;var iD=io.extend({options:{tileSize:256,opacity:1,updateWhenIdle:tk,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){g(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),t5(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(tY(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(t7(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof A?t:new A(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,n=this.getPane().children,a=-t(-1/0,1/0),s=0,r=n.length;s<r;s++)e=n[s].style.zIndex,n[s]!==this._container&&e&&(a=t(a,+e));isFinite(a)&&(this.options.zIndex=a+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!tn){en(this._container,this.options.opacity);var t=+new Date,e=!1,n=!1;for(var a in this._tiles){var s=this._tiles[a];if(s.current&&s.loaded){var r=Math.min(1,(t-s.loaded)/200);en(s.el,r),r<1?e=!0:(s.active?n=!0:this._onOpaqueTile(s),s.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),e&&(M(this._fadeFrame),this._fadeFrame=E(this._updateOpacity,this))}},_onOpaqueTile:u,_initContainer:function(){this._container||(this._container=tK("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var n in this._levels)this._levels[n].el.children.length||n===t?(this._levels[n].el.style.zIndex=e-Math.abs(t-n),this._onUpdateLevel(n)):(t5(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var a=this._levels[t],s=this._map;return a||((a=this._levels[t]={}).el=tK("div","leaflet-tile-container leaflet-zoom-animated",this._container),a.el.style.zIndex=e,a.origin=s.project(s.unproject(s.getPixelOrigin()),t).round(),a.zoom=t,this._setZoomTransform(a,s.getCenter(),s.getZoom()),a.el.offsetWidth,this._onCreateLevel(a)),this._level=a}},_onUpdateLevel:u,_onRemoveLevel:u,_onCreateLevel:u,_pruneTiles:function(){if(this._map){var t,e,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var a=e.coords;this._retainParent(a.x,a.y,a.z,a.z-5)||this._retainChildren(a.x,a.y,a.z,a.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)t5(this._levels[t].el),this._onRemoveLevel(t),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,n,a){var s=Math.floor(t/2),r=Math.floor(e/2),l=n-1,h=new A(+s,+r);h.z=+l;var c=this._tileCoordsToKey(h),d=this._tiles[c];return d&&d.active?d.retain=!0:(d&&d.loaded&&(d.retain=!0),a<l&&this._retainParent(s,r,l,a))},_retainChildren:function(t,e,n,a){for(var s=2*t;s<2*t+2;s++)for(var r=2*e;r<2*e+2;r++){var l=new A(s,r);l.z=n+1;var h=this._tileCoordsToKey(l),c=this._tiles[h];c&&c.active?c.retain=!0:(c&&c.loaded&&(c.retain=!0),n+1<a&&this._retainChildren(s,r,n+1,a))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,n,a){var s=this._clampZoom(Math.round(e));(void 0!==this.options.maxZoom&&s>this.options.maxZoom||void 0!==this.options.minZoom&&s<this.options.minZoom)&&(s=void 0);var r=this.options.updateWhenZooming&&s!==this._tileZoom;a&&!r||(this._tileZoom=s,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==s&&this._update(t),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var n in this._levels)this._setZoomTransform(this._levels[n],t,e)},_setZoomTransform:function(t,e,n){var a=this._map.getZoomScale(n,t.zoom),s=t.origin.multiplyBy(a).subtract(this._map._getNewPixelOrigin(e,n)).round();tL?ea(t.el,s,a):es(t.el,s)},_resetGrid:function(){var t=this._map,e=t.options.crs,n=this._tileSize=this.getTileSize(),a=this._tileZoom,s=this._map.getPixelWorldBounds(this._tileZoom);s&&(this._globalTileRange=this._pxBoundsToTileRange(s)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],a).x/n.x),Math.ceil(t.project([0,e.wrapLng[1]],a).x/n.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],a).y/n.x),Math.ceil(t.project([e.wrapLat[1],0],a).y/n.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,n=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),a=e.getZoomScale(n,this._tileZoom),s=e.project(t,this._tileZoom).floor(),r=e.getSize().divideBy(2*a);return new I(s.subtract(r),s.add(r))},_update:function(t){var e=this._map;if(e){var n=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var a=this._getTiledPixelBounds(t),s=this._pxBoundsToTileRange(a),r=s.getCenter(),l=[],h=this.options.keepBuffer,c=new I(s.getBottomLeft().subtract([h,-h]),s.getTopRight().add([h,-h]));if(!(isFinite(s.min.x)&&isFinite(s.min.y)&&isFinite(s.max.x)&&isFinite(s.max.y)))throw Error("Attempted to load an infinite number of tiles");for(var d in this._tiles){var u=this._tiles[d].coords;u.z===this._tileZoom&&c.contains(new A(u.x,u.y))||(this._tiles[d].current=!1)}if(1<Math.abs(n-this._tileZoom))this._setView(t,n);else{for(var p=s.min.y;p<=s.max.y;p++)for(var m=s.min.x;m<=s.max.x;m++){var f=new A(m,p);if(f.z=this._tileZoom,this._isValidTile(f)){var g=this._tiles[this._tileCoordsToKey(f)];g?g.current=!0:l.push(f)}}if(l.sort(function(t,e){return t.distanceTo(r)-e.distanceTo(r)}),0!==l.length){this._loading||(this._loading=!0,this.fire("loading"));var y=document.createDocumentFragment();for(m=0;m<l.length;m++)this._addTile(l[m],y);this._level.el.appendChild(y)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var n=this._globalTileRange;if(!e.wrapLng&&(t.x<n.min.x||t.x>n.max.x)||!e.wrapLat&&(t.y<n.min.y||t.y>n.max.y))return!1}if(!this.options.bounds)return!0;var a=this._tileCoordsToBounds(t);return j(this.options.bounds).overlaps(a)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,n=this.getTileSize(),a=t.scaleBy(n),s=a.add(n);return[e.unproject(a,t.z),e.unproject(s,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),n=new F(e[0],e[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),n=new A(+e[0],+e[1]);return n.z=+e[2],n},_removeTile:function(t){var e=this._tiles[t];e&&(t5(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){t9(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=u,t.onmousemove=u,tn&&this.options.opacity<1&&en(t,this.options.opacity),ts&&!tr&&(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,e){var n=this._getTilePos(t),a=this._tileCoordsToKey(t),s=this.createTile(this._wrapCoords(t),r(this._tileReady,this,t));this._initTile(s),this.createTile.length<2&&E(r(this._tileReady,this,t,null,s)),es(s,n),this._tiles[a]={el:s,coords:t,current:!0},e.appendChild(s),this.fire("tileloadstart",{tile:s,coords:t})},_tileReady:function(t,e,n){e&&this.fire("tileerror",{error:e,tile:n,coords:t});var a=this._tileCoordsToKey(t);(n=this._tiles[a])&&(n.loaded=+new Date,this._map._fadeAnimated?(en(n.el,0),M(this._fadeFrame),this._fadeFrame=E(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),e||(t9(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),tn||!this._map._fadeAnimated?E(this._pruneTiles,this):setTimeout(r(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new A(this._wrapX?d(t.x,this._wrapX):t.x,this._wrapY?d(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new I(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),iW=iD.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(t,e){this._url=t,(e=g(this,e)).detectRetina&&tC&&0<e.maxZoom&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom++):(e.zoomOffset++,e.maxZoom--),e.minZoom=Math.max(0,e.minZoom)),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),ts||this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var n=document.createElement("img");return ef(n,"load",r(this._tileOnLoad,this,e,n)),ef(n,"error",r(this._tileOnError,this,e,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),n.alt="",n.setAttribute("role","presentation"),n.src=this.getTileUrl(t),n},getTileUrl:function(t){var e={r:tC?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var a=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=a),e["-y"]=a}return k(this._url,n(e,this.options))},_tileOnLoad:function(t,e){tn?setTimeout(r(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,n){var a=this.options.errorTileUrl;a&&e.getAttribute("src")!==a&&(e.src=a),t(n,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=u,e.onerror=u,e.complete||(e.src=$,t5(e),delete this._tiles[t]))},_removeTile:function(t){var e=this._tiles[t];if(e)return th||e.el.setAttribute("src",$),iD.prototype._removeTile.call(this,t)},_tileReady:function(t,e,n){if(this._map&&(!n||n.getAttribute("src")!==$))return iD.prototype._tileReady.call(this,t,e,n)}});function iA(t,e){return new iW(t,e)}var iO=iW.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var a=n({},this.defaultWmsParams);for(var s in e)s in this.options||(a[s]=e[s]);var r=(e=g(this,e)).detectRetina&&tC?2:1,l=this.getTileSize();a.width=l.x*r,a.height=l.y*r,this.wmsParams=a},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=1.3<=this._wmsVersion?"crs":"srs";this.wmsParams[e]=this._crs.code,iW.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),n=this._crs,a=Z(n.project(e[0]),n.project(e[1])),s=a.min,r=a.max,l=(1.3<=this._wmsVersion&&this._crs===ie?[s.y,s.x,r.y,r.x]:[s.x,s.y,r.x,r.y]).join(","),h=iW.prototype.getTileUrl.call(this,t);return h+y(this.wmsParams,h,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+l},setParams:function(t,e){return n(this.wmsParams,t),e||this.redraw(),this}});iW.WMS=iO,iA.wms=function(t,e){return new iO(t,e)};var iB=io.extend({options:{padding:.1,tolerance:0},initialize:function(t){g(this,t),h(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&t9(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var n=this._map.getZoomScale(e,this._zoom),a=er(this._container),s=this._map.getSize().multiplyBy(.5+this.options.padding),r=this._map.project(this._center,e),l=this._map.project(t,e).subtract(r),h=s.multiplyBy(-n).add(a).add(s).subtract(l);tL?ea(this._container,h,n):es(this._container,h)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),n=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new I(n,n.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),iI=iB.extend({getEvents:function(){var t=iB.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){iB.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");ef(t,"mousemove",c(this._onMouseMove,32,this),this),ef(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ef(t,"mouseout",this._handleMouseOut,this),this._ctx=t.getContext("2d")},_destroyContainer:function(){M(this._redrawRequest),delete this._ctx,t5(this._container),ey(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){iB.prototype._update.call(this);var t=this._bounds,e=this._container,n=t.getSize(),a=tC?2:1;es(e,t.min),e.width=a*n.x,e.height=a*n.y,e.style.width=n.x+"px",e.style.height=n.y+"px",tC&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){iB.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t);var e=(this._layers[h(t)]=t)._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,n=e.next,a=e.prev;n?n.prev=a:this._drawLast=a,a?a.next=n:this._drawFirst=n,delete t._order,delete this._layers[h(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,n,a=t.options.dashArray.split(/[, ]+/),s=[];for(n=0;n<a.length;n++){if(isNaN(e=Number(a[n])))return;s.push(e)}t.options._dashArray=s}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||E(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new I,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.clearRect(0,0,this._container.width,this._container.height)},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var n=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var a=this._drawFirst;a;a=a.next)t=a.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var n,a,s,r,l=t._parts,h=l.length,c=this._ctx;if(h){for(c.beginPath(),n=0;n<h;n++){for(a=0,s=l[n].length;a<s;a++)r=l[n][a],c[a?"lineTo":"moveTo"](r.x,r.y);e&&c.closePath()}this._fillStroke(c,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,n=this._ctx,a=Math.max(Math.round(t._radius),1),s=(Math.max(Math.round(t._radiusY),1)||a)/a;1!=s&&(n.save(),n.scale(1,s)),n.beginPath(),n.arc(e.x,e.y/s,a,0,2*Math.PI,!1),1!=s&&n.restore(),this._fillStroke(n,t)}},_fillStroke:function(t,e){var n=e.options;n.fill&&(t.globalAlpha=n.fillOpacity,t.fillStyle=n.fillColor||n.color,t.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=n.opacity,t.lineWidth=n.weight,t.strokeStyle=n.color,t.lineCap=n.lineCap,t.lineJoin=n.lineJoin,t.stroke())},_onClick:function(t){for(var e,n,a=this._map.mouseEventToLayerPoint(t),s=this._drawFirst;s;s=s.next)(e=s.layer).options.interactive&&e._containsPoint(a)&&!this._map._draggableMoved(e)&&(n=e);n&&(eM(t),this._fireEvent([n],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(et(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(t,e){for(var n,a,s=this._drawFirst;s;s=s.next)(n=s.layer).options.interactive&&n._containsPoint(e)&&(a=n);a!==this._hoveredLayer&&(this._handleMouseOut(t),a&&(t9(this._container,"leaflet-interactive"),this._fireEvent([a],t,"mouseover"),this._hoveredLayer=a)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t)},_fireEvent:function(t,e,n){this._map._fireDOMEvent(e,n||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var n=e.next,a=e.prev;n&&((n.prev=a)?a.next=n:n&&(this._drawFirst=n),e.prev=this._drawLast,(this._drawLast.next=e).next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var n=e.next,a=e.prev;a&&((a.next=n)?n.prev=a:a&&(this._drawLast=a),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}});function iZ(t){return tP?new iI(t):null}var iF=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),ij=tT?iF:Q,iR=iB.extend({getEvents:function(){var t=iB.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_initContainer:function(){this._container=ij("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=ij("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){t5(this._container),ey(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){iB.prototype._update.call(this);var t=this._bounds,e=t.getSize(),n=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,n.setAttribute("width",e.x),n.setAttribute("height",e.y)),es(n,t.min),n.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=ij("path");t.options.className&&t9(e,t.options.className),t.options.interactive&&t9(e,"leaflet-interactive"),this._updateStyle(t),this._layers[h(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){t5(t._path),t.removeInteractiveTarget(t._path),delete this._layers[h(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,n=t.options;e&&(n.stroke?(e.setAttribute("stroke",n.color),e.setAttribute("stroke-opacity",n.opacity),e.setAttribute("stroke-width",n.weight),e.setAttribute("stroke-linecap",n.lineCap),e.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?e.setAttribute("stroke-dasharray",n.dashArray):e.removeAttribute("stroke-dasharray"),n.dashOffset?e.setAttribute("stroke-dashoffset",n.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),n.fill?(e.setAttribute("fill",n.fillColor||n.color),e.setAttribute("fill-opacity",n.fillOpacity),e.setAttribute("fill-rule",n.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,tt(t._parts,e))},_updateCircle:function(t){var e=t._point,n=Math.max(Math.round(t._radius),1),a="a"+n+","+(Math.max(Math.round(t._radiusY),1)||n)+" 0 1,0 ",s=t._empty()?"M0 0":"M"+(e.x-n)+","+e.y+a+2*n+",0 "+a+-(2*n)+",0 ";this._setPath(t,s)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){tY(t._path)},_bringToBack:function(t){t7(t._path)}});function iN(t){return t_||tT?new iR(t):null}tT&&iR.include({_initContainer:function(){this._container=tK("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(iB.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=iF("shape");t9(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=iF("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[h(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;t5(e),t.removeInteractiveTarget(e),delete this._layers[h(t)]},_updateStyle:function(t){var e=t._stroke,n=t._fill,a=t.options,s=t._container;s.stroked=!!a.stroke,s.filled=!!a.fill,a.stroke?(e||(e=t._stroke=iF("stroke")),s.appendChild(e),e.weight=a.weight+"px",e.color=a.color,e.opacity=a.opacity,a.dashArray?e.dashStyle=w(a.dashArray)?a.dashArray.join(" "):a.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=a.lineCap.replace("butt","flat"),e.joinstyle=a.lineJoin):e&&(s.removeChild(e),t._stroke=null),a.fill?(n||(n=t._fill=iF("fill")),s.appendChild(n),n.color=a.fillColor||a.color,n.opacity=a.fillOpacity):n&&(s.removeChild(n),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),n=Math.round(t._radius),a=Math.round(t._radiusY||n);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+n+","+a+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){tY(t._container)},_bringToBack:function(t){t7(t._container)}}),eA.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&iZ(t)||iN(t)}});var iG=im.extend({initialize:function(t,e){im.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=j(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});iR.create=ij,iR.pointsToPath=tt,ig.geometryToLayer=iy,ig.coordsToLatLng=iv,ig.coordsToLatLngs=iL,ig.latLngToCoords=ik,ig.latLngsToCoords=iw,ig.getFeature=ix,ig.asFeature=i$,eA.mergeOptions({boxZoom:!0});var i0=eR.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){ef(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){ey(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){t5(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),tN(),eh(),this._startPoint=this._map.mouseEventToContainerPoint(t),ef(document,{contextmenu:eb,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=tK("div","leaflet-zoom-box",this._container),t9(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new I(this._point,this._startPoint),n=e.getSize();es(this._box,e.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(t5(this._box),et(this._container,"leaflet-crosshair")),tG(),ec(),ey(document,{contextmenu:eb,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(r(this._resetState,this),0);var e=new F(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}});eA.addInitHook("addHandler","boxZoom",i0),eA.mergeOptions({doubleClickZoom:!0});var iU=eR.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,n=e.getZoom(),a=e.options.zoomDelta,s=t.originalEvent.shiftKey?n-a:n+a;"center"===e.options.doubleClickZoom?e.setZoom(s):e.setZoomAround(t.containerPoint,s)}});eA.addInitHook("addHandler","doubleClickZoom",iU),eA.mergeOptions({dragging:!0,inertia:!tr,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var iH=eR.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new eH(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}t9(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){et(this._map._container,"leaflet-grab"),et(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=j(this._map.options.maxBounds);this._offsetLimit=Z(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;1<this._positions.length&&50<t-this._times[0];)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),n=this._initialWorldOffset,a=this._draggable._newPos.x,s=(a-e+n)%t+e-n,r=(a+e+n)%t-e-n;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Math.abs(s+n)<Math.abs(r+n)?s:r},_onDragEnd:function(t){var e=this._map,n=e.options,a=!n.inertia||this._times.length<2;if(e.fire("dragend",t),a)e.fire("moveend");else{this._prunePositions(+new Date);var s=this._lastPos.subtract(this._positions[0]),r=(this._lastTime-this._times[0])/1e3,l=n.easeLinearity,h=s.multiplyBy(l/r),c=h.distanceTo([0,0]),d=Math.min(n.inertiaMaxSpeed,c),u=h.multiplyBy(d/c),p=d/(n.inertiaDeceleration*l),m=u.multiplyBy(-p/2).round();m.x||m.y?(m=e._limitOffset(m,e.options.maxBounds),E(function(){e.panBy(m,{duration:p,easeLinearity:l,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}});eA.addInitHook("addHandler","dragging",iH),eA.mergeOptions({keyboard:!0,keyboardPanDelta:80});var iV=eR.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),ef(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),ey(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,n=t.scrollTop||e.scrollTop,a=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(a,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,n,a=this._panKeys={},s=this.keyCodes;for(e=0,n=s.left.length;e<n;e++)a[s.left[e]]=[-1*t,0];for(e=0,n=s.right.length;e<n;e++)a[s.right[e]]=[t,0];for(e=0,n=s.down.length;e<n;e++)a[s.down[e]]=[0,t];for(e=0,n=s.up.length;e<n;e++)a[s.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,n,a=this._zoomKeys={},s=this.keyCodes;for(e=0,n=s.zoomIn.length;e<n;e++)a[s.zoomIn[e]]=t;for(e=0,n=s.zoomOut.length;e<n;e++)a[s.zoomOut[e]]=-t},_addHooks:function(){ef(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){ey(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,n=t.keyCode,a=this._map;if(n in this._panKeys)a._panAnim&&a._panAnim._inProgress||(e=this._panKeys[n],t.shiftKey&&(e=B(e).multiplyBy(3)),a.panBy(e),a.options.maxBounds&&a.panInsideBounds(a.options.maxBounds));else if(n in this._zoomKeys)a.setZoom(a.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n||!a._popup||!a._popup.options.closeOnEscapeKey)return;a.closePopup()}eb(t)}}});eA.addInitHook("addHandler","keyboard",iV),eA.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var i1=eR.extend({addHooks:function(){ef(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){ey(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=e_(t),n=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var a=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(r(this._performZoom,this),a),eb(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),n=this._map.options.zoomSnap||0;t._stop();var a=4*Math.log(2/(1+Math.exp(-Math.abs(this._delta/(4*this._map.options.wheelPxPerZoomLevel)))))/Math.LN2,s=n?Math.ceil(a/n)*n:a,r=t._limitZoom(e+(0<this._delta?s:-s))-e;this._delta=0,this._startTime=null,r&&("center"===t.options.scrollWheelZoom?t.setZoom(e+r):t.setZoomAround(this._lastMousePos,e+r))}});eA.addInitHook("addHandler","scrollWheelZoom",i1),eA.mergeOptions({tap:!0,tapTolerance:15});var i3=eR.extend({addHooks:function(){ef(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ey(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(e$(t),this._fireClick=!0,1<t.touches.length)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var e=t.touches[0],n=e.target;this._startPos=this._newPos=new A(e.clientX,e.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&t9(n,"leaflet-active"),this._holdTimeout=setTimeout(r(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",e))},this),1e3),this._simulateEvent("mousedown",e),ef(document,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),ey(document,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&t&&t.changedTouches){var e=t.changedTouches[0],n=e.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&et(n,"leaflet-active"),this._simulateEvent("mouseup",e),this._isTapValid()&&this._simulateEvent("click",e)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new A(e.clientX,e.clientY),this._simulateEvent("mousemove",e)},_simulateEvent:function(t,e){var n=document.createEvent("MouseEvents");n._simulated=!0,e.target._simulatedClick=!0,n.initMouseEvent(t,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(n)}});t$&&!tx&&eA.addInitHook("addHandler","tap",i3),eA.mergeOptions({touchZoom:t$&&!tr,bounceAtZoomLimits:!0});var iq=eR.extend({addHooks:function(){t9(this._map._container,"leaflet-touch-zoom"),ef(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){et(this._map._container,"leaflet-touch-zoom"),ey(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var n=e.mouseEventToContainerPoint(t.touches[0]),a=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(n.add(a)._divideBy(2))),this._startDist=n.distanceTo(a),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),ef(document,"touchmove",this._onTouchMove,this),ef(document,"touchend",this._onTouchEnd,this),e$(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,n=e.mouseEventToContainerPoint(t.touches[0]),a=e.mouseEventToContainerPoint(t.touches[1]),s=n.distanceTo(a)/this._startDist;if(this._zoom=e.getScaleZoom(s,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&s<1||this._zoom>e.getMaxZoom()&&1<s)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1==s)return}else{var l=n._add(a)._divideBy(2)._subtract(this._centerPoint);if(1==s&&0===l.x&&0===l.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(l),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),M(this._animRequest);var h=r(e._move,e,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=E(h,this,!0),e$(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,M(this._animRequest),ey(document,"touchmove",this._onTouchMove),ey(document,"touchend",this._onTouchEnd),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});eA.addInitHook("addHandler","touchZoom",iq),eA.BoxZoom=i0,eA.DoubleClickZoom=iU,eA.Drag=iH,eA.Keyboard=iV,eA.ScrollWheelZoom=i1,eA.Tap=i3,eA.TouchZoom=iq,Object.freeze=e,t.version="1.5.1+HEAD.2e3e0ff",t.Control=eB,t.control=eO,t.Browser=tM,t.Evented=W,t.Mixin={Events:D},t.Util=S,t.Class=z,t.Handler=eR,t.extend=n,t.bind=r,t.stamp=h,t.setOptions=g,t.DomEvent=eD,t.DomUtil=em,t.PosAnimation=eW,t.Draggable=eH,t.LineUtil=eK,t.PolyUtil=eY,t.Point=A,t.point=B,t.Bounds=I,t.bounds=Z,t.Transformation=q,t.transformation=X,t.Projection=e9,t.LatLng=R,t.latLng=N,t.LatLngBounds=F,t.latLngBounds=j,t.CRS=U,t.GeoJSON=ig,t.geoJSON=iC,t.geoJson=iC,t.Layer=io,t.LayerGroup=ia,t.layerGroup=function(t,e){return new ia(t,e)},t.FeatureGroup=is,t.featureGroup=function(t){return new is(t)},t.ImageOverlay=iP,t.imageOverlay=function(t,e,n){return new iP(t,e,n)},t.VideoOverlay=i_,t.videoOverlay=function(t,e,n){return new i_(t,e,n)},t.SVGOverlay=iT,t.svgOverlay=function(t,e,n){return new iT(t,e,n)},t.DivOverlay=iE,t.Popup=iM,t.popup=function(t,e){return new iM(t,e)},t.Tooltip=iS,t.tooltip=function(t,e){return new iS(t,e)},t.Icon=ir,t.icon=function(t){return new ir(t)},t.DivIcon=iz,t.divIcon=function(t){return new iz(t)},t.Marker=ic,t.marker=function(t,e){return new ic(t,e)},t.TileLayer=iW,t.tileLayer=iA,t.GridLayer=iD,t.gridLayer=function(t){return new iD(t)},t.SVG=iR,t.svg=iN,t.Renderer=iB,t.Canvas=iI,t.canvas=iZ,t.Path=id,t.CircleMarker=iu,t.circleMarker=function(t,e){return new iu(t,e)},t.Circle=i8,t.circle=function(t,e,n){return new i8(t,e,n)},t.Polyline=ip,t.polyline=function(t,e){return new ip(t,e)},t.Polygon=im,t.polygon=function(t,e){return new im(t,e)},t.Rectangle=iG,t.rectangle=function(t,e){return new iG(t,e)},t.Map=eA,t.map=function(t,e){return new eA(t,e)};var i4=window.L;t.noConflict=function(){return window.L=i4,this},window.L=t});var Waymark_L=L.noConflict();"use strict";this.L=this.L||{},this.Waymark_L.Control=this.Waymark_L.Control||{},this.Waymark_L.Control.Geocoder=function(t){"use strict";t=t&&Waymark_L.hasOwnProperty("default")?t.default:t;var e=0,n=/[&<>"'`]/g,a=/[&<>"'`]/,s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};function r(t){return s[t]}function l(t,n,a,s,r){var l="_l_geocoder_"+e++;n[r||"callback"]=l,window[l]=Waymark_L.Util.bind(a,s);var h=document.createElement("script");h.type="text/javascript",h.src=t+c(n),h.id=l,document.getElementsByTagName("head")[0].appendChild(h)}function h(t,e,n){var a=new XMLHttpRequest;a.onreadystatechange=function(){var t;if(4===a.readyState){if(200!==a.status&&304!==a.status)t="";else if("string"==typeof a.response)try{t=JSON.parse(a.response)}catch(e){t=a.response}else t=a.response;n(t)}},a.open("GET",t+c(e),!0),a.responseType="json",a.setRequestHeader("Accept","application/json"),a.send(null)}function c(t,e,n){var a=[];for(var s in t){var r=encodeURIComponent(n?s.toUpperCase():s),l=t[s];if(Waymark_L.Util.isArray(l))for(var h=0;h<l.length;h++)a.push(r+"="+encodeURIComponent(l[h]));else a.push(r+"="+encodeURIComponent(l))}return(e&&-1!==e.indexOf("?")?"&":"?")+a.join("&")}var d=Waymark_L.Class.extend({options:{service_url:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"},initialize:function(t,e){Waymark_L.setOptions(this,e),this._accessToken=t},geocode:function(t,e,n){var a={SingleLine:t,outFields:"Addr_Type",forStorage:!1,maxLocations:10,f:"json"};this._key&&this._key.length&&(a.token=this._key),h(this.options.service_url+"/findAddressCandidates",Waymark_L.extend(a,this.options.geocodingQueryParams),function(t){var a,s,r,l=[];if(t.candidates&&t.candidates.length)for(var h=0;h<=t.candidates.length-1;h++)a=t.candidates[h],s=Waymark_L.latLng(a.location.y,a.location.x),r=Waymark_L.latLngBounds(Waymark_L.latLng(a.extent.ymax,a.extent.xmax),Waymark_L.latLng(a.extent.ymin,a.extent.xmin)),l[h]={name:a.address,bbox:r,center:s};e.call(n,l)})},suggest:function(t,e,n){return this.geocode(t,e,n)},reverse:function(t,e,n,a){var s={location:encodeURIComponent(t.lng)+","+encodeURIComponent(t.lat),distance:100,f:"json"};h(this.options.service_url+"/reverseGeocode",s,function(t){var e,s=[];t&&!t.error&&(e=Waymark_L.latLng(t.location.y,t.location.x),s.push({name:t.address.Match_addr,center:e,bounds:Waymark_L.latLngBounds(e,e)})),n.call(a,s)})}}),u=Waymark_L.Class.extend({initialize:function(t){this.key=t},geocode:function(t,e,n){l("https://dev.virtualearth.net/REST/v1/Locations",{query:t,key:this.key},function(t){var a=[];if(t.resourceSets.length>0)for(var s=t.resourceSets[0].resources.length-1;s>=0;s--){var r=t.resourceSets[0].resources[s],l=r.bbox;a[s]={name:r.name,bbox:Waymark_L.latLngBounds([l[0],l[1]],[l[2],l[3]]),center:Waymark_L.latLng(r.point.coordinates)}}e.call(n,a)},this,"jsonp")},reverse:function(t,e,n,a){l("//dev.virtualearth.net/REST/v1/Locations/"+t.lat+","+t.lng,{key:this.key},function(t){for(var e=[],s=t.resourceSets[0].resources.length-1;s>=0;s--){var r=t.resourceSets[0].resources[s],l=r.bbox;e[s]={name:r.name,bbox:Waymark_L.latLngBounds([l[0],l[1]],[l[2],l[3]]),center:Waymark_L.latLng(r.point.coordinates)}}n.call(a,e)},this,"jsonp")}}),p=Waymark_L.Class.extend({options:{serviceUrl:"https://maps.googleapis.com/maps/api/geocode/json",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(t,e){this._key=t,Waymark_L.setOptions(this,e),this.options.serviceUrl=this.options.service_url||this.options.serviceUrl},geocode:function(t,e,n){var a={address:t};this._key&&this._key.length&&(a.key=this._key),a=Waymark_L.Util.extend(a,this.options.geocodingQueryParams),h(this.options.serviceUrl,a,function(t){var a,s,r,l=[];if(t.results&&t.results.length)for(var h=0;h<=t.results.length-1;h++)a=t.results[h],s=Waymark_L.latLng(a.geometry.location),r=Waymark_L.latLngBounds(Waymark_L.latLng(a.geometry.viewport.northeast),Waymark_L.latLng(a.geometry.viewport.southwest)),l[h]={name:a.formatted_address,bbox:r,center:s,properties:a.address_components};e.call(n,l)})},reverse:function(t,e,n,a){var s={latlng:encodeURIComponent(t.lat)+","+encodeURIComponent(t.lng)};s=Waymark_L.Util.extend(s,this.options.reverseQueryParams),this._key&&this._key.length&&(s.key=this._key),h(this.options.serviceUrl,s,function(t){var e,s,r,l=[];if(t.results&&t.results.length)for(var h=0;h<=t.results.length-1;h++)e=t.results[h],s=Waymark_L.latLng(e.geometry.location),r=Waymark_L.latLngBounds(Waymark_L.latLng(e.geometry.viewport.northeast),Waymark_L.latLng(e.geometry.viewport.southwest)),l[h]={name:e.formatted_address,bbox:r,center:s,properties:e.address_components};n.call(a,l)})}}),m=Waymark_L.Class.extend({options:{geocodeUrl:"https://geocoder.api.here.com/6.2/geocode.json",reverseGeocodeUrl:"https://reverse.geocoder.api.here.com/6.2/reversegeocode.json",app_id:"<insert your app_id here>",app_code:"<insert your app_code here>",geocodingQueryParams:{},reverseQueryParams:{},reverseGeocodeProxRadius:null},initialize:function(t){Waymark_L.setOptions(this,t)},geocode:function(t,e,n){var a={searchtext:t,gen:9,app_id:this.options.app_id,app_code:this.options.app_code,jsonattributes:1};a=Waymark_L.Util.extend(a,this.options.geocodingQueryParams),this.getJSON(this.options.geocodeUrl,a,e,n)},reverse:function(t,e,n,a){var s=this.options.reverseGeocodeProxRadius?this.options.reverseGeocodeProxRadius:null,r=s?","+encodeURIComponent(s):"",l={prox:encodeURIComponent(t.lat)+","+encodeURIComponent(t.lng)+r,mode:"retrieveAddresses",app_id:this.options.app_id,app_code:this.options.app_code,gen:9,jsonattributes:1};l=Waymark_L.Util.extend(l,this.options.reverseQueryParams),this.getJSON(this.options.reverseGeocodeUrl,l,n,a)},getJSON:function(t,e,n,a){h(t,e,function(t){var e,s,r,l=[];if(t.response.view&&t.response.view.length)for(var h=0;h<=t.response.view[0].result.length-1;h++)e=t.response.view[0].result[h].location,s=Waymark_L.latLng(e.displayPosition.latitude,e.displayPosition.longitude),r=Waymark_L.latLngBounds(Waymark_L.latLng(e.mapView.topLeft.latitude,e.mapView.topLeft.longitude),Waymark_L.latLng(e.mapView.bottomRight.latitude,e.mapView.bottomRight.longitude)),l[h]={name:e.address.label,bbox:r,center:s};n.call(a,l)})}}),f=Waymark_L.Class.extend({options:{next:void 0,sizeInMeters:1e4},initialize:function(t){Waymark_L.Util.setOptions(this,t)},geocode:function(t,e,n){if((a=t.match(/^([NS])\s*(\d{1,3}(?:\.\d*)?)\W*([EW])\s*(\d{1,3}(?:\.\d*)?)$/))?s=Waymark_L.latLng((/N/i.test(a[1])?1:-1)*parseFloat(a[2]),(/E/i.test(a[3])?1:-1)*parseFloat(a[4])):(a=t.match(/^(\d{1,3}(?:\.\d*)?)\s*([NS])\W*(\d{1,3}(?:\.\d*)?)\s*([EW])$/))?s=Waymark_L.latLng((/N/i.test(a[2])?1:-1)*parseFloat(a[1]),(/E/i.test(a[4])?1:-1)*parseFloat(a[3])):(a=t.match(/^([NS])\s*(\d{1,3})?\s*(\d{1,3}(?:\.\d*)?)?[']?\W*([EW])\s*(\d{1,3})?\s*(\d{1,3}(?:\.\d*)?)?[']?$/))?s=Waymark_L.latLng((/N/i.test(a[1])?1:-1)*(parseFloat(a[2])+parseFloat(a[3]/60)),(/E/i.test(a[4])?1:-1)*(parseFloat(a[5])+parseFloat(a[6]/60))):(a=t.match(/^(\d{1,3})?\s*(\d{1,3}(?:\.\d*)?)?[']?\s*([NS])\W*(\d{1,3})?\s*(\d{1,3}(?:\.\d*)?)?[']?\s*([EW])$/))?s=Waymark_L.latLng((/N/i.test(a[3])?1:-1)*(parseFloat(a[1])+parseFloat(a[2]/60)),(/E/i.test(a[6])?1:-1)*(parseFloat(a[4])+parseFloat(a[5]/60))):(a=t.match(/^([NS])\s*(\d{1,3})?\s*(\d{1,2})[']?\s*(\d{1,3}(?:\.\d*)?)?["]?\W*([EW])\s*(\d{1,3})?\s*(\d{1,2})[']?\s*(\d{1,3}(?:\.\d*)?)?["]?$/))?s=Waymark_L.latLng((/N/i.test(a[1])?1:-1)*(parseFloat(a[2])+parseFloat(a[3]/60+parseFloat(a[4]/3600))),(/E/i.test(a[5])?1:-1)*(parseFloat(a[6])+parseFloat(a[7]/60)+parseFloat(a[8]/3600))):(a=t.match(/^(\d{1,3})?\s*(\d{1,2})[']?\s*(\d{1,3}(?:\.\d*)?)?["]\s*([NS])\W*(\d{1,3})?\s*(\d{1,2})[']?\s*(\d{1,3}(?:\.\d*)?)?["]?\s*([EW])$/))?s=Waymark_L.latLng((/N/i.test(a[4])?1:-1)*(parseFloat(a[1])+parseFloat(a[2]/60+parseFloat(a[3]/3600))),(/E/i.test(a[8])?1:-1)*(parseFloat(a[5])+parseFloat(a[6]/60)+parseFloat(a[7]/3600))):(a=t.match(/^\s*([+-]?\d+(?:\.\d*)?)\s*[\s,]\s*([+-]?\d+(?:\.\d*)?)\s*$/))&&(s=Waymark_L.latLng(parseFloat(a[1]),parseFloat(a[2]))),s){var a,s,r=[{name:t,center:s,bbox:s.toBounds(this.options.sizeInMeters)}];e.call(n,r)}else this.options.next&&this.options.next.geocode(t,e,n)}}),g=Waymark_L.Class.extend({options:{serviceUrl:"https://api.mapbox.com/geocoding/v5/mapbox.places/",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(t,e){Waymark_L.setOptions(this,e),this.options.geocodingQueryParams.access_token=t,this.options.reverseQueryParams.access_token=t},geocode:function(t,e,n){var a=this.options.geocodingQueryParams;void 0!==a.proximity&&void 0!==a.proximity.lat&&void 0!==a.proximity.lng&&(a.proximity=a.proximity.lng+","+a.proximity.lat),h(this.options.serviceUrl+encodeURIComponent(t)+".json",a,function(t){var a,s,r,l=[];if(t.features&&t.features.length)for(var h=0;h<=t.features.length-1;h++){a=t.features[h],s=Waymark_L.latLng(a.center.reverse()),r=a.bbox?Waymark_L.latLngBounds(Waymark_L.latLng(a.bbox.slice(0,2).reverse()),Waymark_L.latLng(a.bbox.slice(2,4).reverse())):Waymark_L.latLngBounds(s,s);for(var c={text:a.text,address:a.address},d=0;d<(a.context||[]).length;d++)c[a.context[d].id.split(".")[0]]=a.context[d].text;l[h]={name:a.place_name,bbox:r,center:s,properties:c}}e.call(n,l)})},suggest:function(t,e,n){return this.geocode(t,e,n)},reverse:function(t,e,n,a){h(this.options.serviceUrl+encodeURIComponent(t.lng)+","+encodeURIComponent(t.lat)+".json",this.options.reverseQueryParams,function(t){var e,s,r,l=[];if(t.features&&t.features.length)for(var h=0;h<=t.features.length-1;h++)e=t.features[h],s=Waymark_L.latLng(e.center.reverse()),r=e.bbox?Waymark_L.latLngBounds(Waymark_L.latLng(e.bbox.slice(0,2).reverse()),Waymark_L.latLng(e.bbox.slice(2,4).reverse())):Waymark_L.latLngBounds(s,s),l[h]={name:e.place_name,bbox:r,center:s};n.call(a,l)})}}),y=Waymark_L.Class.extend({options:{serviceUrl:"https://www.mapquestapi.com/geocoding/v1"},initialize:function(t,e){this._key=decodeURIComponent(t),Waymark_L.Util.setOptions(this,e)},_formatName:function(){var t,e=[];for(t=0;t<arguments.length;t++)arguments[t]&&e.push(arguments[t]);return e.join(", ")},geocode:function(t,e,n){h(this.options.serviceUrl+"/address",{key:this._key,location:t,limit:5,outFormat:"json"},Waymark_L.bind(function(t){var a,s,r=[];if(t.results&&t.results[0].locations)for(var l=t.results[0].locations.length-1;l>=0;l--)a=t.results[0].locations[l],s=Waymark_L.latLng(a.latLng),r[l]={name:this._formatName(a.street,a.adminArea4,a.adminArea3,a.adminArea1),bbox:Waymark_L.latLngBounds(s,s),center:s};e.call(n,r)},this))},reverse:function(t,e,n,a){h(this.options.serviceUrl+"/reverse",{key:this._key,location:t.lat+","+t.lng,outputFormat:"json"},Waymark_L.bind(function(t){var e,s,r=[];if(t.results&&t.results[0].locations)for(var l=t.results[0].locations.length-1;l>=0;l--)e=t.results[0].locations[l],s=Waymark_L.latLng(e.latLng),r[l]={name:this._formatName(e.street,e.adminArea4,e.adminArea3,e.adminArea1),bbox:Waymark_L.latLngBounds(s,s),center:s};n.call(a,r)},this))}}),v=Waymark_L.Class.extend({options:{userId:"<insert your userId here>",apiKey:"<insert your apiKey here>",serviceUrl:"https://neutrinoapi.com/"},initialize:function(t){Waymark_L.Util.setOptions(this,t)},geocode:function(t,e,n){h(this.options.serviceUrl+"geocode-address",{apiKey:this.options.apiKey,userId:this.options.userId,address:t.split(/\s+/).join(".")},function(t){var a,s,r=[];t.locations&&(t.geometry=t.locations[0],a=Waymark_L.latLng(t.geometry.latitude,t.geometry.longitude),s=Waymark_L.latLngBounds(a,a),r[0]={name:t.geometry.address,bbox:s,center:a}),e.call(n,r)})},suggest:function(t,e,n){return this.geocode(t,e,n)},reverse:function(t,e,n,a){h(this.options.serviceUrl+"geocode-reverse",{apiKey:this.options.apiKey,userId:this.options.userId,latitude:t.lat,longitude:t.lng},function(e){var s,r,l=[];200==e.status.status&&e.found&&(s=Waymark_L.latLng(t.lat,t.lng),r=Waymark_L.latLngBounds(s,s),l[0]={name:e.address,bbox:r,center:s}),n.call(a,l)})}}),k=Waymark_L.Class.extend({options:{serviceUrl:"https://nominatim.openstreetmap.org/",geocodingQueryParams:{},reverseQueryParams:{},htmlTemplate:function(t){var e,s,l=t.address,h=[];return(l.road||l.building)&&h.push("{building} {road} {house_number}"),(l.city||l.town||l.village||l.hamlet)&&h.push('<span class="'+(h.length>0?"leaflet-control-geocoder-address-detail":"")+'">{postcode} {city} {town} {village} {hamlet}</span>'),(l.state||l.country)&&h.push('<span class="'+(h.length>0?"leaflet-control-geocoder-address-context":"")+'">{state} {country}</span>'),e=h.join("<br/>"),s=l,e.replace(/\{ *([\w_]+) *\}/g,function(t,e){var l,h=s[e];return void 0===h?h="":"function"==typeof h&&(h=h(s)),null==(l=h)?"":l?(l=""+l,a.test(l))?l.replace(n,r):l:l+""})}},initialize:function(t){Waymark_L.Util.setOptions(this,t)},geocode:function(t,e,n){h(this.options.serviceUrl+"search",Waymark_L.extend({q:t,limit:5,format:"json",addressdetails:1},this.options.geocodingQueryParams),Waymark_L.bind(function(t){for(var a=[],s=t.length-1;s>=0;s--){for(var r=t[s].boundingbox,l=0;l<4;l++)r[l]=parseFloat(r[l]);a[s]={icon:t[s].icon,name:t[s].display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(t[s]):void 0,bbox:Waymark_L.latLngBounds([r[0],r[2]],[r[1],r[3]]),center:Waymark_L.latLng(t[s].lat,t[s].lon),properties:t[s]}}e.call(n,a)},this))},reverse:function(t,e,n,a){h(this.options.serviceUrl+"reverse",Waymark_L.extend({lat:t.lat,lon:t.lng,zoom:Math.round(Math.log(e/256)/Math.log(2)),addressdetails:1,format:"json"},this.options.reverseQueryParams),Waymark_L.bind(function(t){var e,s=[];t&&t.lat&&t.lon&&(e=Waymark_L.latLng(t.lat,t.lon),s.push({name:t.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(t):void 0,center:e,bounds:Waymark_L.latLngBounds(e,e),properties:t})),n.call(a,s)},this))}}),w=Waymark_L.Class.extend({options:{OpenLocationCode:void 0,codeLength:void 0},initialize:function(t){Waymark_L.setOptions(this,t)},geocode:function(t,e,n){try{var a=this.options.OpenLocationCode.decode(t),s={name:t,center:Waymark_L.latLng(a.latitudeCenter,a.longitudeCenter),bbox:Waymark_L.latLngBounds(Waymark_L.latLng(a.latitudeLo,a.longitudeLo),Waymark_L.latLng(a.latitudeHi,a.longitudeHi))};e.call(n,[s])}catch(r){console.warn(r),e.call(n,[])}},reverse:function(t,e,n,a){try{var s={name:this.options.OpenLocationCode.encode(t.lat,t.lng,this.options.codeLength),center:Waymark_L.latLng(t.lat,t.lng),bbox:Waymark_L.latLngBounds(Waymark_L.latLng(t.lat,t.lng),Waymark_L.latLng(t.lat,t.lng))};n.call(a,[s])}catch(r){console.warn(r),n.call(a,[])}}}),x=Waymark_L.Class.extend({options:{serviceUrl:"https://api.opencagedata.com/geocode/v1/json"},initialize:function(t){this._accessToken=t},geocode:function(t,e,n){h(this.options.serviceUrl,{key:this._accessToken,q:t},function(t){var a,s,r,l=[];if(t.results&&t.results.length)for(var h=0;h<t.results.length;h++)r=t.results[h],a=Waymark_L.latLng(r.geometry),s=r.annotations&&r.annotations.bounds?Waymark_L.latLngBounds(Waymark_L.latLng(r.annotations.bounds.northeast),Waymark_L.latLng(r.annotations.bounds.southwest)):Waymark_L.latLngBounds(a,a),l.push({name:r.formatted,bbox:s,center:a});e.call(n,l)})},suggest:function(t,e,n){return this.geocode(t,e,n)},reverse:function(t,e,n,a){h(this.options.serviceUrl,{key:this._accessToken,q:[t.lat,t.lng].join(",")},function(t){var e,s,r,l=[];if(t.results&&t.results.length)for(var h=0;h<t.results.length;h++)r=t.results[h],e=Waymark_L.latLng(r.geometry),s=r.annotations&&r.annotations.bounds?Waymark_L.latLngBounds(Waymark_L.latLng(r.annotations.bounds.northeast),Waymark_L.latLng(r.annotations.bounds.southwest)):Waymark_L.latLngBounds(e,e),l.push({name:r.formatted,bbox:s,center:e});n.call(a,l)})}}),$=Waymark_L.Class.extend({options:{serviceUrl:"https://api.geocode.earth/v1",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(t,e){Waymark_L.Util.setOptions(this,e),this._apiKey=t,this._lastSuggest=0},geocode:function(t,e,n){var a=this;h(this.options.serviceUrl+"/search",Waymark_L.extend({api_key:this._apiKey,text:t},this.options.geocodingQueryParams),function(t){e.call(n,a._parseResults(t,"bbox"))})},suggest:function(t,e,n){var a=this;h(this.options.serviceUrl+"/autocomplete",Waymark_L.extend({api_key:this._apiKey,text:t},this.options.geocodingQueryParams),Waymark_L.bind(function(t){t.geocoding.timestamp>this._lastSuggest&&(this._lastSuggest=t.geocoding.timestamp,e.call(n,a._parseResults(t,"bbox")))},this))},reverse:function(t,e,n,a){var s=this;h(this.options.serviceUrl+"/reverse",Waymark_L.extend({api_key:this._apiKey,"point.lat":t.lat,"point.lon":t.lng},this.options.reverseQueryParams),function(t){n.call(a,s._parseResults(t,"bounds"))})},_parseResults:function(t,e){var n=[];return Waymark_L.geoJson(t,{pointToLayer:function(t,e){return Waymark_L.circleMarker(e)},onEachFeature:function(t,a){var s,r,l={};a.getBounds?r=(s=a.getBounds()).getCenter():a.feature.bbox?(r=a.getLatLng(),s=Waymark_L.latLngBounds(Waymark_L.GeoJSON.coordsToLatLng(a.feature.bbox.slice(0,2)),Waymark_L.GeoJSON.coordsToLatLng(a.feature.bbox.slice(2,4)))):(r=a.getLatLng(),s=Waymark_L.latLngBounds(r,r)),l.name=a.feature.properties.label,l.center=r,l[e]=s,l.properties=a.feature.properties,n.push(l)}}),n}});function b(t,e){return new $(t,e)}var C=$,P=C.extend({options:{serviceUrl:"https://api.openrouteservice.org/geocode"}}),_=Waymark_L.Class.extend({options:{serviceUrl:"https://photon.komoot.de/api/",reverseUrl:"https://photon.komoot.de/reverse/",nameProperties:["name","street","suburb","hamlet","town","city","state","country"]},initialize:function(t){Waymark_L.setOptions(this,t)},geocode:function(t,e,n){var a=Waymark_L.extend({q:t},this.options.geocodingQueryParams);h(this.options.serviceUrl,a,Waymark_L.bind(function(t){e.call(n,this._decodeFeatures(t))},this))},suggest:function(t,e,n){return this.geocode(t,e,n)},reverse:function(t,e,n,a){var s=Waymark_L.extend({lat:t.lat,lon:t.lng},this.options.reverseQueryParams);h(this.options.reverseUrl,s,Waymark_L.bind(function(t){n.call(a,this._decodeFeatures(t))},this))},_decodeFeatures:function(t){var e,n,a,s,r,l,h=[];if(t&&t.features)for(e=0;e<t.features.length;e++)a=(n=t.features[e]).geometry.coordinates,s=Waymark_L.latLng(a[1],a[0]),l=(r=n.properties.extent)?Waymark_L.latLngBounds([r[1],r[0]],[r[3],r[2]]):Waymark_L.latLngBounds(s,s),h.push({name:this._decodeFeatureName(n),html:this.options.htmlTemplate?this.options.htmlTemplate(n):void 0,center:s,bbox:l,properties:n.properties});return h},_decodeFeatureName:function(t){return(this.options.nameProperties||[]).map(function(e){return t.properties[e]}).filter(function(t){return!!t}).join(", ")}}),T=Waymark_L.Class.extend({options:{serviceUrl:"https://api.what3words.com/v2/"},initialize:function(t){this._accessToken=t},geocode:function(t,e,n){h(this.options.serviceUrl+"forward",{key:this._accessToken,addr:t.split(/\s+/).join(".")},function(t){var a,s,r=[];t.geometry&&(a=Waymark_L.latLng(t.geometry.lat,t.geometry.lng),s=Waymark_L.latLngBounds(a,a),r[0]={name:t.words,bbox:s,center:a}),e.call(n,r)})},suggest:function(t,e,n){return this.geocode(t,e,n)},reverse:function(t,e,n,a){h(this.options.serviceUrl+"reverse",{key:this._accessToken,coords:[t.lat,t.lng].join(",")},function(t){var e,s,r=[];200==t.status.status&&(e=Waymark_L.latLng(t.geometry.lat,t.geometry.lng),s=Waymark_L.latLngBounds(e,e),r[0]={name:t.words,bbox:s,center:e}),n.call(a,r)})}}),E=Object.freeze({ArcGis:d,arcgis:function t(e,n){return new d(e,n)},Bing:u,bing:function t(e){return new u(e)},Google:p,google:function t(e,n){return new p(e,n)},HERE:m,here:function t(e){return new m(e)},LatLng:f,latLng:function t(e){return new f(e)},Mapbox:g,mapbox:function t(e,n){return new g(e,n)},MapQuest:y,mapQuest:function t(e,n){return new y(e,n)},Neutrino:v,neutrino:function t(e){return new v(e)},Nominatim:k,nominatim:function t(e){return new k(e)},OpenLocationCode:w,openLocationCode:function t(e){return new w(e)},OpenCage:x,opencage:function t(e){return new x(e)},Pelias:$,pelias:b,GeocodeEarth:$,geocodeEarth:b,Mapzen:C,mapzen:b,Openrouteservice:P,openrouteservice:function t(e,n){return new P(e,n)},Photon:_,photon:function t(e){return new _(e)},What3Words:T,what3words:function t(e){return new T(e)}}),M=Waymark_L.Control.extend({options:{showUniqueResult:!0,showResultIcons:!1,collapsed:!0,expand:"touch",position:"topright",placeholder:"Search...",errorMessage:"Nothing found.",queryMinLength:1,suggestMinLength:3,suggestTimeout:250,defaultMarkGeocode:!0},includes:Waymark_L.Evented.prototype||Waymark_L.Mixin.Events,initialize:function(t){Waymark_L.Util.setOptions(this,t),this.options.geocoder||(this.options.geocoder=new k),this._requestCount=0},addThrobberClass:function(){Waymark_L.DomUtil.addClass(this._container,"leaflet-control-geocoder-throbber")},removeThrobberClass:function(){Waymark_L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-throbber")},onAdd:function(t){var e,n="leaflet-control-geocoder",a=Waymark_L.DomUtil.create("div",n+" leaflet-bar"),s=Waymark_L.DomUtil.create("button",n+"-icon",a),r=this._form=Waymark_L.DomUtil.create("div",n+"-form",a);return this._map=t,this._container=a,s.innerHTML="&nbsp;",s.type="button",(e=this._input=Waymark_L.DomUtil.create("input","",r)).type="text",e.placeholder=this.options.placeholder,Waymark_L.DomEvent.disableClickPropagation(e),this._errorElement=Waymark_L.DomUtil.create("div",n+"-form-no-error",a),this._errorElement.innerHTML=this.options.errorMessage,this._alts=Waymark_L.DomUtil.create("ul",n+"-alternatives leaflet-control-geocoder-alternatives-minimized",a),Waymark_L.DomEvent.disableClickPropagation(this._alts),Waymark_L.DomEvent.addListener(e,"keydown",this._keydown,this),this.options.geocoder.suggest&&Waymark_L.DomEvent.addListener(e,"input",this._change,this),Waymark_L.DomEvent.addListener(e,"blur",function(){this.options.collapsed&&!this._preventBlurCollapse&&this._collapse(),this._preventBlurCollapse=!1},this),this.options.collapsed?"click"===this.options.expand?Waymark_L.DomEvent.addListener(a,"click",function(t){0===t.button&&2!==t.detail&&this._toggle()},this):Waymark_L.Browser.touch&&"touch"===this.options.expand?Waymark_L.DomEvent.addListener(a,"touchstart mousedown",function(t){this._toggle(),t.preventDefault(),t.stopPropagation()},this):(Waymark_L.DomEvent.addListener(a,"mouseover",this._expand,this),Waymark_L.DomEvent.addListener(a,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):(this._expand(),Waymark_L.Browser.touch?Waymark_L.DomEvent.addListener(a,"touchstart",function(){this._geocode()},this):Waymark_L.DomEvent.addListener(a,"click",function(){this._geocode()},this)),this.options.defaultMarkGeocode&&this.on("markgeocode",this.markGeocode,this),this.on("startgeocode",this.addThrobberClass,this),this.on("finishgeocode",this.removeThrobberClass,this),this.on("startsuggest",this.addThrobberClass,this),this.on("finishsuggest",this.removeThrobberClass,this),Waymark_L.DomEvent.disableClickPropagation(a),a},_geocodeResult:function(t,e){if(!e&&this.options.showUniqueResult&&1===t.length)this._geocodeResultSelected(t[0]);else if(t.length>0){this._alts.innerHTML="",this._results=t,Waymark_L.DomUtil.removeClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),Waymark_L.DomUtil.addClass(this._container,"leaflet-control-geocoder-options-open");for(var n=0;n<t.length;n++)this._alts.appendChild(this._createAlt(t[n],n))}else Waymark_L.DomUtil.addClass(this._container,"leaflet-control-geocoder-options-error"),Waymark_L.DomUtil.addClass(this._errorElement,"leaflet-control-geocoder-error")},markGeocode:function(t){return t=t.geocode||t,this._map.fitBounds(t.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new Waymark_L.Marker(t.center).bindPopup(t.html||t.name).addTo(this._map).openPopup(),this},_geocode:function(t){var e=this._input.value;if(t||!(e.length<this.options.queryMinLength)){var n=++this._requestCount,a=t?"suggest":"geocode",s={input:e};this._lastGeocode=e,t||this._clearResults(),this.fire("start"+a,s),this.options.geocoder[a](e,function(e){n===this._requestCount&&(s.results=e,this.fire("finish"+a,s),this._geocodeResult(e,t))},this)}},_geocodeResultSelected:function(t){this.fire("markgeocode",{geocode:t})},_toggle:function(){Waymark_L.DomUtil.hasClass(this._container,"leaflet-control-geocoder-expanded")?this._collapse():this._expand()},_expand:function(){Waymark_L.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded"),this._input.select(),this.fire("expand")},_collapse:function(){Waymark_L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-expanded"),Waymark_L.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),Waymark_L.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),Waymark_L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-open"),Waymark_L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-error"),this._input.blur(),this.fire("collapse")},_clearResults:function(){Waymark_L.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),this._selection=null,Waymark_L.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),Waymark_L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-open"),Waymark_L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-error")},_createAlt:function(t,e){var n=Waymark_L.DomUtil.create("li",""),a=Waymark_L.DomUtil.create("a","",n),s=this.options.showResultIcons&&t.icon?Waymark_L.DomUtil.create("img","",a):null,r=t.html?void 0:document.createTextNode(t.name),l=function e(a){this._preventBlurCollapse=!0,Waymark_L.DomEvent.stop(a),this._geocodeResultSelected(t),Waymark_L.DomEvent.on(n,"click",function(){this.options.collapsed?this._collapse():this._clearResults()},this)};return s&&(s.src=t.icon),n.setAttribute("data-result-index",e),t.html?a.innerHTML=a.innerHTML+t.html:a.appendChild(r),Waymark_L.DomEvent.addListener(n,"mousedown touchstart",l,this),n},_keydown:function(t){var e=this,n=function t(n){e._selection&&(Waymark_L.DomUtil.removeClass(e._selection,"leaflet-control-geocoder-selected"),e._selection=e._selection[n>0?"nextSibling":"previousSibling"]),e._selection||(e._selection=e._alts[n>0?"firstChild":"lastChild"]),e._selection&&Waymark_L.DomUtil.addClass(e._selection,"leaflet-control-geocoder-selected")};switch(t.keyCode){case 27:this.options.collapsed?this._collapse():this._clearResults();break;case 38:n(-1);break;case 40:n(1);break;case 13:if(this._selection){var a=parseInt(this._selection.getAttribute("data-result-index"),10);this._geocodeResultSelected(this._results[a]),this._clearResults()}else this._geocode();break;default:return}Waymark_L.DomEvent.preventDefault(t)},_change:function(){var t=this._input.value;t!==this._lastGeocode&&(clearTimeout(this._suggestTimeout),t.length>=this.options.suggestMinLength?this._suggestTimeout=setTimeout(Waymark_L.bind(function(){this._geocode(!0)},this),this.options.suggestTimeout):this._clearResults())}});return Waymark_L.Util.extend(M,E),Waymark_L.Util.extend(Waymark_L.Control,{Geocoder:M,geocoder:function t(e){return new M(e)}}),M}(L),function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(void 0!==e&&e.L?module.exports=t(L):module.exports=t(require("leaflet"))),void 0!==e&&e.L&&(e.Waymark_L.Control.Locate=t(L))}(function(t){var e=function(e,n,a){(a=a.split(" ")).forEach(function(a){t.DomUtil[e].call(this,n,a)})},n=function(t,n){e("addClass",t,n)},a=function(t,n){e("removeClass",t,n)},s=t.Marker.extend({initialize:function(e,n){t.Util.setOptions(this,n),this._latlng=e,this.createIcon()},createIcon:function(){var e=this.options,n="";void 0!==e.color&&(n+="stroke:"+e.color+";"),void 0!==e.weight&&(n+="stroke-width:"+e.weight+";"),void 0!==e.fillColor&&(n+="fill:"+e.fillColor+";"),void 0!==e.fillOpacity&&(n+="fill-opacity:"+e.fillOpacity+";"),void 0!==e.opacity&&(n+="opacity:"+e.opacity+";");var a=this._getIconSVG(e,n);this._locationIcon=t.divIcon({className:a.className,html:a.svg,iconSize:[a.w,a.h]}),this.setIcon(this._locationIcon)},_getIconSVG:function(t,e){var n=t.radius,a=n+t.weight,s=2*a;return{className:"leaflet-control-locate-location",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="'+s+'" height="'+s+'" version="1.1" viewBox="-'+a+" -"+a+" "+s+" "+s+'"><circle r="'+n+'" style="'+e+'" /></svg>',w:s,h:s}},setStyle:function(e){t.Util.setOptions(this,e),this.createIcon()}}),r=s.extend({initialize:function(e,n,a){t.Util.setOptions(this,a),this._latlng=e,this._heading=n,this.createIcon()},setHeading:function(t){this._heading=t},_getIconSVG:function(t,e){var n=t.radius,a=t.width+t.weight,s=2*(n+t.depth+t.weight),r="M0,0 l"+t.width/2+","+t.depth+" l-"+a+",0 z";return{className:"leaflet-control-locate-heading",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="'+a+'" height="'+s+'" version="1.1" viewBox="-'+a/2+" 0 "+a+" "+s+'" style="transform: rotate('+this._heading+'deg)"><path d="'+r+'" style="'+e+'" /></svg>',w:a,h:s}}}),l=t.Control.extend({options:{position:"topleft",layer:void 0,setView:"untilPanOrZoom",keepCurrentZoomLevel:!1,getLocationBounds:function(t){return t.bounds},flyTo:!1,clickBehavior:{inView:"stop",outOfView:"setView",inViewNotFollowing:"inView"},returnToPrevBounds:!1,cacheLocation:!0,drawCircle:!0,drawMarker:!0,showCompass:!0,markerClass:s,compassClass:r,circleStyle:{className:"leaflet-control-locate-circle",color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:0},markerStyle:{className:"leaflet-control-locate-marker",color:"#fff",fillColor:"#2A93EE",fillOpacity:1,weight:3,opacity:1,radius:9},compassStyle:{fillColor:"#2A93EE",fillOpacity:1,weight:0,color:"#fff",opacity:1,radius:9,width:9,depth:6},followCircleStyle:{},followMarkerStyle:{},followCompassStyle:{},icon:"fa fa-map-marker",iconLoading:"fa fa-spinner fa-spin",iconElementTag:"span",circlePadding:[0,0],metric:!0,createButtonCallback:function(e,n){var a=t.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",e);return a.title=n.strings.title,{link:a,icon:t.DomUtil.create(n.iconElementTag,n.icon,a)}},onLocationError:function(t,e){alert(t.message)},onLocationOutsideMapBounds:function(t){t.stop(),alert(t.options.strings.outsideMapBoundsMsg)},showPopup:!0,strings:{title:"Show me where I am",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:1/0,watch:!0,setView:!1}},initialize:function(e){for(var n in e)"object"==typeof this.options[n]?t.extend(this.options[n],e[n]):this.options[n]=e[n];this.options.followMarkerStyle=t.extend({},this.options.markerStyle,this.options.followMarkerStyle),this.options.followCircleStyle=t.extend({},this.options.circleStyle,this.options.followCircleStyle),this.options.followCompassStyle=t.extend({},this.options.compassStyle,this.options.followCompassStyle)},onAdd:function(e){var n=t.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control");this._layer=this.options.layer||new t.LayerGroup,this._layer.addTo(e),this._event=void 0,this._compassHeading=null,this._prevBounds=null;var a=this.options.createButtonCallback(n,this.options);return this._link=a.link,this._icon=a.icon,t.DomEvent.on(this._link,"click",t.DomEvent.stopPropagation).on(this._link,"click",t.DomEvent.preventDefault).on(this._link,"click",this._onClick,this).on(this._link,"dblclick",t.DomEvent.stopPropagation),this._resetVariables(),this._map.on("unload",this._unload,this),n},_onClick:function(){this._justClicked=!0;var t=this._isFollowing();if(this._userPanned=!1,this._userZoomed=!1,this._active&&!this._event)this.stop();else if(this._active&&void 0!==this._event){var e=this.options.clickBehavior,n=e.outOfView;switch(this._map.getBounds().contains(this._event.latlng)&&(n=t?e.inView:e.inViewNotFollowing),e[n]&&(n=e[n]),n){case"setView":this.setView();break;case"stop":this.stop(),this.options.returnToPrevBounds&&(this.options.flyTo?this._map.flyToBounds:this._map.fitBounds).bind(this._map)(this._prevBounds)}}else this.options.returnToPrevBounds&&(this._prevBounds=this._map.getBounds()),this.start();this._updateContainerStyle()},start:function(){this._activate(),this._event&&(this._drawMarker(this._map),this.options.setView&&this.setView()),this._updateContainerStyle()},stop:function(){this._deactivate(),this._cleanClasses(),this._resetVariables(),this._removeMarker()},stopFollowing:function(){this._userPanned=!0,this._updateContainerStyle(),this._drawMarker()},_activate:function(){this._active||(this._map.locate(this.options.locateOptions),this._active=!0,this._map.on("locationfound",this._onLocationFound,this),this._map.on("locationerror",this._onLocationError,this),this._map.on("dragstart",this._onDrag,this),this._map.on("zoomstart",this._onZoom,this),this._map.on("zoomend",this._onZoomEnd,this),this.options.showCompass&&("ondeviceorientationabsolute"in window?t.DomEvent.on(window,"deviceorientationabsolute",this._onDeviceOrientation,this):"ondeviceorientation"in window&&t.DomEvent.on(window,"deviceorientation",this._onDeviceOrientation,this)))},_deactivate:function(){this._map.stopLocate(),this._active=!1,this.options.cacheLocation||(this._event=void 0),this._map.off("locationfound",this._onLocationFound,this),this._map.off("locationerror",this._onLocationError,this),this._map.off("dragstart",this._onDrag,this),this._map.off("zoomstart",this._onZoom,this),this._map.off("zoomend",this._onZoomEnd,this),this.options.showCompass&&(this._compassHeading=null,"ondeviceorientationabsolute"in window?t.DomEvent.off(window,"deviceorientationabsolute",this._onDeviceOrientation,this):"ondeviceorientation"in window&&t.DomEvent.off(window,"deviceorientation",this._onDeviceOrientation,this))},setView:function(){if(this._drawMarker(),this._isOutsideMapBounds())this._event=void 0,this.options.onLocationOutsideMapBounds(this);else if(this.options.keepCurrentZoomLevel)(e=this.options.flyTo?this._map.flyTo:this._map.panTo).bind(this._map)([this._event.latitude,this._event.longitude]);else{var e=this.options.flyTo?this._map.flyToBounds:this._map.fitBounds;this._ignoreEvent=!0,e.bind(this._map)(this.options.getLocationBounds(this._event),{padding:this.options.circlePadding,maxZoom:this.options.locateOptions.maxZoom}),t.Util.requestAnimFrame(function(){this._ignoreEvent=!1},this)}},_drawCompass:function(){if(this._event){var t=this._event.latlng;if(this.options.showCompass&&t&&null!==this._compassHeading){var e=this._isFollowing()?this.options.followCompassStyle:this.options.compassStyle;this._compass?(this._compass.setLatLng(t),this._compass.setHeading(this._compassHeading),this._compass.setStyle&&this._compass.setStyle(e)):this._compass=new this.options.compassClass(t,this._compassHeading,e).addTo(this._layer)}!this._compass||this.options.showCompass&&null!==this._compassHeading||(this._compass.removeFrom(this._layer),this._compass=null)}},_drawMarker:function(){void 0===this._event.accuracy&&(this._event.accuracy=0);var e,n,a=this._event.accuracy,s=this._event.latlng;if(this.options.drawCircle){var r=this._isFollowing()?this.options.followCircleStyle:this.options.circleStyle;this._circle?this._circle.setLatLng(s).setRadius(a).setStyle(r):this._circle=t.circle(s,a,r).addTo(this._layer)}if(n=this.options.metric?(e=a.toFixed(0),this.options.strings.metersUnit):(e=(3.2808399*a).toFixed(0),this.options.strings.feetUnit),this.options.drawMarker){var l=this._isFollowing()?this.options.followMarkerStyle:this.options.markerStyle;this._marker?(this._marker.setLatLng(s),this._marker.setStyle&&this._marker.setStyle(l)):this._marker=new this.options.markerClass(s,l).addTo(this._layer)}this._drawCompass();var h=this.options.strings.popup;this.options.showPopup&&h&&this._marker&&this._marker.bindPopup(t.Util.template(h,{distance:e,unit:n}))._popup.setLatLng(s),this.options.showPopup&&h&&this._compass&&this._compass.bindPopup(t.Util.template(h,{distance:e,unit:n}))._popup.setLatLng(s)},_removeMarker:function(){this._layer.clearLayers(),this._marker=void 0,this._circle=void 0},_unload:function(){this.stop(),this._map.off("unload",this._unload,this)},_setCompassHeading:function(e){!isNaN(parseFloat(e))&&isFinite(e)?(e=Math.round(e),this._compassHeading=e,t.Util.requestAnimFrame(this._drawCompass,this)):this._compassHeading=null},_onCompassNeedsCalibration:function(){this._setCompassHeading()},_onDeviceOrientation:function(t){this._active&&(t.webkitCompassHeading?this._setCompassHeading(t.webkitCompassHeading):t.absolute&&t.alpha&&this._setCompassHeading(360-t.alpha))},_onLocationError:function(t){3==t.code&&this.options.locateOptions.watch||(this.stop(),this.options.onLocationError(t,this))},_onLocationFound:function(t){if((!this._event||this._event.latlng.lat!==t.latlng.lat||this._event.latlng.lng!==t.latlng.lng||this._event.accuracy!==t.accuracy)&&this._active){switch(this._event=t,this._drawMarker(),this._updateContainerStyle(),this.options.setView){case"once":this._justClicked&&this.setView();break;case"untilPan":this._userPanned||this.setView();break;case"untilPanOrZoom":this._userPanned||this._userZoomed||this.setView();break;case"always":this.setView()}this._justClicked=!1}},_onDrag:function(){this._event&&!this._ignoreEvent&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_onZoom:function(){this._event&&!this._ignoreEvent&&(this._userZoomed=!0,this._updateContainerStyle(),this._drawMarker())},_onZoomEnd:function(){this._event&&this._drawCompass(),this._event&&!this._ignoreEvent&&this._marker&&!this._map.getBounds().pad(-.3).contains(this._marker.getLatLng())&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_isFollowing:function(){return!!this._active&&("always"===this.options.setView||("untilPan"===this.options.setView?!this._userPanned:"untilPanOrZoom"===this.options.setView?!this._userPanned&&!this._userZoomed:void 0))},_isOutsideMapBounds:function(){return void 0!==this._event&&this._map.options.maxBounds&&!this._map.options.maxBounds.contains(this._event.latlng)},_updateContainerStyle:function(){this._container&&(this._active&&!this._event?this._setClasses("requesting"):this._isFollowing()?this._setClasses("following"):this._active?this._setClasses("active"):this._cleanClasses())},_setClasses:function(t){"requesting"==t?(a(this._container,"active following"),n(this._container,"requesting"),a(this._icon,this.options.icon),n(this._icon,this.options.iconLoading)):"active"==t?(a(this._container,"requesting following"),n(this._container,"active"),a(this._icon,this.options.iconLoading),n(this._icon,this.options.icon)):"following"==t&&(a(this._container,"requesting"),n(this._container,"active following"),a(this._icon,this.options.iconLoading),n(this._icon,this.options.icon))},_cleanClasses:function(){t.DomUtil.removeClass(this._container,"requesting"),t.DomUtil.removeClass(this._container,"active"),t.DomUtil.removeClass(this._container,"following"),a(this._icon,this.options.iconLoading),n(this._icon,this.options.icon)},_resetVariables:function(){this._active=!1,this._justClicked=!1,this._userPanned=!1,this._userZoomed=!1}});return t.control.locate=function(e){return new t.Control.Locate(e)},l},window),function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";var t,e;t=function(t){return t.locales={},t.locale=null,t.registerLocale=function e(n,a){t.locales[n]=t.Util.extend({},t.locales[n],a)},t.setLocale=function e(n){t.locale=n},t.i18n=t._=function e(n,a){t.locale&&t.locales[t.locale]&&t.locales[t.locale][n]&&(n=t.locales[t.locale][n]);try{n=t.Util.template(n,a)}catch(s){}return n}},e=window,"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(module.exports=t(require("leaflet"))),void 0!==e&&e.L&&t(e.L),L.Control.Elevation=L.Control.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,options:{autohide:!L.Browser.mobile,autohideMarker:!0,collapsed:!1,controlButton:{iconCssClass:"elevation-toggle-icon",title:"Elevation"},detached:!0,distanceFactor:1,dragging:!L.Browser.mobile,downloadLink:"link",elevationDiv:"#elevation-div",followMarker:!0,forceAxisBounds:!1,gpxOptions:{async:!0,marker_options:{startIconUrl:null,endIconUrl:null,shadowUrl:null,wptIcons:{"":L.divIcon({className:"elevation-waypoint-marker",html:'<i class="elevation-waypoint-icon"></i>',iconSize:[30,30],iconAnchor:[8,30]})}}},height:200,heightFactor:1,hoverNumber:{decimalsX:2,decimalsY:0,formatter:void 0},imperial:!1,interpolation:"curveLinear",lazyLoadJS:!0,legend:!0,loadData:{defer:!1,lazy:!1},marker:"elevation-line",markerIcon:L.divIcon({className:"elevation-position-marker",html:'<i class="elevation-position-icon"></i>',iconSize:[32,32],iconAnchor:[16,16]}),placeholder:!1,position:"topright",polyline:{className:"elevation-polyline",color:"#000",opacity:.75,weight:5,lineCap:"round"},reverseCoords:!1,skipNullZCoords:!1,theme:"lightblue-theme",margins:{top:10,right:20,bottom:30,left:50},responsive:!0,summary:"inline",width:600,xLabel:"km",xTicks:void 0,yAxisMax:void 0,yAxisMin:void 0,yLabel:"m",yTicks:void 0,zFollow:13},__mileFactor:.621371,__footFactor:3.28084,addData:function(t,e){L.Control.Elevation._d3LazyLoader=this._lazyLoadJS("https://unpkg.com/d3@5.15.0/dist/d3.min.js","object"!=typeof d3,L.Control.Elevation._d3LazyLoader).then((function(t,e){this._addData(t),this._container&&this._applyData(),null==e&&t.on&&(e=t),e&&(e._path&&L.DomUtil.addClass(e._path,this.options.polyline.className+" "+this.options.theme),e.on("mousemove",this._mousemoveLayerHandler,this).on("mouseout",this._mouseoutHandler,this)),this.track_info=L.extend({},this.track_info,{distance:this._distance,elevation_max:this._maxElevation,elevation_min:this._minElevation,ascent:this._ascent,descent:this._descent}),this._layers=this._layers||{},this._layers[L.Util.stamp(e)]=e,this._fireEvt("eledata_added",{data:t,layer:e,track_info:this.track_info},!0)}).bind(this,t,e))},addTo:function(t){return this.options.detached?this._appendElevationDiv(t._container).appendChild(this.onAdd(t)):L.Control.prototype.addTo.call(this,t),this},clear:function(){this._clearPath(),this._clearChart(),this._clearData(),this._fireEvt("eledata_clear")},disableDragging:function(){this._draggingEnabled=!1,this._resetDrag()},enableDragging:function(){this._draggingEnabled=!0},fitBounds:function(t){t=t||this._fullExtent,this._map&&t&&this._map.fitBounds(t)},getZFollow:function(){return this._zFollow},hide:function(){this._container.style.display="none"},initialize:function(t){this.options=this._deepMerge({},this.options,t),this.options.imperial?(this._distanceFactor=this.__mileFactor,this._heightFactor=this.__footFactor,this._xLabel="mi",this._yLabel="ft"):(this._distanceFactor=this.options.distanceFactor,this._heightFactor=this.options.heightFactor,this._xLabel=this.options.xLabel,this._yLabel=this.options.yLabel),this._chartEnabled=!0,this._draggingEnabled=this.options.dragging,this._zFollow=this.options.zFollow,this.options.followMarker&&(this._setMapView=L.Util.throttle(this._setMapView,300,this)),this.options.placeholder&&(this.options.loadData.lazy=this.options.loadData.defer=!0),this.on("waypoint_added",function(t){t.point._popup&&(t.point._popup.options.className="elevation-popup",t.point._popup._content=decodeURI(t.point._popup._content)),t.point._popup&&t.point._popup._content&&t.point.bindTooltip(t.point._popup._content,{direction:"top",sticky:!0,opacity:1,className:"elevation-tooltip"}).openTooltip()})},load:function(t,e){this.loadData(t,e)},loadChart:function(t){this.addTo(t)},loadData:function(t,e){(e=L.extend({},this.options.loadData,e)).defer?this.loadDefer(t,e):e.lazy?this.loadLazy(t,e):this._isXMLDoc(t)?this.loadGPX(t):this._isJSONDoc(t)?this.loadGeoJSON(t):this.loadFile(t)},loadDefer:function(t,e){(e=L.extend({},this.options.loadData,e)).defer=!1,"complete"!==document.readyState?window.addEventListener("load",L.bind(this.loadData,this,t,e),{once:!0}):this.loadData(t,e)},loadFile:function(t){this._downloadURL=t;try{let e=new XMLHttpRequest;e.responseType="text",e.open("GET",t),e.onload=(function(){if(200!==e.status)throw"Error "+e.status+" while fetching remote file: "+t;this.loadData(e.response,{lazy:!1,defer:!1})}).bind(this),e.send()}catch(n){console.warn(n)}},loadGeoJSON:function(t){"string"==typeof t&&(t=JSON.parse(t)),this.layer=this.geojson=L.geoJson(t,{style:(function(t){let e=L.extend({},this.options.polyline);return this.options.theme&&(e.className+=" "+this.options.theme),e}).bind(this),pointToLayer:(function(t,e){let n=L.marker(e,{icon:this.options.gpxOptions.marker_options.wptIcons[""]}),a=t.properties.desc?t.properties.desc:"",s=t.properties.name?t.properties.name:"";return(s||a)&&n.bindPopup("<b>"+s+"</b>"+(a.length>0?"<br>"+a:"")).openPopup(),this.fire("waypoint_added",{point:n,point_type:"waypoint",element:e}),n}).bind(this),onEachFeature:(function(e,n){"Point"!=e.geometry.type&&(this.addData(e,n),this.track_info=L.extend({},this.track_info,{type:"geojson",name:t.name}))}).bind(this)}),this._map?(this._map.once("layeradd",function(e){this._fireEvt("eledata_loaded",{data:t,layer:this.layer,name:this.track_info.name,track_info:this.track_info},!0)},this),this.layer.addTo(this._map)):console.warn("Undefined elevation map object")},loadGPX:function(t){L.Control.Elevation._gpxLazyLoader=this._lazyLoadJS("https://unpkg.com/leaflet-gpx@1.5.0/gpx.js","function"!=typeof L.GPX,L.Control.Elevation._gpxLazyLoader).then((function(t){this.options.gpxOptions.polyline_options=L.extend({},this.options.polyline,this.options.gpxOptions.polyline_options),this.options.theme&&(this.options.gpxOptions.polyline_options.className+=" "+this.options.theme),this.layer=this.gpx=new L.GPX(t,this.options.gpxOptions),this.layer.on("loaded",function(t){this.fitBounds(t.target.getBounds())},this),this.layer.on("addpoint",function(t){this.fire("waypoint_added",t,!0)},this),this.layer.once("addline",function(e){this.addData(e.line),this.track_info=L.extend({},this.track_info,{type:"gpx",name:this.layer.get_name()}),this._fireEvt("eledata_loaded",{data:t,layer:this.layer,name:this.track_info.name,track_info:this.track_info},!0)},this),this._map?this.layer.addTo(this._map):console.warn("Undefined elevation map object")}).bind(this,t))},loadLazy:function(t,e){(e=L.extend({},this.options.loadData,e)).lazy=!1;let n=!1,a=L.bind(function(t){n||(L.Util.requestAnimFrame(function(){this._isVisible(this.placeholder)&&(window.removeEventListener("scroll",a),this.loadData(t,e),this.once("eledata_loaded",function(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder)},this)),n=!1},this),n=!0)},this,t);window.addEventListener("scroll",a),this.placeholder&&this.placeholder.addEventListener("mouseenter",a,{once:!0}),a()},onAdd:function(t){this._map=t;let e=this._container=L.DomUtil.create("div","elevation-control elevation");if(this.options.detached||L.DomUtil.addClass(e,"leaflet-control"),this.options.theme&&L.DomUtil.addClass(e,this.options.theme),this.options.placeholder&&!this._data){if(this.placeholder=L.DomUtil.create("img","elevation-placeholder"),"string"==typeof this.options.placeholder)this.placeholder.src=this.options.placeholder,this.placeholder.alt="";else for(let n in this.options.placeholder)this.placeholder.setAttribute(n,this.options.placeholder[n]);e.insertBefore(this.placeholder,e.firstChild)}return L.Control.Elevation._d3LazyLoader=this._lazyLoadJS("https://unpkg.com/d3@5.15.0/dist/d3.min.js","object"!=typeof d3,L.Control.Elevation._d3LazyLoader).then((function(t,e){this._initToggle(e),this._initChart(e),this._applyData(),this._map.on("zoom viewreset zoomanim",this._hidePositionMarker,this),this._map.on("resize",this._resetView,this),this._map.on("resize",this._resizeChart,this),this._map.on("mousedown",this._resetDrag,this),this._map.on("eledata_added",this._updateSummary,this),L.DomEvent.on(this._map._container,"mousewheel",this._resetDrag,this),L.DomEvent.on(this._map._container,"touchstart",this._resetDrag,this)}).bind(this,t,e)),e},onRemove:function(t){this._container=null},redraw:function(){this._resizeChart()},setZFollow:function(t){this._zFollow=t},show:function(){this._container.style.display="block"},_addData:function(t){let e=t&&t.geometry,n=t&&"FeatureCollection"===t.type,a=t&&t._latlngs;if(e)switch(e.type){case"LineString":this._addGeoJSONData(e.coordinates);break;case"MultiLineString":e.coordinates.forEach(t=>this._addGeoJSONData(t));break;default:console.warn("Unsopperted GeoJSON feature geometry type:"+e.type)}n&&t.features.forEach(t=>this._addData(t)),a&&this._addGPXdata(t._latlngs)},_addGeoJSONData:function(t){t&&t.forEach(t=>this._addPoint(t[1],t[0],t[2]))},_addGPXdata:function(t){t&&t.forEach(t=>this._addPoint(t.lat,t.lng,t.meta.ele))},_addPoint:function(t,e,n){this.options.reverseCoords&&([t,e]=[e,t]);let a=this._data||[],s=this._maxElevation||-1/0,r=this._minElevation||Infinity,l=this._distance||0,h=new L.LatLng(t,e),c=a.length?a[a.length-1].latlng:h;if(l+=Math.round(h.distanceTo(c)*this._distanceFactor/1e3*1e5)/1e5,!this.options.skipNullZCoords&&a.length>0){let d=a[a.length-1].z;if(isNaN(d)){let u=this._lastValidZ,p=n*this._heightFactor;isNaN(u)||isNaN(p)?isNaN(u)?isNaN(p)||(d=p):d=u:d=(u+p)/2,isNaN(d)?a.splice(a.length-1,1):a[a.length-1].z=d}}if(!isNaN(n*=this._heightFactor)){s=s<n?n:s,r=r>n?n:r;let m=n-this._lastValidZ;m>0?(this.track_info.ascent=(this.track_info.ascent||0)+m,this._ascent=this.track_info.ascent):m<0&&(this.track_info.descent=(this.track_info.descent||0)-m,this._descent=this.track_info.descent),this._lastValidZ=n}a.push({dist:l,x:t,y:e,z:n,latlng:h}),this._data=a,this._distance=l,this._maxElevation=s,this._minElevation=r},_appendChart:function(t){let e=t.append("g").attr("transform","translate("+this.options.margins.left+","+this.options.margins.top+")");this._appendGrid(e),this._appendAreaPath(e),this._appendAxis(e),this._appendFocusRect(e),this._appendMouseFocusG(e),this._appendLegend(e)},_appendElevationDiv:function(t){let e=document.querySelector(this.options.elevationDiv);return e||(e=L.DomUtil.create("div","leaflet-control elevation elevation-div"),this.options.elevationDiv="#elevation-div_"+Math.random().toString(36).substr(2,9),e.id=this.options.elevationDiv.substr(1),t.parentNode.insertBefore(e,t.nextSibling)),this.options.detached&&(L.DomUtil.addClass(e,"elevation-detached"),L.DomUtil.removeClass(e,"leaflet-control")),this.eleDiv=e,this.eleDiv},_appendXaxis:function(t){t.append("g").attr("class","x axis").attr("transform","translate(0,"+this._height()+")").call(d3.axisBottom().scale(this._x).ticks(this.options.xTicks)).append("text").attr("x",this._width()+6).attr("y",30).text(this._xLabel)},_appendXGrid:function(t){t.append("g").attr("class","x grid").attr("transform","translate(0,"+this._height()+")").call(d3.axisBottom().scale(this._x).ticks(this.options.xTicks).tickSize(-this._height()).tickFormat(""))},_appendYaxis:function(t){t.append("g").attr("class","y axis").call(d3.axisLeft().scale(this._y).ticks(this.options.yTicks)).append("text").attr("x",-30).attr("y",3).text(this._yLabel)},_appendYGrid:function(t){t.append("g").attr("class","y grid").call(d3.axisLeft().scale(this._y).ticks(this.options.yTicks).tickSize(-this._width()).tickFormat(""))},_appendAreaPath:function(t){this._areapath=t.append("path").attr("class","area")},_appendAxis:function(t){this._axis=t.append("g").attr("class","axis"),this._appendXaxis(this._axis),this._appendYaxis(this._axis)},_appendFocusRect:function(t){let e=this._focusRect=t.append("rect").attr("width",this._width()).attr("height",this._height()).style("fill","none").style("stroke","none").style("pointer-events","all");L.Browser.mobile&&(e.on("touchmove.drag",this._dragHandler.bind(this)).on("touchstart.drag",this._dragStartHandler.bind(this)).on("touchstart.focus",this._mousemoveHandler.bind(this)).on("touchmove.focus",this._mousemoveHandler.bind(this)),L.DomEvent.on(this._container,"touchend",this._dragEndHandler,this)),e.on("mousemove.drag",this._dragHandler.bind(this)).on("mousedown.drag",this._dragStartHandler.bind(this)).on("mouseenter.focus",this._mouseenterHandler.bind(this)).on("mousemove.focus",this._mousemoveHandler.bind(this)).on("mouseout.focus",this._mouseoutHandler.bind(this)),L.DomEvent.on(this._container,"mouseup",this._dragEndHandler,this)},_appendGrid:function(t){this._grid=t.append("g").attr("class","grid"),this._appendXGrid(this._grid),this._appendYGrid(this._grid)},_appendMouseFocusG:function(t){let e=this._focusG=t.append("g").attr("class","mouse-focus-group");this._mousefocus=e.append("svg:line").attr("class","mouse-focus-line").attr("x2","0").attr("y2","0").attr("x1","0").attr("y1","0"),this._focuslabelrect=e.append("rect").attr("class","mouse-focus-label").attr("x",0).attr("y",0).attr("width",0).attr("height",0).attr("rx",3).attr("ry",3),this._focuslabeltext=e.append("svg:text").attr("class","mouse-focus-label-text"),this._focuslabelY=this._focuslabeltext.append("svg:tspan").attr("class","mouse-focus-label-y").attr("dy","-1em"),this._focuslabelX=this._focuslabeltext.append("svg:tspan").attr("class","mouse-focus-label-x").attr("dy","2em")},_appendLegend:function(t){if(!this.options.legend)return;let e=this._legend=t.append("g").attr("class","legend"),n=this._altitudeLegend=this._legend.append("g").attr("class","legend-altitude");n.append("rect").attr("class","area").attr("x",this._width()/2-50).attr("y",this._height()+this.options.margins.bottom-17).attr("width",50).attr("height",5).attr("opacity",.75),n.append("text").text(L._("Altitude")).attr("x",this._width()/2+5).attr("font-size",10).style("text-decoration-thickness","2px").style("font-weight","700").attr("y",this._height()+this.options.margins.bottom-11),e.on("click",(function(){if(this._chartEnabled)this._clearChart(),this._clearPath(),this._chartEnabled=!1;else{for(let t in this._resizeChart(),this._layers)L.DomUtil.addClass(this._layers[t]._path,this.options.polyline.className+" "+this.options.theme);this._chartEnabled=!0}}).bind(this))},_appendPositionMarker:function(t){let e=this.options.theme,n=t.select("g");this._mouseHeightFocus=n.append("svg:line").attr("class",e+" height-focus line").attr("x2",0).attr("y2",0).attr("x1",0).attr("y1",0),this._pointG=n.append("g"),this._pointG.append("svg:circle").attr("class",e+" height-focus circle-lower").attr("r",6).attr("cx",0).attr("cy",0),this._mouseHeightFocusLabel=n.append("svg:text").attr("class",e+" height-focus-label").style("pointer-events","none")},_applyData:function(){if(!this._data)return;let t=d3.extent(this._data,t=>t.dist),e=d3.extent(this._data,t=>t.z),n=this.options;void 0!==n.yAxisMin&&(n.yAxisMin<e[0]||n.forceAxisBounds)&&(e[0]=n.yAxisMin),void 0!==n.yAxisMax&&(n.yAxisMax>e[1]||n.forceAxisBounds)&&(e[1]=n.yAxisMax),this._x.domain(t),this._y.domain(e),this._areapath.datum(this._data).attr("d",this._area),this._updateAxis(),this._fullExtent=this._calculateFullExtent(this._data)},_calculateFullExtent:function(t){if(!t||t.length<1)throw Error("no data in parameters");let e=new L.latLngBounds(t[0].latlng,t[0].latlng);return t.forEach(t=>e.extend(t.latlng)),e},_clearChart:function(){this._resetDrag(),this._areapath&&(this._areapath.attr("d","M0 0"),this._x.domain([0,1]),this._y.domain([0,1]),this._updateAxis()),this._altitudeLegend&&this._altitudeLegend.select("text").style("text-decoration-line","line-through")},_clearData:function(){this._data=null,this._distance=null,this._maxElevation=null,this._minElevation=null,this.track_info=null,this._layers=null},_clearPath:function(){for(let t in this._hidePositionMarker(),this._layers)L.DomUtil.removeClass(this._layers[t]._path,this.options.polyline.className),L.DomUtil.removeClass(this._layers[t]._path,this.options.theme)},_collapse:function(){this._container&&(L.DomUtil.removeClass(this._container,"elevation-expanded"),L.DomUtil.addClass(this._container,"elevation-collapsed"))},_deepMerge:function(t,...e){if(!e.length)return t;let n=e.shift();if(this._isObject(t)&&this._isObject(n))for(let a in n)this._isObject(n[a])?(t[a]||Object.assign(t,{[a]:{}}),this._deepMerge(t[a],n[a])):Object.assign(t,{[a]:n[a]});return this._deepMerge(t,...e)},_dragHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!0,this._drawDragRectangle()},_dragEndHandler:function(){if(!this._dragStartCoords||!this._dragCurrentCoords||!this._gotDragged){this._dragStartCoords=null,this._gotDragged=!1,this._draggingEnabled&&this._resetDrag();return}let t=this._findItemForX(this._dragStartCoords[0]),e=this._findItemForX(this._dragCurrentCoords[0]);t!=e&&(this._hidePositionMarker(),this._fitSection(t,e),this._dragStartCoords=null,this._gotDragged=!1,this._fireEvt("elechart_dragged",{data:{dragstart:this._data[t],dragend:this._data[e]}},!0))},_dragStartHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!1,this._dragStartCoords=d3.mouse(this._focusRect.node())},_drawDragRectangle:function(){if(!this._dragStartCoords||!this._draggingEnabled)return;let t=this._dragCurrentCoords=d3.mouse(this._focusRect.node()),e=Math.min(this._dragStartCoords[0],t[0]),n=Math.max(this._dragStartCoords[0],t[0]);if(this._dragRectangle||this._dragRectangleG)this._dragRectangle.attr("width",n-e).attr("x",e);else{let a=d3.select(this._container).select("svg").select("g");this._dragRectangleG=a.insert("g",".mouse-focus-group"),this._dragRectangle=this._dragRectangleG.append("rect").attr("width",n-e).attr("height",this._height()).attr("x",e).attr("class","mouse-drag").style("pointer-events","none")}},_expand:function(){this._container&&(L.DomUtil.removeClass(this._container,"elevation-collapsed"),L.DomUtil.addClass(this._container,"elevation-expanded"))},_findItemForLatLng:function(t){let e=null,n=1/0;return this._data.forEach(a=>{let s=t.distanceTo(a.latlng);s<n&&(n=s,e=a)}),e},_findItemForX:function(t){let e=this._data?this._data:[0,1],n;return(0,d3.bisector(t=>t.dist).left)(e,this._x.invert(t))},_fireEvt:function(t,e,n){this.fire&&this.fire(t,e,n),this._map&&this._map.fire(t,e,n)},_fitSection:function(t,e){let n=this._calculateFullExtent(this._data.slice(Math.min(t,e),Math.max(t,e)));this.fitBounds(n)},_formatter:function(t,e,n){let a=L.Util.formatNum(t,e).toString(),s=a.split(".");if(s[1]){for(let r=e-s[1].length;r>0;r--)s[1]+="0";a=s.join(n||".")}return a},_height:function(){let t=this.options;return t.height-t.margins.top-t.margins.bottom},_hidePositionMarker:function(){this.options.autohideMarker&&(this._selectedItem=null,this._marker&&(this._map&&this._map.removeLayer(this._marker),this._marker=null),this._mouseHeightFocus&&(this._mouseHeightFocus.style("visibility","hidden"),this._mouseHeightFocusLabel.style("visibility","hidden")),this._pointG&&this._pointG.style("visibility","hidden"),this._focusG&&this._focusG.style("visibility","hidden"))},_initChart:function(){let t=this.options;if(t.xTicks=t.xTicks||Math.round(this._width()/75),t.yTicks=t.yTicks||Math.round(this._height()/30),t.hoverNumber.formatter=t.hoverNumber.formatter||this._formatter,t.responsive){if(t.detached){let e=this.eleDiv.offsetWidth,n=this.eleDiv.offsetHeight;t.width=e>0?e:t.width,t.height=n-20>0?n-20:t.height}else{t._maxWidth=t._maxWidth>t.width?t._maxWidth:t.width;let a=this._map._container.clientWidth;t.width=t._maxWidth>a?a-30:t.width}}let s=this._x=d3.scaleLinear().range([0,this._width()]),r=this._y=d3.scaleLinear().range([this._height(),0]),l="function"==typeof t.interpolation?t.interpolation:d3[t.interpolation];this._area=d3.area().curve(l).x(t=>t.xDiagCoord=s(t.dist)).y0(this._height()).y1(t=>r(t.z)),this._line=d3.line().x(t=>d3.mouse(c.select("g"))[0]).y(t=>this._height());let h=d3.select(this._container),c=h.append("svg").attr("class","background").attr("width",t.width).attr("height",t.height);this.summaryDiv=h.append("div").attr("class","elevation-summary "+(this.options.summary?this.options.summary+"-summary":"")).node(),this._appendChart(c),this._updateSummary()},_initToggle:function(t){if(t.setAttribute("aria-haspopup",!0),this.options.detached||L.DomEvent.disableClickPropagation(t),L.Browser.mobile&&L.DomEvent.on(t,"click",L.DomEvent.stopPropagation),!this.options.detached){let e="elevation-toggle "+this.options.controlButton.iconCssClass+(this.options.autohide?"":" close-button"),n=this._button=L.DomUtil.create("a",e,t);n.href="#",n.title=this.options.controlButton.title,this.options.collapsed&&(this._collapse(),this.options.autohide?L.DomEvent.on(t,"mouseover",this._expand,this).on(t,"mouseout",this._collapse,this):L.DomEvent.on(n,"click",L.DomEvent.stop).on(n,"click",this._toggle,this),L.DomEvent.on(n,"focus",this._toggle,this),this._map.on("click",this._collapse,this))}},_isObject:function(t){return t&&"object"==typeof t&&!Array.isArray(t)},_isJSONDoc:function(t,e){if(e=void 0===e||e,"string"==typeof t&&e)return 0==(t=t.trim()).indexOf("{")||0==t.indexOf("[");try{JSON.parse(t.toString())}catch(n){if("object"==typeof t&&e)return!0;return console.warn(n),!1}return!0},_isXMLDoc:function(t,e){if(e=void 0===e||e,"string"==typeof t&&e)return 0==(t=t.trim()).indexOf("<");{let n=(t?t.ownerDocument||t:0).documentElement;return!!n&&"HTML"!==n.nodeName}},_isDomVisible:function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},_isVisible:function(t){var e,n,a,s;if(!t)return!1;let r=window.getComputedStyle(t);if("hidden"===(n=r).visibility||"none"===n.display)return!1;let l,h,c,d,u,p;return a=t,s=r,h=(l=a.getBoundingClientRect()).left+1,c=l.right-1,d=l.top+1,l.bottom,u=!0,p=a.style.pointerEvents,"none"==s["pointer-events"]&&(a.style.pointerEvents="auto"),document.elementFromPoint(h,d)!==a&&(u=!1),document.elementFromPoint(c,d)!==a&&(u=!1),a.style.pointerEvents=p,!!u},_lazyLoadJS:function(t,e,n){return!1!==e&&this.options.lazyLoadJS?n instanceof Promise?n:new Promise((e,n)=>{let a=document.createElement("script");a.addEventListener("load",e,{once:!0}),a.src=t,document.head.appendChild(a)}):Promise.resolve()},_mouseenterHandler:function(){this._fireEvt("elechart_enter",null,!0)},_mousemoveHandler:function(t,e,n){if(!this._data||0===this._data.length||!this._chartEnabled)return;let a=d3.mouse(this._focusRect.node())[0],s=this._data[this._findItemForX(a)];this._hidePositionMarker(),this._showDiagramIndicator(s,a),this._showPositionMarker(s),this._setMapView(s),this._map&&this._map._container&&L.DomUtil.addClass(this._map._container,"elechart-hover"),this._fireEvt("elechart_change",{data:s},!0),this._fireEvt("elechart_hover",{data:s},!0)},_mousemoveLayerHandler:function(t){if(!this._data||0===this._data.length)return;let e=t.latlng,n=this._findItemForLatLng(e);if(n){let a=n.xDiagCoord;this._hidePositionMarker(),this._showDiagramIndicator(n,a),this._showPositionMarker(n)}},_mouseoutHandler:function(){this.options.detached||this._hidePositionMarker(),this._map&&this._map._container&&L.DomUtil.removeClass(this._map._container,"elechart-hover"),this._fireEvt("elechart_leave",null,!0)},_mousewheelHandler:function(t){if(this._map.gestureHandling&&this._map.gestureHandling._enabled)return;let e=this._selectedItem?this._selectedItem.latlng:this._map.getCenter(),n=t.deltaY>0?this._map.getZoom()-1:this._map.getZoom()+1;this._resetDrag(),this._map.flyTo(e,n)},_resetDrag:function(){this._dragRectangleG&&(this._dragRectangleG.remove(),this._dragRectangleG=null,this._dragRectangle=null,this._hidePositionMarker())},_resetView:function(){this._map&&this._map._isFullscreen||(this._resetDrag(),this._hidePositionMarker(),this.fitBounds(this._fullExtent))},_resizeChart:function(){if(this.options.responsive){if(this.options.detached){let t=this.eleDiv.offsetWidth;t<=0||(this.options.width=t,this.eleDiv.innerHTML="",this.eleDiv.appendChild(this.onAdd(this._map)))}else this._map.removeControl(this._container),this.addTo(this._map)}},_saveFile:function(t){let e=document,n=e.createElement("a"),a=e.body;n.href=t,n.target="_new",n.download="",n.style.display="none",a.appendChild(n),n.click(),a.removeChild(n)},_showDiagramIndicator:function(t,e){if(!this._chartEnabled)return;let n=this.options;this._focusG.style("visibility","visible"),this._mousefocus.attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",this._height()).classed("hidden",!1);let a=t.z,s=t.dist,r=(t.latlng,n.hoverNumber.formatter(a,n.hoverNumber.decimalsY)),l=n.hoverNumber.formatter(s,n.hoverNumber.decimalsX);this._focuslabeltext.attr("y",this._y(t.z)).style("font-weight","700"),this._focuslabelX.text(l+" "+this._xLabel).attr("x",e+10),this._focuslabelY.text(r+" "+this._yLabel).attr("x",e+10);let h=this._focuslabeltext.node();if(this._isDomVisible(h)){let c=h.getBBox();this._focuslabelrect.attr("x",c.x-2).attr("y",c.y-2).attr("width",c.width+4).attr("height",c.height+4),e>=this._width()/2&&(this._focuslabelrect.attr("x",this._focuslabelrect.attr("x")-this._focuslabelrect.attr("width")-4-10),this._focuslabelX.attr("x",this._focuslabelX.attr("x")-this._focuslabelrect.attr("width")-4-10),this._focuslabelY.attr("x",this._focuslabelY.attr("x")-this._focuslabelrect.attr("width")-4-10))}},_toggle:function(){L.DomUtil.hasClass(this._container,"elevation-expanded")?this._collapse():this._expand()},_setMapView:function(t){if(!this.options.followMarker||!this._map)return;let e=this._map.getZoom();e=e<this._zFollow?this._zFollow:e,this._map.setView(t.latlng,e,{animate:!0,duration:.25})},_showPositionMarker:function(t){this._selectedItem=t,this._map&&!this._map.getPane("elevationPane")&&(this._map.createPane("elevationPane"),this._map.getPane("elevationPane").style.zIndex=625,this._map.getPane("elevationPane").style.pointerEvents="none"),"elevation-line"==this.options.marker?this._updatePositionMarker(t):"position-marker"==this.options.marker&&this._updateLeafletMarker(t)},_updateAxis:function(){this._grid.selectAll("g").remove(),this._axis.selectAll("g").remove(),this._appendXGrid(this._grid),this._appendYGrid(this._grid),this._appendXaxis(this._axis),this._appendYaxis(this._axis)},_updateHeightIndicator:function(t){let e=this.options,n=e.hoverNumber.formatter(t.z,e.hoverNumber.decimalsY);e.hoverNumber.formatter(t.dist,e.hoverNumber.decimalsX);let a=this._height()/this._maxElevation*t.z,s=t.y-a;this._mouseHeightFocus.attr("x1",t.x).attr("x2",t.x).attr("y1",t.y).attr("y2",s).style("visibility","visible"),this._mouseHeightFocusLabel.attr("x",t.x).attr("y",s).text(n+" "+this._yLabel).style("visibility","visible")},_updateLeafletMarker:function(t){let e=t.latlng;this._marker?this._marker.setLatLng(e):(this._marker=new L.Marker(e,{icon:this.options.markerIcon,zIndexOffset:1e6}),this._marker.addTo(this._map,{pane:"elevationPane"}))},_updatePointG:function(t){this._pointG.attr("transform","translate("+t.x+","+t.y+")").style("visibility","visible")},_updatePositionMarker:function(t){let e=this._map.latLngToLayerPoint(t.latlng),n={dist:t.dist,x:e.x,y:e.y,z:t.z};if(!this._mouseHeightFocus){L.svg({pane:"elevationPane"}).addTo(this._map);let a=d3.select(this._map.getContainer()).select(".leaflet-elevation-pane svg");this._appendPositionMarker(a)}this._updatePointG(n),this._updateHeightIndicator(n)},_updateSummary:function(){this.summaryDiv.innerHTML="",this.track_info=this.track_info||{},this.track_info.distance=this._distance||0,this.track_info.elevation_max=this._maxElevation||0,this.track_info.elevation_min=this._minElevation||0,this.track_info.ascent=this._ascent||0,this.track_info.descent=this._descent||0,this.options.summary&&(this.summaryDiv.innerHTML+='<span class="totlen"><span class="summarylabel">'+L._("Total Length: ")+'</span><span class="summaryvalue">'+this.track_info.distance.toFixed(2)+" "+this._xLabel+'</span></span><span class="maxele"><span class="summarylabel">'+L._("Max Elevation: ")+'</span><span class="summaryvalue">'+this.track_info.elevation_max.toFixed(2)+" "+this._yLabel+'</span></span><span class="minele"><span class="summarylabel">'+L._("Min Elevation: ")+'</span><span class="summaryvalue">'+this.track_info.elevation_min.toFixed(2)+" "+this._yLabel+'</span></span><span class="totasc"><span class="summarylabel">'+L._("Total Ascent: ")+'</span><span class="summaryvalue">'+this.track_info.ascent.toFixed(0)+" "+this._yLabel+'</span></span><span class="totdesc"><span class="summarylabel">'+L._("Total Descent: ")+'</span><span class="summaryvalue">'+this.track_info.descent.toFixed(0)+" "+this._yLabel+"</span></span>"),this.options.downloadLink&&this._downloadURL&&(this.summaryDiv.innerHTML+='<span class="download"><a href="#">'+L._("Download")+"</a></span>",this.summaryDiv.querySelector(".download a").onclick=(function(t){t.preventDefault();let e={confirm:this._saveFile.bind(this,this._downloadURL)},n=this.options.downloadLink;"modal"==n?("function"==typeof CustomEvent&&document.dispatchEvent(new CustomEvent("eletrack_download",{detail:e})),this._fireEvt("eletrack_download",e)):("link"==n||!0===n)&&e.confirm()}).bind(this))},_width:function(){let t=this.options;return t.width-t.margins.left-t.margins.right}}),L.control.elevation=function(t){return new L.Control.Elevation(t)}}),function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(module.exports=t(require("leaflet"))),void 0!==e&&e.L&&t(e.L)}(function(t){Waymark_L.Editable=Waymark_L.Evented.extend({statics:{FORWARD:1,BACKWARD:-1},options:{zIndex:1e3,polygonClass:Waymark_L.Polygon,polylineClass:Waymark_L.Polyline,markerClass:Waymark_L.Marker,rectangleClass:Waymark_L.Rectangle,circleClass:Waymark_L.Circle,drawingCSSClass:"leaflet-editable-drawing",drawingCursor:"crosshair",editLayer:void 0,featuresLayer:void 0,polylineEditorClass:void 0,polygonEditorClass:void 0,markerEditorClass:void 0,rectangleEditorClass:void 0,circleEditorClass:void 0,lineGuideOptions:{},skipMiddleMarkers:!1},initialize:function(t,e){Waymark_L.setOptions(this,e),this._lastZIndex=this.options.zIndex,this.map=t,this.editLayer=this.createEditLayer(),this.featuresLayer=this.createFeaturesLayer(),this.forwardLineGuide=this.createLineGuide(),this.backwardLineGuide=this.createLineGuide()},fireAndForward:function(t,e){(e=e||{}).editTools=this,this.fire(t,e),this.map.fire(t,e)},createLineGuide:function(){var t=Waymark_L.extend({dashArray:"5,10",weight:1,interactive:!1},this.options.lineGuideOptions);return Waymark_L.polyline([],t)},createVertexIcon:function(t){return Waymark_L.Browser.mobile&&Waymark_L.Browser.touch?new Waymark_L.Editable.TouchVertexIcon(t):new Waymark_L.Editable.VertexIcon(t)},createEditLayer:function(){return this.options.editLayer||new Waymark_L.LayerGroup().addTo(this.map)},createFeaturesLayer:function(){return this.options.featuresLayer||new Waymark_L.LayerGroup().addTo(this.map)},moveForwardLineGuide:function(t){this.forwardLineGuide._latlngs.length&&(this.forwardLineGuide._latlngs[1]=t,this.forwardLineGuide._bounds.extend(t),this.forwardLineGuide.redraw())},moveBackwardLineGuide:function(t){this.backwardLineGuide._latlngs.length&&(this.backwardLineGuide._latlngs[1]=t,this.backwardLineGuide._bounds.extend(t),this.backwardLineGuide.redraw())},anchorForwardLineGuide:function(t){this.forwardLineGuide._latlngs[0]=t,this.forwardLineGuide._bounds.extend(t),this.forwardLineGuide.redraw()},anchorBackwardLineGuide:function(t){this.backwardLineGuide._latlngs[0]=t,this.backwardLineGuide._bounds.extend(t),this.backwardLineGuide.redraw()},attachForwardLineGuide:function(){this.editLayer.addLayer(this.forwardLineGuide)},attachBackwardLineGuide:function(){this.editLayer.addLayer(this.backwardLineGuide)},detachForwardLineGuide:function(){this.forwardLineGuide.setLatLngs([]),this.editLayer.removeLayer(this.forwardLineGuide)},detachBackwardLineGuide:function(){this.backwardLineGuide.setLatLngs([]),this.editLayer.removeLayer(this.backwardLineGuide)},blockEvents:function(){this._oldTargets||(this._oldTargets=this.map._targets,this.map._targets={})},unblockEvents:function(){this._oldTargets&&(this.map._targets=Waymark_L.extend(this.map._targets,this._oldTargets),delete this._oldTargets)},registerForDrawing:function(t){this._drawingEditor&&this.unregisterForDrawing(this._drawingEditor),this.blockEvents(),t.reset(),this._drawingEditor=t,this.map.on("mousemove touchmove",t.onDrawingMouseMove,t),this.map.on("mousedown",this.onMousedown,this),this.map.on("mouseup",this.onMouseup,this),Waymark_L.DomUtil.addClass(this.map._container,this.options.drawingCSSClass),this.defaultMapCursor=this.map._container.style.cursor,this.map._container.style.cursor=this.options.drawingCursor},unregisterForDrawing:function(t){this.unblockEvents(),Waymark_L.DomUtil.removeClass(this.map._container,this.options.drawingCSSClass),this.map._container.style.cursor=this.defaultMapCursor,(t=t||this._drawingEditor)&&(this.map.off("mousemove touchmove",t.onDrawingMouseMove,t),this.map.off("mousedown",this.onMousedown,this),this.map.off("mouseup",this.onMouseup,this),t===this._drawingEditor&&(delete this._drawingEditor,t._drawing&&t.cancelDrawing()))},onMousedown:function(t){1==t.originalEvent.which&&(this._mouseDown=t,this._drawingEditor.onDrawingMouseDown(t))},onMouseup:function(t){if(this._mouseDown){var e=this._drawingEditor,n=this._mouseDown;if(this._mouseDown=null,e.onDrawingMouseUp(t),this._drawingEditor===e){var a=Waymark_L.point(n.originalEvent.clientX,n.originalEvent.clientY);Math.abs(Waymark_L.point(t.originalEvent.clientX,t.originalEvent.clientY).distanceTo(a))<9*(window.devicePixelRatio||1)&&this._drawingEditor.onDrawingClick(t)}}},drawing:function(){return this._drawingEditor&&this._drawingEditor.drawing()},stopDrawing:function(){this.unregisterForDrawing()},commitDrawing:function(t){this._drawingEditor&&this._drawingEditor.commitDrawing(t)},connectCreatedToMap:function(t){return this.featuresLayer.addLayer(t)},startPolyline:function(t,e){var n=this.createPolyline([],e);return n.enableEdit(this.map).newShape(t),n},startPolygon:function(t,e){var n=this.createPolygon([],e);return n.enableEdit(this.map).newShape(t),n},startMarker:function(t,e){t=t||this.map.getCenter().clone();var n=this.createMarker(t,e);return n.enableEdit(this.map).startDrawing(),n},startRectangle:function(t,e){var n=t||Waymark_L.latLng([0,0]),a=new Waymark_L.LatLngBounds(n,n),s=this.createRectangle(a,e);return s.enableEdit(this.map).startDrawing(),s},startCircle:function(t,e){t=t||this.map.getCenter().clone();var n=this.createCircle(t,e);return n.enableEdit(this.map).startDrawing(),n},startHole:function(t,e){t.newHole(e)},createLayer:function(t,e,n){n=Waymark_L.Util.extend({editOptions:{editTools:this}},n);var a=new t(e,n);return this.fireAndForward("editable:created",{layer:a}),a},createPolyline:function(t,e){return this.createLayer(e&&e.polylineClass||this.options.polylineClass,t,e)},createPolygon:function(t,e){return this.createLayer(e&&e.polygonClass||this.options.polygonClass,t,e)},createMarker:function(t,e){return this.createLayer(e&&e.markerClass||this.options.markerClass,t,e)},createRectangle:function(t,e){return this.createLayer(e&&e.rectangleClass||this.options.rectangleClass,t,e)},createCircle:function(t,e){return this.createLayer(e&&e.circleClass||this.options.circleClass,t,e)}}),Waymark_L.extend(Waymark_L.Editable,{makeCancellable:function(t){t.cancel=function(){t._cancelled=!0}}}),Waymark_L.Map.mergeOptions({editToolsClass:Waymark_L.Editable,editable:!1,editOptions:{}}),Waymark_L.Map.addInitHook(function(){this.whenReady(function(){this.options.editable&&(this.editTools=new this.options.editToolsClass(this,this.options.editOptions))})}),Waymark_L.Editable.VertexIcon=Waymark_L.DivIcon.extend({options:{iconSize:new Waymark_L.Point(8,8)}}),Waymark_L.Editable.TouchVertexIcon=Waymark_L.Editable.VertexIcon.extend({options:{iconSize:new Waymark_L.Point(20,20)}}),Waymark_L.Editable.VertexMarker=Waymark_L.Marker.extend({options:{draggable:!0,className:"leaflet-div-icon leaflet-vertex-icon"},initialize:function(t,e,n,a){this.latlng=t,this.latlngs=e,this.editor=n,Waymark_L.Marker.prototype.initialize.call(this,t,a),this.options.icon=this.editor.tools.createVertexIcon({className:this.options.className}),this.latlng.__vertex=this,this.editor.editLayer.addLayer(this),this.setZIndexOffset(n.tools._lastZIndex+1)},onAdd:function(t){Waymark_L.Marker.prototype.onAdd.call(this,t),this.on("drag",this.onDrag),this.on("dragstart",this.onDragStart),this.on("dragend",this.onDragEnd),this.on("mouseup",this.onMouseup),this.on("click",this.onClick),this.on("contextmenu",this.onContextMenu),this.on("mousedown touchstart",this.onMouseDown),this.on("mouseover",this.onMouseOver),this.on("mouseout",this.onMouseOut),this.addMiddleMarkers()},onRemove:function(t){this.middleMarker&&this.middleMarker.delete(),delete this.latlng.__vertex,this.off("drag",this.onDrag),this.off("dragstart",this.onDragStart),this.off("dragend",this.onDragEnd),this.off("mouseup",this.onMouseup),this.off("click",this.onClick),this.off("contextmenu",this.onContextMenu),this.off("mousedown touchstart",this.onMouseDown),this.off("mouseover",this.onMouseOver),this.off("mouseout",this.onMouseOut),Waymark_L.Marker.prototype.onRemove.call(this,t)},onDrag:function(t){t.vertex=this,this.editor.onVertexMarkerDrag(t);var e=Waymark_L.DomUtil.getPosition(this._icon),n=this._map.layerPointToLatLng(e);this.latlng.update(n),this._latlng=this.latlng,this.editor.refresh(),this.middleMarker&&this.middleMarker.updateLatLng();var a=this.getNext();a&&a.middleMarker&&a.middleMarker.updateLatLng()},onDragStart:function(t){t.vertex=this,this.editor.onVertexMarkerDragStart(t)},onDragEnd:function(t){t.vertex=this,this.editor.onVertexMarkerDragEnd(t)},onClick:function(t){t.vertex=this,this.editor.onVertexMarkerClick(t)},onMouseup:function(t){Waymark_L.DomEvent.stop(t),t.vertex=this,this.editor.map.fire("mouseup",t)},onContextMenu:function(t){t.vertex=this,this.editor.onVertexMarkerContextMenu(t)},onMouseDown:function(t){t.vertex=this,this.editor.onVertexMarkerMouseDown(t)},onMouseOver:function(t){t.vertex=this,this.editor.onVertexMarkerMouseOver(t)},onMouseOut:function(t){t.vertex=this,this.editor.onVertexMarkerMouseOut(t)},delete:function(){var t=this.getNext();this.latlngs.splice(this.getIndex(),1),this.editor.editLayer.removeLayer(this),this.editor.onVertexDeleted({latlng:this.latlng,vertex:this}),this.latlngs.length||this.editor.deleteShape(this.latlngs),t&&t.resetMiddleMarker(),this.editor.refresh()},getIndex:function(){return this.latlngs.indexOf(this.latlng)},getLastIndex:function(){return this.latlngs.length-1},getPrevious:function(){if(!(this.latlngs.length<2)){var t=this.getIndex(),e=t-1;0===t&&this.editor.CLOSED&&(e=this.getLastIndex());var n=this.latlngs[e];if(n)return n.__vertex}},getNext:function(){if(!(this.latlngs.length<2)){var t=this.getIndex(),e=t+1;t===this.getLastIndex()&&this.editor.CLOSED&&(e=0);var n=this.latlngs[e];if(n)return n.__vertex}},addMiddleMarker:function(t){this.editor.hasMiddleMarkers()&&(t=t||this.getPrevious())&&!this.middleMarker&&(this.middleMarker=this.editor.addMiddleMarker(t,this,this.latlngs,this.editor))},addMiddleMarkers:function(){if(this.editor.hasMiddleMarkers()){var t=this.getPrevious();t&&this.addMiddleMarker(t);var e=this.getNext();e&&e.resetMiddleMarker()}},resetMiddleMarker:function(){this.middleMarker&&this.middleMarker.delete(),this.addMiddleMarker()},split:function(){this.editor.splitShape&&this.editor.splitShape(this.latlngs,this.getIndex())},continue:function(){if(this.editor.continueBackward){var t=this.getIndex();0===t?this.editor.continueBackward(this.latlngs):t===this.getLastIndex()&&this.editor.continueForward(this.latlngs)}}}),Waymark_L.Editable.mergeOptions({vertexMarkerClass:Waymark_L.Editable.VertexMarker}),Waymark_L.Editable.MiddleMarker=Waymark_L.Marker.extend({options:{opacity:.5,className:"leaflet-div-icon leaflet-middle-icon",draggable:!0},initialize:function(t,e,n,a,s){this.left=t,this.right=e,this.editor=a,this.latlngs=n,Waymark_L.Marker.prototype.initialize.call(this,this.computeLatLng(),s),this._opacity=this.options.opacity,this.options.icon=this.editor.tools.createVertexIcon({className:this.options.className}),this.editor.editLayer.addLayer(this),this.setVisibility()},setVisibility:function(){var t=this._map.latLngToContainerPoint(this.left.latlng),e=this._map.latLngToContainerPoint(this.right.latlng),n=Waymark_L.point(this.options.icon.options.iconSize);t.distanceTo(e)<3*n.x?this.hide():this.show()},show:function(){this.setOpacity(this._opacity)},hide:function(){this.setOpacity(0)},updateLatLng:function(){this.setLatLng(this.computeLatLng()),this.setVisibility()},computeLatLng:function(){var t=this.editor.map.latLngToContainerPoint(this.left.latlng),e=this.editor.map.latLngToContainerPoint(this.right.latlng),n=(t.y+e.y)/2,a=(t.x+e.x)/2;return this.editor.map.containerPointToLatLng([a,n])},onAdd:function(t){Waymark_L.Marker.prototype.onAdd.call(this,t),Waymark_L.DomEvent.on(this._icon,"mousedown touchstart",this.onMouseDown,this),t.on("zoomend",this.setVisibility,this)},onRemove:function(t){delete this.right.middleMarker,Waymark_L.DomEvent.off(this._icon,"mousedown touchstart",this.onMouseDown,this),t.off("zoomend",this.setVisibility,this),Waymark_L.Marker.prototype.onRemove.call(this,t)},onMouseDown:function(t){var e=Waymark_L.DomUtil.getPosition(this._icon);if(t={originalEvent:t,latlng:this.editor.map.layerPointToLatLng(e)},0!==this.options.opacity&&(Waymark_L.Editable.makeCancellable(t),this.editor.onMiddleMarkerMouseDown(t),!t._cancelled)){this.latlngs.splice(this.index(),0,t.latlng),this.editor.refresh();var n=this._icon,a=this.editor.addVertexMarker(t.latlng,this.latlngs);this.editor.onNewVertex(a);var s=a._icon.parentNode;s.removeChild(a._icon),a._icon=n,s.appendChild(a._icon),a._initIcon(),a._initInteraction(),a.setOpacity(1),Waymark_L.Draggable._dragging=!1,a.dragging._draggable._onDown(t.originalEvent),this.delete()}},delete:function(){this.editor.editLayer.removeLayer(this)},index:function(){return this.latlngs.indexOf(this.right.latlng)}}),Waymark_L.Editable.mergeOptions({middleMarkerClass:Waymark_L.Editable.MiddleMarker}),Waymark_L.Editable.BaseEditor=Waymark_L.Handler.extend({initialize:function(t,e,n){Waymark_L.setOptions(this,n),this.map=t,this.feature=e,this.feature.editor=this,this.editLayer=new Waymark_L.LayerGroup,this.tools=this.options.editTools||t.editTools},addHooks:function(){this.isConnected()?this.onFeatureAdd():this.feature.once("add",this.onFeatureAdd,this),this.onEnable(),this.feature.on(this._getEvents(),this)},removeHooks:function(){this.feature.off(this._getEvents(),this),this.feature.dragging&&this.feature.dragging.disable(),this.editLayer.clearLayers(),this.tools.editLayer.removeLayer(this.editLayer),this.onDisable(),this._drawing&&this.cancelDrawing()},drawing:function(){return!!this._drawing},reset:function(){},onFeatureAdd:function(){this.tools.editLayer.addLayer(this.editLayer),this.feature.dragging&&this.feature.dragging.enable()},hasMiddleMarkers:function(){return!this.options.skipMiddleMarkers&&!this.tools.options.skipMiddleMarkers},fireAndForward:function(t,e){(e=e||{}).layer=this.feature,this.feature.fire(t,e),this.tools.fireAndForward(t,e)},onEnable:function(){this.fireAndForward("editable:enable")},onDisable:function(){this.fireAndForward("editable:disable")},onEditing:function(){this.fireAndForward("editable:editing")},onStartDrawing:function(){this.fireAndForward("editable:drawing:start")},onEndDrawing:function(){this.fireAndForward("editable:drawing:end")},onCancelDrawing:function(){this.fireAndForward("editable:drawing:cancel")},onCommitDrawing:function(t){this.fireAndForward("editable:drawing:commit",t)},onDrawingMouseDown:function(t){this.fireAndForward("editable:drawing:mousedown",t)},onDrawingMouseUp:function(t){this.fireAndForward("editable:drawing:mouseup",t)},startDrawing:function(){this._drawing||(this._drawing=Waymark_L.Editable.FORWARD),this.tools.registerForDrawing(this),this.onStartDrawing()},commitDrawing:function(t){this.onCommitDrawing(t),this.endDrawing()},cancelDrawing:function(){Waymark_L.Draggable._dragging=!1,this.onCancelDrawing(),this.endDrawing()},endDrawing:function(){this._drawing=!1,this.tools.unregisterForDrawing(this),this.onEndDrawing()},onDrawingClick:function(t){this.drawing()&&(Waymark_L.Editable.makeCancellable(t),this.fireAndForward("editable:drawing:click",t),t._cancelled||(this.isConnected()||this.connect(t),this.processDrawingClick(t)))},isConnected:function(){return this.map.hasLayer(this.feature)},connect:function(){this.tools.connectCreatedToMap(this.feature),this.tools.editLayer.addLayer(this.editLayer)},onMove:function(t){this.fireAndForward("editable:drawing:move",t)},onDrawingMouseMove:function(t){this.onMove(t)},_getEvents:function(){return{dragstart:this.onDragStart,drag:this.onDrag,dragend:this.onDragEnd,remove:this.disable}},onDragStart:function(t){this.onEditing(),this.fireAndForward("editable:dragstart",t)},onDrag:function(t){this.onMove(t),this.fireAndForward("editable:drag",t)},onDragEnd:function(t){this.fireAndForward("editable:dragend",t)}}),Waymark_L.Editable.MarkerEditor=Waymark_L.Editable.BaseEditor.extend({onDrawingMouseMove:function(t){Waymark_L.Editable.BaseEditor.prototype.onDrawingMouseMove.call(this,t),this._drawing&&this.feature.setLatLng(t.latlng)},processDrawingClick:function(t){this.fireAndForward("editable:drawing:clicked",t),this.commitDrawing(t)},connect:function(t){t&&(this.feature._latlng=t.latlng),Waymark_L.Editable.BaseEditor.prototype.connect.call(this,t)}}),Waymark_L.Editable.PathEditor=Waymark_L.Editable.BaseEditor.extend({CLOSED:!1,MIN_VERTEX:2,addHooks:function(){return Waymark_L.Editable.BaseEditor.prototype.addHooks.call(this),this.feature&&this.initVertexMarkers(),this},initVertexMarkers:function(t){if(this.enabled()){if(a(t=t||this.getLatLngs()))this.addVertexMarkers(t);else for(var e=0;e<t.length;e++)this.initVertexMarkers(t[e])}},getLatLngs:function(){return this.feature.getLatLngs()},reset:function(){this.editLayer.clearLayers(),this.initVertexMarkers()},addVertexMarker:function(t,e){return new this.tools.options.vertexMarkerClass(t,e,this)},onNewVertex:function(t){this.fireAndForward("editable:vertex:new",{latlng:t.latlng,vertex:t})},addVertexMarkers:function(t){for(var e=0;e<t.length;e++)this.addVertexMarker(t[e],t)},refreshVertexMarkers:function(t){t=t||this.getDefaultLatLngs();for(var e=0;e<t.length;e++)t[e].__vertex.update()},addMiddleMarker:function(t,e,n){return new this.tools.options.middleMarkerClass(t,e,n,this)},onVertexMarkerClick:function(t){if(Waymark_L.Editable.makeCancellable(t),this.fireAndForward("editable:vertex:click",t),!t._cancelled&&(!this.tools.drawing()||this.tools._drawingEditor===this)){var e,n=t.vertex.getIndex();t.originalEvent.ctrlKey?this.onVertexMarkerCtrlClick(t):t.originalEvent.altKey?this.onVertexMarkerAltClick(t):t.originalEvent.shiftKey?this.onVertexMarkerShiftClick(t):t.originalEvent.metaKey?this.onVertexMarkerMetaKeyClick(t):n===t.vertex.getLastIndex()&&this._drawing===Waymark_L.Editable.FORWARD?n>=this.MIN_VERTEX-1&&(e=!0):0===n&&this._drawing===Waymark_L.Editable.BACKWARD&&this._drawnLatLngs.length>=this.MIN_VERTEX?e=!0:0===n&&this._drawing===Waymark_L.Editable.FORWARD&&this._drawnLatLngs.length>=this.MIN_VERTEX&&this.CLOSED?e=!0:this.onVertexRawMarkerClick(t),this.fireAndForward("editable:vertex:clicked",t),e&&this.commitDrawing(t)}},onVertexRawMarkerClick:function(t){this.fireAndForward("editable:vertex:rawclick",t),!t._cancelled&&this.vertexCanBeDeleted(t.vertex)&&t.vertex.delete()},vertexCanBeDeleted:function(t){return t.latlngs.length>this.MIN_VERTEX},onVertexDeleted:function(t){this.fireAndForward("editable:vertex:deleted",t)},onVertexMarkerCtrlClick:function(t){this.fireAndForward("editable:vertex:ctrlclick",t)},onVertexMarkerShiftClick:function(t){this.fireAndForward("editable:vertex:shiftclick",t)},onVertexMarkerMetaKeyClick:function(t){this.fireAndForward("editable:vertex:metakeyclick",t)},onVertexMarkerAltClick:function(t){this.fireAndForward("editable:vertex:altclick",t)},onVertexMarkerContextMenu:function(t){this.fireAndForward("editable:vertex:contextmenu",t)},onVertexMarkerMouseDown:function(t){this.fireAndForward("editable:vertex:mousedown",t)},onVertexMarkerMouseOver:function(t){this.fireAndForward("editable:vertex:mouseover",t)},onVertexMarkerMouseOut:function(t){this.fireAndForward("editable:vertex:mouseout",t)},onMiddleMarkerMouseDown:function(t){this.fireAndForward("editable:middlemarker:mousedown",t)},onVertexMarkerDrag:function(t){this.onMove(t),this.feature._bounds&&this.extendBounds(t),this.fireAndForward("editable:vertex:drag",t)},onVertexMarkerDragStart:function(t){this.fireAndForward("editable:vertex:dragstart",t)},onVertexMarkerDragEnd:function(t){this.fireAndForward("editable:vertex:dragend",t)},setDrawnLatLngs:function(t){this._drawnLatLngs=t||this.getDefaultLatLngs()},startDrawing:function(){this._drawnLatLngs||this.setDrawnLatLngs(),Waymark_L.Editable.BaseEditor.prototype.startDrawing.call(this)},startDrawingForward:function(){this.startDrawing()},endDrawing:function(){this.tools.detachForwardLineGuide(),this.tools.detachBackwardLineGuide(),this._drawnLatLngs&&this._drawnLatLngs.length<this.MIN_VERTEX&&this.deleteShape(this._drawnLatLngs),Waymark_L.Editable.BaseEditor.prototype.endDrawing.call(this),delete this._drawnLatLngs},addLatLng:function(t){this._drawing===Waymark_L.Editable.FORWARD?this._drawnLatLngs.push(t):this._drawnLatLngs.unshift(t),this.feature._bounds.extend(t);var e=this.addVertexMarker(t,this._drawnLatLngs);this.onNewVertex(e),this.refresh()},newPointForward:function(t){this.addLatLng(t),this.tools.attachForwardLineGuide(),this.tools.anchorForwardLineGuide(t)},newPointBackward:function(t){this.addLatLng(t),this.tools.anchorBackwardLineGuide(t)},push:function(t){if(!t)return console.error("Waymark_L.Editable.PathEditor.push expect a valid latlng as parameter");this._drawing===Waymark_L.Editable.FORWARD?this.newPointForward(t):this.newPointBackward(t)},removeLatLng:function(t){t.__vertex.delete(),this.refresh()},pop:function(){var t;if(!(this._drawnLatLngs.length<=1))return t=this._drawing===Waymark_L.Editable.FORWARD?this._drawnLatLngs[this._drawnLatLngs.length-1]:this._drawnLatLngs[0],this.removeLatLng(t),this._drawing===Waymark_L.Editable.FORWARD?this.tools.anchorForwardLineGuide(this._drawnLatLngs[this._drawnLatLngs.length-1]):this.tools.anchorForwardLineGuide(this._drawnLatLngs[0]),t},processDrawingClick:function(t){t.vertex&&t.vertex.editor===this||(this._drawing===Waymark_L.Editable.FORWARD?this.newPointForward(t.latlng):this.newPointBackward(t.latlng),this.fireAndForward("editable:drawing:clicked",t))},onDrawingMouseMove:function(t){Waymark_L.Editable.BaseEditor.prototype.onDrawingMouseMove.call(this,t),this._drawing&&(this.tools.moveForwardLineGuide(t.latlng),this.tools.moveBackwardLineGuide(t.latlng))},refresh:function(){this.feature.redraw(),this.onEditing()},newShape:function(t){var e=this.addNewEmptyShape();e&&(this.setDrawnLatLngs(e[0]||e),this.startDrawingForward(),this.fireAndForward("editable:shape:new",{shape:e}),t&&this.newPointForward(t))},deleteShape:function(t,e){var n={shape:t};if(Waymark_L.Editable.makeCancellable(n),this.fireAndForward("editable:shape:delete",n),!n._cancelled)return t=this._deleteShape(t,e),this.ensureNotFlat&&this.ensureNotFlat(),this.feature.setLatLngs(this.getLatLngs()),this.refresh(),this.reset(),this.fireAndForward("editable:shape:deleted",{shape:t}),t},_deleteShape:function(t,e){if((e=e||this.getLatLngs()).length){var n,a,s=this,r=function(t,e){return t.splice(t.indexOf(e),1),t.length||s._deleteShape(t),e};if(e===t)return a=(n=e).splice(0,Number.MAX_VALUE);for(var l=0;l<e.length;l++){if(e[l]===t)return r(e,t);if(-1!==e[l].indexOf(t))return r(e[l],t)}}},deleteShapeAt:function(t){var e=this.feature.shapeAt(t);if(e)return this.deleteShape(e)},appendShape:function(t){this.insertShape(t)},prependShape:function(t){this.insertShape(t,0)},insertShape:function(t,e){this.ensureMulti(),t=this.formatShape(t),void 0===e&&(e=this.feature._latlngs.length),this.feature._latlngs.splice(e,0,t),this.feature.redraw(),this._enabled&&this.reset()},extendBounds:function(t){this.feature._bounds.extend(t.vertex.latlng)},onDragStart:function(t){this.editLayer.clearLayers(),Waymark_L.Editable.BaseEditor.prototype.onDragStart.call(this,t)},onDragEnd:function(t){this.initVertexMarkers(),Waymark_L.Editable.BaseEditor.prototype.onDragEnd.call(this,t)}}),Waymark_L.Editable.PolylineEditor=Waymark_L.Editable.PathEditor.extend({startDrawingBackward:function(){this._drawing=Waymark_L.Editable.BACKWARD,this.startDrawing()},continueBackward:function(t){this.drawing()||(t=t||this.getDefaultLatLngs(),this.setDrawnLatLngs(t),t.length>0&&(this.tools.attachBackwardLineGuide(),this.tools.anchorBackwardLineGuide(t[0])),this.startDrawingBackward())},continueForward:function(t){this.drawing()||(t=t||this.getDefaultLatLngs(),this.setDrawnLatLngs(t),t.length>0&&(this.tools.attachForwardLineGuide(),this.tools.anchorForwardLineGuide(t[t.length-1])),this.startDrawingForward())},getDefaultLatLngs:function(t){return!(t=t||this.feature._latlngs).length||t[0]instanceof Waymark_L.LatLng?t:this.getDefaultLatLngs(t[0])},ensureMulti:function(){this.feature._latlngs.length&&a(this.feature._latlngs)&&(this.feature._latlngs=[this.feature._latlngs])},addNewEmptyShape:function(){if(!this.feature._latlngs.length)return this.feature._latlngs;var t=[];return this.appendShape(t),t},formatShape:function(t){return a(t)?t:t[0]?this.formatShape(t[0]):void 0},splitShape:function(t,e){if(e&&!(e>=t.length-1)){this.ensureMulti();var n=this.feature._latlngs.indexOf(t);if(-1!==n){var a=t.slice(0,e+1),s=t.slice(e);s[0]=Waymark_L.latLng(s[0].lat,s[0].lng,s[0].alt),this.feature._latlngs.splice(n,1,a,s),this.refresh(),this.reset()}}}}),Waymark_L.Editable.PolygonEditor=Waymark_L.Editable.PathEditor.extend({CLOSED:!0,MIN_VERTEX:3,newPointForward:function(t){Waymark_L.Editable.PathEditor.prototype.newPointForward.call(this,t),this.tools.backwardLineGuide._latlngs.length||this.tools.anchorBackwardLineGuide(t),2===this._drawnLatLngs.length&&this.tools.attachBackwardLineGuide()},addNewEmptyHole:function(t){this.ensureNotFlat();var e=this.feature.shapeAt(t);if(e){var n=[];return e.push(n),n}},newHole:function(t){var e=this.addNewEmptyHole(t);e&&(this.setDrawnLatLngs(e),this.startDrawingForward(),t&&this.newPointForward(t))},addNewEmptyShape:function(){if(!this.feature._latlngs.length||!this.feature._latlngs[0].length)return this.feature._latlngs;var t=[];return this.appendShape(t),t},ensureMulti:function(){this.feature._latlngs.length&&a(this.feature._latlngs[0])&&(this.feature._latlngs=[this.feature._latlngs])},ensureNotFlat:function(){(!this.feature._latlngs.length||a(this.feature._latlngs))&&(this.feature._latlngs=[this.feature._latlngs])},vertexCanBeDeleted:function(t){var e=this.feature.parentShape(t.latlngs);return Waymark_L.Util.indexOf(e,t.latlngs)>0||Waymark_L.Editable.PathEditor.prototype.vertexCanBeDeleted.call(this,t)},getDefaultLatLngs:function(){return this.feature._latlngs.length||this.feature._latlngs.push([]),this.feature._latlngs[0]},formatShape:function(t){return a(t)&&(!t[0]||0!==t[0].length)?[t]:t}}),Waymark_L.Editable.RectangleEditor=Waymark_L.Editable.PathEditor.extend({CLOSED:!0,MIN_VERTEX:4,options:{skipMiddleMarkers:!0},extendBounds:function(t){var e=t.vertex.getIndex(),n=t.vertex.getNext(),a=t.vertex.getPrevious(),s=t.vertex.latlngs[(e+2)%4],r=new Waymark_L.LatLngBounds(t.latlng,s);a.latlng.update([t.latlng.lat,s.lng]),n.latlng.update([s.lat,t.latlng.lng]),this.updateBounds(r),this.refreshVertexMarkers()},onDrawingMouseDown:function(t){Waymark_L.Editable.PathEditor.prototype.onDrawingMouseDown.call(this,t),this.connect();var e=this.getDefaultLatLngs();3===e.length&&e.push(t.latlng);var n=new Waymark_L.LatLngBounds(t.latlng,t.latlng);this.updateBounds(n),this.updateLatLngs(n),this.refresh(),this.reset(),t.originalEvent._simulated=!1,this.map.dragging._draggable._onUp(t.originalEvent),e[3].__vertex.dragging._draggable._onDown(t.originalEvent)},onDrawingMouseUp:function(t){this.commitDrawing(t),t.originalEvent._simulated=!1,Waymark_L.Editable.PathEditor.prototype.onDrawingMouseUp.call(this,t)},onDrawingMouseMove:function(t){t.originalEvent._simulated=!1,Waymark_L.Editable.PathEditor.prototype.onDrawingMouseMove.call(this,t)},getDefaultLatLngs:function(t){return t||this.feature._latlngs[0]},updateBounds:function(t){this.feature._bounds=t},updateLatLngs:function(t){for(var e=this.getDefaultLatLngs(),n=this.feature._boundsToLatLngs(t),a=0;a<e.length;a++)e[a].update(n[a])}}),Waymark_L.Editable.CircleEditor=Waymark_L.Editable.PathEditor.extend({MIN_VERTEX:2,options:{skipMiddleMarkers:!0},initialize:function(t,e,n){Waymark_L.Editable.PathEditor.prototype.initialize.call(this,t,e,n),this._resizeLatLng=this.computeResizeLatLng()},computeResizeLatLng:function(){var t=(this.feature._radius||this.feature._mRadius)*Math.cos(Math.PI/4),e=this.map.project(this.feature._latlng);return this.map.unproject([e.x+t,e.y-t])},updateResizeLatLng:function(){this._resizeLatLng.update(this.computeResizeLatLng()),this._resizeLatLng.__vertex.update()},getLatLngs:function(){return[this.feature._latlng,this._resizeLatLng]},getDefaultLatLngs:function(){return this.getLatLngs()},onVertexMarkerDrag:function(t){1===t.vertex.getIndex()?this.resize(t):this.updateResizeLatLng(t),Waymark_L.Editable.PathEditor.prototype.onVertexMarkerDrag.call(this,t)},resize:function(t){var e=this.feature._latlng.distanceTo(t.latlng);this.feature.setRadius(e)},onDrawingMouseDown:function(t){Waymark_L.Editable.PathEditor.prototype.onDrawingMouseDown.call(this,t),this._resizeLatLng.update(t.latlng),this.feature._latlng.update(t.latlng),this.connect(),t.originalEvent._simulated=!1,this.map.dragging._draggable._onUp(t.originalEvent),this._resizeLatLng.__vertex.dragging._draggable._onDown(t.originalEvent)},onDrawingMouseUp:function(t){this.commitDrawing(t),t.originalEvent._simulated=!1,Waymark_L.Editable.PathEditor.prototype.onDrawingMouseUp.call(this,t)},onDrawingMouseMove:function(t){t.originalEvent._simulated=!1,Waymark_L.Editable.PathEditor.prototype.onDrawingMouseMove.call(this,t)},onDrag:function(t){Waymark_L.Editable.PathEditor.prototype.onDrag.call(this,t),this.feature.dragging.updateLatLng(this._resizeLatLng)}});var e={createEditor:function(t){t=t||this._map;var e=(this.options.editOptions||{}).editTools||t.editTools;if(!e)throw Error("Unable to detect Editable instance.");return new(this.options.editorClass||this.getEditorClass(e))(t,this,this.options.editOptions)},enableEdit:function(t){return this.editor||this.createEditor(t),this.editor.enable(),this.editor},editEnabled:function(){return this.editor&&this.editor.enabled()},disableEdit:function(){this.editor&&(this.editor.disable(),delete this.editor)},toggleEdit:function(){this.editEnabled()?this.disableEdit():this.enableEdit()},_onEditableAdd:function(){this.editor&&this.enableEdit()}},n=function(){this.on("add",this._onEditableAdd)},a=Waymark_L.LineUtil.isFlat||Waymark_L.LineUtil._flat||Waymark_L.Polyline._flat;Waymark_L.Polyline&&(Waymark_L.Polyline.include(e),Waymark_L.Polyline.include({getEditorClass:function(t){return t&&t.options.polylineEditorClass?t.options.polylineEditorClass:Waymark_L.Editable.PolylineEditor},shapeAt:function(t,e){var n=null;if((e=e||this._latlngs).length){if(a(e)&&this.isInLatLngs(t,e))n=e;else for(var s=0;s<e.length;s++)if(this.isInLatLngs(t,e[s]))return e[s]}return n},isInLatLngs:function(t,e){if(!e)return!1;var n,a,s,r,l=[],h=this._clickTolerance();if(this._projectLatlngs(e,l,this._pxBounds),l=l[0],r=this._map.latLngToLayerPoint(t),!this._pxBounds.contains(r))return!1;for(n=1,s=l.length,a=0;n<s;a=n++)if(Waymark_L.LineUtil.pointToSegmentDistance(r,l[a],l[n])<=h)return!0;return!1}}),Waymark_L.Polyline.addInitHook(n)),Waymark_L.Polygon&&(Waymark_L.Polygon.include(e),Waymark_L.Polygon.include({getEditorClass:function(t){return t&&t.options.polygonEditorClass?t.options.polygonEditorClass:Waymark_L.Editable.PolygonEditor},shapeAt:function(t,e){var n=null;if((e=e||this._latlngs).length){if(a(e)&&this.isInLatLngs(t,e))n=e;else if(a(e[0])&&this.isInLatLngs(t,e[0]))n=e;else for(var s=0;s<e.length;s++)if(this.isInLatLngs(t,e[s][0]))return e[s]}return n},isInLatLngs:function(t,e){var n,a,s,r,l,h=!1;for(s=0,r=(l=e.length)-1;s<l;r=s++)n=e[s],a=e[r],n.lat>t.lat!=a.lat>t.lat&&t.lng<(a.lng-n.lng)*(t.lat-n.lat)/(a.lat-n.lat)+n.lng&&(h=!h);return h},parentShape:function(t,e){if(e=e||this._latlngs){var n=Waymark_L.Util.indexOf(e,t);if(-1!==n)return e;for(var a=0;a<e.length;a++)if(-1!==(n=Waymark_L.Util.indexOf(e[a],t)))return e[a]}}})),Waymark_L.Marker&&(Waymark_L.Marker.include(e),Waymark_L.Marker.include({getEditorClass:function(t){return t&&t.options.markerEditorClass?t.options.markerEditorClass:Waymark_L.Editable.MarkerEditor}}),Waymark_L.Marker.addInitHook(n)),Waymark_L.Rectangle&&(Waymark_L.Rectangle.include(e),Waymark_L.Rectangle.include({getEditorClass:function(t){return t&&t.options.rectangleEditorClass?t.options.rectangleEditorClass:Waymark_L.Editable.RectangleEditor}})),Waymark_L.Circle&&(Waymark_L.Circle.include(e),Waymark_L.Circle.include({getEditorClass:function(t){return t&&t.options.circleEditorClass?t.options.circleEditorClass:Waymark_L.Editable.CircleEditor}})),Waymark_L.LatLng.prototype.update=function(t){t=Waymark_L.latLng(t),this.lat=t.lat,this.lng=t.lng}},window),Waymark_L.FeatureGroup.SubGroup=Waymark_L.FeatureGroup.extend({initialize:function(t,e){Waymark_L.FeatureGroup.prototype.initialize.call(this,e),this.setParentGroup(t)},setParentGroup:function(t){var e=t instanceof Waymark_L.LayerGroup;return this._parentGroup=t,this.onAdd=e?"function"==typeof t.addLayers?this._onAddToGroupBatch:this._onAddToGroup:this._onAddToMap,this.onRemove=e?"function"==typeof t.removeLayers?this._onRemoveFromGroupBatch:this._onRemoveFromGroup:this._onRemoveFromMap,this.addLayer=e?this._addLayerToGroup:this._addLayerToMap,this.removeLayer=e?this._removeLayerFromGroup:this._removeLayerFromMap,this},setParentGroupSafe:function(t){var e=this._map;return e&&e.removeLayer(this),this.setParentGroup(t),e&&e.addLayer(this),this},getParentGroup:function(){return this._parentGroup},_onAddToGroupBatch:function(t){var e=this.getLayers();this._map=t,this._parentGroup.addLayers(e)},_onRemoveFromGroupBatch:function(){var t=this.getLayers();this._parentGroup.removeLayers(t),this._map=null},_onAddToGroup:function(t){var e=this._parentGroup;this._map=t,this.eachLayer(e.addLayer,e)},_onRemoveFromGroup:function(){var t=this._parentGroup;this.eachLayer(t.removeLayer,t),this._map=null},_onAddToMap:Waymark_L.FeatureGroup.prototype.onAdd,_onRemoveFromMap:Waymark_L.FeatureGroup.prototype.onRemove,_addLayerToGroup:function(t){if(this.hasLayer(t))return this;t.addEventParent(this);var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._parentGroup.addLayer(t),this.fire("layeradd",{layer:t})},_removeLayerFromGroup:function(t){if(!this.hasLayer(t))return this;var e=t in this._layers?t:this.getLayerId(t);return(t=this._layers[e]).removeEventParent(this),this._map&&t&&this._parentGroup.removeLayer(t),delete this._layers[e],this.fire("layerremove",{layer:t})},_addLayerToMap:Waymark_L.FeatureGroup.prototype.addLayer,_removeLayerFromMap:Waymark_L.FeatureGroup.prototype.removeLayer}),Waymark_L.featureGroup.subGroup=function(t,e){return new Waymark_L.FeatureGroup.SubGroup(t,e)},function(t){var e;if("function"==typeof define&&define.amd)define(["leaflet"],t);else if("undefined"!=typeof module)e=require("leaflet"),module.exports=t(e);else{if(void 0===window.L)throw Error("Leaflet must be loaded first");t(window.L)}}(function(t){Waymark_L.Control.Fullscreen=Waymark_L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(t){var e=Waymark_L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=Waymark_L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",e),this.link.href="#",this._map=t,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),Waymark_L.DomEvent.on(this.link,"click",this._click,this),e},_click:function(t){Waymark_L.DomEvent.stopPropagation(t),Waymark_L.DomEvent.preventDefault(t),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}}),Waymark_L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(t){var e=this.getContainer();this.isFullscreen()?t&&t.pseudoFullscreen?this._disablePseudoFullscreen(e):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(e):t&&t.pseudoFullscreen?this._enablePseudoFullscreen(e):e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen?e.msRequestFullscreen():this._enablePseudoFullscreen(e)},_enablePseudoFullscreen:function(t){Waymark_L.DomUtil.addClass(t,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(t){Waymark_L.DomUtil.removeClass(t,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(t){this._isFullscreen=t;var e=this.getContainer();t?Waymark_L.DomUtil.addClass(e,"leaflet-fullscreen-on"):Waymark_L.DomUtil.removeClass(e,"leaflet-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(t){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;e!==this.getContainer()||this._isFullscreen?e!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange")):(this._setFullscreen(!0),this.fire("fullscreenchange"))}}),Waymark_L.Map.mergeOptions({fullscreenControl:!1}),Waymark_L.Map.addInitHook(function(){if(this.options.fullscreenControl&&(this.fullscreenControl=new Waymark_L.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl)),"onfullscreenchange"in document?t="fullscreenchange":"onmozfullscreenchange"in document?t="mozfullscreenchange":"onwebkitfullscreenchange"in document?t="webkitfullscreenchange":"onmsfullscreenchange"in document&&(t="MSFullscreenChange"),t){var t,e=Waymark_L.bind(this._onFullscreenChange,this);this.whenReady(function(){Waymark_L.DomEvent.on(document,t,e)}),this.on("unload",function(){Waymark_L.DomEvent.off(document,t,e)})}}),Waymark_L.control.fullscreen=function(t){return new Waymark_L.Control.Fullscreen(t)}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t.Leaflet=t.Leaflet||{},t.Leaflet.markercluster=t.Leaflet.markercluster||{}))}(this,function(t){"use strict";var e=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var e=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,e?this._withAnimation:this._noAnimation),this._markerCluster=e?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(t){if(t instanceof L.LayerGroup)return this.addLayers([t]);if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this.fire("layeradd",{layer:t}),this;if(!this._map)return this._needsClustering.push(t),this.fire("layeradd",{layer:t}),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom),this.fire("layeradd",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var e=t,n=this._zoom;if(t.__parent)for(;e.__parent._zoom>=n;)e=e.__parent;return this._currentShownBounds.contains(e.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,e):this._animationAddLayerNonAnimated(t,e)),this},removeLayer:function(t){return t instanceof L.LayerGroup?this.removeLayers([t]):t.getLatLng?this._map?(t.__parent&&(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this.fire("layerremove",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),t.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow())),this):(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push({layer:t,latlng:t._latlng}),this.fire("layerremove",{layer:t}),this):(this._nonPointGroup.removeLayer(t),this.fire("layerremove",{layer:t}),this)},addLayers:function(t,e){if(!L.Util.isArray(t))return this.addLayer(t);var n,a=this._featureGroup,s=this._nonPointGroup,r=this.options.chunkedLoading,l=this.options.chunkInterval,h=this.options.chunkProgress,c=t.length,d=0,u=!0;if(this._map){var p=(new Date).getTime(),m=L.bind(function(){for(var f=(new Date).getTime();c>d&&!(r&&0==d%200&&(new Date).getTime()-f>l);d++){if((n=t[d])instanceof L.LayerGroup)u&&(t=t.slice(),u=!1),this._extractNonGroupLayers(n,t),c=t.length;else if(n.getLatLng){if(!this.hasLayer(n)&&(this._addLayer(n,this._maxZoom),e||this.fire("layeradd",{layer:n}),n.__parent&&2===n.__parent.getChildCount())){var g=n.__parent.getAllChildMarkers(),y=g[0]===n?g[1]:g[0];a.removeLayer(y)}}else s.addLayer(n),e||this.fire("layeradd",{layer:n})}h&&h(d,c,(new Date).getTime()-p),d===c?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(m,this.options.chunkDelay)},this);m()}else for(var f=this._needsClustering;c>d;d++)(n=t[d])instanceof L.LayerGroup?(u&&(t=t.slice(),u=!1),this._extractNonGroupLayers(n,t),c=t.length):n.getLatLng?this.hasLayer(n)||f.push(n):s.addLayer(n);return this},removeLayers:function(t){var e,n,a=t.length,s=this._featureGroup,r=this._nonPointGroup,l=!0;if(!this._map){for(e=0;a>e;e++)(n=t[e])instanceof L.LayerGroup?(l&&(t=t.slice(),l=!1),this._extractNonGroupLayers(n,t),a=t.length):(this._arraySplice(this._needsClustering,n),r.removeLayer(n),this.hasLayer(n)&&this._needsRemoving.push({layer:n,latlng:n._latlng}),this.fire("layerremove",{layer:n}));return this}if(this._unspiderfy){this._unspiderfy();var h=t.slice(),c=a;for(e=0;c>e;e++)(n=h[e])instanceof L.LayerGroup?(this._extractNonGroupLayers(n,h),c=h.length):this._unspiderfyLayer(n)}for(e=0;a>e;e++)(n=t[e])instanceof L.LayerGroup?(l&&(t=t.slice(),l=!1),this._extractNonGroupLayers(n,t),a=t.length):n.__parent?(this._removeLayer(n,!0,!0),this.fire("layerremove",{layer:n}),s.hasLayer(n)&&(s.removeLayer(n),n.clusterShow&&n.clusterShow())):(r.removeLayer(n),this.fire("layerremove",{layer:n}));return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){t.off(this._childMarkerEventHandlers,this),delete t.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;this._topClusterLevel&&t.extend(this._topClusterLevel._bounds);for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var n,a,s,r=this._needsClustering.slice(),l=this._needsRemoving;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(r),a=r.length-1;a>=0;a--){for(n=!0,s=l.length-1;s>=0;s--)if(l[s].layer===r[a]){n=!1;break}n&&t.call(e,r[a])}this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},getLayer:function(t){var e=null;return t=parseInt(t,10),this.eachLayer(function(n){L.stamp(n)===t&&(e=n)}),e},hasLayer:function(t){if(!t)return!1;var e,n=this._needsClustering;for(e=n.length-1;e>=0;e--)if(n[e]===t)return!0;for(e=(n=this._needsRemoving).length-1;e>=0;e--)if(n[e].layer===t)return!1;return!(!t.__parent||t.__parent._group!==this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){"function"!=typeof e&&(e=function(){});var n=function(){!t._icon&&!t.__parent._icon||this._inZoomAnimation||(this._map.off("moveend",n,this),this.off("animationend",n,this),t._icon?e():t.__parent._icon&&(this.once("spiderfied",e,this),t.__parent.spiderfy()))};t._icon&&this._map.getBounds().contains(t.getLatLng())?e():t.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",n,this),this._map.panTo(t.getLatLng())):(this._map.on("moveend",n,this),this.on("animationend",n,this),t.__parent.zoomToBounds())},onAdd:function(t){var e,n,a;if(this._map=t,!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(t),this._nonPointGroup.addTo(t),this._gridClusters||this._generateInitialClusters(),this._maxLat=t.options.crs.projection.MAX_LATITUDE,e=0,n=this._needsRemoving.length;n>e;e++)(a=this._needsRemoving[e]).newlatlng=a.layer._latlng,a.layer._latlng=a.latlng;for(e=0,n=this._needsRemoving.length;n>e;e++)a=this._needsRemoving[e],this._removeLayer(a.layer,!0),a.layer._latlng=a.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),n=this._needsClustering,this._needsClustering=[],this.addLayers(n,!0)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var n=t.length-1;n>=0;n--)if(t[n]===e)return t.splice(n,1),!0},_removeFromGridUnclustered:function(t,e){for(var n=this._map,a=this._gridUnclustered,s=Math.floor(this._map.getMinZoom());e>=s&&a[e].removeObject(t,n.project(t.getLatLng(),e));e--);},_childMarkerDragStart:function(t){t.target.__dragStart=t.target._latlng},_childMarkerMoved:function(t){if(!this._ignoreMove&&!t.target.__dragStart){var e=t.target._popup&&t.target._popup.isOpen();this._moveChild(t.target,t.oldLatLng,t.latlng),e&&t.target.openPopup()}},_moveChild:function(t,e,n){t._latlng=e,this.removeLayer(t),t._latlng=n,this.addLayer(t)},_childMarkerDragEnd:function(t){var e=t.target.__dragStart;delete t.target.__dragStart,e&&this._moveChild(t.target,e,t.target._latlng)},_removeLayer:function(t,e,n){var a=this._gridClusters,s=this._gridUnclustered,r=this._featureGroup,l=this._map,h=Math.floor(this._map.getMinZoom());e&&this._removeFromGridUnclustered(t,this._maxZoom);var c,d=t.__parent,u=d._markers;for(this._arraySplice(u,t);d&&(d._childCount--,d._boundsNeedUpdate=!0,!(d._zoom<h));)e&&d._childCount<=1?(c=d._markers[0]===t?d._markers[1]:d._markers[0],a[d._zoom].removeObject(d,l.project(d._cLatLng,d._zoom)),s[d._zoom].addObject(c,l.project(c.getLatLng(),d._zoom)),this._arraySplice(d.__parent._childClusters,d),d.__parent._markers.push(c),c.__parent=d.__parent,d._icon&&(r.removeLayer(d),n||r.addLayer(c))):d._iconNeedsUpdate=!0,d=d.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},fire:function(t,e,n){if(e&&e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;t="cluster"+t}L.FeatureGroup.prototype.fire.call(this,t,e,n)},listens:function(t,e){return L.FeatureGroup.prototype.listens.call(this,t,e)||L.FeatureGroup.prototype.listens.call(this,"cluster"+t,e)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),n=" marker-cluster-";return n+=10>e?"small":100>e?"medium":"large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+n,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,n=this.options.showCoverageOnHover,a=this.options.zoomToBoundsOnClick;(e||a)&&this.on("clusterclick",this._zoomOrSpiderfy,this),n&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){for(var e=t.layer,n=e;1===n._childClusters.length;)n=n._childClusters[0];n._zoom===this._maxZoom&&n._childCount===e._childCount&&this.options.spiderfyOnMaxZoom?e.spiderfy():this.options.zoomToBoundsOnClick&&e.zoomToBounds(),t.originalEvent&&13===t.originalEvent.keyCode&&this._map._container.focus()},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,n=this.options.zoomToBoundsOnClick,a=this._map;(t||n)&&this.off("clusterclick",this._zoomOrSpiderfy,this),e&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),a.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=Math.ceil(this._map.getMaxZoom()),e=Math.floor(this._map.getMinZoom()),n=this.options.maxClusterRadius,a=n;"function"!=typeof n&&(a=function(){return n}),null!==this.options.disableClusteringAtZoom&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var s=t;s>=e;s--)this._gridClusters[s]=new L.DistanceGrid(a(s)),this._gridUnclustered[s]=new L.DistanceGrid(a(s));this._topClusterLevel=new this._markerCluster(this,e-1)},_addLayer:function(t,e){var n,a,s=this._gridClusters,r=this._gridUnclustered,l=Math.floor(this._map.getMinZoom());for(this.options.singleMarkerMode&&this._overrideMarkerIcon(t),t.on(this._childMarkerEventHandlers,this);e>=l;e--){n=this._map.project(t.getLatLng(),e);var h=s[e].getNearObject(n);if(h)return h._addChild(t),void(t.__parent=h);if(h=r[e].getNearObject(n)){var c=h.__parent;c&&this._removeLayer(h,!1);var d=new this._markerCluster(this,e,h,t);s[e].addObject(d,this._map.project(d._cLatLng,e)),h.__parent=d,t.__parent=d;var u=d;for(a=e-1;a>c._zoom;a--)u=new this._markerCluster(this,a,u),s[a].addObject(u,this._map.project(h.getLatLng(),a));return c._addChild(u),void this._removeFromGridUnclustered(h,e)}r[e].addObject(t,n)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()})},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var t=Math.round(this._map._zoom);this._processQueue(),this._zoom<t&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,t)):this._zoom>t?(this._animationStart(),this._animationZoomOut(this._zoom,t)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(t){var e=this._maxLat;return void 0!==e&&(t.getNorth()>=e&&(t._northEast.lat=1/0),t.getSouth()<=-e&&(t._southWest.lat=-1/0)),t},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(2===e._childCount){e._addToMap();var n=e.getAllChildMarkers();this._featureGroup.removeLayer(n[0]),this._featureGroup.removeLayer(n[1])}else e._updateIcon()},_extractNonGroupLayers:function(t,e){var n,a=t.getLayers(),s=0;for(e=e||[];s<a.length;s++)(n=a[s])instanceof L.LayerGroup?this._extractNonGroupLayers(n,e):e.push(n);return e},_overrideMarkerIcon:function(t){return t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}})}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(t,e){var n,a=this._getExpandedVisibleBounds(),s=this._featureGroup,r=Math.floor(this._map.getMinZoom());this._ignoreMove=!0,this._topClusterLevel._recursively(a,t,r,function(r){var l,h=r._latlng,c=r._markers;for(a.contains(h)||(h=null),r._isSingleParent()&&t+1===e?(s.removeLayer(r),r._recursivelyAddChildrenToMap(null,e,a)):(r.clusterHide(),r._recursivelyAddChildrenToMap(h,e,a)),n=c.length-1;n>=0;n--)l=c[n],a.contains(l._latlng)||s.removeLayer(l)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(a,e),s.eachLayer(function(t){t instanceof L.MarkerCluster||!t._icon||t.clusterShow()}),this._topClusterLevel._recursively(a,t,e,function(t){t._recursivelyRestoreChildPositions(e)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(a,t,r,function(t){s.removeLayer(t),t.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){var n=this,a=this._featureGroup;a.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.clusterHide(),this._enqueue(function(){a.removeLayer(t),t.clusterShow(),n._animationEnd()})):(this._forceLayout(),n._animationStart(),n._animationZoomOutSingle(e,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(t,e,n){var a=this._getExpandedVisibleBounds(),s=Math.floor(this._map.getMinZoom());t._recursivelyAnimateChildrenInAndAddSelfToMap(a,s,e+1,n);var r=this;this._forceLayout(),t._recursivelyBecomeVisible(a,n),this._enqueue(function(){if(1===t._childCount){var l=t._markers[0];this._ignoreMove=!0,l.setLatLng(l.getLatLng()),this._ignoreMove=!1,l.clusterShow&&l.clusterShow()}else t._recursively(a,n,s,function(t){t._recursivelyRemoveChildrenFromMap(a,s,e+1)});r._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)};var n=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(t,e,n,a){L.Marker.prototype.initialize.call(this,n?n._cLatLng||n.getLatLng():new L.LatLng(0,0),{icon:this,pane:t.options.clusterPane}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,n&&this._addChild(n),a&&this._addChild(a)},getAllChildMarkers:function(t,e){t=t||[];for(var n=this._childClusters.length-1;n>=0;n--)this._childClusters[n].getAllChildMarkers(t);for(var a=this._markers.length-1;a>=0;a--)e&&this._markers[a].__dragStart||t.push(this._markers[a]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(t){for(var e,n=this._childClusters.slice(),a=this._group._map,s=a.getBoundsZoom(this._bounds),r=this._zoom+1,l=a.getZoom();n.length>0&&s>r;){r++;var h=[];for(e=0;e<n.length;e++)h=h.concat(n[e]._childClusters);n=h}s>r?this._group._map.setView(this._latlng,r):l>=s?this._group._map.setView(this._latlng,l+1):this._group._map.fitBounds(this._bounds,t)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_setClusterCenter:function(t){this._cLatLng||(this._cLatLng=t._cLatLng||t._latlng)},_resetBounds:function(){var t=this._bounds;t._southWest&&(t._southWest.lat=1/0,t._southWest.lng=1/0),t._northEast&&(t._northEast.lat=-1/0,t._northEast.lng=-1/0)},_recalculateBounds:function(){var t,e,n,a,s=this._markers,r=this._childClusters,l=0,h=0,c=this._childCount;if(0!==c){for(this._resetBounds(),t=0;t<s.length;t++)n=s[t]._latlng,this._bounds.extend(n),l+=n.lat,h+=n.lng;for(t=0;t<r.length;t++)(e=r[t])._boundsNeedUpdate&&e._recalculateBounds(),this._bounds.extend(e._bounds),n=e._wLatLng,a=e._childCount,l+=n.lat*a,h+=n.lng*a;this._latlng=this._wLatLng=new L.LatLng(l/c,h/c),this._boundsNeedUpdate=!1}},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,n){this._recursively(t,this._group._map.getMinZoom(),n-1,function(t){var n,a,s=t._markers;for(n=s.length-1;n>=0;n--)(a=s[n])._icon&&(a._setPos(e),a.clusterHide())},function(t){var n,a,s=t._childClusters;for(n=s.length-1;n>=0;n--)(a=s[n])._icon&&(a._setPos(e),a.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,n,a){this._recursively(t,a,e,function(s){s._recursivelyAnimateChildrenIn(t,s._group._map.latLngToLayerPoint(s.getLatLng()).round(),n),s._isSingleParent()&&n-1===a?(s.clusterShow(),s._recursivelyRemoveChildrenFromMap(t,e,n)):s.clusterHide(),s._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,this._group._map.getMinZoom(),e,null,function(t){t.clusterShow()})},_recursivelyAddChildrenToMap:function(t,e,n){this._recursively(n,this._group._map.getMinZoom()-1,e,function(a){if(e!==a._zoom)for(var s=a._markers.length-1;s>=0;s--){var r=a._markers[s];n.contains(r._latlng)&&(t&&(r._backupLatlng=r.getLatLng(),r.setLatLng(t),r.clusterHide&&r.clusterHide()),a._group._featureGroup.addLayer(r))}},function(e){e._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var n=this._markers[e];n._backupLatlng&&(n.setLatLng(n._backupLatlng),delete n._backupLatlng)}if(t-1===this._zoom)for(var a=this._childClusters.length-1;a>=0;a--)this._childClusters[a]._restorePosition();else for(var s=this._childClusters.length-1;s>=0;s--)this._childClusters[s]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,n,a){var s,r;this._recursively(t,e-1,n-1,function(t){for(r=t._markers.length-1;r>=0;r--)s=t._markers[r],a&&a.contains(s._latlng)||(t._group._featureGroup.removeLayer(s),s.clusterShow&&s.clusterShow())},function(t){for(r=t._childClusters.length-1;r>=0;r--)s=t._childClusters[r],a&&a.contains(s._latlng)||(t._group._featureGroup.removeLayer(s),s.clusterShow&&s.clusterShow())})},_recursively:function(t,e,n,a,s){var r,l,h=this._childClusters,c=this._zoom;if(c>=e&&(a&&a(this),s&&c===n&&s(this)),e>c||n>c)for(r=h.length-1;r>=0;r--)(l=h[r])._boundsNeedUpdate&&l._recalculateBounds(),t.intersects(l._bounds)&&l._recursively(t,e,n,a,s)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var t=this.options.opacity;return this.setOpacity(0),this.options.opacity=t,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var n=this._getCoord(e.x),a=this._getCoord(e.y),s=this._grid,r=s[a]=s[a]||{},l=r[n]=r[n]||[],h=L.Util.stamp(t);this._objectPoint[h]=e,l.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var n,a,s=this._getCoord(e.x),r=this._getCoord(e.y),l=this._grid,h=l[r]=l[r]||{},c=h[s]=h[s]||[];for(delete this._objectPoint[L.Util.stamp(t)],n=0,a=c.length;a>n;n++)if(c[n]===t)return c.splice(n,1),1===a&&delete h[s],!0},eachObject:function(t,e){var n,a,s,r,l,h,c,d=this._grid;for(n in d)for(a in l=d[n])for(h=l[a],s=0,r=h.length;r>s;s++)(c=t.call(e,h[s]))&&(s--,r--)},getNearObject:function(t){var e,n,a,s,r,l,h,c,d=this._getCoord(t.x),u=this._getCoord(t.y),p=this._objectPoint,m=this._sqCellSize,f=null;for(e=u-1;u+1>=e;e++)if(s=this._grid[e]){for(n=d-1;d+1>=n;n++)if(r=s[n])for(a=0,l=r.length;l>a;a++)h=r[a],(m>(c=this._sqDist(p[L.Util.stamp(h)],t))||m>=c&&null===f)&&(m=c,f=h)}return f},_getCoord:function(t){var e=Math.floor(t/this._cellSize);return isFinite(e)?e:t},_sqDist:function(t,e){var n=e.x-t.x,a=e.y-t.y;return n*n+a*a}},L.QuickHull={getDistant:function(t,e){var n=e[1].lat-e[0].lat;return(e[0].lng-e[1].lng)*(t.lat-e[0].lat)+n*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var n,a,s,r=0,l=null,h=[];for(n=e.length-1;n>=0;n--)a=e[n],(s=this.getDistant(a,t))>0&&(h.push(a),s>r&&(r=s,l=a));return{maxPoint:l,newPoints:h}},buildConvexHull:function(t,e){var n=[],a=this.findMostDistantPointFromBaseLine(t,e);return a.maxPoint?n=(n=n.concat(this.buildConvexHull([t[0],a.maxPoint],a.newPoints))).concat(this.buildConvexHull([a.maxPoint,t[1]],a.newPoints)):[t[0]]},getConvexHull:function(t){var e,n=!1,a=!1,s=!1,r=!1,l=null,h=null,c=null,d=null,u=null,p=null;for(e=t.length-1;e>=0;e--){var m=t[e];(!1===n||m.lat>n)&&(l=m,n=m.lat),(!1===a||m.lat<a)&&(h=m,a=m.lat),(!1===s||m.lng>s)&&(c=m,s=m.lng),(!1===r||m.lng<r)&&(d=m,r=m.lng)}return a!==n?(p=h,u=l):(p=d,u=c),[].concat(this.buildConvexHull([p,u],t),this.buildConvexHull([u,p],t))}},L.MarkerCluster.include({getConvexHull:function(){var t,e,n=this.getAllChildMarkers(),a=[];for(e=n.length-1;e>=0;e--)t=n[e].getLatLng(),a.push(t);return L.QuickHull.getConvexHull(a)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var t,e=this.getAllChildMarkers(null,!0),n=this._group._map.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,e.length>=this._circleSpiralSwitchover?t=this._generatePointsSpiral(e.length,n):(n.y+=10,t=this._generatePointsCircle(e.length,n)),this._animationSpiderfy(e,t)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var n,a,s=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t)/this._2PI,r=this._2PI/t,l=[];for(s=Math.max(s,35),l.length=t,n=0;t>n;n++)a=this._circleStartAngle+n*r,l[n]=new L.Point(e.x+s*Math.cos(a),e.y+s*Math.sin(a))._round();return l},_generatePointsSpiral:function(t,e){var n,a=this._group.options.spiderfyDistanceMultiplier,s=a*this._spiralLengthStart,r=a*this._spiralFootSeparation,l=a*this._spiralLengthFactor*this._2PI,h=0,c=[];for(c.length=t,n=t;n>=0;n--)t>n&&(c[n]=new L.Point(e.x+s*Math.cos(h),e.y+s*Math.sin(h))._round()),h+=r/s+5e-4*n,s+=l/h;return c},_noanimationUnspiderfy:function(){var t,e,n=this._group,a=n._map,s=n._featureGroup,r=this.getAllChildMarkers(null,!0);for(n._ignoreMove=!0,this.setOpacity(1),e=r.length-1;e>=0;e--)t=r[e],s.removeLayer(t),t._preSpiderfyLatlng&&(t.setLatLng(t._preSpiderfyLatlng),delete t._preSpiderfyLatlng),t.setZIndexOffset&&t.setZIndexOffset(0),t._spiderLeg&&(a.removeLayer(t._spiderLeg),delete t._spiderLeg);n.fire("unspiderfied",{cluster:this,markers:r}),n._ignoreMove=!1,n._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(t,e){var n,a,s,r,l=this._group,h=l._map,c=l._featureGroup,d=this._group.options.spiderLegPolylineOptions;for(l._ignoreMove=!0,n=0;n<t.length;n++)r=h.layerPointToLatLng(e[n]),a=t[n],s=new L.Polyline([this._latlng,r],d),h.addLayer(s),a._spiderLeg=s,a._preSpiderfyLatlng=a._latlng,a.setLatLng(r),a.setZIndexOffset&&a.setZIndexOffset(1e6),c.addLayer(a);this.setOpacity(.3),l._ignoreMove=!1,l.fire("spiderfied",{cluster:this,markers:t})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(t,e){var n,a,s,r,l,h,c=this,d=this._group,u=d._map,p=d._featureGroup,m=this._latlng,f=u.latLngToLayerPoint(m),g=L.Path.SVG,y=L.extend({},this._group.options.spiderLegPolylineOptions),v=y.opacity;for(void 0===v&&(v=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),g?(y.opacity=0,y.className=(y.className||"")+" leaflet-cluster-spider-leg"):y.opacity=v,d._ignoreMove=!0,n=0;n<t.length;n++)a=t[n],h=u.layerPointToLatLng(e[n]),s=new L.Polyline([m,h],y),u.addLayer(s),a._spiderLeg=s,g&&(l=(r=s._path).getTotalLength()+.1,r.style.strokeDasharray=l,r.style.strokeDashoffset=l),a.setZIndexOffset&&a.setZIndexOffset(1e6),a.clusterHide&&a.clusterHide(),p.addLayer(a),a._setPos&&a._setPos(f);for(d._forceLayout(),d._animationStart(),n=t.length-1;n>=0;n--)h=u.layerPointToLatLng(e[n]),(a=t[n])._preSpiderfyLatlng=a._latlng,a.setLatLng(h),a.clusterShow&&a.clusterShow(),g&&((r=(s=a._spiderLeg)._path).style.strokeDashoffset=0,s.setStyle({opacity:v}));this.setOpacity(.3),d._ignoreMove=!1,setTimeout(function(){d._animationEnd(),d.fire("spiderfied",{cluster:c,markers:t})},200)},_animationUnspiderfy:function(t){var e,n,a,s,r,l,h=this,c=this._group,d=c._map,u=c._featureGroup,p=t?d._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):d.latLngToLayerPoint(this._latlng),m=this.getAllChildMarkers(null,!0),f=L.Path.SVG;for(c._ignoreMove=!0,c._animationStart(),this.setOpacity(1),n=m.length-1;n>=0;n--)(e=m[n])._preSpiderfyLatlng&&(e.closePopup(),e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng,l=!0,e._setPos&&(e._setPos(p),l=!1),e.clusterHide&&(e.clusterHide(),l=!1),l&&u.removeLayer(e),f&&(r=(s=(a=e._spiderLeg)._path).getTotalLength()+.1,s.style.strokeDashoffset=r,a.setStyle({opacity:0})));c._ignoreMove=!1,setTimeout(function(){var t=0;for(n=m.length-1;n>=0;n--)(e=m[n])._spiderLeg&&t++;for(n=m.length-1;n>=0;n--)(e=m[n])._spiderLeg&&(e.clusterShow&&e.clusterShow(),e.setZIndexOffset&&e.setZIndexOffset(0),t>1&&u.removeLayer(e),d.removeLayer(e._spiderLeg),delete e._spiderLeg);c._animationEnd(),c.fire("unspiderfied",{cluster:h,markers:m})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow(),t.setZIndexOffset&&t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(t){return t?t instanceof L.MarkerClusterGroup?t=t._topClusterLevel.getAllChildMarkers():t instanceof L.LayerGroup?t=t._layers:t instanceof L.MarkerCluster?t=t.getAllChildMarkers():t instanceof L.Marker&&(t=[t]):t=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(t),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(t),this},_flagParentsIconsNeedUpdate:function(t){var e,n;for(e in t)for(n=t[e].__parent;n;)n._iconNeedsUpdate=!0,n=n.__parent},_refreshSingleMarkerModeMarkers:function(t){var e,n;for(e in t)n=t[e],this.hasLayer(n)&&n.setIcon(this._overrideMarkerIcon(n))}}),L.Marker.include({refreshIconOptions:function(t,e){var n=this.options.icon;return L.setOptions(n,t),this.setIcon(n),e&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),t.MarkerClusterGroup=e,t.MarkerCluster=n}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("leaflet")):"function"==typeof define&&define.amd?define(["leaflet"],e):e(t.L)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e,n,a,s=function t(e,n){var a=e.value;return e.isInPixels?a/n:a};function r(t){if("string"==typeof t&&-1!==t.indexOf("%"))return{value:parseFloat(t)/100,isInPixels:!1};var e=t?parseFloat(t):0;return{value:e,isInPixels:e>0}}e=Waymark_L.Marker.prototype._initIcon,n=Waymark_L.Marker.prototype._setPos,a="msTransform"===Waymark_L.DomUtil.TRANSFORM,Waymark_L.Marker.addInitHook(function(){var t=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;t&&(t=t[0]+"px "+t[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||t||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(t){t.target._applyRotation()})}),Waymark_L.Marker.include({_initIcon:function(){e.call(this)},_setPos:function(t){n.call(this,t),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[Waymark_L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,a?this._icon.style[Waymark_L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[Waymark_L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(t){return this.options.rotationAngle=t,this.update(),this},setRotationOrigin:function(t){return this.options.rotationOrigin=t,this.update(),this}}),t.Symbol=t.Symbol||{},t.Symbol.Dash=t.Class.extend({options:{pixelSize:10,pathOptions:{}},initialize:function e(n){t.Util.setOptions(this,n),this.options.pathOptions.clickable=!1},buildSymbol:function e(n,a,s,r,l){var h=this.options;if(h.pixelSize<=1)return t.polyline([n.latLng,n.latLng],h.pathOptions);var c=s.project(n.latLng),d=-(n.heading-90)*(Math.PI/180),u=t.point(c.x+h.pixelSize*Math.cos(d+Math.PI)/2,c.y+h.pixelSize*Math.sin(d)/2),p=c.add(c.subtract(u));return t.polyline([s.unproject(u),s.unproject(p)],h.pathOptions)}}),t.Symbol.dash=function(e){return new t.Symbol.Dash(e)},t.Symbol.ArrowHead=t.Class.extend({options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function e(n){t.Util.setOptions(this,n),this.options.pathOptions.clickable=!1},buildSymbol:function e(n,a,s,r,l){return this.options.polygon?t.polygon(this._buildArrowPath(n,s),this.options.pathOptions):t.polyline(this._buildArrowPath(n,s),this.options.pathOptions)},_buildArrowPath:function e(n,a){var s=Math.PI/180,r=a.project(n.latLng),l=-(n.heading-90)*s,h=this.options.headAngle/2*s,c=l+h,d=l-h,u=t.point(r.x-this.options.pixelSize*Math.cos(c),r.y+this.options.pixelSize*Math.sin(c)),p=t.point(r.x-this.options.pixelSize*Math.cos(d),r.y+this.options.pixelSize*Math.sin(d));return[a.unproject(u),n.latLng,a.unproject(p)]}}),t.Symbol.arrowHead=function(e){return new t.Symbol.ArrowHead(e)},t.Symbol.Marker=t.Class.extend({options:{markerOptions:{},rotate:!1},initialize:function e(n){t.Util.setOptions(this,n),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1},buildSymbol:function e(n,a,s,r,l){return this.options.rotate&&(this.options.markerOptions.rotationAngle=n.heading+(this.options.angleCorrection||0)),t.marker(n.latLng,this.options.markerOptions)}}),t.Symbol.marker=function(e){return new t.Symbol.Marker(e)};var l=function e(n){var a;return Array.isArray(n)&&((a=n[0])instanceof t.LatLng||Array.isArray(a)&&2===a.length&&"number"==typeof a[0])};t.PolylineDecorator=t.FeatureGroup.extend({options:{patterns:[]},initialize:function e(n,a){t.FeatureGroup.prototype.initialize.call(this),t.Util.setOptions(this,a),this._map=null,this._paths=this._initPaths(n),this._bounds=this._initBounds(),this._patterns=this._initPatterns(this.options.patterns)},_initPaths:function e(n,a){var s=this;return l(n)?[a?n.concat([n[0]]):n]:n instanceof t.Polyline?this._initPaths(n.getLatLngs(),n instanceof t.Polygon):Array.isArray(n)?n.reduce(function(t,e){return t.concat(s._initPaths(e,a))},[]):[]},_initPatterns:function t(e){return e.map(this._parsePatternDef)},setPatterns:function t(e){this.options.patterns=e,this._patterns=this._initPatterns(this.options.patterns),this.redraw()},setPaths:function t(e){this._paths=this._initPaths(e),this._bounds=this._initBounds(),this.redraw()},_parsePatternDef:function t(e,n){return{symbolFactory:e.symbol,offset:r(e.offset),endOffset:r(e.endOffset),repeat:r(e.repeat)}},onAdd:function t(e){this._map=e,this._draw(),this._map.on("moveend",this.redraw,this)},onRemove:function e(n){this._map.off("moveend",this.redraw,this),this._map=null,t.FeatureGroup.prototype.onRemove.call(this,n)},_initBounds:function e(){var n=this._paths.reduce(function(t,e){return t.concat(e)},[]);return t.latLngBounds(n)},getBounds:function t(){return this._bounds},_buildSymbols:function t(e,n,a){var s=this;return a.map(function(t,r){return n.buildSymbol(t,e,s._map,r,a.length)})},_getDirectionPoints:function e(n,a){var r=this;return n.length<2?[]:(function t(e,n){var a,r=(a=e).reduce(function(t,e,n,a){var s,r;if(n>0&&(s=e,r=a[n-1],s.x!==r.x||s.y!==r.y)){var l,h,c,d,u,p,m=a[n-1],f=t.length>0?t[t.length-1].distB:0,g=(l=m,c=(h=e).x-l.x,Math.sqrt(c*c+(d=h.y-l.y)*d));t.push({a:m,b:e,distA:f,distB:f+g,heading:(u=m,(180*Math.atan2((p=e).y-u.y,p.x-u.x)/Math.PI+90+360)%360)})}return t},[]),l=r.length;if(0===l)return[];var h=r[l-1].distB,c=s(n.offset,h),d=s(n.endOffset,h),u=s(n.repeat,h),p=h*u,m=d>0?h*d:0,f=[],g=c>0?h*c:0;do f.push(g),g+=p;while(p>0&&g<h-m);var y=0,v=r[0];return f.map(function(t){for(;t>v.distB&&y<l-1;)v=r[++y];var e,n,a,s=(t-v.distA)/(v.distB-v.distA);return{pt:(e=v.a,n=v.b,a=s,n.x!==e.x?{x:e.x+a*(n.x-e.x),y:e.y+a*(n.y-e.y)}:{x:e.x,y:e.y+(n.y-e.y)*a}),heading:v.heading}})})(n.map(function(t){return r._map.project(t)}),a).map(function(e){return{latLng:r._map.unproject(t.point(e.pt)),heading:e.heading}})},redraw:function t(){this._map&&(this.clearLayers(),this._draw())},_getPatternLayers:function e(n){var a=this,s=this._map.getBounds().pad(.1);return this._paths.map(function(e){var r=a._getDirectionPoints(e,n).filter(function(t){return s.contains(t.latLng)});return t.featureGroup(a._buildSymbols(e,n.symbolFactory,r))})},_draw:function e(){var n=this;this._patterns.map(function(t){return n._getPatternLayers(t)}).forEach(function(e){n.addLayer(t.featureGroup(e))})}}),t.polylineDecorator=function(e,n){return new t.PolylineDecorator(e,n)}}),Waymark_L.Control.SleepMapControl=Waymark_L.Control.extend({initialize:function(t){Waymark_L.setOptions(this,t)},options:{position:"topright",prompt:"disable map",styles:{backgroundColor:"white",padding:"5px",border:"2px solid gray"}},buildContainer:function(){var t=this,e=Waymark_L.DomUtil.create("p","sleep-button"),n=this._nonBoundEvent.bind(this);return e.appendChild(document.createTextNode(this.options.prompt)),Waymark_L.DomEvent.addListener(e,"click",n),Waymark_L.DomEvent.addListener(e,"touchstart",n),Object.keys(this.options.styles).map(function(n){e.style[n]=t.options.styles[n]}),this._container=e},onAdd:function(){return this._container||this.buildContainer()},_nonBoundEvent:function(t){return Waymark_L.DomEvent.stop(t),this._map&&this._map.sleep._sleepMap(),!1}}),Waymark_L.Control.sleepMapControl=function(){return new Waymark_L.Control.SleepMapControl},Waymark_L.Map.mergeOptions({sleep:!0,sleepTime:750,wakeTime:750,wakeMessageTouch:"Touch to Wake",sleepNote:!0,hoverToWake:!0,sleepOpacity:.7,sleepButton:Waymark_L.Control.sleepMapControl}),Waymark_L.Map.Sleep=Waymark_L.Handler.extend({addHooks:function(){this.sleepNote=Waymark_L.DomUtil.create("p","sleep-note",this._map._container),this._enterTimeout=null,this._exitTimeout=null,this._sleepButton=this._map.options.sleepButton(),this._map.tap&&this._map.addControl(this._sleepButton);var t=this._map._container.style;t.WebkitTransition+="opacity .5s",t.MozTransition+="opacity .5s",this._setSleepNoteStyle(),this._sleepMap()},removeHooks:function(){this._map.scrollWheelZoom.enabled()||this._map.scrollWheelZoom.enable(),this._map.tap&&!this._map.tap.enabled()&&(this._map.touchZoom.enable(),this._map.dragging.enable(),this._map.tap.enable()),Waymark_L.DomUtil.setOpacity(this._map._container,1),Waymark_L.DomUtil.setOpacity(this.sleepNote,0),this._removeSleepingListeners(),this._removeAwakeListeners()},_setSleepNoteStyle:function(){var t="",e=this.sleepNote.style;if(t=this._map.tap?this._map.options.wakeMessageTouch:this._map.options.wakeMessage?this._map.options.wakeMessage:this._map.options.hoverToWake?"click or hover to wake":"click to wake",this._map.options.sleepNote&&(this.sleepNote.appendChild(document.createTextNode(t)),e.pointerEvents="none",e.maxWidth="150px",e.transitionDuration=".2s",e.zIndex=5e3,e.opacity=".6",e.margin="auto",e.textAlign="center",e.borderRadius="4px",e.top="50%",e.position="relative",e.padding="5px",e.border="solid 2px black",e.background="white",this._map.options.sleepNoteStyle)){var n=this._map.options.sleepNoteStyle;Object.keys(n).map(function(t){e[t]=n[t]})}},_wakeMap:function(t){this._stopWaiting(),this._map.scrollWheelZoom.enable(),this._map.dragging.enable(),this._map.tap&&(this._map.touchZoom.enable(),this._map.tap.enable(),this._map.addControl(this._sleepButton)),Waymark_L.DomUtil.setOpacity(this._map._container,1),this.sleepNote.style.opacity=0,this._addAwakeListeners()},_sleepMap:function(){this._stopWaiting(),this._map.scrollWheelZoom.disable(),this._map.tap&&(this._map.touchZoom.disable(),this._map.dragging.disable(),this._map.tap.disable(),this._map.removeControl(this._sleepButton)),Waymark_L.DomUtil.setOpacity(this._map._container,this._map.options.sleepOpacity),this.sleepNote.style.opacity=.4,this._addSleepingListeners()},_wakePending:function(){if(this._map.once("mousedown",this._wakeMap,this),this._map.options.hoverToWake){var t=this;this._map.once("mouseout",this._sleepMap,this),t._enterTimeout=setTimeout(function(){t._map.off("mouseout",t._sleepMap,t),t._wakeMap()},t._map.options.wakeTime)}},_sleepPending:function(){var t=this;t._map.once("mouseover",t._wakeMap,t),t._exitTimeout=setTimeout(function(){t._map.off("mouseover",t._wakeMap,t),t._sleepMap()},t._map.options.sleepTime)},_addSleepingListeners:function(){this._map.once("mouseover",this._wakePending,this),this._map.tap&&this._map.once("click",this._wakeMap,this)},_addAwakeListeners:function(){this._map.once("mouseout",this._sleepPending,this)},_removeSleepingListeners:function(){this._map.options.hoverToWake&&this._map.off("mouseover",this._wakePending,this),this._map.off("mousedown",this._wakeMap,this),this._map.tap&&this._map.off("click",this._wakeMap,this)},_removeAwakeListeners:function(){this._map.off("mouseout",this._sleepPending,this)},_stopWaiting:function(){this._removeSleepingListeners(),this._removeAwakeListeners(),this._enterTimeout&&clearTimeout(this._enterTimeout),this._exitTimeout&&clearTimeout(this._exitTimeout),this._enterTimeout=null,this._exitTimeout=null}}),Waymark_L.Map.addInitHook("addHandler","sleep",Waymark_L.Map.Sleep);var toGeoJSON=function(){var t,e=/\s*/g,n=/^\s*|\s*$/g,a=/\s+/;function s(t){if(!t||!t.length)return 0;for(var e=0,n=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e)|0;return n}function r(t,e){return t.getElementsByTagName(e)}function l(t,e){return t.getAttribute(e)}function h(t,e){return parseFloat(l(t,e))}function c(t,e){var n=r(t,e);return n.length?n[0]:null}function d(t){for(var e=0,n=[];e<t.length;e++)n[e]=parseFloat(t[e]);return n}function u(t){if(t){var e;(e=t).normalize&&e.normalize()}return t&&t.textContent||""}function p(t,e){var n,a,s={};for(a=0;a<e.length;a++)(n=c(t,e[a]))&&(s[e[a]]=u(n));return s}function m(t,e){for(var n in e)t[n]=e[n]}function f(t){return d(t.replace(e,"").split(","))}function g(t){for(var e=t.replace(n,"").split(a),s=[],r=0;r<e.length;r++)s.push(f(e[r]));return s}function y(t){var e,n=[h(t,"lon"),h(t,"lat")],a=c(t,"ele"),s=c(t,"gpxtpx:hr")||c(t,"hr"),r=c(t,"time");return a&&(e=parseFloat(u(a)),isNaN(e)||n.push(e)),{coordinates:n,time:r?u(r):null,heartRate:s?parseFloat(u(s)):null}}function v(){return{type:"FeatureCollection",features:[]}}if("undefined"!=typeof XMLSerializer)t=new XMLSerializer;else{var k="object"==typeof process&&!process.browser,w="object"==typeof Titanium;if("object"==typeof exports&&(k||w))t=new(require("xmldom")).XMLSerializer;else throw Error("Unable to initialize serializer")}function x(e){return void 0!==e.xml?e.xml:t.serializeToString(e)}return{kml:function(t){for(var e=v(),n={},a={},h={},p=["Polygon","LineString","Point","Track","gx:Track"],m=r(t,"Placemark"),y=r(t,"Style"),k=r(t,"StyleMap"),w=0;w<y.length;w++){var $=s(x(y[w])).toString(16);n["#"+l(y[w],"id")]=$,a[$]=y[w]}for(var b=0;b<k.length;b++){n["#"+l(k[b],"id")]=s(x(k[b])).toString(16);for(var C=r(k[b],"Pair"),P={},_=0;_<C.length;_++)P[u(c(C[_],"key"))]=u(c(C[_],"styleUrl"));h["#"+l(k[b],"id")]=P}for(var T=0;T<m.length;T++)e.features=e.features.concat(z(m[T]));function E(t){var e,n;return"#"===(t=t||"").substr(0,1)&&(t=t.substr(1)),(6===t.length||3===t.length)&&(e=t),8===t.length&&(n=parseInt(t.substr(0,2),16)/255,e="#"+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)),[e,isNaN(n)?void 0:n]}function M(t){return d(t.split(" "))}function S(t){var e=r(t,"coord","gx"),n=[],a=[];0===e.length&&(e=r(t,"gx:coord"));for(var s=0;s<e.length;s++)n.push(M(u(e[s])));for(var l=r(t,"when"),h=0;h<l.length;h++)a.push(u(l[h]));return{coords:n,times:a}}function z(t){var e,s=function t(e){var n,a,s,l,h,d=[],m=[];if(c(e,"MultiGeometry"))return t(c(e,"MultiGeometry"));if(c(e,"MultiTrack"))return t(c(e,"MultiTrack"));if(c(e,"gx:MultiTrack"))return t(c(e,"gx:MultiTrack"));for(s=0;s<p.length;s++)if(a=r(e,p[s])){for(l=0;l<a.length;l++)if(n=a[l],"Point"===p[s])d.push({type:"Point",coordinates:f(u(c(n,"coordinates")))});else if("LineString"===p[s])d.push({type:"LineString",coordinates:g(u(c(n,"coordinates")))});else if("Polygon"===p[s]){var y=r(n,"LinearRing"),v=[];for(h=0;h<y.length;h++)v.push(g(u(c(y[h],"coordinates"))));d.push({type:"Polygon",coordinates:v})}else if("Track"===p[s]||"gx:Track"===p[s]){var k=S(n);d.push({type:"LineString",coordinates:k.coords}),k.times.length&&m.push(k.times)}}return{geoms:d,coordTimes:m}}(t),d={},m=u(c(t,"name")),y=u(c(t,"address")),v=u(c(t,"styleUrl")),k=u(c(t,"description")),w=c(t,"TimeSpan"),x=c(t,"TimeStamp"),$=c(t,"ExtendedData"),b=c(t,"LineStyle"),C=c(t,"PolyStyle"),P=c(t,"visibility");if(!s.geoms.length)return[];if(m&&(d.name=m),y&&(d.address=y),v){"#"!==v[0]&&(v="#"+v),d.styleUrl=v,n[v]&&(d.styleHash=n[v]),h[v]&&(d.styleMapHash=h[v],d.styleHash=n[h[v].normal]);var _=a[d.styleHash];if(_){b||(b=c(_,"LineStyle")),C||(C=c(_,"PolyStyle"));var T=c(_,"IconStyle");if(T){var M=c(T,"Icon");if(M){var z=u(c(M,"href"));z&&(d.icon=z)}}}}if(k&&(d.description=k),w){var D=u(c(w,"begin")),W=u(c(w,"end"));d.timespan={begin:D,end:W}}if(x&&(d.timestamp=u(c(x,"when"))),b){var A=E(u(c(b,"color"))),O=A[0],B=A[1],I=parseFloat(u(c(b,"width")));O&&(d.stroke=O),isNaN(B)||(d["stroke-opacity"]=B),isNaN(I)||(d["stroke-width"]=I)}if(C){var Z=E(u(c(C,"color"))),F=Z[0],j=Z[1],R=u(c(C,"fill")),N=u(c(C,"outline"));F&&(d.fill=F),isNaN(j)||(d["fill-opacity"]=j),R&&(d["fill-opacity"]="1"===R?d["fill-opacity"]||1:0),N&&(d["stroke-opacity"]="1"===N?d["stroke-opacity"]||1:0)}if($){var G=r($,"Data"),U=r($,"SimpleData");for(e=0;e<G.length;e++)d[G[e].getAttribute("name")]=u(c(G[e],"value"));for(e=0;e<U.length;e++)d[U[e].getAttribute("name")]=u(U[e])}P&&(d.visibility=u(P)),s.coordTimes.length&&(d.coordTimes=1===s.coordTimes.length?s.coordTimes[0]:s.coordTimes);var H={type:"Feature",geometry:1===s.geoms.length?s.geoms[0]:{type:"GeometryCollection",geometries:s.geoms},properties:d};return l(t,"id")&&(H.id=l(t,"id")),[H]}return e},gpx:function(t){var e,n,a=r(t,"trk"),s=r(t,"rte"),h=r(t,"wpt"),d=v();for(e=0;e<a.length;e++)(n=k(a[e]))&&d.features.push(n);for(e=0;e<s.length;e++)(n=w(s[e]))&&d.features.push(n);for(e=0;e<h.length;e++)d.features.push(x(h[e]));function f(t,e){for(var n=0;n<e;n++)t.push(null);return t}function g(t,e){var n=r(t,e),a=[],s=[],l=[],h=n.length;if(h<2)return{};for(var c=0;c<h;c++){var d=y(n[c]);a.push(d.coordinates),d.time&&s.push(d.time),(d.heartRate||l.length)&&(l.length||f(l,c),l.push(d.heartRate||null))}return{line:a,times:s,heartRates:l}}function k(t){for(var e,n=r(t,"trkseg"),a=[],s=[],l=[],h=0;h<n.length;h++)if((e=g(n[h],"trkpt"))&&(e.line&&a.push(e.line),e.times&&e.times.length&&s.push(e.times),l.length||e.heartRates&&e.heartRates.length)){if(!l.length)for(var d=0;d<h;d++)l.push(f([],a[d].length));e.heartRates&&e.heartRates.length?l.push(e.heartRates):l.push(f([],e.line.length||0))}if(0!==a.length){var u=b(t);return m(u,$(c(t,"extensions"))),s.length&&(u.coordTimes=1===a.length?s[0]:s),l.length&&(u.heartRates=1===a.length?l[0]:l),{type:"Feature",properties:u,geometry:{type:1===a.length?"LineString":"MultiLineString",coordinates:1===a.length?a[0]:a}}}}function w(t){var e=g(t,"rtept");if(e.line){var n=b(t);return m(n,$(c(t,"extensions"))),{type:"Feature",properties:n,geometry:{type:"LineString",coordinates:e.line}}}}function x(t){var e=b(t);return m(e,p(t,["sym"])),{type:"Feature",properties:e,geometry:{type:"Point",coordinates:y(t).coordinates}}}function $(t){var e={};if(t){var n=c(t,"line");if(n){var a=u(c(n,"color")),s=parseFloat(u(c(n,"opacity"))),r=parseFloat(u(c(n,"width")));a&&(e.stroke=a),isNaN(s)||(e["stroke-opacity"]=s),isNaN(r)||(e["stroke-width"]=96*r/25.4)}}return e}function b(t){var e=p(t,["name","cmt","desc","type","time","keywords"]),n=r(t,"link");n.length&&(e.links=[]);for(var a,s=0;s<n.length;s++)m(a={href:l(n[s],"href")},p(n[s],["text","type"])),e.links.push(a);return e}return d}}}();"undefined"!=typeof module&&(module.exports=toGeoJSON),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;(e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).togpx=t()}}(function(){var t;return(function t(e,n,a){function s(l,h){if(!n[l]){if(!e[l]){var c="function"==typeof require&&require;if(!h&&c)return c(l,!0);if(r)return r(l,!0);var d=Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[l]={exports:{}};e[l][0].call(u.exports,function(t){var n;return s(e[l][1][t]||t)},u,u.exports,t,e,n,a)}return n[l].exports}for(var r="function"==typeof require&&require,l=0;l<a.length;l++)s(a[l]);return s})({1:[function(t,e,n){var a=t("jxon");a.config({attrPrefix:"@"}),e.exports=function t(e,n){if("string"==typeof(n=function(t,e){for(var n in t)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}({creator:"togpx",metadata:void 0,featureTitle:function t(e){if(!e)return"";if("object"==typeof e.tags){var n=t(e.tags);if(""!==n)return n}return e.name?e.name:e.ref?e.ref:e.id?e.id:""},featureDescription:function t(e){if(!e)return"";if("object"==typeof e.tags)return t(e.tags);var n="";for(var a in e)"object"!=typeof e[a]&&(n+=a+"="+e[a]+"\n");return n.substr(0,n.length-1)},featureLink:void 0,featureCoordTimes:function t(e){return e.properties&&(e.properties.times||e.properties.coordTimes)||null}},n||{})).featureCoordTimes){var s,r=n.featureCoordTimes;n.featureCoordTimes=function(t){return t.properties[r]}}function l(t,e){n.featureLink&&(t.link={"@href":n.featureLink(e.properties)})}var h={gpx:{"@xmlns":"http://www.topografix.com/GPX/1/1","@xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","@xsi:schemaLocation":"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd","@version":"1.1",metadata:null,wpt:[],trk:[]}};return n.creator&&(h.gpx["@creator"]=n.creator),n.metadata?h.gpx.metadata=n.metadata:delete n.metadata,(s="FeatureCollection"===e.type?e.features:"Feature"===e.type?[e]:[{type:"Feature",properties:{},geometry:e}]).forEach(function t(e){switch(e.geometry.type){case"Point":case"MultiPoint":var a=e.geometry.coordinates;"Point"==e.geometry.type&&(a=[a]),a.forEach(function(t){o={"@lat":t[1],"@lon":t[0],name:n.featureTitle(e.properties),desc:n.featureDescription(e.properties)},void 0!==t[2]&&(o.ele=t[2]),l(o,e),h.gpx.wpt.push(o)});break;case"LineString":case"MultiLineString":var a=e.geometry.coordinates,s=n.featureCoordTimes(e);"LineString"==e.geometry.type&&(a=[a]),l(o={name:n.featureTitle(e.properties),desc:n.featureDescription(e.properties)},e),o.trkseg=[],a.forEach(function(t){var e={trkpt:[]};t.forEach(function(t,n){var a={"@lat":t[1],"@lon":t[0]};void 0!==t[2]&&(a.ele=t[2]),s&&s[n]&&(a.time=s[n]),e.trkpt.push(a)}),o.trkseg.push(e)}),h.gpx.trk.push(o);break;case"Polygon":case"MultiPolygon":l(o={name:n.featureTitle(e.properties),desc:n.featureDescription(e.properties)},e),o.trkseg=[];var a=e.geometry.coordinates,s=n.featureCoordTimes(e);"Polygon"==e.geometry.type&&(a=[a]),a.forEach(function(t){t.forEach(function(t){var e={trkpt:[]},n=0;t.forEach(function(t){var a={"@lat":t[1],"@lon":t[0]};void 0!==t[2]&&(a.ele=t[2]),s&&s[n]&&(a.time=s[n]),n++,e.trkpt.push(a)}),o.trkseg.push(e)})}),h.gpx.trk.push(o);break;case"GeometryCollection":e.geometry.geometries.forEach(function(n){t({properties:e.properties,geometry:n})});break;default:console.log("warning: unsupported geometry type: "+e.geometry.type)}}),gpx_str=a.stringify(h)}},{jxon:2}],2:[function(e,n,a){var s,r;s=this,r=function(t,e){var n,a={valueKey:"_",attrKey:"$",attrPrefix:"$",lowerCaseTags:!1,trueIsEmpty:!1,autoDate:!1,ignorePrefixedNodes:!1,parseValues:!1},s=[],r=/^\s*$/,l=/^(?:true|false)$/i;return new function(){function h(t){return a.parseValues?r.test(t)?null:l.test(t)?"true"===t.toLowerCase():isFinite(t)?parseFloat(t):a.autoDate&&isFinite(Date.parse(t))?new Date(t):t:t}function c(){}this.config=function(e){for(var s in e)a[s]=e[s];a.parserErrorHandler&&(n=new t.DOMParser({errorHandler:a.parserErrorHandler,locator:{}}))},c.prototype.toString=function(){return"null"},c.prototype.valueOf=function(){return null},this.xmlToJs=this.build=function(t,e,n,r){var l=arguments.length>1&&"number"==typeof e?3&e:1;return function t(e,n,r,l){var d,u,p=s.length,m=e.hasChildNodes(),f=e.nodeType===e.ELEMENT_NODE&&e.hasAttributes(),g=Boolean(2&n),y=0,v="",k=g?{}:!!a.trueIsEmpty||"";if(m)for(var w,x=0;x<e.childNodes.length;x++)4===(w=e.childNodes.item(x)).nodeType?v+=w.nodeValue:3===w.nodeType?v+=w.nodeValue.trim():1!==w.nodeType||a.ignorePrefixedNodes&&w.prefix||s.push(w);var $=s.length,b=h(v);!g&&(m||f)&&(k=0===n?null===(P=b)?new c:P instanceof Object?P:new P.constructor(P):{});for(var C=p;C<$;C++)d=s[C].nodeName,a.lowerCaseTags&&(d=d.toLowerCase()),u=t(s[C],n,r,l),k.hasOwnProperty(d)?(k[d].constructor!==Array&&(k[d]=[k[d]]),k[d].push(u)):(k[d]=u,y++);if(f){for(var P,_,T,E=e.attributes.length,M=l?"":a.attrPrefix,S=l?{}:k,z=0;z<E;y++,z++)T=(_=e.attributes.item(z)).name,a.lowerCaseTags&&(T=T.toLowerCase()),S[M+T]=h(_.value.trim());l&&(r&&Object.freeze(S),k[a.attrKey]=S,y-=E-1)}return 3===n||(2===n||1===n&&y>0)&&v?k[a.valueKey]=b:!g&&0===y&&v&&(k=b),r&&(g||y>0)&&Object.freeze(k),s.length=p,k}(t,l,n||!1,arguments.length>3?r:3===l)},this.jsToXml=this.unbuild=function(n,s,r,l){var h=(t.document&&t.document.implementation||new t.DOMImplementation).createDocument(s||null,r||"",l||null);return function t(n,s,r){var l,h,c;if(r.constructor===String||r.constructor===Number||r.constructor===Boolean){if(s.appendChild(n.createTextNode(r.toString())),r===r.valueOf())return}else r.constructor===Date&&s.appendChild(n.createTextNode(r.toISOString()));for(var d in r){if(void 0!==(l=r[d])){if(null===l&&(l={}),!isFinite(d)&&!(l instanceof Function)){if(d===a.valueKey)null!==l&&!0!==l&&s.appendChild(n.createTextNode(l.constructor===Date?l.toISOString():String(l)));else if(d===a.attrKey)for(var u in l)s.setAttribute(u,l[u]);else if(d===a.attrPrefix+"xmlns")e&&s.setAttribute(d.slice(1),l);else if(d.charAt(0)===a.attrPrefix)s.setAttribute(d.slice(1),l);else if(l.constructor===Array)for(var p in l)l.hasOwnProperty(p)&&(h=(c=l[p]&&l[p][a.attrPrefix+"xmlns"]||s.namespaceURI)?n.createElementNS(c,d):n.createElement(d),t(n,h,l[p]||{}),s.appendChild(h));else h=(c=(l||{})[a.attrPrefix+"xmlns"]||s.namespaceURI)?n.createElementNS(c,d):n.createElement(d),l instanceof Object?t(n,h,l):null===l||!0===l&&a.trueIsEmpty||h.appendChild(n.createTextNode(l.toString())),s.appendChild(h)}}}}(h,h.documentElement||h,n),h},this.stringToXml=function(e){return n||(n=new t.DOMParser),n.parseFromString(e,"application/xml")},this.xmlToString=function(e){return void 0!==e.xml?e.xml:new t.XMLSerializer().serializeToString(e)},this.stringToJs=function(t){var e=this.stringToXml(t);return this.xmlToJs(e)},this.jsToString=this.stringify=function(t,e,n,a){return this.xmlToString(this.jsToXml(t,e,n,a))},this.each=function(t,e,n){t instanceof Array?t.forEach(e,n):[t].forEach(e,n)}}},"function"==typeof t&&t.amd?t([],r(window)):"object"==typeof a?"object"==typeof window&&window.DOMImplementation&&window.XMLSerializer&&window.DOMParser?n.exports=r(window):n.exports=r(e("xmldom"),!0):s.JXON=r(window)},{xmldom:3}],3:[function(t,e,n){},{}]},{},[1])(1)}),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;(e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).tokml=t()}}(function(){return(function(){function t(e,n,a){function s(l,h){if(!n[l]){if(!e[l]){var c="function"==typeof require&&require;if(!h&&c)return c(l,!0);if(r)return r(l,!0);var d=Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[l]={exports:{}};e[l][0].call(u.exports,function(t){return s(e[l][1][t]||t)},u,u.exports,t,e,n,a)}return n[l].exports}for(var r="function"==typeof require&&require,l=0;l<a.length;l++)s(a[l]);return s}return t})()({1:[function(t,e,n){var a=t("xml-escape"),s=t("strxml").tag;function r(t,e){return function(n){if(!n.properties||!l.valid(n.geometry))return"";var r=l.any(n.geometry);if(!r)return"";var h="",u="";if(t.simplestyle){var p,m,f,g,y,v,k,w,x,$,b,C,P,_,T=(p=n.properties,m="",p["marker-symbol"]&&(m=m+"ms"+p["marker-symbol"]),p["marker-color"]&&(m=m+"mc"+p["marker-color"].replace("#","")),p["marker-size"]&&(m=m+"ms"+p["marker-size"]),p.stroke&&(m=m+"s"+p.stroke.replace("#","")),p["stroke-width"]&&(m=m+"sw"+p["stroke-width"].toString().replace(".","")),p["stroke-opacity"]&&(m=m+"mo"+p["stroke-opacity"].toString().replace(".","")),p.fill&&(m=m+"f"+p.fill.replace("#","")),p["fill-opacity"]&&(m=m+"fo"+p["fill-opacity"].toString().replace(".","")),m);T&&(l.isPoint(n.geometry)&&(f=n.properties,f["marker-size"]||f["marker-symbol"]||f["marker-color"])?(-1===e.indexOf(T)&&(h=(g=n.properties,y=T,s("Style",{id:y},s("IconStyle",s("Icon",s("href",(v=g,k=v["marker-size"]||"medium",w=v["marker-symbol"]?"-"+v["marker-symbol"]:"",x=(v["marker-color"]||"7e7e7e").replace("#",""),"https://api.tiles.mapbox.com/v3/marker/pin-"+k.charAt(0)+w+"+"+x+".png"))))+($=g,s("hotSpot",{xunits:"fraction",yunits:"fraction",x:"0.5",y:"0.5"},"")))),e.push(T)),u=s("styleUrl","#"+T)):(l.isPolygon(n.geometry)||l.isLine(n.geometry))&&function t(e){for(var n in e)if(({stroke:!0,"stroke-opacity":!0,"stroke-width":!0,fill:!0,"fill-opacity":!0})[n])return!0}(n.properties)&&(-1===e.indexOf(T)&&(h=(b=n.properties,C=T,P=s("LineStyle",s("color",d(b.stroke,b["stroke-opacity"])||"ff555555")+s("width",{},void 0===b["stroke-width"]?2:b["stroke-width"])),_="",(b.fill||b["fill-opacity"])&&(_=s("PolyStyle",s("color",{},d(b.fill,b["fill-opacity"])||"88555555"))),s("Style",{id:C},P+_)),e.push(T)),u=s("styleUrl","#"+T)))}var E,M,S,z,D,W,A,O={};return n.id&&(O.id=n.id),h+s("Placemark",O,(E=n.properties,M=t,(E[M.name]?s("name",a(E[M.name])):"")+(S=n.properties,z=t,S[z.description]?s("description",a(S[z.description])):"")+(D=n.properties,s("ExtendedData",{},(function t(e){var n=[];for(var a in e)e[a]?n.push([a,e[a]]):n.push([a,""]);return n})(D).map(c).join("")))+(W=n.properties,A=t,W[A.timestamp]?s("TimeStamp",s("when",a(W[A.timestamp]))):"")+r+u))}}e.exports=function t(e,n){var a,l;return'<?xml version="1.0" encoding="UTF-8"?>'+s("kml",{xmlns:"http://www.opengis.net/kml/2.2"},s("Document",(a=n=n||{documentName:void 0,documentDescription:void 0,name:"name",description:"description",simplestyle:!1,timestamp:"timestamp"},(void 0!==a.documentName?s("name",a.documentName):"")+(l=n,void 0!==l.documentDescription?s("description",l.documentDescription):"")+function t(e,n){if(!e.type)return"";var a=[];switch(e.type){case"FeatureCollection":if(!e.features)return"";return e.features.map(r(n,a)).join("");case"Feature":return r(n,a)(e);default:return r(n,a)({type:"Feature",geometry:e,properties:{}})}}(e,n))))};var l={Point:function(t){return s("Point",s("coordinates",t.coordinates.join(",")))},LineString:function(t){return s("LineString",s("coordinates",h(t.coordinates)))},Polygon:function(t){if(!t.coordinates.length)return"";var e=t.coordinates[0],n=t.coordinates.slice(1),a=s("outerBoundaryIs",s("LinearRing",s("coordinates",h(e)))),r=n.map(function(t){return s("innerBoundaryIs",s("LinearRing",s("coordinates",h(t))))}).join("");return s("Polygon",a+r)},MultiPoint:function(t){return t.coordinates.length?s("MultiGeometry",t.coordinates.map(function(t){return l.Point({coordinates:t})}).join("")):""},MultiPolygon:function(t){return t.coordinates.length?s("MultiGeometry",t.coordinates.map(function(t){return l.Polygon({coordinates:t})}).join("")):""},MultiLineString:function(t){return t.coordinates.length?s("MultiGeometry",t.coordinates.map(function(t){return l.LineString({coordinates:t})}).join("")):""},GeometryCollection:function(t){return s("MultiGeometry",t.geometries.map(l.any).join(""))},valid:function(t){return t&&t.type&&(t.coordinates||"GeometryCollection"===t.type&&t.geometries&&t.geometries.every(l.valid))},any:function(t){return l[t.type]?l[t.type](t):""},isPoint:function(t){return"Point"===t.type||"MultiPoint"===t.type},isPolygon:function(t){return"Polygon"===t.type||"MultiPolygon"===t.type},isLine:function(t){return"LineString"===t.type||"MultiLineString"===t.type}};function h(t){return t.map(function(t){return t.join(",")}).join(" ")}function c(t){return s("Data",{name:t[0]},s("value",{},a(t[1]?t[1].toString():"")))}function d(t,e){if("string"!=typeof t)return"";if(3===(t=t.replace("#","").toLowerCase()).length)t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2];else if(6!==t.length)return"";var n=t[0]+t[1],a=t[2]+t[3],s=t[4]+t[5],r="ff";return"number"==typeof e&&e>=0&&e<=1&&((r=(255*e).toString(16)).indexOf(".")>-1&&(r=r.substr(0,r.indexOf("."))),r.length<2&&(r="0"+r)),r+s+a+n}},{strxml:2,"xml-escape":3}],2:[function(t,e,n){var a=t("xml-escape");function s(t){return Object.keys(t).length?" "+Object.keys(t).map(function(e){return e+'="'+a(t[e])+'"'}).join(" "):""}e.exports.attr=s,e.exports.tagClose=function t(e,n){return"<"+e+s(n)+"/>"},e.exports.tag=function t(e,n,a){return(Array.isArray(n)||"string"==typeof n)&&(a=n,n={}),Array.isArray(a)&&(a="\n"+a.map(function(t){return"  "+t}).join("\n")+"\n"),"<"+e+s(n)+">"+a+"</"+e+">"}},{"xml-escape":3}],3:[function(t,e,n){(e.exports=function t(e,n){var a;if(null!=e)return e=e.toString(),n=(n||"").replace(/[^&"<>\']/g,""),a="([&\"<>'])".replace(RegExp("["+n+"]","g"),""),e.replace(RegExp(a,"g"),function(e,n){return t.map[n]})}).map={">":"&gt;","<":"&lt;","'":"&apos;",'"':"&quot;","&":"&amp;"}},{}]},{},[1])(1)});var waymark_js_localize={action_fullscreen_activate:"View Fullscreen",action_fullscreen_deactivate:"Exit Fullscreen",action_locate_activate:"Show me where I am",action_zoom_in:"Zoom in",action_zoom_out:"Zoom out",label_total_length:"Total Length: ",label_max_elevation:"Max. Elevation: ",label_min_elevation:"Min. Elevation: ",label_ascent:"Total Ascent: ",label_descent:"Total Descent: ",add_line_title:"Draw a Line",add_photo_title:"Upload an Image",add_marker_title:"Place a Marker",add_rectangle_title:"Draw a Rectangle",add_polygon_title:"Draw a Polygon",add_circle_title:"Draw a Circle",upload_file_title:"Read Lines and Markers from file (GPX/KML/GeoJSON supported, which most apps should Export to)",action_duplicate:"Duplicate",action_delete:"Delete",action_edit:"Edit",action_edit_done:"Finish editing",action_upload_image:"Upload Image",object_title_placeholder:"Title",object_image_placeholder:"Image URL",object_description_placeholder:"Description",object_type_label:"Type",marker_latlng_label:"Lat,Lng",action_delete_confirm:"Are you sure you want to delete this",action_search_placeholder:"Search...",object_label_marker:"Marker",object_label_line:"Line",object_label_shape:"Shape",object_label_marker_plural:"Markers",object_label_line_plural:"Lines",object_label_shape_plural:"Shapes",error_message_prefix:"Waymark Error",info_message_prefix:"Waymark Info",error_file_type:"This file type is not supported.",error_file_conversion:"Could not convert this file to GeoJSON.",error_file_upload:"File upload error.",error_photo_meta:"Could not retrieve Image metadata.",info_exif_yes:"Image location metadata (EXIF) detected!",info_exif_no:"Image location metadata (EXIF) NOT detected.",error_no_wpmedia:"WordPress Media Library not found",no_direction:"No Direction",show_direction:"Show Direction",reverse_direction:"Reverse Direction"};if(void 0===waymark_js)var waymark_js={lang:{}};for(key in waymark_js_localize)void 0===waymark_js.lang[key]&&(waymark_js.lang[key]=waymark_js_localize[key]);function Waymark_Map(){this.fallback_latlng=[51.38436,-68.74923],this.fallback_zoom=9,this.init=function(t){for(config_key in Waymark=this,Waymark.jq_map_container=null,Waymark.config={map_div_id:"waymark-map",map_options:{show_type_labels:1,button_position:"bottomright",max_zoom:0},map_height:400,map_width:null,map_init_zoom:void 0,map_init_latlng:void 0,map_init_basemap:void 0,show_gallery:0,show_filter:0,show_elevation:0,show_cluster:1,elevation_div_id:"waymark-elevation",elevation_units:"metric",elevation_initial:1,tile_layers:{},line_types:{},shape_types:{},marker_types:{},marker_data_defaults:{title:void 0,type:void 0,image_thumbnail_url:void 0,image_medium_url:void 0,image_large_url:void 0,description:void 0},line_data_defaults:{type:void 0,title:void 0,image_thumbnail_url:void 0,image_medium_url:void 0,image_large_url:void 0,description:void 0,direction:void 0},shape_data_defaults:{type:void 0,title:void 0,image_thumbnail_url:void 0,image_medium_url:void 0,image_large_url:void 0,description:void 0},editor_options:{confirm_delete:1},handle_content_callback:void 0,handle_delete_callback:void 0,handle_edit_callback:void 0,handle_custom_type_callback:void 0,media_library_sizes:["thumbnail","medium","large","full"]},Waymark.config)void 0!==t[config_key]&&(Waymark.config[config_key]=t[config_key]);var e=Waymark.get_type("line"),n=Waymark.make_key(e.line_title);Waymark.config.line_data_defaults.type=n;var a=Waymark.get_type("shape"),s=Waymark.make_key(a.shape_title);Waymark.config.shape_data_defaults.type=s;var r=Waymark.get_type("marker"),l=Waymark.make_key(r.marker_title);Waymark.config.marker_data_defaults.type=l,Waymark.marker_parent_group=Waymark_L.layerGroup(),Waymark.marker_sub_groups={},Waymark.line_parent_group=Waymark_L.layerGroup(),Waymark.line_sub_groups={},Waymark.shape_parent_group=Waymark_L.layerGroup(),Waymark.shape_sub_groups={},Waymark.pre_map_setup(),Waymark.setup_map(),Waymark.handle_resize(),Waymark.init_done()},this.get_property=function(t,...e){return e.reduce((t,e)=>t&&t[e],t)},this.debug=function(t){!0==this.get_property(waymark_settings,"misc","advanced","debug_mode")&&("string"==typeof t?console.log("["+waymark_js.lang.info_message_prefix+"] "+t):(console.log("["+waymark_js.lang.info_message_prefix+"] ..."),console.log(t)))},this.message=function(t=null,e="info",n="console"){if(t){var a="";(a="error"===e?waymark_js.lang.error_message_prefix:waymark_js.lang.info_message_prefix)&&(a="["+a+"] "),"console"==n?console.log(a+t):alert(a+t)}},this.title_case=function(t){return t.replace(/(?:^|\s)\w/g,function(t){return t.toUpperCase()})},this.transliterate=function(t){var e={:"YO",:"I",:"TS",:"U",:"K",:"E",:"N",:"G",:"SH",:"SCH",:"Z",:"H",:"'",:"yo",:"i",:"ts",:"u",:"k",:"e",:"n",:"g",:"sh",:"sch",:"z",:"h",:"'",:"F",:"I",:"V",:"a",:"P",:"R",:"O",:"L",:"D",:"ZH",:"E",:"f",:"i",:"v",:"a",:"p",:"r",:"o",:"l",:"d",:"zh",:"e",:"Ya",:"CH",:"S",:"M",:"I",:"T",:"'",:"B",:"YU",:"ya",:"ch",:"s",:"m",:"i",:"t",:"'",:"b",:"yu"};return t.split("").map(function(t){return e[t]||t}).join("")},this.make_key=function(t){return t?t=(t=(t=this.transliterate(t)).replace(/[^a-z0-9+]+/gi,"")).toLowerCase():t},this.get_feature_overlay_type=function(t){if(void 0===t.geometry.type)return!1;switch(t.geometry.type){case"Point":if(t.properties.radius)return"shape";return"marker";case"LineString":case"MultiLineString":return"line";case"Polygon":return"shape"}return!1},this.setup_map=function(){Waymark=this,Waymark.jq_map_container=jQuery("#"+Waymark.config.map_div_id),Waymark.jq_map_container.addClass("waymark-map-container"),Waymark.jq_map_container.css("height",Waymark.config.map_height+"px");var t={fullscreenControl:!1,attributionControl:!1,editable:!0,zoomControl:!1,sleep:!1};"view"==Waymark.mode?(t.dragging=!1,t.sleep=!0,t.wakeTime=1e3*this.get_property(waymark_settings,"misc","interaction_options","delay_seconds"),"1"===this.get_property(waymark_settings,"misc","interaction_options","do_message")?(t.sleepNote=!0,t.wakeMessage=this.get_property(waymark_settings,"misc","interaction_options","wake_message")):(t.sleepNote=!1,t.wakeMessage=!1),t.sleepOpacity=1,(max_zoom=Waymark.config.map_options.max_zoom)&&(t.maxZoom=max_zoom)):t.dragging=!0,Waymark.map=Waymark_L.map(Waymark.config.map_div_id,t),Waymark_L.control.attribution({prefix:'<a href="https://wordpress.org/plugins/waymark" title="Share your way">Waymark</a> | <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'}).addTo(Waymark.map),!0==this.get_property(waymark_settings,"misc","map_options","show_scale")&&Waymark_L.control.scale().addTo(Waymark.map),Waymark.jq_map_container.data("Waymark",Waymark),void 0!==Waymark.config.map_init_latlng?Waymark.map.setView(Waymark.config.map_init_latlng):Waymark.map.setView(Waymark.fallback_latlng),void 0!==Waymark.config.map_init_zoom?Waymark.map.setZoom(Waymark.config.map_init_zoom):Waymark.map.setZoom(Waymark.fallback_zoom),Waymark_L.Path.mergeOptions({color:"#b42714"}),Waymark_L.control.zoom({position:Waymark.config.map_options.button_position,zoomInTitle:waymark_js.lang.action_zoom_in,zoomOutTitle:waymark_js.lang.action_zoom_out}).addTo(Waymark.map),Waymark_L.control.locate({position:"bottomright",icon:"ion ion-android-locate",drawCircle:!1,strings:{title:waymark_js.lang.action_locate_activate},locateOptions:{enableHighAccuracy:!0}}).addTo(Waymark.map),Waymark_L.control.fullscreen({position:Waymark.config.map_options.button_position,title:{false:waymark_js.lang.action_fullscreen_activate,true:waymark_js.lang.action_fullscreen_deactivate}}).addTo(Waymark.map),Waymark.marker_parent_group.addTo(Waymark.map),Waymark.line_parent_group.addTo(Waymark.map),Waymark.shape_parent_group.addTo(Waymark.map),Waymark.setup_layers(),Waymark.create_data_layer(),Waymark.create_buttons()},this.create_data_layer=function(){Waymark=this,Waymark.map_data=Waymark_L.geoJSON(null,{pointToLayer:function(t,e){return void 0!==t.properties&&t.properties.radius?new Waymark_L.Circle(e,parseFloat(t.properties.radius)):Waymark.create_marker(e)},onEachFeature:function(t,e){switch(t.geometry.type){case"Point":if(t.properties.radius){t.properties=Waymark.parse_layer_data("shape",t.properties);var n=Waymark.get_type("shape",t.properties.type);e.setStyle({color:n.shape_colour,fillOpacity:n.fill_opacity}),Waymark.info_window("shape",t,e),Waymark.tooltip("shape",t,e),Waymark.add_to_group("shape",e)}else{t.properties=Waymark.parse_layer_data("marker",t.properties);var n=Waymark.get_type("marker",t.properties.type);e.setIcon(Waymark_L.divIcon(Waymark.build_icon_data(n))),void 0!==Waymark.gallery_images&&Waymark.add_to_gallery(e),Waymark.info_window("marker",t,e),Waymark.tooltip("marker",t,e),Waymark.add_to_group("marker",e)}break;case"LineString":case"MultiLineString":t.properties=Waymark.parse_layer_data("line",t.properties);var n=Waymark.get_type("line",t.properties.type);e.setStyle({color:n.line_colour,weight:n.line_weight,opacity:n.line_opacity}),Waymark.info_window("line",t,e),Waymark.tooltip("line",t,e);var a=parseInt(n.line_display);Waymark.draw_line_direction(e,a),Waymark.add_to_group("line",e);break;case"Polygon":t.properties=Waymark.parse_layer_data("shape",t.properties),t.properties.rectangle;var n=Waymark.get_type("shape",t.properties.type);e.setStyle({color:n.shape_colour,fillOpacity:n.fill_opacity}),Waymark.info_window("shape",t,e),Waymark.tooltip("shape",t,e),Waymark.add_to_group("shape",e)}}})},this.draw_line_direction=function(t,e=!0){var n=t.feature,a=n.properties.direction,s=Waymark.get_type("line",n.properties.type);if("object"==typeof t.direction_layer&&Waymark.map.removeLayer(t.direction_layer),"string"==typeof a&&("default"==a||"reverse"==a)){var r=45;"reverse"==a&&(r=360-r);var l=Waymark_L.polylineDecorator(t,{patterns:[{repeat:100,symbol:L.Symbol.arrowHead({pixelSize:15,headAngle:r,polygon:!0,pathOptions:{color:"#fff",fillColor:s.line_colour,opacity:"0.7",stroke:!0,fillOpacity:.7,weight:2}})},]});e&&l.addTo(Waymark.map),t.direction_layer=l}},this.setup_layers=function(){Waymark=this,Waymark.layer_control=Waymark_L.control.layers();var t,e=[],n=0;if(void 0!==Waymark.config.map_init_basemap)for(var a in Waymark.config.tile_layers){Waymark.config.map_init_basemap.toUpperCase()===Waymark.config.tile_layers[a].layer_name.toUpperCase()&&(n=a)}for(var a in Waymark.config.tile_layers){void 0!==Waymark.config.tile_layers[a].append&&(Waymark.config.tile_layers[a].layer_url+=Waymark.config.tile_layers[a].append);var s={id:Waymark.config.tile_layers[a].layer_name.replace(/ /g,""),attribution:Waymark.config.tile_layers[a].layer_attribution},r=parseInt(Waymark.config.tile_layers[a].layer_max_zoom);r&&(s.maxZoom=r);var l=Waymark_L.tileLayer(Waymark.config.tile_layers[a].layer_url,s);e[Waymark.config.tile_layers[a].layer_name]=l,a==n&&l.addTo(Waymark.map)}if(a>=1)for(basemap_name in Waymark.layer_control.addTo(Waymark.map),e)Waymark.layer_control.addBaseLayer(e[basemap_name],basemap_name)},this.get_type=function(t,e){Waymark=this;var n=null;for(var a in Waymark.config[t+"_types"]){0==a&&(n=Waymark.config[t+"_types"][a]);var s=Waymark.config[t+"_types"][a][t+"_title"];s&&Waymark.make_key(e)==Waymark.make_key(s)&&(n=Waymark.config[t+"_types"][a])}return Waymark.parse_type(n,t)},this.parse_type=function(t,e){if(Waymark=this,"object"!=typeof t)return t;if("line"===e){var n=[{key:"line_colour",default:"#b42714"},{key:"line_weight",default:"3"},{key:"line_opacity",default:"0.7"},];for(var a in n)"string"!=typeof t[n[a].key]&&(t[n[a].key]=n[a].default)}return t.type_key=Waymark.make_key(t[e+"_title"]),t},this.handle_resize=function(){Waymark=this,jQuery(window).on("resize",function(){Waymark.config.map_height=Waymark.jq_map_container.height(),Waymark.config.map_width=Waymark.jq_map_container.width(),"function"==typeof Waymark.size_gallery&&Waymark.size_gallery()})},this.tooltip=function(t,e,n){Waymark=this;var a="";if("1"==Waymark.config.map_options.show_type_labels){var s=Waymark.get_type(t,e.properties.type);if(s){var r=s[t+"_title"];r&&(a="["+r+"] ")}}e.properties.title&&(a+=e.properties.title),a&&(n.bindTooltip(a),n.on("mouseover",function(t){var e=t.target.getTooltip();e.setLatLng(t.latlng),e.openTooltip()}),n.on("mousemove",function(t){t.target.getTooltip().setLatLng(t.latlng)}))},this.get_data_defaults=function(t){return Object.assign({},Waymark.config[t+"_data_defaults"])},this.parse_layer_data=function(t,e){Waymark=this;var n=Waymark.get_data_defaults(t);if("object"==typeof e)for(r in n)void 0!==e[r]&&e[r]&&(n[r]=e[r]);for(r in e)if(e[r])switch(r){case"name":n.title=e[r];break;case"desc":case"notes":n.description=e[r];break;case"radius":n[r]=parseFloat(e[r])}var a=this.get_property(waymark_settings,"overlay","properties");if(Object.keys(a).length){var s="";for(i in a){var r=a[i].property_key,l=a[i].property_title,h=e[r];void 0!==h&&(s+='<p class="waymark-property waymark-property-'+r+'"><b>'+l+"</b><br />"+h+"</p>",Waymark.debug("Importing "+l+" ("+r+") ==> "+h))}s&&(void 0===n.description&&(n.description=""),n.description+=s)}return n},this.add_to_group=function(t,e){var n=e.feature;if(void 0!==n.properties.type){var a=n.properties.type,s=Waymark.get_type(t,a);if(void 0===Waymark[t+"_sub_groups"][s.type_key]){var r=Waymark_L.featureGroup.subGroup(Waymark[t+"_parent_group"]);Waymark[t+"_sub_groups"][s.type_key]=r,"view"==Waymark.mode&&void 0!==s[t+"_display"]?"1"==s[t+"_display"]&&r.addTo(Waymark.map):r.addTo(Waymark.map)}if(e.addTo(Waymark[t+"_sub_groups"][s.type_key]),"line"==t&&"object"==typeof e.direction_layer&&e.direction_layer.addTo(Waymark[t+"_sub_groups"][s.type_key]),Waymark.config.show_filter&&"view"==Waymark.mode)for(key in Waymark.layer_control.addTo(Waymark.map),Waymark.layer_control.removeLayer(Waymark[t+"_parent_group"]),Waymark.layer_control.addOverlay(Waymark[t+"_parent_group"],"<b>"+waymark_js_localize["object_label_"+t+"_plural"]+"</b>"),Waymark_L.stamp(Waymark[t+"_parent_group"]),Waymark[t+"_sub_groups"]){var l=Waymark.get_type(t,key),r=Waymark[t+"_sub_groups"][key];Waymark.layer_control.removeLayer(r),Waymark.layer_control.addOverlay(r,Waymark.type_to_text(t,l))}}else e.addTo(Waymark[t+"_parent_group"])},this.type_to_text=function(t,e,n="span"){var a="";switch(t){case"marker":a+="color:"+e.icon_colour+";",a+="background:"+Waymark.get_marker_background(e.marker_colour);break;case"line":a+="color:"+e.line_colour+";box-shadow:inset 0 0 0 1px "+e.line_colour;break;case"shape":a+="background:"+e.shape_colour}return"<"+n+' class="waymark-type-text waymark-'+t+'-type" style="'+a+'">'+e[t+"_title"]+"</"+n+">"},this.create_marker=function(t){return Waymark_L.marker(t)},this.build_icon_data=function(t){var e={className:"waymark-marker waymark-marker-"+t.type_key};if(void 0!==t.marker_shape&&void 0!==t.marker_size){switch(e.className+=" waymark-marker-"+t.marker_shape,e.className+=" waymark-marker-"+t.marker_size,t.marker_shape){case"rectangle":case"circle":case"marker":switch(t.marker_size){case"small":e.iconSize=[16,16];break;case"medium":e.iconSize=[25,25];break;default:e.iconSize=[32,32]}}"marker"==t.marker_shape&&(e.iconAnchor=[e.iconSize[0]/2,1.25*e.iconSize[1],])}var n="background:"+Waymark.get_marker_background(t.marker_colour)+";",a="color:"+t.icon_colour+";";e.html='<div class="waymark-marker-background" style="'+n+'"></div>';var s="waymark-marker-icon";switch(t.icon_type){case"text":s+=" waymark-icon-text",e.html+='<div style="'+a+'" class="'+s+'">'+t.marker_icon+"</div>";break;case"html":s+=" waymark-icon-html";var r=jQuery("<div/>").html(t.marker_icon).text();e.html+='<div class="'+s+'">'+r+"</div>";break;default:s+=" waymark-icon-icon",0===t.marker_icon.indexOf("ion-")?(s+=" ion ",s+=" "+t.marker_icon):0===t.marker_icon.indexOf("fa-")?(s+=" fa",s+=" "+t.marker_icon):(s+=" ion",s+=" ion-"+t.marker_icon),e.html+='<i style="'+a+'" class="'+s+'"></i>'}return e},this.get_marker_background=function(t){if(["red","darkred","orange","green","darkgreen","blue","purple","darkpurple","cadetblue","white","black",].includes(t))switch(t){case"red":return"#da3d20";case"darkred":return"#a43233";case"orange":return"#f9960a";case"green":return"#70af00";case"darkgreen":return"#72820d";case"blue":return"#2aabe1";case"purple":return"#d553bd";case"darkpurple":return"#5c3a6e";case"cadetblue":return"#416979";case"white":return"#fbfbfb";case"black":return"#303030"}return t},this.create_marker_json=function(t,e={}){Waymark.debug(Waymark.config.marker_data_defaults);var n=Object.assign({},Waymark.config.marker_data_defaults,e),a={geometry:{type:"Point",coordinates:[t.lng,t.lat]},type:"Feature",properties:n};return Waymark.debug(a),a},this.get_exif_latlng=function(t){return t.GPSLatitudeNum&&!isNaN(t.GPSLatitudeNum)&&t.GPSLongitudeNum&&!isNaN(t.GPSLongitudeNum)?(Waymark.debug(waymark_js.lang.info_exif_yes),L.latLng(t.GPSLatitudeNum,t.GPSLongitudeNum)):(Waymark.debug(waymark_js.lang.info_exif_no),!1)},this.get_image_sizes=function(t,e){Waymark=this;var n={};for(var a in Waymark.config.media_library_sizes)n["image_"+Waymark.config.media_library_sizes[a]+"_url"]=e,void 0!==t[Waymark.config.media_library_sizes[a]]&&void 0!==t[Waymark.config.media_library_sizes[a]].url&&(n["image_"+Waymark.config.media_library_sizes[a]+"_url"]=t[Waymark.config.media_library_sizes[a]].url);return n},this.pre_map_setup=function(){},this.init_done=function(){},this.info_window=function(t,e,n){},this.build_content=function(t,e){}}function Waymark_Map_Viewer(){this.gallery_images=[],this.pre_map_setup=function(){Waymark=this,Waymark.mode="view"},this.init_done=function(){Waymark=this,Waymark.jq_map_container.show(),Waymark.map.invalidateSize(),Waymark.config.map_width=Waymark.jq_map_container.width(),Waymark.setup_gallery(),Waymark.setup_elevation(),Waymark.setupCluster(),jQuery(Waymark.map.getContainer()).addClass("waymark-is-viewer"),Waymark.setup_hidden_checker()},this.setupCluster=()=>{Waymark.config.show_cluster&&(Waymark.jq_map_container.addClass("waymark-has-cluster"),Waymark.map._layersMaxZoom=18,Waymark.marker_cluster=L.markerClusterGroup({animate:!1,showCoverageOnHover:!1,removeOutsideVisibleBounds:!0,iconCreateFunction:this.clusterIconFunction,spiderfyOnMaxZoom:!1,disableClusteringAtZoom:Waymark.get_property(waymark_settings,"misc","cluster_options","cluster_threshold"),maxClusterRadius:Waymark.get_property(waymark_settings,"misc","cluster_options","cluster_radius")}),Waymark.marker_parent_group=Waymark.marker_cluster,Waymark.map.addLayer(Waymark.marker_cluster))},this.clusterIconFunction=t=>{let e=new Map([]);t.getAllChildMarkers().forEach(t=>{let n=t.feature.properties.type,a=Waymark.get_type("marker",n);a.iconData=Waymark.build_icon_data(a),e.has(n)?a.typeCount++:a.typeCount=1,e.set(n,a)});let n="",a=0,s=0,r=0;return[...e.entries()].sort((t,e)=>e[1].typeCount-t[1].typeCount).forEach(([t,l])=>{let h=l.typeCount,c=l.iconData,d=e.size-a;s=c.iconSize[0]>s?c.iconSize[0]:s,r=c.iconSize[0]>r?c.iconSize[0]:r,h>1&&(c.html+=`<div class="waymark-cluster-count">${h}</div>`);let u=8*a;n+=`
				<div 
					class="${c.className}" 
					style="
						left:${u}px;
						z-index:${d};
						height:${c.iconSize[1]}px;
						width:${c.iconSize[0]}px;
						height:${c.iconSize[1]}px;
					"
				>
					${c.html}					
				</div>
			`,a++}),L.divIcon({className:"waymark-cluster",html:n,iconSize:[s,r]})},this.setup_hidden_checker=function(){let t=setInterval(function(){(is_hidden=Waymark.jq_map_container.is(":hidden"))||(Waymark.reset_map_view(),clearInterval(t))},100)},this.create_buttons=function(){},this.load_json=function(t){Waymark=this,"object"==typeof t&&void 0!==t.features&&(Waymark.map_data.addData(t),Waymark.reset_map_view())},this.reset_map_view=function(){if(Waymark=this,void 0===Waymark.config.map_init_latlng&&void 0===Waymark.config.map_init_zoom){var t=Waymark.map_data.getBounds();"object"==typeof t&&t.isValid()&&(Waymark.map.invalidateSize(),Waymark.map.fitBounds(t))}else void 0!==Waymark.config.map_init_latlng&&void 0!==Waymark.config.map_init_zoom?Waymark.map.setView(Waymark.config.map_init_latlng,Waymark.config.map_init_zoom):(void 0!==Waymark.config.map_init_latlng&&(Waymark.map.setView(Waymark.config.map_init_latlng),Waymark.map.setZoom(Waymark.map.getBoundsZoom(Waymark.map_data.getBounds()))),void 0!==Waymark.config.map_init_zoom&&(Waymark.map.setZoom(Waymark.config.map_init_zoom),Waymark.map.setView(Waymark.map_data.getBounds().getCenter())))},this.build_content=function(t,e){Waymark=this;var n=jQuery("<div />"),a=jQuery("<ul />").addClass("waymark-info waymark-"+t+"-info");for(key in Waymark.config[t+"_data_defaults"]){var s=null;switch(key){case"title":e.properties.title?s=jQuery("<strong />").html(e.properties.title):(s=jQuery("<strong />").html("&nbsp;"),a.addClass("waymark-no-title"));break;case"type":if("1"!=Waymark.config.map_options.show_type_labels)break;var r=Waymark.get_type(t,e.properties.type);r&&(s=Waymark.type_to_text(t,r,"small"));break;case"description":var l=e.properties.description;l?s=0===l.indexOf("<")?l:jQuery("<p />").html(l):a.addClass("waymark-no-description");break;case"image_large_url":if(void 0!==e.properties.image_large_url){var h=e.properties.image_large_url;if(void 0!==e.properties.image_medium_url)var h=e.properties.image_medium_url;s=jQuery("<a />").attr({href:e.properties.image_large_url,target:"_blank",style:"background-image:url("+h+")"})}else a.addClass("waymark-no-image")}s&&a.append(jQuery("<li />").addClass("waymark-info-"+key+" waymark-"+t+"-info-"+key).append(s))}return a.children().length&&n.append(a),n},this.info_window=function(t,e,n){if(Waymark=this,Waymark.config.show_elevation&&"line"==t&&(Waymark.config.elevation_initial&&Waymark.line_has_elevation_data(e)&&!Waymark.elevation_container.is(":visible")&&(Waymark.elevation_container.show(),Waymark.elevation_control.loadData(e)),n.on("click",function(t){var e=t.target.feature;Waymark.elevation_control.clear(),void 0!==Waymark.elevation_control.layer&&Waymark.elevation_control.layer.removeFrom(Waymark.map),Waymark.elevation_container.hide(),Waymark.line_has_elevation_data(e)&&(Waymark.elevation_container.show(),Waymark.elevation_control.loadData(e))})),void 0!==e.properties.description||void 0!==e.properties.image_large_url){var a=Waymark.build_content(t,e,n),s=e.properties.title;"function"==typeof Waymark.config.handle_content_callback?n.on("click",function(){Waymark.config.handle_content_callback(a.get(0),s,Waymark.mode)}):n.bindPopup(a.get(0)).openPopup()}},this.line_has_elevation_data=function(t){if("MultiLineString"==t.geometry.type){for(var e in t.geometry.coordinates)for(var n in t.geometry.coordinates[e])if(3==t.geometry.coordinates[e][n].length)return!0}else for(var n in t.geometry.coordinates)if(3==t.geometry.coordinates[n].length)return!0;return!1},this.setup_elevation=function(){if(Waymark=this,Waymark.config.show_elevation){Waymark_L.registerLocale("waymark",{"Total Length: ":waymark_js.lang.label_total_length,"Max Elevation: ":waymark_js.lang.label_max_elevation,"Min Elevation: ":waymark_js.lang.label_min_elevation,"Total Ascent: ":waymark_js.lang.label_ascent,"Total Descent: ":waymark_js.lang.label_descent}),Waymark_L.setLocale("waymark");var t={theme:"magenta-theme",detached:!0,followMarker:!1,width:Waymark.config.map_width};if(void 0!==Waymark.config.elevation_div_id){t.elevationDiv="#"+Waymark.config.elevation_div_id,Waymark.elevation_container=jQuery(t.elevationDiv),Waymark.elevation_container.hide();var e=jQuery("<span />").addClass("waymark-elevation-close").text("x").on("click",{W:Waymark},function(t){var e=t.data.W;e.elevation_control.clear(),e.elevation_control.layer.removeFrom(e.map),e.elevation_container.hide()});Waymark.elevation_container.append(e)}void 0!==Waymark.config.elevation_units&&"imperial"==Waymark.config.elevation_units&&(t.imperial=!0),Waymark.elevation_control=Waymark_L.control.elevation(t).addTo(Waymark.map),Waymark.map.on("overlayremove",function(t){if(void 0!==Waymark.elevation_control.layer){var e=null;Waymark.elevation_control.layer.eachLayer(function(t){e=JSON.stringify(t.getLatLngs())}),e&&t.layer.eachLayer(function(t){void 0!==t.getLatLngs&&e==JSON.stringify(t.getLatLngs())&&(Waymark.elevation_control.clear(),Waymark.elevation_control.layer.removeFrom(Waymark.map),Waymark.elevation_container.hide())})}})}},this.setup_gallery=function(){if(Waymark=this,Waymark.config.show_gallery){Waymark.gallery=jQuery("<div />").attr("id",Waymark.config.gallery_div_id).css("width",Waymark.config.map_width).addClass("waymark-gallery-container").html(""),Waymark_L.DomEvent.disableClickPropagation(Waymark.gallery.get(0)),jQuery(Waymark.map.getContainer()).append(Waymark.gallery),Waymark.size_gallery();var t=Waymark;Waymark.map.on("moveend",function(){t.render_gallery()},{W:t}),Waymark.map.on("layerremove layeradd",function(){t.render_gallery()},{W:t})}},this.size_gallery=function(){if(Waymark=this,void 0!==Waymark.gallery&&Waymark.gallery.length){gallery_padding=parseInt(gallery_padding=(gallery_padding=Waymark.gallery.css("paddingRight")).replace("px",""));var t=Waymark.config.map_width-2*gallery_padding;Waymark.gallery.css("width",t)}},this.add_to_gallery=function(t){if(Waymark=this,void 0===t.feature.properties.image_thumbnail_url||void 0===t.feature.properties.image_large_url)return!1;var e=Object.assign({},t.feature.properties);e.latlng=t.feature.geometry.coordinates,e.marker=t,Waymark.gallery_images.push(e)},this.render_gallery=function(){Waymark=this;var t=0;if(void 0!==Waymark.gallery&&Waymark.gallery.length&&(Waymark.gallery.html(""),Waymark.gallery.hide(),jQuery(Waymark.map.getContainer()).removeClass("waymark-has-gallery"),Waymark.gallery_images.length)){for(i=0;i<Waymark.gallery_images.length;i++){var e=Waymark.gallery_images[i];let n=Waymark.map;if(Waymark.config.show_cluster&&"object"==typeof Waymark.marker_cluster&&(n=Waymark.marker_cluster),Waymark.map.getBounds().contains(e.marker.getLatLng())&&n.hasLayer(e.marker)){t++;var a=jQuery("<div />").addClass("waymark-image").on("click",{marker:e.marker},function(t){t.data.marker.openPopup()}),s=jQuery("<img />").attr({src:e.image_thumbnail_url});a.append(s),Waymark.gallery.append(a)}}t&&(Waymark.gallery.show(),jQuery(Waymark.map.getContainer()).addClass("waymark-has-gallery"))}}}function Waymark_Map_Editor(){this.pre_map_setup=function(){Waymark=this,Waymark.mode="edit"},this.init_done=function(){Waymark=this,jQuery(Waymark.map.getContainer()).addClass("waymark-is-editor"),Waymark.jq_map_container.append(jQuery("<div />").attr({id:"waymark-loading"}).html('<div class="waymark-spinner"></div>')),Waymark.map.on("editable:drawing:commit",function(t){switch(void 0===(layer=t.layer).feature&&(layer.feature={type:"Feature",properties:{}}),!0){case layer instanceof Waymark_L.Circle:layer.feature.properties=Waymark.config.shape_data_defaults,layer.feature.properties.radius=layer.getRadius();break;case layer instanceof Waymark_L.Rectangle:layer.feature.properties=Waymark.config.shape_data_defaults,layer.feature.properties.rectangle=!0;break;case layer instanceof Waymark_L.Polygon:layer.feature.properties=Waymark.config.shape_data_defaults;break;case layer instanceof Waymark_L.Polyline:layer.feature.properties=Waymark.config.line_data_defaults}Waymark.map_data.addData(layer.toGeoJSON()),Waymark.map.removeLayer(layer),Waymark.save_data_layer(),Waymark.map_was_edited()}),Waymark.map.on("editable:editing",function(t){void 0!==(layer=t.layer).feature&&layer.feature.properties.radius&&(layer.feature.properties.radius=layer.getRadius()),Waymark.save_data_layer(),Waymark.map_was_edited()}),Waymark.map.on("popupopen",function(t){var e=t.popup._source.feature;setTimeout(function(){wp.editor.initialize("waymark-info-description",{tinymce:{toolbar1:"styleselect | bullist numlist | link image",setup:function(t){t.on("change",function(t){e.properties.description=wp.editor.getContent("waymark-info-description"),Waymark.save_data_layer(),Waymark.map_was_edited()})}}})},250)}),Waymark.map.on("popupclose",function(t){wp.editor.remove("waymark-info-description"),jQuery("#waymark-info-description").show()})},this.create_marker=function(t){Waymark=this;var e=Waymark_L.marker(t,{draggable:!0});return e.on("moveend",function(t){var e=t.target,n=e.feature;n.geometry.coordinates=[e._latlng.lng.toFixed(6),e._latlng.lat.toFixed(6),],Waymark.info_window("marker",n,e),Waymark.save_data_layer(),Waymark.map_was_edited()}),e},this.save_data_layer=function(){Waymark=this;var t=jQuery(".waymark-input-map_data").first(),e=JSON.stringify(Waymark.map_data.toGeoJSON());t.html(e)},this.map_was_edited=function(){},this.loading_start=function(){Waymark=this,Waymark.jq_map_container.addClass("waymark-loading")},this.loading_stop=function(){Waymark=this,Waymark.jq_map_container.removeClass("waymark-loading")},this.create_buttons=function(){Waymark=this;var t=Waymark_L.Control.geocoder({position:"bottomright",defaultMarkGeocode:!1,placeholder:waymark_js.lang.action_search_placeholder});t.on("markgeocode",function(t){Waymark.map.fitBounds(t.geocode.bbox)}),t.addTo(Waymark.map);var e=Waymark_L.Control.extend({options:{position:"bottomleft"},onAdd:function(t){var e=Waymark_L.DomUtil.create("div","leaflet-bar leaflet-control waymark-leaflet-control waymark-edit-toolbar"),n=Waymark_L.DomUtil.create("a","waymark-icon waymark-edit-button waymark-edit-line",e);n.setAttribute("title",waymark_js.lang.add_line_title),n.onclick=function(){Waymark.map.editTools.startPolyline()};var n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-image",e);n.innerHTML='<i class="ion ion-image"></i>',n.setAttribute("title",waymark_js.lang.add_photo_title),n.onclick=function(){if(void 0!==wp.media)return wp.media.editor.send.attachment=function(t,e){if(Waymark.debug(e),void 0===e.url)return!1;var n=new FormData;n.append("waymark_security",waymark_security),n.append("action","waymark_get_attatchment_meta"),n.append("attachment_id",e.id),jQuery.ajax({type:"POST",url:waymark_js.ajaxurl,data:n,dataType:"json",processData:!1,contentType:!1,success:function(t){if(Waymark.debug(t),null===t){Waymark.message(waymark_js.lang.error_photo_meta,"error");return}var n=Waymark.map.getCenter();(latlng=Waymark.get_exif_latlng(t))&&(n=latlng,Waymark.map.setView(n));var a=Waymark.get_image_sizes(e.sizes,e.url),s=Waymark.create_marker_json(n,a);Waymark.map_data.addData(s),Waymark.save_data_layer(),Waymark.map_was_edited()}})},wp.media.editor.open(),!1;var t=jQuery("<input />").attr({type:"file",name:"add_photo"}).css("display","none").change(function(){Waymark.handle_file_upload(jQuery(this))});jQuery("#waymark-edit-toolbar").append(t),t.trigger("click")};var n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-marker",e);n.innerHTML='<i class="ion ion-location"></i>',n.setAttribute("title",waymark_js.lang.add_marker_title),n.onclick=function(){var t=Waymark.create_marker_json(Waymark.map.getCenter());Waymark.map_data.addData(t),Waymark.save_data_layer(),Waymark.map_was_edited()};var n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-rectangle",e);n.innerHTML='<i class="ion ion-android-checkbox-outline-blank"></i>',n.setAttribute("title",waymark_js.lang.add_rectangle_title),n.onclick=function(){Waymark.map.editTools.startRectangle()};var n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-polygon",e);n.innerHTML='<i class="ion ion-android-star-outline"></i>',n.setAttribute("title",waymark_js.lang.add_polygon_title),n.onclick=function(){Waymark.map.editTools.startPolygon()};var n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-circle",e);if(n.innerHTML='<i class="ion ion-ios-circle-outline"></i>',n.setAttribute("title",waymark_js.lang.add_circle_title),n.onclick=function(){Waymark.map.editTools.startCircle()},void 0!==wp.media&&!0==Waymark.get_property(waymark_settings,"misc","editor_options","media_library_uploads")){var n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-upload",e);n.innerHTML='<i class="ion ion-document"></i><i class="ion ion-arrow-up-c"></i>',n.setAttribute("title",waymark_js.lang.upload_file_title),n.onclick=function(){return wp.media.editor.send.attachment=function(t,e){Waymark.debug(e),jQuery.ajax({type:"GET",url:e.url,dataType:"text",success:function(t){switch(e.mime){case"application/gpx+xml":Waymark.load_file_contents(t,"gpx");break;case"application/vnd.google-earth.kml+xml":Waymark.load_file_contents(t,"kml");break;case"application/geo+json":Waymark.load_file_contents(t,"geojson");break;default:Waymark.message(waymark_js.lang.error_file_upload)}}})},wp.media.editor.open(),!1}}else{var a=jQuery("<input />").attr({type:"file",name:"add_file"}).css("display","none").change(function(){Waymark.handle_file_upload(jQuery(this))}),n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-upload",e);jQuery("#waymark-edit-toolbar").append(a),n.innerHTML='<i class="ion ion-document"></i><i class="ion ion-arrow-up-c"></i>',n.setAttribute("title",waymark_js.lang.upload_file_title),n.onclick=function(){a.trigger("click"),Waymark.map.editTools.stopDrawing()}}return e}});Waymark.map.addControl(new e)},this.handle_file_upload=function(t,e={}){Waymark=this,Waymark.loading_start();var n=new FormData;n.append("waymark_security",waymark_security),n.append("action","waymark_read_file"),n.append(t.attr("name"),t[0].files[0]),jQuery.ajax({type:"POST",url:waymark_js.ajaxurl,data:n,dataType:"json",processData:!1,contentType:!1,success:function(n){if(Waymark.debug(n),null===n)return Waymark.message(waymark_js.lang.error_file_upload,"error"),Waymark.loading_stop(),!1;if(n.error)return Waymark.message(n.error,"error"),Waymark.loading_stop(),!1;switch(t.attr("name")){case"add_file":Waymark.load_file_contents(n.file_contents,n.file_type);break;case"add_photo":if(void 0===n.url)return!1;var a=Waymark.map.getCenter();(latlng=Waymark.get_exif_latlng(n))&&(a=latlng,Waymark.map.setView(a));var s=Waymark.get_image_sizes(n.sizes,n.url),r=Waymark.create_marker_json(a,s);Waymark.map_data.addData(r),//!!! To-do - move this into Waymark.map_was_edited()
Waymark.save_data_layer();break;case"marker_photo":if(void 0===n.url)return!1;var s=Waymark.get_image_sizes(n.sizes,n.url);e.feature.properties=Object.assign({},e.feature.properties,s),e.img_view.attr("href",e.feature.properties.image_large_url),jQuery("img",e.img_view).attr("src",e.feature.properties.image_thumbnail_url),e.img_input.val(e.feature.properties.image_large_url),//!!! To-do - move this into Waymark.map_was_edited()
Waymark.save_data_layer()}Waymark.map_was_edited(),Waymark.loading_stop()}})},this.build_content=function(t,e,n){Waymark=this;var a=jQuery("<div />"),s=jQuery("<ul />").addClass("waymark-info");if("line"==t||"shape"==t){var r=jQuery("<button />").html('<i class="ion-edit"></i>').addClass("button").attr("title",waymark_js.lang.action_edit+" "+Waymark.title_case(waymark_js.lang["object_label_"+t])).on("click",function(e){e.preventDefault();var a=jQuery(this),s=jQuery("i",a);return n.editEnabled()?(n.disableEdit(),a.attr("title",waymark_js.lang.action_edit+" "+Waymark.title_case(waymark_js.lang["object_label_"+t])),s.attr("class","ion-edit"),"function"==typeof Waymark.config.handle_edit_callback&&Waymark.config.handle_edit_callback(!1)):(n.enableEdit(),n.closePopup(),a.attr("title",waymark_js.lang.action_edit_done),s.attr("class","ion-android-done"),"function"==typeof Waymark.config.handle_edit_callback&&Waymark.config.handle_edit_callback(!0)),!1});s.append(jQuery("<li />").addClass("waymark-info-button waymark-info-edit waymark-"+t+"-edit").append(r))}var r=jQuery("<button />").html('<i class="ion-ios-copy"></i>').addClass("button").attr("title",waymark_js.lang.action_duplicate+" "+Waymark.title_case(waymark_js.lang["object_label_"+t])).on("click",function(t){return t.preventDefault(),Waymark.load_json(Object.assign({},n.feature)),Waymark.map_was_edited(),!1});s.append(jQuery("<li />").addClass("waymark-info-button waymark-info-duplicate waymark-"+t+"-duplicate").append(r));var r=jQuery("<button />").html('<i class="ion-trash-a"></i>').addClass("button").attr("title",waymark_js.lang.action_delete+" "+Waymark.title_case(waymark_js.lang["object_label_"+t])).on("click",function(a){return a.preventDefault(),!!("1"!=Waymark.config.editor_options.confirm_delete||confirm(waymark_js.lang.action_delete_confirm+" "+Waymark.title_case(waymark_js.lang["object_label_"+t])+"?"))&&(Waymark.map.removeLayer(n),Waymark.map_data.removeLayer(n),Waymark.save_data_layer(),Waymark.map_was_edited(),"function"==typeof Waymark.config.handle_delete_callback&&Waymark.config.handle_delete_callback(e),!1)});s.append(jQuery("<li />").addClass("waymark-info-button waymark-info-delete waymark-"+t+"-delete").append(r));var l=Waymark.config[t+"_types"];if("line"==t){var h=jQuery("<select />");h.append(jQuery("<option />").val("").text(Waymark.title_case(waymark_js.lang.no_direction)),jQuery("<option />").val("default").text(Waymark.title_case(waymark_js.lang.show_direction)),jQuery("<option />").val("reverse").text(Waymark.title_case(waymark_js.lang.reverse_direction))),h.change(function(){jQuery("option:selected",jQuery(this));var t=jQuery(this).val();e.properties.direction=t,Waymark.draw_line_direction(n),Waymark.save_data_layer(),Waymark.map_was_edited()}),s.append(jQuery("<li />").addClass("waymark-info-direction waymark-line-direction").append(h)),"string"==typeof e.properties.direction&&jQuery("option",h).filter(function(){return jQuery(this).val()==Waymark.make_key(e.properties.direction)}).attr("selected","selected")}var c=jQuery("<select />");for(var d in c.append(jQuery("<option />").attr({disabled:"disabled"}).text(Waymark.title_case(waymark_js.lang["object_label_"+t])+" "+waymark_js.lang.object_type_label+":")),l){var u=Waymark.make_key(l[d][t+"_title"]);c.append(jQuery("<option />").val(u).text(l[d][t+"_title"]))}c.change(function(){jQuery("option:selected",jQuery(this));var a=jQuery(this).val();if(e.properties.type=a,"object"!=typeof a)var s=Waymark.get_type(t,e.properties.type);switch(t){case"line":n.setStyle({color:s.line_colour,weight:s.line_weight,opacity:s.line_opacity});break;case"shape":n.setStyle({color:s.shape_colour,fillOpacity:s.fill_opacity});break;case"marker":n.setIcon(Waymark_L.divIcon(Waymark.build_icon_data(s)))}Waymark.save_data_layer(),Waymark.map_was_edited()}),s.append(jQuery("<li />").addClass("waymark-info-type waymark-"+t+"-type").append(c)),jQuery("option",c).filter(function(){return jQuery(this).val()==Waymark.make_key(e.properties.type)}).attr("selected","selected");var p=jQuery("<div />").addClass("waymark-overlay-preview waymark-"+t+"-preview");for(var d in l){var m=l[d][t+"_title"],u=Waymark.make_key(m),f=Waymark.get_type(t,u),g=jQuery("<div />").addClass("waymark-type").data("type_key",u).attr("title",m);switch(t){case"marker":var y=Waymark.build_icon_data(f);g.addClass(y.className).html(y.html).css({width:y.iconSize[0],height:y.iconSize[1]});break;case"line":g.addClass("waymark-line").append(jQuery("<div />").css({margin:"15px 0",height:"1px",borderTop:f.line_weight+"px solid "+f.line_colour}));break;case"shape":g.addClass("waymark-shape").css({border:"3px solid "+f.shape_colour}).append(jQuery("<div />").css({height:"20px",background:f.shape_colour,opacity:f.fill_opacity}))}var v=jQuery("<div />").addClass("waymark-overlay-wrap waymark-"+t+"-wrap");"1"==Waymark.config.map_options.show_type_labels&&v.append(jQuery("<div />").addClass("waymark-type-title").text(m)),v.append(g),v.on("click",function(){var e=(g=jQuery(".waymark-type",jQuery(this))).data("type_key");jQuery("option",c).each(function(){g.val()==e?g.attr("selected","selected"):g.removeAttr("selected")}),c.val(e),c.trigger("change"),jQuery(".waymark-"+t+"-wrap",p).each(function(){g.removeClass("waymark-active")}),g.parent(".waymark-"+t+"-wrap").addClass("waymark-active")}),u==Waymark.make_key(e.properties.type)?(v.addClass("waymark-active"),p.prepend(v)):p.append(v)}for(key in s.append(p),Waymark.config[t+"_data_defaults"]){var r=null;switch(key){case"title":var r=jQuery("<input />").attr({type:"text",value:e.properties.title,placeholder:Waymark.title_case(waymark_js.lang["object_label_"+t])+" "+waymark_js.lang.object_title_placeholder}).on("change",function(){e.properties.title=jQuery(this).val(),Waymark.save_data_layer(),Waymark.map_was_edited()});break;case"description":var r=jQuery("<textarea />").attr({id:"waymark-info-description",class:"wp-editor",placeholder:Waymark.title_case(waymark_js.lang["object_label_"+t])+" "+waymark_js.lang.object_description_placeholder}).val(e.properties.description).on("change",function(){e.properties.description=jQuery(this).val(),Waymark.save_data_layer(),Waymark.map_was_edited()});break;case"image_large_url":var k=jQuery("<input />").attr({value:e.properties.image_large_url,placeholder:waymark_js.lang.object_image_placeholder}).on("change",function(){e.properties.image_large_url=jQuery(this).val(),Waymark.save_data_layer(),Waymark.map_was_edited()});if(void 0!==e.properties.image_thumbnail_url)var w=e.properties.image_thumbnail_url;else var w=e.properties.image_large_url;var x=jQuery("<img />").attr({src:w,width:160});k.on("change",function(){x.attr("src",jQuery(this).val())});var $=jQuery("<a />").attr({href:e.properties.image_large_url,target:"_blank"}).append(x).hover(function(){jQuery(this).addClass("waymark-hover")},function(){jQuery(this).removeClass("waymark-hover")}),b=jQuery("<button />").text(waymark_js.lang.action_upload_image).attr({type:"submit",name:"add_photo",class:"waymark-input button button-small",id:"add_photo"}).on("click",function(t){if(t.preventDefault(),void 0!==wp.media)return wp.media.editor.send.attachment=function(t,n){if(Waymark.debug(n),void 0===n.url)return!1;var a=Waymark.get_image_sizes(n.sizes,n.url);e.properties=Object.assign({},e.properties,a),$.attr("href",e.properties.image_large_url),jQuery("img",$).attr("src",e.properties.image_thumbnail_url),k.val(e.properties.image_large_url),Waymark.save_data_layer(),Waymark.map_was_edited()},wp.media.editor.open(),!1;var n=jQuery("<input />").attr({type:"file",name:"marker_photo"}).css("display","none").change(function(){Waymark.handle_file_upload(jQuery(this),{feature:e,img_view:$,img_input:k})});jQuery("#waymark-edit-toolbar").append(n),n.trigger("click")}),r=jQuery("<div />").append($,k,b)}r&&s.append(jQuery("<li />").addClass("waymark-info-"+key+" waymark-"+t+"-info-"+key).append(r))}if("marker"==t&&void 0!==n.feature.geometry.coordinates){n.feature.geometry.coordinates;var C=n.feature.geometry.coordinates[1],P=n.feature.geometry.coordinates[0];"number"==typeof C&&(P=P.toFixed(6),C=C.toFixed(6)),r=jQuery("<small>").html("<b>"+waymark_js.lang.marker_latlng_label+"</b>: "+C+","+P),s.append(jQuery("<li />").addClass("waymark-info-latlng waymark-marker-info-latlng").append(r))}return s.children().length&&a.append(s),a},this.info_window=function(t,e,n){Waymark=this;var a=Waymark.title_case(waymark_js.lang.action_edit+" "+t);if("function"==typeof Waymark.config.handle_content_callback)n.on("click",function(){var s=Waymark.build_content(t,e,n);Waymark.config.handle_content_callback(s.get(0),a,Waymark.mode)});else{var s=Waymark.build_content(t,e,n).get(0);n.bindPopup(s,{}).openPopup().on("click",function(){})}},this.load_file_contents=function(t,e){switch(Waymark=this,t=t.trim(),e=e.toLowerCase()){case"gpx":var n=new DOMParser().parseFromString(t,"text/xml"),a=toGeoJSON.gpx(n);break;case"kml":var s=new DOMParser().parseFromString(t,"text/xml"),a=toGeoJSON.kml(s);break;case"json":case"geojson":var a=JSON.parse(t);break;default:Waymark.message(waymark_js.lang.error_file_type,"error")}void 0!==a?this.load_json(a):Waymark.message(waymark_js.lang.error_file_conversion,"error")},this.load_json=function(t){if(Waymark=this,"object"==typeof t){Waymark.map_data.addData(t),Waymark.save_data_layer();var e=Waymark.map_data.getBounds();e.isValid()&&Waymark.map.fitBounds(e)}}}function Waymark_Map_Factory(){this.instances=[],this.viewer=function(){var t=Object.assign(new Waymark_Map,new Waymark_Map_Viewer);return this.instances.push(t),t},this.editor=function(){var t=Object.assign(new Waymark_Map,new Waymark_Map_Editor);return this.instances.push(t),t}}window.Waymark_Map_Factory=new Waymark_Map_Factory;