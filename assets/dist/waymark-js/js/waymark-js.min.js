!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.L={})}(this,(function(t){var e=Object.freeze;function i(t){var e,i,n,a;for(i=1,n=arguments.length;i<n;i++)for(e in a=arguments[i])t[e]=a[e];return t}Object.freeze=function(t){return t};var n=Object.create||function(t){return a.prototype=t,new a};function a(){}function o(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var n=i.call(arguments,2);return function(){return t.apply(e,n.length?n.concat(i.call(arguments)):arguments)}}var r=0;function s(t){return t._leaflet_id=t._leaflet_id||++r,t._leaflet_id}function l(t,e,i){var n,a,o,r;return r=function(){n=!1,a&&(o.apply(i,a),a=!1)},o=function(){n?a=arguments:(t.apply(i,arguments),setTimeout(r,e),n=!0)}}function h(t,e,i){var n=e[1],a=e[0],o=n-a;return t===n&&i?t:((t-a)%o+o)%o+a}function d(){return!1}function c(t,e){return e=void 0===e?6:e,+(Math.round(t+"e+"+e)+"e-"+e)}function u(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function _(t){return u(t).split(/\s+/)}function p(t,e){for(var i in t.hasOwnProperty("options")||(t.options=t.options?n(t.options):{}),e)t.options[i]=e[i];return t.options}function m(t,e,i){var n=[];for(var a in t)n.push(encodeURIComponent(i?a.toUpperCase():a)+"="+encodeURIComponent(t[a]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")}var f=/\{ *([\w_-]+) *\}/g;function g(t,e){return t.replace(f,(function(t,i){var n=e[i];if(void 0===n)throw new Error("No value provided for variable "+t);return"function"==typeof n&&(n=n(e)),n}))}var y=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function v(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1}var k="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function w(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var b=0;function x(t){var e=+new Date,i=Math.max(0,16-(e-b));return b=e+i,window.setTimeout(t,i)}var W=window.requestAnimationFrame||w("RequestAnimationFrame")||x,P=window.cancelAnimationFrame||w("CancelAnimationFrame")||w("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function C(t,e,i){if(!i||W!==x)return W.call(window,o(t,e));t.call(e)}function M(t){t&&P.call(window,t)}var E=(Object.freeze||Object)({freeze:e,extend:i,create:n,bind:o,lastId:r,stamp:s,throttle:l,wrapNum:h,falseFn:d,formatNum:c,trim:u,splitWords:_,setOptions:p,getParamString:m,template:g,isArray:y,indexOf:v,emptyImageUrl:k,requestFn:W,cancelFn:P,requestAnimFrame:C,cancelAnimFrame:M});function T(){}T.extend=function(t){function e(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()}var a=e.__super__=this.prototype,o=n(a);for(var r in(o.constructor=e).prototype=o,this)this.hasOwnProperty(r)&&"prototype"!==r&&"__super__"!==r&&(e[r]=this[r]);return t.statics&&(i(e,t.statics),delete t.statics),t.includes&&(function(t){if("undefined"!=typeof L&&L&&L.Mixin){t=y(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(t.includes),i.apply(null,[o].concat(t.includes)),delete t.includes),o.options&&(t.options=i(n(o.options),t.options)),i(o,t),o._initHooks=[],o.callInitHooks=function(){if(!this._initHooksCalled){a.callInitHooks&&a.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=o._initHooks.length;t<e;t++)o._initHooks[t].call(this)}},e},T.include=function(t){return i(this.prototype,t),this},T.mergeOptions=function(t){return i(this.prototype.options,t),this},T.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};var S={on:function(t,e,i){if("object"==typeof t)for(var n in t)this._on(n,t[n],e);else for(var a=0,o=(t=_(t)).length;a<o;a++)this._on(t[a],e,i);return this},off:function(t,e,i){if(t)if("object"==typeof t)for(var n in t)this._off(n,t[n],e);else for(var a=0,o=(t=_(t)).length;a<o;a++)this._off(t[a],e,i);else delete this._events;return this},_on:function(t,e,i){this._events=this._events||{};var n=this._events[t];n||(n=[],this._events[t]=n),i===this&&(i=void 0);for(var a={fn:e,ctx:i},o=n,r=0,s=o.length;r<s;r++)if(o[r].fn===e&&o[r].ctx===i)return;o.push(a)},_off:function(t,e,i){var n,a,o;if(this._events&&(n=this._events[t]))if(e){if(i===this&&(i=void 0),n)for(a=0,o=n.length;a<o;a++){var r=n[a];if(r.ctx===i&&r.fn===e)return r.fn=d,this._firingCount&&(this._events[t]=n=n.slice()),void n.splice(a,1)}}else{for(a=0,o=n.length;a<o;a++)n[a].fn=d;delete this._events[t]}},fire:function(t,e,n){if(!this.listens(t,n))return this;var a=i({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var o=this._events[t];if(o){this._firingCount=this._firingCount+1||1;for(var r=0,s=o.length;r<s;r++){var l=o[r];l.fn.call(l.ctx||this,a)}this._firingCount--}}return n&&this._propagateEvent(a),this},listens:function(t,e){var i=this._events&&this._events[t];if(i&&i.length)return!0;if(e)for(var n in this._eventParents)if(this._eventParents[n].listens(t,e))return!0;return!1},once:function(t,e,i){if("object"==typeof t){for(var n in t)this.once(n,t[n],e);return this}var a=o((function(){this.off(t,e,i).off(t,a,i)}),this);return this.on(t,e,i).on(t,a,i)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[s(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[s(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,i({layer:t.target,propagatedFrom:t.target},t),!0)}};S.addEventListener=S.on,S.removeEventListener=S.clearAllEventListeners=S.off,S.addOneTimeEventListener=S.once,S.fireEvent=S.fire,S.hasEventListeners=S.listens;var D=T.extend(S);function z(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e}var j=Math.trunc||function(t){return 0<t?Math.floor(t):Math.ceil(t)};function O(t,e,i){return t instanceof z?t:y(t)?new z(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new z(t.x,t.y):new z(t,e,i)}function B(t,e){if(t)for(var i=e?[t,e]:t,n=0,a=i.length;n<a;n++)this.extend(i[n])}function A(t,e){return!t||t instanceof B?t:new B(t,e)}function F(t,e){if(t)for(var i=e?[t,e]:t,n=0,a=i.length;n<a;n++)this.extend(i[n])}function I(t,e){return t instanceof F?t:new F(t,e)}function N(t,e,i){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==i&&(this.alt=+i)}function Z(t,e,i){return t instanceof N?t:y(t)&&"object"!=typeof t[0]?3===t.length?new N(t[0],t[1],t[2]):2===t.length?new N(t[0],t[1]):null:null==t?t:"object"==typeof t&&"lat"in t?new N(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new N(t,e,i)}z.prototype={clone:function(){return new z(this.x,this.y)},add:function(t){return this.clone()._add(O(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(O(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new z(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new z(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=j(this.x),this.y=j(this.y),this},distanceTo:function(t){var e=(t=O(t)).x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return(t=O(t)).x===this.x&&t.y===this.y},contains:function(t){return t=O(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+c(this.x)+", "+c(this.y)+")"}},B.prototype={extend:function(t){return t=O(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new z((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new z(this.min.x,this.max.y)},getTopRight:function(){return new z(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return(t="number"==typeof t[0]||t instanceof z?O(t):A(t))instanceof B?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=A(t);var e=this.min,i=this.max,n=t.min,a=t.max,o=a.x>=e.x&&n.x<=i.x,r=a.y>=e.y&&n.y<=i.y;return o&&r},overlaps:function(t){t=A(t);var e=this.min,i=this.max,n=t.min,a=t.max,o=a.x>e.x&&n.x<i.x,r=a.y>e.y&&n.y<i.y;return o&&r},isValid:function(){return!(!this.min||!this.max)}},F.prototype={extend:function(t){var e,i,n=this._southWest,a=this._northEast;if(t instanceof N)i=e=t;else{if(!(t instanceof F))return t?this.extend(Z(t)||I(t)):this;if(e=t._southWest,i=t._northEast,!e||!i)return this}return n||a?(n.lat=Math.min(e.lat,n.lat),n.lng=Math.min(e.lng,n.lng),a.lat=Math.max(i.lat,a.lat),a.lng=Math.max(i.lng,a.lng)):(this._southWest=new N(e.lat,e.lng),this._northEast=new N(i.lat,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,a=Math.abs(e.lng-i.lng)*t;return new F(new N(e.lat-n,e.lng-a),new N(i.lat+n,i.lng+a))},getCenter:function(){return new N((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new N(this.getNorth(),this.getWest())},getSouthEast:function(){return new N(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof N||"lat"in t?Z(t):I(t);var e,i,n=this._southWest,a=this._northEast;return t instanceof F?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=a.lat&&e.lng>=n.lng&&i.lng<=a.lng},intersects:function(t){t=I(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),a=t.getNorthEast(),o=a.lat>=e.lat&&n.lat<=i.lat,r=a.lng>=e.lng&&n.lng<=i.lng;return o&&r},overlaps:function(t){t=I(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),a=t.getNorthEast(),o=a.lat>e.lat&&n.lat<i.lat,r=a.lng>e.lng&&n.lng<i.lng;return o&&r},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=I(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}};var R,U={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,i=this.scale(t);return new B(this.transformation.transform(e.min,i),this.transformation.transform(e.max,i))},infinite:!(N.prototype={equals:function(t,e){return!!t&&(t=Z(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+c(this.lat,t)+", "+c(this.lng,t)+")"},distanceTo:function(t){return G.distance(this,Z(t))},wrap:function(){return G.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return I([this.lat-e,this.lng-i],[this.lat+e,this.lng+i])},clone:function(){return new N(this.lat,this.lng,this.alt)}}),wrapLatLng:function(t){var e=this.wrapLng?h(t.lng,this.wrapLng,!0):t.lng;return new N(this.wrapLat?h(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),i=this.wrapLatLng(e),n=e.lat-i.lat,a=e.lng-i.lng;if(0==n&&0==a)return t;var o=t.getSouthWest(),r=t.getNorthEast();return new F(new N(o.lat-n,o.lng-a),new N(r.lat-n,r.lng-a))}},G=i({},U,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,n=t.lat*i,a=e.lat*i,o=Math.sin((e.lat-t.lat)*i/2),r=Math.sin((e.lng-t.lng)*i/2),s=o*o+Math.cos(n)*Math.cos(a)*r*r,l=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*l}}),V={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),a=Math.sin(n*e);return new z(this.R*t.lng*e,this.R*Math.log((1+a)/(1-a))/2)},unproject:function(t){var e=180/Math.PI;return new N((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:(R=6378137*Math.PI,new B([-R,-R],[R,R]))};function H(t,e,i,n){if(y(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=i,this._d=n}function q(t,e,i,n){return new H(t,e,i,n)}H.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new z((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var Q,X=i({},G,{code:"EPSG:3857",projection:V,transformation:(Q=.5/(Math.PI*V.R),q(Q,.5,-Q,.5))}),K=i({},X,{code:"EPSG:900913"});function J(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Y(t,e){var i,n,a,o,r,s,l="";for(i=0,a=t.length;i<a;i++){for(n=0,o=(r=t[i]).length;n<o;n++)l+=(n?"L":"M")+(s=r[n]).x+" "+s.y;l+=e?Et?"z":"x":""}return l||"M0 0"}var $=document.documentElement.style,tt="ActiveXObject"in window,et=tt&&!document.addEventListener,it="msLaunchUri"in navigator&&!("documentMode"in document),nt=St("webkit"),at=St("android"),ot=St("android 2")||St("android 3"),rt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),st=at&&St("Google")&&rt<537&&!("AudioNode"in window),lt=!!window.opera,ht=St("chrome"),dt=St("gecko")&&!nt&&!lt&&!tt,ct=!ht&&St("safari"),ut=St("phantom"),_t="OTransition"in $,pt=0===navigator.platform.indexOf("Win"),mt=tt&&"transition"in $,ft="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ot,gt="MozPerspective"in $,yt=!window.L_DISABLE_3D&&(mt||ft||gt)&&!_t&&!ut,vt="undefined"!=typeof orientation||St("mobile"),kt=vt&&nt,Lt=vt&&ft,wt=!window.PointerEvent&&window.MSPointerEvent,bt=!(!window.PointerEvent&&!wt),xt=!window.L_NO_TOUCH&&(bt||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),Wt=vt&&lt,Pt=vt&&dt,Ct=1<(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI),Mt=!!document.createElement("canvas").getContext,Et=!(!document.createElementNS||!J("svg").createSVGRect),Tt=!Et&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}();function St(t){return 0<=navigator.userAgent.toLowerCase().indexOf(t)}var Dt=(Object.freeze||Object)({ie:tt,ielt9:et,edge:it,webkit:nt,android:at,android23:ot,androidStock:st,opera:lt,chrome:ht,gecko:dt,safari:ct,phantom:ut,opera12:_t,win:pt,ie3d:mt,webkit3d:ft,gecko3d:gt,any3d:yt,mobile:vt,mobileWebkit:kt,mobileWebkit3d:Lt,msPointer:wt,pointer:bt,touch:xt,mobileOpera:Wt,mobileGecko:Pt,retina:Ct,canvas:Mt,svg:Et,vml:Tt}),zt=wt?"MSPointerDown":"pointerdown",jt=wt?"MSPointerMove":"pointermove",Ot=wt?"MSPointerUp":"pointerup",Bt=wt?"MSPointerCancel":"pointercancel",At=["INPUT","SELECT","OPTION"],Ft={},It=!1,Nt=0;function Zt(t){Ft[t.pointerId]=t,Nt++}function Rt(t){Ft[t.pointerId]&&(Ft[t.pointerId]=t)}function Ut(t){delete Ft[t.pointerId],Nt--}function Gt(t,e){for(var i in t.touches=[],Ft)t.touches.push(Ft[i]);t.changedTouches=[t],e(t)}var Vt=wt?"MSPointerDown":bt?"pointerdown":"touchstart",Ht=wt?"MSPointerUp":bt?"pointerup":"touchend",qt="_leaflet_";var Qt,Xt,Kt,Jt,Yt,$t=me(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),te=me(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ee="webkitTransition"===te||"OTransition"===te?te+"End":"transitionend";function ie(t){return"string"==typeof t?document.getElementById(t):t}function ne(t,e){var i=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!i||"auto"===i)&&document.defaultView){var n=document.defaultView.getComputedStyle(t,null);i=n?n[e]:null}return"auto"===i?null:i}function ae(t,e,i){var n=document.createElement(t);return n.className=e||"",i&&i.appendChild(n),n}function oe(t){var e=t.parentNode;e&&e.removeChild(t)}function re(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function se(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function le(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function he(t,e){if(void 0!==t.classList)return t.classList.contains(e);var i=_e(t);return 0<i.length&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)}function de(t,e){if(void 0!==t.classList)for(var i=_(e),n=0,a=i.length;n<a;n++)t.classList.add(i[n]);else if(!he(t,e)){var o=_e(t);ue(t,(o?o+" ":"")+e)}}function ce(t,e){void 0!==t.classList?t.classList.remove(e):ue(t,u((" "+_e(t)+" ").replace(" "+e+" "," ")))}function ue(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function _e(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function pe(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&function(t,e){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(t){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}(t,e)}function me(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1}function fe(t,e,i){var n=e||new z(0,0);t.style[$t]=(mt?"translate("+n.x+"px,"+n.y+"px)":"translate3d("+n.x+"px,"+n.y+"px,0)")+(i?" scale("+i+")":"")}function ge(t,e){t._leaflet_pos=e,yt?fe(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function ye(t){return t._leaflet_pos||new z(0,0)}if("onselectstart"in document)Qt=function(){Ce(window,"selectstart",Oe)},Xt=function(){Ee(window,"selectstart",Oe)};else{var ve=me(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Qt=function(){if(ve){var t=document.documentElement.style;Kt=t[ve],t[ve]="none"}},Xt=function(){ve&&(document.documentElement.style[ve]=Kt,Kt=void 0)}}function ke(){Ce(window,"dragstart",Oe)}function Le(){Ee(window,"dragstart",Oe)}function we(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(be(),Yt=(Jt=t).style.outline,t.style.outline="none",Ce(window,"keydown",be))}function be(){Jt&&(Jt.style.outline=Yt,Yt=Jt=void 0,Ee(window,"keydown",be))}function xe(t){for(;!((t=t.parentNode).offsetWidth&&t.offsetHeight||t===document.body););return t}function We(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var Pe=(Object.freeze||Object)({TRANSFORM:$t,TRANSITION:te,TRANSITION_END:ee,get:ie,getStyle:ne,create:ae,remove:oe,empty:re,toFront:se,toBack:le,hasClass:he,addClass:de,removeClass:ce,setClass:ue,getClass:_e,setOpacity:pe,testProp:me,setTransform:fe,setPosition:ge,getPosition:ye,disableTextSelection:Qt,enableTextSelection:Xt,disableImageDrag:ke,enableImageDrag:Le,preventOutline:we,restoreOutline:be,getSizedParentNode:xe,getScale:We});function Ce(t,e,i,n){if("object"==typeof e)for(var a in e)Te(t,a,e[a],i);else for(var o=0,r=(e=_(e)).length;o<r;o++)Te(t,e[o],i,n);return this}var Me="_leaflet_events";function Ee(t,e,i,n){if("object"==typeof e)for(var a in e)Se(t,a,e[a],i);else if(e)for(var o=0,r=(e=_(e)).length;o<r;o++)Se(t,e[o],i,n);else{for(var s in t[Me])Se(t,s,t[Me][s]);delete t[Me]}return this}function Te(t,e,i,n){var a=e+s(i)+(n?"_"+s(n):"");if(t[Me]&&t[Me][a])return this;var r=function(e){return i.call(n||t,e||window.event)},l=r;bt&&0===e.indexOf("touch")?function(t,e,i,n){"touchstart"===e?function(t,e,i){var n=o((function(t){if("mouse"!==t.pointerType&&t.MSPOINTER_TYPE_MOUSE&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE){if(!(At.indexOf(t.target.tagName)<0))return;Oe(t)}Gt(t,e)}));t["_leaflet_touchstart"+i]=n,t.addEventListener(zt,n,!1),It||(document.documentElement.addEventListener(zt,Zt,!0),document.documentElement.addEventListener(jt,Rt,!0),document.documentElement.addEventListener(Ot,Ut,!0),document.documentElement.addEventListener(Bt,Ut,!0),It=!0)}(t,i,n):"touchmove"===e?function(t,e,i){var n=function(t){(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons)&&Gt(t,e)};t["_leaflet_touchmove"+i]=n,t.addEventListener(jt,n,!1)}(t,i,n):"touchend"===e&&function(t,e,i){var n=function(t){Gt(t,e)};t["_leaflet_touchend"+i]=n,t.addEventListener(Ot,n,!1),t.addEventListener(Bt,n,!1)}(t,i,n)}(t,e,r,a):!xt||"dblclick"!==e||bt&&ht?"addEventListener"in t?"mousewheel"===e?t.addEventListener("onwheel"in t?"wheel":"mousewheel",r,!1):"mouseenter"===e||"mouseleave"===e?(r=function(e){e=e||window.event,Ge(t,e)&&l(e)},t.addEventListener("mouseenter"===e?"mouseover":"mouseout",r,!1)):("click"===e&&at&&(r=function(t){!function(t,e){var i=t.timeStamp||t.originalEvent&&t.originalEvent.timeStamp,n=Ne&&i-Ne;if(n&&100<n&&n<500||t.target._simulatedClick&&!t._simulated)return Be(t);Ne=i,e(t)}(t,l)}),t.addEventListener(e,r,!1)):"attachEvent"in t&&t.attachEvent("on"+e,r):function(t,e,i){var n,a,o=!1;function r(t){var e;if(bt){if(!it||"mouse"===t.pointerType)return;e=Nt}else e=t.touches.length;if(!(1<e)){var i=Date.now(),r=i-(n||i);a=t.touches?t.touches[0]:t,o=0<r&&r<=250,n=i}}function s(t){if(o&&!a.cancelBubble){if(bt){if(!it||"mouse"===t.pointerType)return;var i,r,s={};for(r in a)i=a[r],s[r]=i&&i.bind?i.bind(a):i;a=s}a.type="dblclick",a.button=0,e(a),n=null}}t[qt+Vt+i]=r,t[qt+Ht+i]=s,t[qt+"dblclick"+i]=e,t.addEventListener(Vt,r,!1),t.addEventListener(Ht,s,!1),t.addEventListener("dblclick",e,!1)}(t,r,a),t[Me]=t[Me]||{},t[Me][a]=r}function Se(t,e,i,n){var a=e+s(i)+(n?"_"+s(n):""),o=t[Me]&&t[Me][a];if(!o)return this;bt&&0===e.indexOf("touch")?function(t,e,i){var n=t["_leaflet_"+e+i];"touchstart"===e?t.removeEventListener(zt,n,!1):"touchmove"===e?t.removeEventListener(jt,n,!1):"touchend"===e&&(t.removeEventListener(Ot,n,!1),t.removeEventListener(Bt,n,!1))}(t,e,a):!xt||"dblclick"!==e||bt&&ht?"removeEventListener"in t?"mousewheel"===e?t.removeEventListener("onwheel"in t?"wheel":"mousewheel",o,!1):t.removeEventListener("mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,o,!1):"detachEvent"in t&&t.detachEvent("on"+e,o):function(t,e){var i=t[qt+Vt+e],n=t[qt+Ht+e],a=t[qt+"dblclick"+e];t.removeEventListener(Vt,i,!1),t.removeEventListener(Ht,n,!1),it||t.removeEventListener("dblclick",a,!1)}(t,a),t[Me][a]=null}function De(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,Ue(t),this}function ze(t){return Te(t,"mousewheel",De),this}function je(t){return Ce(t,"mousedown touchstart dblclick",De),Te(t,"click",Re),this}function Oe(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Be(t){return Oe(t),De(t),this}function Ae(t,e){if(!e)return new z(t.clientX,t.clientY);var i=We(e),n=i.boundingClientRect;return new z((t.clientX-n.left)/i.x-e.clientLeft,(t.clientY-n.top)/i.y-e.clientTop)}var Fe=pt&&ht?2*window.devicePixelRatio:dt?window.devicePixelRatio:1;function Ie(t){return it?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/Fe:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}var Ne,Ze={};function Re(t){Ze[t.type]=!0}function Ue(t){var e=Ze[t.type];return Ze[t.type]=!1,e}function Ge(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(t){return!1}return i!==t}var Ve=(Object.freeze||Object)({on:Ce,off:Ee,stopPropagation:De,disableScrollPropagation:ze,disableClickPropagation:je,preventDefault:Oe,stop:Be,getMousePosition:Ae,getWheelDelta:Ie,fakeStop:Re,skipped:Ue,isExternalTarget:Ge,addListener:Ce,removeListener:Ee}),He=D.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=ye(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=C(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,i=1e3*this._duration;e<i?this._runFrame(this._easeOut(e/i),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var i=this._startPos.add(this._offset.multiplyBy(t));e&&i._round(),ge(this._el,i),this.fire("step")},_complete:function(){M(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),qe=D.extend({options:{crs:X,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=p(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(Z(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=te&&yt&&!Wt&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Ce(this._proxy,ee,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,n){return e=void 0===e?this._zoom:this._limitZoom(e),t=this._limitCenter(Z(t),e,this.options.maxBounds),n=n||{},this._stop(),this._loaded&&!n.reset&&!0!==n&&(void 0!==n.animate&&(n.zoom=i({animate:n.animate},n.zoom),n.pan=i({animate:n.animate,duration:n.duration},n.pan)),this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(t,e),this)},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(yt?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(yt?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),a=this.getSize().divideBy(2),o=(t instanceof z?t:this.latLngToContainerPoint(t)).subtract(a).multiplyBy(1-1/n),r=this.containerPointToLatLng(a.add(o));return this.setView(r,e,{zoom:i})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():I(t);var i=O(e.paddingTopLeft||e.padding||[0,0]),n=O(e.paddingBottomRight||e.padding||[0,0]),a=this.getBoundsZoom(t,!1,i.add(n));if((a="number"==typeof e.maxZoom?Math.min(e.maxZoom,a):a)===1/0)return{center:t.getCenter(),zoom:a};var o=n.subtract(i).divideBy(2),r=this.project(t.getSouthWest(),a),s=this.project(t.getNorthEast(),a);return{center:this.unproject(r.add(s).divideBy(2).add(o),a),zoom:a}},fitBounds:function(t,e){if(!(t=I(t)).isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(t,e);return this.setView(i.center,i.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=O(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new He,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){de(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,i){if(!1===(i=i||{}).animate||!yt)return this.setView(t,e,i);this._stop();var n=this.project(this.getCenter()),a=this.project(t),o=this.getSize(),r=this._zoom;t=Z(t),e=void 0===e?r:e;var s=Math.max(o.x,o.y),l=s*this.getZoomScale(r,e),h=a.distanceTo(n)||1,d=1.42,c=d*d;function u(t){var e=(l*l-s*s+(t?-1:1)*c*c*h*h)/(2*(t?l:s)*c*h),i=Math.sqrt(e*e+1)-e;return i<1e-9?-18:Math.log(i)}function _(t){return(Math.exp(t)-Math.exp(-t))/2}function p(t){return(Math.exp(t)+Math.exp(-t))/2}var m=u(0);var f=Date.now(),g=(u(1)-m)/d,y=i.duration?1e3*i.duration:1e3*g*.8;return this._moveStart(!0,i.noMoveStart),function i(){var o,l=(Date.now()-f)/y,u=(o=l,(1-Math.pow(1-o,1.5))*g);l<=1?(this._flyToFrame=C(i,this),this._move(this.unproject(n.add(a.subtract(n).multiplyBy(function(t){return s*(p(m)*(_(e=m+d*t)/p(e))-_(m))/c;var e}(u)/h)),r),this.getScaleZoom(s/function(t){return s*(p(m)/p(m+d*t))}(u),r),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}.call(this),this},flyToBounds:function(t,e){var i=this._getBoundsCenterZoom(t,e);return this.flyTo(i.center,i.zoom,e)},setMaxBounds:function(t){return(t=I(t)).isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var i=this.getCenter(),n=this._limitCenter(i,this._zoom,I(t));return i.equals(n)||this.panTo(n,e),this._enforcingBounds=!1,this},panInside:function(t,e){var i=O((e=e||{}).paddingTopLeft||e.padding||[0,0]),n=O(e.paddingBottomRight||e.padding||[0,0]),a=this.getCenter(),o=this.project(a),r=this.project(t),s=this.getPixelBounds(),l=s.getSize().divideBy(2),h=A([s.min.add(i),s.max.subtract(n)]);if(!h.contains(r)){this._enforcingBounds=!0;var d=o.subtract(r),c=O(r.x+d.x,r.y+d.y);(r.x<h.min.x||r.x>h.max.x)&&(c.x=o.x-d.x,0<d.x?c.x+=l.x-i.x:c.x-=l.x-n.x),(r.y<h.min.y||r.y>h.max.y)&&(c.y=o.y-d.y,0<d.y?c.y+=l.y-i.y:c.y-=l.y-n.y),this.panTo(this.unproject(c),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=i({animate:!1,pan:!0},!0===t?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var n=this.getSize(),a=e.divideBy(2).round(),r=n.divideBy(2).round(),s=a.subtract(r);return s.x||s.y?(t.animate&&t.pan?this.panBy(s):(t.pan&&this._rawPanBy(s),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:n})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=i({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=o(this._handleGeolocationResponse,this),n=o(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,n,t):navigator.geolocation.getCurrentPosition(e,n,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=new N(t.coords.latitude,t.coords.longitude),i=e.toBounds(2*t.coords.accuracy),n=this._locateOptions;if(n.setView){var a=this.getBoundsZoom(i);this.setView(e,n.maxZoom?Math.min(a,n.maxZoom):a)}var o={latlng:e,bounds:i,timestamp:t.timestamp};for(var r in t.coords)"number"==typeof t.coords[r]&&(o[r]=t.coords[r]);this.fire("locationfound",o)},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var t;for(t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),oe(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(M(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)oe(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var i=ae("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=i),i},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new F(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=I(t),i=O(i||[0,0]);var n=this.getZoom()||0,a=this.getMinZoom(),o=this.getMaxZoom(),r=t.getNorthWest(),s=t.getSouthEast(),l=this.getSize().subtract(i),h=A(this.project(s,n),this.project(r,n)).getSize(),d=yt?this.options.zoomSnap:1,c=l.x/h.x,u=l.y/h.y,_=e?Math.max(c,u):Math.min(c,u);return n=this.getScaleZoom(_,n),d&&(n=Math.round(n/(d/100))*(d/100),n=e?Math.ceil(n/d)*d:Math.floor(n/d)*d),Math.max(a,Math.min(o,n))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new z(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var i=this._getTopLeftPoint(t,e);return new B(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var i=this.options.crs;return e=void 0===e?this._zoom:e,i.scale(t)/i.scale(e)},getScaleZoom:function(t,e){var i=this.options.crs;e=void 0===e?this._zoom:e;var n=i.zoom(t*i.scale(e));return isNaN(n)?1/0:n},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(Z(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(O(t),e)},layerPointToLatLng:function(t){var e=O(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(Z(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(Z(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(I(t))},distance:function(t,e){return this.options.crs.distance(Z(t),Z(e))},containerPointToLayerPoint:function(t){return O(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return O(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(O(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Z(t)))},mouseEventToContainerPoint:function(t){return Ae(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=ie(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");Ce(e,"scroll",this._onScroll,this),this._containerId=s(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&yt,de(t,"leaflet-container"+(xt?" leaflet-touch":"")+(Ct?" leaflet-retina":"")+(et?" leaflet-oldie":"")+(ct?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=ne(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),ge(this._mapPane,new z(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(de(t.markerPane,"leaflet-zoom-hide"),de(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e){ge(this._mapPane,new z(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var n=this._zoom!==e;this._moveStart(n,!1)._move(t,e)._moveEnd(n),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,i){void 0===e&&(e=this._zoom);var n=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),(n||i&&i.pinch)&&this.fire("zoom",i),this.fire("move",i)},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return M(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){ge(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={};var e=t?Ee:Ce;e((this._targets[s(this._container)]=this)._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),yt&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){M(this._resizeRequest),this._resizeRequest=C((function(){this.invalidateSize({debounceMoveend:!0})}),this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var i,n=[],a="mouseout"===e||"mouseover"===e,o=t.target||t.srcElement,r=!1;o;){if((i=this._targets[s(o)])&&("click"===e||"preclick"===e)&&!t._simulated&&this._draggableMoved(i)){r=!0;break}if(i&&i.listens(e,!0)){if(a&&!Ge(o,t))break;if(n.push(i),a)break}if(o===this._container)break;o=o.parentNode}return n.length||r||a||!Ge(o,t)||(n=[this]),n},_handleDOMEvent:function(t){if(this._loaded&&!Ue(t)){var e=t.type;"mousedown"!==e&&"keypress"!==e&&"keyup"!==e&&"keydown"!==e||we(t.target||t.srcElement),this._fireDOMEvent(t,e)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,n){if("click"===t.type){var a=i({},t);a.type="preclick",this._fireDOMEvent(a,a.type,n)}if(!t._stopped&&(n=(n||[]).concat(this._findEventTargets(t,e))).length){var o=n[0];"contextmenu"===e&&o.listens(e,!0)&&Oe(t);var r={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var s=o.getLatLng&&(!o._radius||o._radius<=10);r.containerPoint=s?this.latLngToContainerPoint(o.getLatLng()):this.mouseEventToContainerPoint(t),r.layerPoint=this.containerPointToLayerPoint(r.containerPoint),r.latlng=s?o.getLatLng():this.layerPointToLatLng(r.layerPoint)}for(var l=0;l<n.length;l++)if(n[l].fire(e,r,!0),r.originalEvent._stopped||!1===n[l].options.bubblingMouseEvents&&-1!==v(this._mouseEvents,e))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return ye(this._mapPane)||new z(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return this.project(t,e)._subtract(n)},_latLngBoundsToNewLayerBounds:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return A([this.project(t.getSouthWest(),e)._subtract(n),this.project(t.getNorthWest(),e)._subtract(n),this.project(t.getSouthEast(),e)._subtract(n),this.project(t.getNorthEast(),e)._subtract(n)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),a=this.getSize().divideBy(2),o=new B(n.subtract(a),n.add(a)),r=this._getBoundsOffset(o,i,e);return r.round().equals([0,0])?t:this.unproject(n.add(r),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new B(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=A(this.project(e.getNorthEast(),i),this.project(e.getSouthWest(),i)),a=n.min.subtract(t.min),o=n.max.subtract(t.max);return new z(this._rebound(a.x,-o.x),this._rebound(a.y,-o.y))},_rebound:function(t,e){return 0<t+e?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),n=yt?this.options.zoomSnap:1;return n&&(t=Math.round(t/n)*n),Math.max(e,Math.min(i,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){ce(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(i)||(this.panBy(i,e),0))},_createAnimProxy:function(){var t=this._proxy=ae("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",(function(t){var e=$t,i=this._proxy.style[e];fe(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),i===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()}),this),this.on("load moveend",(function(){var t=this.getCenter(),e=this.getZoom();fe(this._proxy,this.project(t,e),this.getZoomScale(e,1))}),this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){oe(this._proxy),delete this._proxy},_catchTransitionEnd:function(t){this._animatingZoom&&0<=t.propertyName.indexOf("transform")&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||!1===i.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),a=this._getCenterOffset(t)._divideBy(1-1/n);return!(!0!==i.animate&&!this.getSize().contains(a)||(C((function(){this._moveStart(!0,!1)._animateZoom(t,e,!0)}),this),0))},_animateZoom:function(t,e,i,n){this._mapPane&&(i&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,de(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:n}),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&ce(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),C((function(){this._moveEnd(!0)}),this))}});function Qe(t){return new Xe(t)}var Xe=T.extend({options:{position:"topright"},initialize:function(t){p(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return de(e,"leaflet-control"),-1!==i.indexOf("bottom")?n.insertBefore(e,n.firstChild):n.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map&&(oe(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null),this},_refocusOnMap:function(t){this._map&&t&&0<t.screenX&&0<t.screenY&&this._map.getContainer().focus()}});qe.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",i=this._controlContainer=ae("div",e+"control-container",this._container);function n(n,a){var o=e+n+" "+e+a;t[n+a]=ae("div",o,i)}n("top","left"),n("top","right"),n("bottom","left"),n("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)oe(this._controlCorners[t]);oe(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Ke=Xe.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,i,n){return i<n?-1:n<i?1:0}},initialize:function(t,e,i){for(var n in p(this,i),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){this._initLayout(),this._update(),(this._map=t).on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return Xe.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(s(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){de(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(de(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):ce(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return ce(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=ae("div",t),i=this.options.collapsed;e.setAttribute("aria-haspopup",!0),je(e),ze(e);var n=this._section=ae("section",t+"-list");i&&(this._map.on("click",this.collapse,this),at||Ce(e,{mouseenter:this.expand,mouseleave:this.collapse},this));var a=this._layersLink=ae("a",t+"-toggle",e);a.href="#",a.title="Layers",xt?(Ce(a,"click",Be),Ce(a,"click",this.expand,this)):Ce(a,"focus",this.expand,this),i||this.expand(),this._baseLayersList=ae("div",t+"-base",n),this._separator=ae("div",t+"-separator",n),this._overlaysList=ae("div",t+"-overlays",n),e.appendChild(n)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&s(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:i}),this.options.sortLayers&&this._layers.sort(o((function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)}),this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;re(this._baseLayersList),re(this._overlaysList),this._layerControlInputs=[];var t,e,i,n,a=0;for(i=0;i<this._layers.length;i++)n=this._layers[i],this._addItem(n),e=e||n.overlay,t=t||!n.overlay,a+=n.overlay?0:1;return this.options.hideSingleBase&&(t=t&&1<a,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(s(t.target)),i=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)},_createRadioElement:function(t,e){var i='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",n=document.createElement("div");return n.innerHTML=i,n.firstChild},_addItem:function(t){var e,i=document.createElement("label"),n=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=n):e=this._createRadioElement("leaflet-base-layers_"+s(this),n),this._layerControlInputs.push(e),e.layerId=s(t.layer),Ce(e,"click",this._onInputClick,this);var a=document.createElement("span");a.innerHTML=" "+t.name;var o=document.createElement("div");return i.appendChild(o),o.appendChild(e),o.appendChild(a),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(i),this._checkDisabledLayers(),i},_onInputClick:function(){var t,e,i=this._layerControlInputs,n=[],a=[];this._handlingClick=!0;for(var o=i.length-1;0<=o;o--)t=i[o],e=this._getLayer(t.layerId).layer,t.checked?n.push(e):t.checked||a.push(e);for(o=0;o<a.length;o++)this._map.hasLayer(a[o])&&this._map.removeLayer(a[o]);for(o=0;o<n.length;o++)this._map.hasLayer(n[o])||this._map.addLayer(n[o]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,e,i=this._layerControlInputs,n=this._map.getZoom(),a=i.length-1;0<=a;a--)t=i[a],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&n<e.options.minZoom||void 0!==e.options.maxZoom&&n>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),Je=Xe.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=ae("div",e+" leaflet-bar"),n=this.options;return this._zoomInButton=this._createButton(n.zoomInText,n.zoomInTitle,e+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(n.zoomOutText,n.zoomOutTitle,e+"-out",i,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,i,n,a){var o=ae("a",i,n);return o.innerHTML=t,o.href="#",o.title=e,o.setAttribute("role","button"),o.setAttribute("aria-label",e),je(o),Ce(o,"click",Be),Ce(o,"click",a,this),Ce(o,"click",this._refocusOnMap,this),o},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";ce(this._zoomInButton,e),ce(this._zoomOutButton,e),!this._disabled&&t._zoom!==t.getMinZoom()||de(this._zoomOutButton,e),!this._disabled&&t._zoom!==t.getMaxZoom()||de(this._zoomInButton,e)}});qe.mergeOptions({zoomControl:!0}),qe.addInitHook((function(){this.options.zoomControl&&(this.zoomControl=new Je,this.addControl(this.zoomControl))}));var Ye=Xe.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",i=ae("div",e),n=this.options;return this._addScales(n,e+"-line",i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=ae("div",e,i)),t.imperial&&(this._iScale=ae("div",e,i))},_update:function(){var t=this._map,e=t.getSize().y/2,i=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(i)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},_updateImperial:function(t){var e,i,n,a=3.2808399*t;5280<a?(e=a/5280,i=this._getRoundNum(e),this._updateScale(this._iScale,i+" mi",i/e)):(n=this._getRoundNum(a),this._updateScale(this._iScale,n+" ft",n/a))},_updateScale:function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return e*(10<=i?10:5<=i?5:3<=i?3:2<=i?2:1)}}),$e=Xe.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){p(this,t),this._attributions={}},onAdd:function(t){for(var e in(t.attributionControl=this)._container=ae("div","leaflet-control-attribution"),je(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),this._container},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t&&(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update()),this},removeAttribution:function(t){return t&&this._attributions[t]&&(this._attributions[t]--,this._update()),this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}}});qe.mergeOptions({attributionControl:!0}),qe.addInitHook((function(){this.options.attributionControl&&(new $e).addTo(this)})),Xe.Layers=Ke,Xe.Zoom=Je,Xe.Scale=Ye,Xe.Attribution=$e,Qe.layers=function(t,e,i){return new Ke(t,e,i)},Qe.zoom=function(t){return new Je(t)},Qe.scale=function(t){return new Ye(t)},Qe.attribution=function(t){return new $e(t)};var ti=T.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled&&(this._enabled=!1,this.removeHooks()),this},enabled:function(){return!!this._enabled}});ti.addTo=function(t,e){return t.addHandler(e,this),this};var ei,ii={Events:S},ni=xt?"touchstart mousedown":"mousedown",ai={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},oi={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},ri=D.extend({options:{clickTolerance:3},initialize:function(t,e,i,n){p(this,n),this._element=t,this._dragStartTarget=e||t,this._preventOutline=i},enable:function(){this._enabled||(Ce(this._dragStartTarget,ni,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(ri._dragging===this&&this.finishDrag(),Ee(this._dragStartTarget,ni,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(!t._simulated&&this._enabled&&(this._moved=!1,!he(this._element,"leaflet-zoom-anim")&&!(ri._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||((ri._dragging=this)._preventOutline&&we(this._element),ke(),Qt(),this._moving)))){this.fire("down");var e=t.touches?t.touches[0]:t,i=xe(this._element);this._startPoint=new z(e.clientX,e.clientY),this._parentScale=We(i),Ce(document,oi[t.type],this._onMove,this),Ce(document,ai[t.type],this._onUp,this)}},_onMove:function(t){if(!t._simulated&&this._enabled)if(t.touches&&1<t.touches.length)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,i=new z(e.clientX,e.clientY)._subtract(this._startPoint);(i.x||i.y)&&(Math.abs(i.x)+Math.abs(i.y)<this.options.clickTolerance||(i.x/=this._parentScale.x,i.y/=this._parentScale.y,Oe(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=ye(this._element).subtract(i),de(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),de(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(i),this._moving=!0,M(this._animRequest),this._lastEvent=t,this._animRequest=C(this._updatePosition,this,!0)))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),ge(this._element,this._newPos),this.fire("drag",t)},_onUp:function(t){!t._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){for(var t in ce(document.body,"leaflet-dragging"),this._lastTarget&&(ce(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),oi)Ee(document,oi[t],this._onMove,this),Ee(document,ai[t],this._onUp,this);Le(),Xt(),this._moved&&this._moving&&(M(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,ri._dragging=!1}});function si(t,e){if(!e||!t.length)return t.slice();var i=e*e;return function(t,e){var i=t.length,n=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(i);n[0]=n[i-1]=1,function t(e,i,n,a,o){var r,s,l,h=0;for(s=a+1;s<=o-1;s++)h<(l=ui(e[s],e[a],e[o],!0))&&(r=s,h=l);n<h&&(i[r]=1,t(e,i,n,a,r),t(e,i,n,r,o))}(t,n,e,0,i-1);var a,o=[];for(a=0;a<i;a++)n[a]&&o.push(t[a]);return o}(t=function(t,e){for(var i=[t[0]],n=1,a=0,o=t.length;n<o;n++)r=t[n],e<(l=(s=t[a]).x-r.x)*l+(h=s.y-r.y)*h&&(i.push(t[n]),a=n);var r,s,l,h;return a<o-1&&i.push(t[o-1]),i}(t,i),i)}function li(t,e,i){return Math.sqrt(ui(t,e,i,!0))}function hi(t,e,i,n,a){var o,r,s,l=n?ei:ci(t,i),h=ci(e,i);for(ei=h;;){if(!(l|h))return[t,e];if(l&h)return!1;s=ci(r=di(t,e,o=l||h,i,a),i),o===l?(t=r,l=s):(e=r,h=s)}}function di(t,e,i,n,a){var o,r,s=e.x-t.x,l=e.y-t.y,h=n.min,d=n.max;return 8&i?(o=t.x+s*(d.y-t.y)/l,r=d.y):4&i?(o=t.x+s*(h.y-t.y)/l,r=h.y):2&i?(o=d.x,r=t.y+l*(d.x-t.x)/s):1&i&&(o=h.x,r=t.y+l*(h.x-t.x)/s),new z(o,r,a)}function ci(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i}function ui(t,e,i,n){var a,o=e.x,r=e.y,s=i.x-o,l=i.y-r,h=s*s+l*l;return 0<h&&(1<(a=((t.x-o)*s+(t.y-r)*l)/h)?(o=i.x,r=i.y):0<a&&(o+=s*a,r+=l*a)),s=t.x-o,l=t.y-r,n?s*s+l*l:new z(o,r)}function _i(t){return!y(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function pi(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),_i(t)}var mi=(Object.freeze||Object)({simplify:si,pointToSegmentDistance:li,closestPointOnSegment:function(t,e,i){return ui(t,e,i)},clipSegment:hi,_getEdgeIntersection:di,_getBitCode:ci,_sqClosestPointOnSegment:ui,isFlat:_i,_flat:pi});function fi(t,e,i){var n,a,o,r,s,l,h,d,c,u=[1,4,2,8];for(a=0,h=t.length;a<h;a++)t[a]._code=ci(t[a],e);for(r=0;r<4;r++){for(d=u[r],n=[],a=0,o=(h=t.length)-1;a<h;o=a++)s=t[a],l=t[o],s._code&d?l._code&d||((c=di(l,s,d,e,i))._code=ci(c,e),n.push(c)):(l._code&d&&((c=di(l,s,d,e,i))._code=ci(c,e),n.push(c)),n.push(s));t=n}return t}var gi,yi=(Object.freeze||Object)({clipPolygon:fi}),vi={project:function(t){return new z(t.lng,t.lat)},unproject:function(t){return new N(t.y,t.x)},bounds:new B([-180,-90],[180,90])},ki={R:6378137,R_MINOR:6356752.314245179,bounds:new B([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,i=this.R,n=t.lat*e,a=this.R_MINOR/i,o=Math.sqrt(1-a*a),r=o*Math.sin(n),s=Math.tan(Math.PI/4-n/2)/Math.pow((1-r)/(1+r),o/2);return n=-i*Math.log(Math.max(s,1e-10)),new z(t.lng*e*i,n)},unproject:function(t){for(var e,i=180/Math.PI,n=this.R,a=this.R_MINOR/n,o=Math.sqrt(1-a*a),r=Math.exp(-t.y/n),s=Math.PI/2-2*Math.atan(r),l=0,h=.1;l<15&&1e-7<Math.abs(h);l++)e=o*Math.sin(s),e=Math.pow((1-e)/(1+e),o/2),s+=h=Math.PI/2-2*Math.atan(r*e)-s;return new N(s*i,t.x*i/n)}},Li=(Object.freeze||Object)({LonLat:vi,Mercator:ki,SphericalMercator:V}),wi=i({},G,{code:"EPSG:3395",projection:ki,transformation:(gi=.5/(Math.PI*ki.R),q(gi,.5,-gi,.5))}),bi=i({},G,{code:"EPSG:4326",projection:vi,transformation:q(1/180,1,-1/180,.5)}),xi=i({},U,{projection:vi,transformation:q(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,n=e.lat-t.lat;return Math.sqrt(i*i+n*n)},infinite:!0});U.Earth=G,U.EPSG3395=wi,U.EPSG3857=X,U.EPSG900913=K,U.EPSG4326=bi,U.Simple=xi;var Wi=D.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[s(t)]=this},removeInteractiveTarget:function(t){return delete this._map._targets[s(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var i=this.getEvents();e.on(i,this),this.once("remove",(function(){e.off(i,this)}),this)}this.onAdd(e),this.getAttribution&&e.attributionControl&&e.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),e.fire("layeradd",{layer:this})}}});qe.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=s(t);return this._layers[e]||((this._layers[e]=t)._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=s(t);return this._layers[e]&&(this._loaded&&t.onRemove(this),t.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(t.getAttribution()),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null),this},hasLayer:function(t){return!!t&&s(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){for(var e=0,i=(t=t?y(t)?t:[t]:[]).length;e<i;e++)this.addLayer(t[e])},_addZoomLimit:function(t){!isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[s(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=s(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,i=this._getZoomSpan();for(var n in this._zoomBoundLayers){var a=this._zoomBoundLayers[n].options;t=void 0===a.minZoom?t:Math.min(t,a.minZoom),e=void 0===a.maxZoom?e:Math.max(e,a.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,i!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Pi=Wi.extend({initialize:function(t,e){var i,n;if(p(this,e),this._layers={},t)for(i=0,n=t.length;i<n;i++)this.addLayer(t[i])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)(i=this._layers[e])[t]&&i[t].apply(i,n);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return s(t)}}),Ci=Pi.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),Pi.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),Pi.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new F;for(var e in this._layers){var i=this._layers[e];t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t}}),Mi=T.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0]},initialize:function(t){p(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n=this._createImg(i,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i=this.options,n=i[e+"Size"];"number"==typeof n&&(n=[n,n]);var a=O(n),o=O("shadow"===e&&i.shadowAnchor||i.iconAnchor||a&&a.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(i.className||""),o&&(t.style.marginLeft=-o.x+"px",t.style.marginTop=-o.y+"px"),a&&(t.style.width=a.x+"px",t.style.height=a.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return Ct&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),Ei=Mi.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return Ei.imagePath||(Ei.imagePath=this._detectIconPath()),(this.options.imagePath||Ei.imagePath)+Mi.prototype._getIconUrl.call(this,t)},_detectIconPath:function(){var t=ae("div","leaflet-default-icon-path",document.body),e=ne(t,"background-image")||ne(t,"backgroundImage");return document.body.removeChild(t),null===e||0!==e.indexOf("url")?"":e.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")}}),Ti=ti.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new ri(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),de(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&ce(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,i=e._map,n=this._marker.options.autoPanSpeed,a=this._marker.options.autoPanPadding,o=ye(e._icon),r=i.getPixelBounds(),s=i.getPixelOrigin(),l=A(r.min._subtract(s).add(a),r.max._subtract(s).subtract(a));if(!l.contains(o)){var h=O((Math.max(l.max.x,o.x)-l.max.x)/(r.max.x-l.max.x)-(Math.min(l.min.x,o.x)-l.min.x)/(r.min.x-l.min.x),(Math.max(l.max.y,o.y)-l.max.y)/(r.max.y-l.max.y)-(Math.min(l.min.y,o.y)-l.min.y)/(r.min.y-l.min.y)).multiplyBy(n);i.panBy(h,{animate:!1}),this._draggable._newPos._add(h),this._draggable._startPos._add(h),ge(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=C(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(M(this._panRequest),this._panRequest=C(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,i=e._shadow,n=ye(e._icon),a=e._map.layerPointToLatLng(n);i&&ge(i,n),e._latlng=a,t.latlng=a,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){M(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Si=Wi.extend({options:{icon:new Ei,interactive:!0,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){p(this,e),this._latlng=Z(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=Z(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=t.icon.createIcon(this._icon),n=!1;i!==this._icon&&(this._icon&&this._removeIcon(),n=!0,t.title&&(i.title=t.title),"IMG"===i.tagName&&(i.alt=t.alt||"")),de(i,e),t.keyboard&&(i.tabIndex="0"),this._icon=i,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var a=t.icon.createShadow(this._shadow),o=!1;a!==this._shadow&&(this._removeShadow(),o=!0),a&&(de(a,e),a.alt=""),this._shadow=a,t.opacity<1&&this._updateOpacity(),n&&this.getPane().appendChild(this._icon),this._initInteraction(),a&&o&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),oe(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&oe(this._shadow),this._shadow=null},_setPos:function(t){ge(this._icon,t),this._shadow&&ge(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(de(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Ti)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Ti(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&pe(this._icon,t),this._shadow&&pe(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}}),Di=Wi.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return p(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t.hasOwnProperty("weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+this._renderer.options.tolerance}}),zi=Di.extend({options:{fill:!0,radius:10},initialize:function(t,e){p(this,e),this._latlng=Z(t),this._radius=this.options.radius},setLatLng:function(t){return this._latlng=Z(t),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return Di.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),n=[t+i,e+i];this._pxBounds=new B(this._point.subtract(n),this._point.add(n))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}}),ji=zi.extend({initialize:function(t,e,n){if("number"==typeof e&&(e=i({},n,{radius:e})),p(this,e),this._latlng=Z(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new F(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:Di.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,i=this._map,n=i.options.crs;if(n.distance===G.distance){var a=Math.PI/180,o=this._mRadius/G.R/a,r=i.project([e+o,t]),s=i.project([e-o,t]),l=r.add(s).divideBy(2),h=i.unproject(l).lat,d=Math.acos((Math.cos(o*a)-Math.sin(e*a)*Math.sin(h*a))/(Math.cos(e*a)*Math.cos(h*a)))/a;!isNaN(d)&&0!==d||(d=o/Math.cos(Math.PI/180*e)),this._point=l.subtract(i.getPixelOrigin()),this._radius=isNaN(d)?0:l.x-i.project([h,t-d]).x,this._radiusY=l.y-r.y}else{var c=n.unproject(n.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(c).x}this._updateBounds()}}),Oi=Di.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){p(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,i,n=1/0,a=null,o=ui,r=0,s=this._parts.length;r<s;r++)for(var l=this._parts[r],h=1,d=l.length;h<d;h++){var c=o(t,e=l[h-1],i=l[h],!0);c<n&&(n=c,a=o(t,e,i))}return a&&(a.distance=Math.sqrt(n)),a},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,a,o,r,s=this._rings[0],l=s.length;if(!l)return null;for(e=t=0;t<l-1;t++)e+=s[t].distanceTo(s[t+1])/2;if(0===e)return this._map.layerPointToLatLng(s[0]);for(n=t=0;t<l-1;t++)if(a=s[t],o=s[t+1],e<(n+=i=a.distanceTo(o)))return r=(n-e)/i,this._map.layerPointToLatLng([o.x-r*(o.x-a.x),o.y-r*(o.y-a.y)])},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=Z(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new F,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return _i(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],i=_i(t),n=0,a=t.length;n<a;n++)i?(e[n]=Z(t[n]),this._bounds.extend(e[n])):e[n]=this._convertLatLngs(t[n]);return e},_project:function(){var t=new B;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new z(t,t);this._pxBounds=new B([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)])},_projectLatlngs:function(t,e,i){var n,a,o=t[0]instanceof N,r=t.length;if(o){for(a=[],n=0;n<r;n++)a[n]=this._map.latLngToLayerPoint(t[n]),i.extend(a[n]);e.push(a)}else for(n=0;n<r;n++)this._projectLatlngs(t[n],e,i)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var e,i,n,a,o,r,s,l=this._parts;for(n=e=0,a=this._rings.length;e<a;e++)for(i=0,o=(s=this._rings[e]).length;i<o-1;i++)(r=hi(s[i],s[i+1],t,i,!0))&&(l[n]=l[n]||[],l[n].push(r[0]),r[1]===s[i+1]&&i!==o-2||(l[n].push(r[1]),n++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,n=t.length;i<n;i++)t[i]=si(t[i],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var i,n,a,o,r,s,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(i=0,o=this._parts.length;i<o;i++)for(n=0,a=(r=(s=this._parts[i]).length)-1;n<r;a=n++)if((e||0!==n)&&li(t,s[a],s[n])<=l)return!0;return!1}});Oi._flat=pi;var Bi=Oi.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,a,o,r,s,l,h=this._rings[0],d=h.length;if(!d)return null;for(o=r=s=0,t=0,e=d-1;t<d;e=t++)i=h[t],n=h[e],a=i.y*n.x-n.y*i.x,r+=(i.x+n.x)*a,s+=(i.y+n.y)*a,o+=3*a;return l=0===o?h[0]:[r/o,s/o],this._map.layerPointToLatLng(l)},_convertLatLngs:function(t){var e=Oi.prototype._convertLatLngs.call(this,t),i=e.length;return 2<=i&&e[0]instanceof N&&e[0].equals(e[i-1])&&e.pop(),e},_setLatLngs:function(t){Oi.prototype._setLatLngs.call(this,t),_i(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return _i(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,i=new z(e,e);if(t=new B(t.min.subtract(i),t.max.add(i)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var n,a=0,o=this._rings.length;a<o;a++)(n=fi(this._rings[a],t,!0)).length&&this._parts.push(n)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,i,n,a,o,r,s,l,h=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(a=0,s=this._parts.length;a<s;a++)for(o=0,r=(l=(e=this._parts[a]).length)-1;o<l;r=o++)i=e[o],n=e[r],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(h=!h);return h||Oi.prototype._containsPoint.call(this,t,!0)}}),Ai=Ci.extend({initialize:function(t,e){p(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,a=y(t)?t:t.features;if(a){for(e=0,i=a.length;e<i;e++)((n=a[e]).geometries||n.geometry||n.features||n.coordinates)&&this.addData(n);return this}var o=this.options;if(o.filter&&!o.filter(t))return this;var r=Fi(t,o);return r?(r.feature=Gi(t),r.defaultOptions=r.options,this.resetStyle(r),o.onEachFeature&&o.onEachFeature(t,r),this.addLayer(r)):this},resetStyle:function(t){return t.options=i({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this},setStyle:function(t){return this.eachLayer((function(e){this._setLayerStyle(e,t)}),this)},_setLayerStyle:function(t,e){t.setStyle&&("function"==typeof e&&(e=e(t.feature)),t.setStyle(e))}});function Fi(t,e){var i,n,a,o,r="Feature"===t.type?t.geometry:t,s=r?r.coordinates:null,l=[],h=e&&e.pointToLayer,d=e&&e.coordsToLatLng||Ii;if(!s&&!r)return null;switch(r.type){case"Point":return i=d(s),h?h(t,i):new Si(i);case"MultiPoint":for(a=0,o=s.length;a<o;a++)i=d(s[a]),l.push(h?h(t,i):new Si(i));return new Ci(l);case"LineString":case"MultiLineString":return n=Ni(s,"LineString"===r.type?0:1,d),new Oi(n,e);case"Polygon":case"MultiPolygon":return n=Ni(s,"Polygon"===r.type?1:2,d),new Bi(n,e);case"GeometryCollection":for(a=0,o=r.geometries.length;a<o;a++){var c=Fi({geometry:r.geometries[a],type:"Feature",properties:t.properties},e);c&&l.push(c)}return new Ci(l);default:throw new Error("Invalid GeoJSON object.")}}function Ii(t){return new N(t[1],t[0],t[2])}function Ni(t,e,i){for(var n,a=[],o=0,r=t.length;o<r;o++)n=e?Ni(t[o],e-1,i):(i||Ii)(t[o]),a.push(n);return a}function Zi(t,e){return e="number"==typeof e?e:6,void 0!==t.alt?[c(t.lng,e),c(t.lat,e),c(t.alt,e)]:[c(t.lng,e),c(t.lat,e)]}function Ri(t,e,i,n){for(var a=[],o=0,r=t.length;o<r;o++)a.push(e?Ri(t[o],e-1,i,n):Zi(t[o],n));return!e&&i&&a.push(a[0]),a}function Ui(t,e){return t.feature?i({},t.feature,{geometry:e}):Gi(e)}function Gi(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}var Vi={toGeoJSON:function(t){return Ui(this,{type:"Point",coordinates:Zi(this.getLatLng(),t)})}};function Hi(t,e){return new Ai(t,e)}Si.include(Vi),ji.include(Vi),zi.include(Vi),Oi.include({toGeoJSON:function(t){var e=!_i(this._latlngs);return Ui(this,{type:(e?"Multi":"")+"LineString",coordinates:Ri(this._latlngs,e?1:0,!1,t)})}}),Bi.include({toGeoJSON:function(t){var e=!_i(this._latlngs),i=e&&!_i(this._latlngs[0]),n=Ri(this._latlngs,i?2:e?1:0,!0,t);return e||(n=[n]),Ui(this,{type:(i?"Multi":"")+"Polygon",coordinates:n})}}),Pi.include({toMultiPoint:function(t){var e=[];return this.eachLayer((function(i){e.push(i.toGeoJSON(t).geometry.coordinates)})),Ui(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var i="GeometryCollection"===e,n=[];return this.eachLayer((function(e){if(e.toGeoJSON){var a=e.toGeoJSON(t);if(i)n.push(a.geometry);else{var o=Gi(a);"FeatureCollection"===o.type?n.push.apply(n,o.features):n.push(o)}}})),i?Ui(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}});var qi=Hi,Qi=Wi.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,i){this._url=t,this._bounds=I(e),p(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(de(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){oe(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&se(this._image),this},bringToBack:function(){return this._map&&le(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=I(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:ae("img");de(e,"leaflet-image-layer"),this._zoomAnimated&&de(e,"leaflet-zoom-animated"),this.options.className&&de(e,this.options.className),e.onselectstart=d,e.onmousemove=d,e.onload=o(this.fire,this,"load"),e.onerror=o(this._overlayOnError,this,"error"),!this.options.crossOrigin&&""!==this.options.crossOrigin||(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;fe(this._image,i,e)},_reset:function(){var t=this._image,e=new B(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=e.getSize();ge(t,e.min),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){pe(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)}}),Xi=Qi.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:ae("video");if(de(e,"leaflet-image-layer"),this._zoomAnimated&&de(e,"leaflet-zoom-animated"),e.onselectstart=d,e.onmousemove=d,e.onloadeddata=o(this.fire,this,"load"),t){for(var i=e.getElementsByTagName("source"),n=[],a=0;a<i.length;a++)n.push(i[a].src);this._url=0<i.length?n:[e.src]}else{y(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&e.style.hasOwnProperty("objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop;for(var r=0;r<this._url.length;r++){var s=ae("source");s.src=this._url[r],e.appendChild(s)}}}}),Ki=Qi.extend({_initImage:function(){var t=this._image=this._url;de(t,"leaflet-image-layer"),this._zoomAnimated&&de(t,"leaflet-zoom-animated"),t.onselectstart=d,t.onmousemove=d}}),Ji=Wi.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(t,e){p(this,t),this._source=e},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&pe(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&pe(this._container,1),this.bringToFront()},onRemove:function(t){t._fadeAnimated?(pe(this._container,0),this._removeTimeout=setTimeout(o(oe,void 0,this._container),200)):oe(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=Z(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&se(this._container),this},bringToBack:function(){return this._map&&le(this._container),this},_prepareOpen:function(t,e,i){if(e instanceof Wi||(i=e,e=t),e instanceof Ci)for(var n in t._layers){e=t._layers[n];break}if(!i)if(e.getCenter)i=e.getCenter();else{if(!e.getLatLng)throw new Error("Unable to get source layer LatLng.");i=e.getLatLng()}return this._source=e,this.update(),i},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=O(this.options.offset),i=this._getAnchor();this._zoomAnimated?ge(this._container,t.add(i)):e=e.add(t).add(i);var n=this._containerBottom=-e.y,a=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=n+"px",this._container.style.left=a+"px"}},_getAnchor:function(){return[0,0]}}),Yi=Ji.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t.openPopup(this),this},onAdd:function(t){Ji.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Di||this._source.on("preclick",De))},onRemove:function(t){Ji.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Di||this._source.off("preclick",De))},getEvents:function(){var t=Ji.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t="leaflet-popup",e=this._container=ae("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=ae("div",t+"-content-wrapper",e);if(this._contentNode=ae("div",t+"-content",i),je(i),ze(this._contentNode),Ce(i,"contextmenu",De),this._tipContainer=ae("div",t+"-tip-container",e),this._tip=ae("div",t+"-tip",this._tipContainer),this.options.closeButton){var n=this._closeButton=ae("a",t+"-close-button",e);n.href="#close",n.innerHTML="&#215;",Ce(n,"click",this._onCloseButtonClick,this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,a=this.options.maxHeight,o="leaflet-popup-scrolled";a&&a<n?(e.height=a+"px",de(t,o)):ce(t,o),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),i=this._getAnchor();ge(this._container,e.add(i))},_adjustPan:function(){if(this.options.autoPan){this._map._panAnim&&this._map._panAnim.stop();var t=this._map,e=parseInt(ne(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+e,n=this._containerWidth,a=new z(this._containerLeft,-i-this._containerBottom);a._add(ye(this._container));var o=t.layerPointToContainerPoint(a),r=O(this.options.autoPanPadding),s=O(this.options.autoPanPaddingTopLeft||r),l=O(this.options.autoPanPaddingBottomRight||r),h=t.getSize(),d=0,c=0;o.x+n+l.x>h.x&&(d=o.x+n-h.x+l.x),o.x-d-s.x<0&&(d=o.x-s.x),o.y+i+l.y>h.y&&(c=o.y+i-h.y+l.y),o.y-c-s.y<0&&(c=o.y-s.y),(d||c)&&t.fire("autopanstart").panBy([d,c])}},_onCloseButtonClick:function(t){this._close(),Be(t)},_getAnchor:function(){return O(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});qe.mergeOptions({closePopupOnClick:!0}),qe.include({openPopup:function(t,e,i){return t instanceof Yi||(t=new Yi(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=t,this.addLayer(t))},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&this.removeLayer(t),this}}),Wi.include({bindPopup:function(t,e){return t instanceof Yi?(p(t,e),(this._popup=t)._source=this):(this._popup&&!e||(this._popup=new Yi(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t,e){return this._popup&&this._map&&(e=this._popup._prepareOpen(this,t,e),this._map.openPopup(this._popup,e)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(t){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(t)),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){var e=t.layer||t.target;this._popup&&this._map&&(Be(t),e instanceof Di?this.openPopup(t.layer||t.target,t.latlng):this._map.hasLayer(this._popup)&&this._popup._source===e?this.closePopup():this.openPopup(e,t.latlng))},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var $i=Ji.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(t){Ji.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(t){Ji.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=Ji.prototype.getEvents.call(this);return xt&&!this.options.permanent&&(t.preclick=this._close),t},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ae("div",t)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e=this._map,i=this._container,n=e.latLngToContainerPoint(e.getCenter()),a=e.layerPointToContainerPoint(t),o=this.options.direction,r=i.offsetWidth,s=i.offsetHeight,l=O(this.options.offset),h=this._getAnchor();t="top"===o?t.add(O(-r/2+l.x,-s+l.y+h.y,!0)):"bottom"===o?t.subtract(O(r/2-l.x,-l.y,!0)):"center"===o?t.subtract(O(r/2+l.x,s/2-h.y+l.y,!0)):"right"===o||"auto"===o&&a.x<n.x?(o="right",t.add(O(l.x+h.x,h.y-s/2+l.y,!0))):(o="left",t.subtract(O(r+h.x-l.x,s/2-h.y-l.y,!0))),ce(i,"leaflet-tooltip-right"),ce(i,"leaflet-tooltip-left"),ce(i,"leaflet-tooltip-top"),ce(i,"leaflet-tooltip-bottom"),de(i,"leaflet-tooltip-"+o),ge(i,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&pe(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return O(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});qe.include({openTooltip:function(t,e,i){return t instanceof $i||(t=new $i(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&&this.removeLayer(t),this}}),Wi.include({bindTooltip:function(t,e){return t instanceof $i?(p(t,e),(this._tooltip=t)._source=this):(this._tooltip&&!e||(this._tooltip=new $i(e,this)),this._tooltip.setContent(t)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),xt&&(i.click=this._openTooltip)),this[e](i),this._tooltipHandlersAdded=!t}},openTooltip:function(t,e){return this._tooltip&&this._map&&(e=this._tooltip._prepareOpen(this,t,e),this._map.openTooltip(this._tooltip,e),this._tooltip.options.interactive&&this._tooltip._container&&(de(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(ce(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var e=t.layer||t.target;this._tooltip&&this._map&&this.openTooltip(e,this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,i,n=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),i=this._map.containerPointToLayerPoint(e),n=this._map.layerPointToLatLng(i)),this._tooltip.setLatLng(n)}});var tn=Mi.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),i=this.options;if(i.html instanceof Element?(re(e),e.appendChild(i.html)):e.innerHTML=!1!==i.html?i.html:"",i.bgPos){var n=O(i.bgPos);e.style.backgroundPosition=-n.x+"px "+-n.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});Mi.Default=Ei;var en=Wi.extend({options:{tileSize:256,opacity:1,updateWhenIdle:vt,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){p(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),oe(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(se(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(le(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=l(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof z?t:new z(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,i=this.getPane().children,n=-t(-1/0,1/0),a=0,o=i.length;a<o;a++)e=i[a].style.zIndex,i[a]!==this._container&&e&&(n=t(n,+e));isFinite(n)&&(this.options.zIndex=n+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!et){pe(this._container,this.options.opacity);var t=+new Date,e=!1,i=!1;for(var n in this._tiles){var a=this._tiles[n];if(a.current&&a.loaded){var o=Math.min(1,(t-a.loaded)/200);pe(a.el,o),o<1?e=!0:(a.active?i=!0:this._onOpaqueTile(a),a.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),e&&(M(this._fadeFrame),this._fadeFrame=C(this._updateOpacity,this))}},_onOpaqueTile:d,_initContainer:function(){this._container||(this._container=ae("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var i in this._levels)this._levels[i].el.children.length||i===t?(this._levels[i].el.style.zIndex=e-Math.abs(t-i),this._onUpdateLevel(i)):(oe(this._levels[i].el),this._removeTilesAtZoom(i),this._onRemoveLevel(i),delete this._levels[i]);var n=this._levels[t],a=this._map;return n||((n=this._levels[t]={}).el=ae("div","leaflet-tile-container leaflet-zoom-animated",this._container),n.el.style.zIndex=e,n.origin=a.project(a.unproject(a.getPixelOrigin()),t).round(),n.zoom=t,this._setZoomTransform(n,a.getCenter(),a.getZoom()),n.el.offsetWidth,this._onCreateLevel(n)),this._level=n}},_onUpdateLevel:d,_onRemoveLevel:d,_onCreateLevel:d,_pruneTiles:function(){if(this._map){var t,e,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var n=e.coords;this._retainParent(n.x,n.y,n.z,n.z-5)||this._retainChildren(n.x,n.y,n.z,n.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)oe(this._levels[t].el),this._onRemoveLevel(t),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,i,n){var a=Math.floor(t/2),o=Math.floor(e/2),r=i-1,s=new z(+a,+o);s.z=+r;var l=this._tileCoordsToKey(s),h=this._tiles[l];return h&&h.active?h.retain=!0:(h&&h.loaded&&(h.retain=!0),n<r&&this._retainParent(a,o,r,n))},_retainChildren:function(t,e,i,n){for(var a=2*t;a<2*t+2;a++)for(var o=2*e;o<2*e+2;o++){var r=new z(a,o);r.z=i+1;var s=this._tileCoordsToKey(r),l=this._tiles[s];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),i+1<n&&this._retainChildren(a,o,i+1,n))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,i,n){var a=this._clampZoom(Math.round(e));(void 0!==this.options.maxZoom&&a>this.options.maxZoom||void 0!==this.options.minZoom&&a<this.options.minZoom)&&(a=void 0);var o=this.options.updateWhenZooming&&a!==this._tileZoom;n&&!o||(this._tileZoom=a,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==a&&this._update(t),i||this._pruneTiles(),this._noPrune=!!i),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,i){var n=this._map.getZoomScale(i,t.zoom),a=t.origin.multiplyBy(n).subtract(this._map._getNewPixelOrigin(e,i)).round();yt?fe(t.el,a,n):ge(t.el,a)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._tileSize=this.getTileSize(),n=this._tileZoom,a=this._map.getPixelWorldBounds(this._tileZoom);a&&(this._globalTileRange=this._pxBoundsToTileRange(a)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],n).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],n).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],n).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],n).y/i.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),n=e.getZoomScale(i,this._tileZoom),a=e.project(t,this._tileZoom).floor(),o=e.getSize().divideBy(2*n);return new B(a.subtract(o),a.add(o))},_update:function(t){var e=this._map;if(e){var i=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var n=this._getTiledPixelBounds(t),a=this._pxBoundsToTileRange(n),o=a.getCenter(),r=[],s=this.options.keepBuffer,l=new B(a.getBottomLeft().subtract([s,-s]),a.getTopRight().add([s,-s]));if(!(isFinite(a.min.x)&&isFinite(a.min.y)&&isFinite(a.max.x)&&isFinite(a.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var h in this._tiles){var d=this._tiles[h].coords;d.z===this._tileZoom&&l.contains(new z(d.x,d.y))||(this._tiles[h].current=!1)}if(1<Math.abs(i-this._tileZoom))this._setView(t,i);else{for(var c=a.min.y;c<=a.max.y;c++)for(var u=a.min.x;u<=a.max.x;u++){var _=new z(u,c);if(_.z=this._tileZoom,this._isValidTile(_)){var p=this._tiles[this._tileCoordsToKey(_)];p?p.current=!0:r.push(_)}}if(r.sort((function(t,e){return t.distanceTo(o)-e.distanceTo(o)})),0!==r.length){this._loading||(this._loading=!0,this.fire("loading"));var m=document.createDocumentFragment();for(u=0;u<r.length;u++)this._addTile(r[u],m);this._level.el.appendChild(m)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalTileRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var n=this._tileCoordsToBounds(t);return I(this.options.bounds).overlaps(n)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,i=this.getTileSize(),n=t.scaleBy(i),a=n.add(i);return[e.unproject(n,t.z),e.unproject(a,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),i=new F(e[0],e[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),i=new z(+e[0],+e[1]);return i.z=+e[2],i},_removeTile:function(t){var e=this._tiles[t];e&&(oe(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){de(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=d,t.onmousemove=d,et&&this.options.opacity<1&&pe(t,this.options.opacity),at&&!ot&&(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,e){var i=this._getTilePos(t),n=this._tileCoordsToKey(t),a=this.createTile(this._wrapCoords(t),o(this._tileReady,this,t));this._initTile(a),this.createTile.length<2&&C(o(this._tileReady,this,t,null,a)),ge(a,i),this._tiles[n]={el:a,coords:t,current:!0},e.appendChild(a),this.fire("tileloadstart",{tile:a,coords:t})},_tileReady:function(t,e,i){e&&this.fire("tileerror",{error:e,tile:i,coords:t});var n=this._tileCoordsToKey(t);(i=this._tiles[n])&&(i.loaded=+new Date,this._map._fadeAnimated?(pe(i.el,0),M(this._fadeFrame),this._fadeFrame=C(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),e||(de(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),et||!this._map._fadeAnimated?C(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new z(this._wrapX?h(t.x,this._wrapX):t.x,this._wrapY?h(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new B(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),nn=en.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(t,e){this._url=t,(e=p(this,e)).detectRetina&&Ct&&0<e.maxZoom&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom++):(e.zoomOffset++,e.maxZoom--),e.minZoom=Math.max(0,e.minZoom)),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),at||this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var i=document.createElement("img");return Ce(i,"load",o(this._tileOnLoad,this,e,i)),Ce(i,"error",o(this._tileOnError,this,e,i)),!this.options.crossOrigin&&""!==this.options.crossOrigin||(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i.alt="",i.setAttribute("role","presentation"),i.src=this.getTileUrl(t),i},getTileUrl:function(t){var e={r:Ct?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var n=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=n),e["-y"]=n}return g(this._url,i(e,this.options))},_tileOnLoad:function(t,e){et?setTimeout(o(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,i){var n=this.options.errorTileUrl;n&&e.getAttribute("src")!==n&&(e.src=n),t(i,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=d,e.onerror=d,e.complete||(e.src=k,oe(e),delete this._tiles[t]))},_removeTile:function(t){var e=this._tiles[t];if(e)return st||e.el.setAttribute("src",k),en.prototype._removeTile.call(this,t)},_tileReady:function(t,e,i){if(this._map&&(!i||i.getAttribute("src")!==k))return en.prototype._tileReady.call(this,t,e,i)}});function an(t,e){return new nn(t,e)}var on=nn.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var n=i({},this.defaultWmsParams);for(var a in e)a in this.options||(n[a]=e[a]);var o=(e=p(this,e)).detectRetina&&Ct?2:1,r=this.getTileSize();n.width=r.x*o,n.height=r.y*o,this.wmsParams=n},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=1.3<=this._wmsVersion?"crs":"srs";this.wmsParams[e]=this._crs.code,nn.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),i=this._crs,n=A(i.project(e[0]),i.project(e[1])),a=n.min,o=n.max,r=(1.3<=this._wmsVersion&&this._crs===bi?[a.y,a.x,o.y,o.x]:[a.x,a.y,o.x,o.y]).join(","),s=nn.prototype.getTileUrl.call(this,t);return s+m(this.wmsParams,s,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+r},setParams:function(t,e){return i(this.wmsParams,t),e||this.redraw(),this}});nn.WMS=on,an.wms=function(t,e){return new on(t,e)};var rn=Wi.extend({options:{padding:.1,tolerance:0},initialize:function(t){p(this,t),s(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&de(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var i=this._map.getZoomScale(e,this._zoom),n=ye(this._container),a=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,e),r=this._map.project(t,e).subtract(o),s=a.multiplyBy(-i).add(n).add(a).subtract(r);yt?fe(this._container,s,i):ge(this._container,s)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new B(i,i.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),sn=rn.extend({getEvents:function(){var t=rn.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){rn.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");Ce(t,"mousemove",l(this._onMouseMove,32,this),this),Ce(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Ce(t,"mouseout",this._handleMouseOut,this),this._ctx=t.getContext("2d")},_destroyContainer:function(){M(this._redrawRequest),delete this._ctx,oe(this._container),Ee(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){rn.prototype._update.call(this);var t=this._bounds,e=this._container,i=t.getSize(),n=Ct?2:1;ge(e,t.min),e.width=n*i.x,e.height=n*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",Ct&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){rn.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t);var e=(this._layers[s(t)]=t)._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,i=e.next,n=e.prev;i?i.prev=n:this._drawLast=n,n?n.next=i:this._drawFirst=i,delete t._order,delete this._layers[s(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,i,n=t.options.dashArray.split(/[, ]+/),a=[];for(i=0;i<n.length;i++){if(e=Number(n[i]),isNaN(e))return;a.push(e)}t.options._dashArray=a}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||C(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new B,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.clearRect(0,0,this._container.width,this._container.height)},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var i=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var n=this._drawFirst;n;n=n.next)t=n.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var i,n,a,o,r=t._parts,s=r.length,l=this._ctx;if(s){for(l.beginPath(),i=0;i<s;i++){for(n=0,a=r[i].length;n<a;n++)o=r[i][n],l[n?"lineTo":"moveTo"](o.x,o.y);e&&l.closePath()}this._fillStroke(l,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,i=this._ctx,n=Math.max(Math.round(t._radius),1),a=(Math.max(Math.round(t._radiusY),1)||n)/n;1!=a&&(i.save(),i.scale(1,a)),i.beginPath(),i.arc(e.x,e.y/a,n,0,2*Math.PI,!1),1!=a&&i.restore(),this._fillStroke(i,t)}},_fillStroke:function(t,e){var i=e.options;i.fill&&(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&&0!==i.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())},_onClick:function(t){for(var e,i,n=this._map.mouseEventToLayerPoint(t),a=this._drawFirst;a;a=a.next)(e=a.layer).options.interactive&&e._containsPoint(n)&&!this._map._draggableMoved(e)&&(i=e);i&&(Re(t),this._fireEvent([i],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(ce(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(t,e){for(var i,n,a=this._drawFirst;a;a=a.next)(i=a.layer).options.interactive&&i._containsPoint(e)&&(n=i);n!==this._hoveredLayer&&(this._handleMouseOut(t),n&&(de(this._container,"leaflet-interactive"),this._fireEvent([n],t,"mouseover"),this._hoveredLayer=n)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t)},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var i=e.next,n=e.prev;i&&((i.prev=n)?n.next=i:i&&(this._drawFirst=i),e.prev=this._drawLast,(this._drawLast.next=e).next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var i=e.next,n=e.prev;n&&((n.next=i)?i.prev=n:n&&(this._drawLast=n),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}});function ln(t){return Mt?new sn(t):null}var hn=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),dn={_initContainer:function(){this._container=ae("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(rn.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=hn("shape");de(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=hn("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[s(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;oe(e),t.removeInteractiveTarget(e),delete this._layers[s(t)]},_updateStyle:function(t){var e=t._stroke,i=t._fill,n=t.options,a=t._container;a.stroked=!!n.stroke,a.filled=!!n.fill,n.stroke?(e||(e=t._stroke=hn("stroke")),a.appendChild(e),e.weight=n.weight+"px",e.color=n.color,e.opacity=n.opacity,n.dashArray?e.dashStyle=y(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=n.lineCap.replace("butt","flat"),e.joinstyle=n.lineJoin):e&&(a.removeChild(e),t._stroke=null),n.fill?(i||(i=t._fill=hn("fill")),a.appendChild(i),i.color=n.fillColor||n.color,i.opacity=n.fillOpacity):i&&(a.removeChild(i),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),i=Math.round(t._radius),n=Math.round(t._radiusY||i);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+i+","+n+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){se(t._container)},_bringToBack:function(t){le(t._container)}},cn=Tt?hn:J,un=rn.extend({getEvents:function(){var t=rn.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_initContainer:function(){this._container=cn("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=cn("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){oe(this._container),Ee(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){rn.prototype._update.call(this);var t=this._bounds,e=t.getSize(),i=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),ge(i,t.min),i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=cn("path");t.options.className&&de(e,t.options.className),t.options.interactive&&de(e,"leaflet-interactive"),this._updateStyle(t),this._layers[s(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){oe(t._path),t.removeInteractiveTarget(t._path),delete this._layers[s(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,i=t.options;e&&(i.stroke?(e.setAttribute("stroke",i.color),e.setAttribute("stroke-opacity",i.opacity),e.setAttribute("stroke-width",i.weight),e.setAttribute("stroke-linecap",i.lineCap),e.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?e.setAttribute("stroke-dasharray",i.dashArray):e.removeAttribute("stroke-dasharray"),i.dashOffset?e.setAttribute("stroke-dashoffset",i.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),i.fill?(e.setAttribute("fill",i.fillColor||i.color),e.setAttribute("fill-opacity",i.fillOpacity),e.setAttribute("fill-rule",i.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,Y(t._parts,e))},_updateCircle:function(t){var e=t._point,i=Math.max(Math.round(t._radius),1),n="a"+i+","+(Math.max(Math.round(t._radiusY),1)||i)+" 0 1,0 ",a=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+n+2*i+",0 "+n+2*-i+",0 ";this._setPath(t,a)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){se(t._path)},_bringToBack:function(t){le(t._path)}});function _n(t){return Et||Tt?new un(t):null}Tt&&un.include(dn),qe.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&ln(t)||_n(t)}});var pn=Bi.extend({initialize:function(t,e){Bi.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=I(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});un.create=cn,un.pointsToPath=Y,Ai.geometryToLayer=Fi,Ai.coordsToLatLng=Ii,Ai.coordsToLatLngs=Ni,Ai.latLngToCoords=Zi,Ai.latLngsToCoords=Ri,Ai.getFeature=Ui,Ai.asFeature=Gi,qe.mergeOptions({boxZoom:!0});var mn=ti.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){Ce(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ee(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){oe(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),Qt(),ke(),this._startPoint=this._map.mouseEventToContainerPoint(t),Ce(document,{contextmenu:Be,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=ae("div","leaflet-zoom-box",this._container),de(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new B(this._point,this._startPoint),i=e.getSize();ge(this._box,e.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(oe(this._box),ce(this._container,"leaflet-crosshair")),Xt(),Le(),Ee(document,{contextmenu:Be,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var e=new F(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}});qe.addInitHook("addHandler","boxZoom",mn),qe.mergeOptions({doubleClickZoom:!0});var fn=ti.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom(),n=e.options.zoomDelta,a=t.originalEvent.shiftKey?i-n:i+n;"center"===e.options.doubleClickZoom?e.setZoom(a):e.setZoomAround(t.containerPoint,a)}});qe.addInitHook("addHandler","doubleClickZoom",fn),qe.mergeOptions({dragging:!0,inertia:!ot,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var gn=ti.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new ri(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}de(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){ce(this._map._container,"leaflet-grab"),ce(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=I(this._map.options.maxBounds);this._offsetLimit=A(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;1<this._positions.length&&50<t-this._times[0];)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,a=(n-e+i)%t+e-i,o=(n+e+i)%t-e-i,r=Math.abs(a+i)<Math.abs(o+i)?a:o;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=r},_onDragEnd:function(t){var e=this._map,i=e.options,n=!i.inertia||this._times.length<2;if(e.fire("dragend",t),n)e.fire("moveend");else{this._prunePositions(+new Date);var a=this._lastPos.subtract(this._positions[0]),o=(this._lastTime-this._times[0])/1e3,r=i.easeLinearity,s=a.multiplyBy(r/o),l=s.distanceTo([0,0]),h=Math.min(i.inertiaMaxSpeed,l),d=s.multiplyBy(h/l),c=h/(i.inertiaDeceleration*r),u=d.multiplyBy(-c/2).round();u.x||u.y?(u=e._limitOffset(u,e.options.maxBounds),C((function(){e.panBy(u,{duration:c,easeLinearity:r,noMoveStart:!0,animate:!0})}))):e.fire("moveend")}}});qe.addInitHook("addHandler","dragging",gn),qe.mergeOptions({keyboard:!0,keyboardPanDelta:80});var yn=ti.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),Ce(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ee(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,i=t.scrollTop||e.scrollTop,n=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(n,i)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,i,n=this._panKeys={},a=this.keyCodes;for(e=0,i=a.left.length;e<i;e++)n[a.left[e]]=[-1*t,0];for(e=0,i=a.right.length;e<i;e++)n[a.right[e]]=[t,0];for(e=0,i=a.down.length;e<i;e++)n[a.down[e]]=[0,t];for(e=0,i=a.up.length;e<i;e++)n[a.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,i,n=this._zoomKeys={},a=this.keyCodes;for(e=0,i=a.zoomIn.length;e<i;e++)n[a.zoomIn[e]]=t;for(e=0,i=a.zoomOut.length;e<i;e++)n[a.zoomOut[e]]=-t},_addHooks:function(){Ce(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ee(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,i=t.keyCode,n=this._map;if(i in this._panKeys)n._panAnim&&n._panAnim._inProgress||(e=this._panKeys[i],t.shiftKey&&(e=O(e).multiplyBy(3)),n.panBy(e),n.options.maxBounds&&n.panInsideBounds(n.options.maxBounds));else if(i in this._zoomKeys)n.setZoom(n.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i||!n._popup||!n._popup.options.closeOnEscapeKey)return;n.closePopup()}Be(t)}}});qe.addInitHook("addHandler","keyboard",yn),qe.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var vn=ti.extend({addHooks:function(){Ce(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ee(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=Ie(t),i=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var n=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),n),Be(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),i=this._map.options.zoomSnap||0;t._stop();var n=this._delta/(4*this._map.options.wheelPxPerZoomLevel),a=4*Math.log(2/(1+Math.exp(-Math.abs(n))))/Math.LN2,o=i?Math.ceil(a/i)*i:a,r=t._limitZoom(e+(0<this._delta?o:-o))-e;this._delta=0,this._startTime=null,r&&("center"===t.options.scrollWheelZoom?t.setZoom(e+r):t.setZoomAround(this._lastMousePos,e+r))}});qe.addInitHook("addHandler","scrollWheelZoom",vn),qe.mergeOptions({tap:!0,tapTolerance:15});var kn=ti.extend({addHooks:function(){Ce(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ee(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(Oe(t),this._fireClick=!0,1<t.touches.length)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var e=t.touches[0],i=e.target;this._startPos=this._newPos=new z(e.clientX,e.clientY),i.tagName&&"a"===i.tagName.toLowerCase()&&de(i,"leaflet-active"),this._holdTimeout=setTimeout(o((function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",e))}),this),1e3),this._simulateEvent("mousedown",e),Ce(document,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),Ee(document,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&t&&t.changedTouches){var e=t.changedTouches[0],i=e.target;i&&i.tagName&&"a"===i.tagName.toLowerCase()&&ce(i,"leaflet-active"),this._simulateEvent("mouseup",e),this._isTapValid()&&this._simulateEvent("click",e)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new z(e.clientX,e.clientY),this._simulateEvent("mousemove",e)},_simulateEvent:function(t,e){var i=document.createEvent("MouseEvents");i._simulated=!0,e.target._simulatedClick=!0,i.initMouseEvent(t,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}});xt&&!bt&&qe.addInitHook("addHandler","tap",kn),qe.mergeOptions({touchZoom:xt&&!ot,bounceAtZoomLimits:!0});var Ln=ti.extend({addHooks:function(){de(this._map._container,"leaflet-touch-zoom"),Ce(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){ce(this._map._container,"leaflet-touch-zoom"),Ee(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(i.add(n)._divideBy(2))),this._startDist=i.distanceTo(n),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),Ce(document,"touchmove",this._onTouchMove,this),Ce(document,"touchend",this._onTouchEnd,this),Oe(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]),a=i.distanceTo(n)/this._startDist;if(this._zoom=e.getScaleZoom(a,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&a<1||this._zoom>e.getMaxZoom()&&1<a)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1==a)return}else{var r=i._add(n)._divideBy(2)._subtract(this._centerPoint);if(1==a&&0===r.x&&0===r.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(r),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),M(this._animRequest);var s=o(e._move,e,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=C(s,this,!0),Oe(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,M(this._animRequest),Ee(document,"touchmove",this._onTouchMove),Ee(document,"touchend",this._onTouchEnd),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});qe.addInitHook("addHandler","touchZoom",Ln),qe.BoxZoom=mn,qe.DoubleClickZoom=fn,qe.Drag=gn,qe.Keyboard=yn,qe.ScrollWheelZoom=vn,qe.Tap=kn,qe.TouchZoom=Ln,Object.freeze=e,t.version="1.5.1+HEAD.2e3e0ff",t.Control=Xe,t.control=Qe,t.Browser=Dt,t.Evented=D,t.Mixin=ii,t.Util=E,t.Class=T,t.Handler=ti,t.extend=i,t.bind=o,t.stamp=s,t.setOptions=p,t.DomEvent=Ve,t.DomUtil=Pe,t.PosAnimation=He,t.Draggable=ri,t.LineUtil=mi,t.PolyUtil=yi,t.Point=z,t.point=O,t.Bounds=B,t.bounds=A,t.Transformation=H,t.transformation=q,t.Projection=Li,t.LatLng=N,t.latLng=Z,t.LatLngBounds=F,t.latLngBounds=I,t.CRS=U,t.GeoJSON=Ai,t.geoJSON=Hi,t.geoJson=qi,t.Layer=Wi,t.LayerGroup=Pi,t.layerGroup=function(t,e){return new Pi(t,e)},t.FeatureGroup=Ci,t.featureGroup=function(t){return new Ci(t)},t.ImageOverlay=Qi,t.imageOverlay=function(t,e,i){return new Qi(t,e,i)},t.VideoOverlay=Xi,t.videoOverlay=function(t,e,i){return new Xi(t,e,i)},t.SVGOverlay=Ki,t.svgOverlay=function(t,e,i){return new Ki(t,e,i)},t.DivOverlay=Ji,t.Popup=Yi,t.popup=function(t,e){return new Yi(t,e)},t.Tooltip=$i,t.tooltip=function(t,e){return new $i(t,e)},t.Icon=Mi,t.icon=function(t){return new Mi(t)},t.DivIcon=tn,t.divIcon=function(t){return new tn(t)},t.Marker=Si,t.marker=function(t,e){return new Si(t,e)},t.TileLayer=nn,t.tileLayer=an,t.GridLayer=en,t.gridLayer=function(t){return new en(t)},t.SVG=un,t.svg=_n,t.Renderer=rn,t.Canvas=sn,t.canvas=ln,t.Path=Di,t.CircleMarker=zi,t.circleMarker=function(t,e){return new zi(t,e)},t.Circle=ji,t.circle=function(t,e,i){return new ji(t,e,i)},t.Polyline=Oi,t.polyline=function(t,e){return new Oi(t,e)},t.Polygon=Bi,t.polygon=function(t,e){return new Bi(t,e)},t.Rectangle=pn,t.rectangle=function(t,e){return new pn(t,e)},t.Map=qe,t.map=function(t,e){return new qe(t,e)};var wn=window.L;t.noConflict=function(){return window.L=wn,this},window.L=t}));var Waymark_L=L.noConflict();
/* @preserve
 * Leaflet Control Geocoder 1.10.0
 * https://github.com/perliedman/leaflet-control-geocoder
 *
 * Copyright (c) 2012 sa3m (https://github.com/sa3m)
 * Copyright (c) 2018 Per Liedman
 * All rights reserved.
 */this.L=this.L||{},this.Waymark_L.Control=this.Waymark_L.Control||{},this.Waymark_L.Control.Geocoder=function(t){"use strict";t=t&&Waymark_L.hasOwnProperty("default")?t.default:t;var e=0,i=/[&<>"'`]/g,n=/[&<>"'`]/,a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};function o(t){return a[t]}function r(t,i,n,a,o){var r="_l_geocoder_"+e++;i[o||"callback"]=r,window[r]=Waymark_L.Util.bind(n,a);var s=document.createElement("script");s.type="text/javascript",s.src=t+h(i),s.id=r,document.getElementsByTagName("head")[0].appendChild(s)}function s(t,e,i){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){var t;if(200!==n.status&&304!==n.status)t="";else if("string"==typeof n.response)try{t=JSON.parse(n.response)}catch(e){t=n.response}else t=n.response;i(t)}},n.open("GET",t+h(e),!0),n.responseType="json",n.setRequestHeader("Accept","application/json"),n.send(null)}function l(t,e){return t.replace(/\{ *([\w_]+) *\}/g,(function(t,a){var r,s=e[a];return void 0===s?s="":"function"==typeof s&&(s=s(e)),null==(r=s)?"":r?(r=""+r,n.test(r)?r.replace(i,o):r):r+""}))}function h(t,e,i){var n=[];for(var a in t){var o=encodeURIComponent(i?a.toUpperCase():a),r=t[a];if(Waymark_L.Util.isArray(r))for(var s=0;s<r.length;s++)n.push(o+"="+encodeURIComponent(r[s]));else n.push(o+"="+encodeURIComponent(r))}return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")}var d=Waymark_L.Class.extend({options:{service_url:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"},initialize:function(t,e){Waymark_L.setOptions(this,e),this._accessToken=t},geocode:function(t,e,i){var n={SingleLine:t,outFields:"Addr_Type",forStorage:!1,maxLocations:10,f:"json"};this._key&&this._key.length&&(n.token=this._key),s(this.options.service_url+"/findAddressCandidates",Waymark_L.extend(n,this.options.geocodingQueryParams),(function(t){var n,a,o,r=[];if(t.candidates&&t.candidates.length)for(var s=0;s<=t.candidates.length-1;s++)n=t.candidates[s],a=Waymark_L.latLng(n.location.y,n.location.x),o=Waymark_L.latLngBounds(Waymark_L.latLng(n.extent.ymax,n.extent.xmax),Waymark_L.latLng(n.extent.ymin,n.extent.xmin)),r[s]={name:n.address,bbox:o,center:a};e.call(i,r)}))},suggest:function(t,e,i){return this.geocode(t,e,i)},reverse:function(t,e,i,n){var a={location:encodeURIComponent(t.lng)+","+encodeURIComponent(t.lat),distance:100,f:"json"};s(this.options.service_url+"/reverseGeocode",a,(function(t){var e,a=[];t&&!t.error&&(e=Waymark_L.latLng(t.location.y,t.location.x),a.push({name:t.address.Match_addr,center:e,bounds:Waymark_L.latLngBounds(e,e)})),i.call(n,a)}))}});var c=Waymark_L.Class.extend({initialize:function(t){this.key=t},geocode:function(t,e,i){r("https://dev.virtualearth.net/REST/v1/Locations",{query:t,key:this.key},(function(t){var n=[];if(t.resourceSets.length>0)for(var a=t.resourceSets[0].resources.length-1;a>=0;a--){var o=t.resourceSets[0].resources[a],r=o.bbox;n[a]={name:o.name,bbox:Waymark_L.latLngBounds([r[0],r[1]],[r[2],r[3]]),center:Waymark_L.latLng(o.point.coordinates)}}e.call(i,n)}),this,"jsonp")},reverse:function(t,e,i,n){r("//dev.virtualearth.net/REST/v1/Locations/"+t.lat+","+t.lng,{key:this.key},(function(t){for(var e=[],a=t.resourceSets[0].resources.length-1;a>=0;a--){var o=t.resourceSets[0].resources[a],r=o.bbox;e[a]={name:o.name,bbox:Waymark_L.latLngBounds([r[0],r[1]],[r[2],r[3]]),center:Waymark_L.latLng(o.point.coordinates)}}i.call(n,e)}),this,"jsonp")}});var u=Waymark_L.Class.extend({options:{serviceUrl:"https://maps.googleapis.com/maps/api/geocode/json",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(t,e){this._key=t,Waymark_L.setOptions(this,e),this.options.serviceUrl=this.options.service_url||this.options.serviceUrl},geocode:function(t,e,i){var n={address:t};this._key&&this._key.length&&(n.key=this._key),n=Waymark_L.Util.extend(n,this.options.geocodingQueryParams),s(this.options.serviceUrl,n,(function(t){var n,a,o,r=[];if(t.results&&t.results.length)for(var s=0;s<=t.results.length-1;s++)n=t.results[s],a=Waymark_L.latLng(n.geometry.location),o=Waymark_L.latLngBounds(Waymark_L.latLng(n.geometry.viewport.northeast),Waymark_L.latLng(n.geometry.viewport.southwest)),r[s]={name:n.formatted_address,bbox:o,center:a,properties:n.address_components};e.call(i,r)}))},reverse:function(t,e,i,n){var a={latlng:encodeURIComponent(t.lat)+","+encodeURIComponent(t.lng)};a=Waymark_L.Util.extend(a,this.options.reverseQueryParams),this._key&&this._key.length&&(a.key=this._key),s(this.options.serviceUrl,a,(function(t){var e,a,o,r=[];if(t.results&&t.results.length)for(var s=0;s<=t.results.length-1;s++)e=t.results[s],a=Waymark_L.latLng(e.geometry.location),o=Waymark_L.latLngBounds(Waymark_L.latLng(e.geometry.viewport.northeast),Waymark_L.latLng(e.geometry.viewport.southwest)),r[s]={name:e.formatted_address,bbox:o,center:a,properties:e.address_components};i.call(n,r)}))}});var _=Waymark_L.Class.extend({options:{geocodeUrl:"https://geocoder.api.here.com/6.2/geocode.json",reverseGeocodeUrl:"https://reverse.geocoder.api.here.com/6.2/reversegeocode.json",app_id:"<insert your app_id here>",app_code:"<insert your app_code here>",geocodingQueryParams:{},reverseQueryParams:{},reverseGeocodeProxRadius:null},initialize:function(t){Waymark_L.setOptions(this,t)},geocode:function(t,e,i){var n={searchtext:t,gen:9,app_id:this.options.app_id,app_code:this.options.app_code,jsonattributes:1};n=Waymark_L.Util.extend(n,this.options.geocodingQueryParams),this.getJSON(this.options.geocodeUrl,n,e,i)},reverse:function(t,e,i,n){var a=this.options.reverseGeocodeProxRadius?this.options.reverseGeocodeProxRadius:null,o=a?","+encodeURIComponent(a):"",r={prox:encodeURIComponent(t.lat)+","+encodeURIComponent(t.lng)+o,mode:"retrieveAddresses",app_id:this.options.app_id,app_code:this.options.app_code,gen:9,jsonattributes:1};r=Waymark_L.Util.extend(r,this.options.reverseQueryParams),this.getJSON(this.options.reverseGeocodeUrl,r,i,n)},getJSON:function(t,e,i,n){s(t,e,(function(t){var e,a,o,r=[];if(t.response.view&&t.response.view.length)for(var s=0;s<=t.response.view[0].result.length-1;s++)e=t.response.view[0].result[s].location,a=Waymark_L.latLng(e.displayPosition.latitude,e.displayPosition.longitude),o=Waymark_L.latLngBounds(Waymark_L.latLng(e.mapView.topLeft.latitude,e.mapView.topLeft.longitude),Waymark_L.latLng(e.mapView.bottomRight.latitude,e.mapView.bottomRight.longitude)),r[s]={name:e.address.label,bbox:o,center:a};i.call(n,r)}))}});var p=Waymark_L.Class.extend({options:{next:void 0,sizeInMeters:1e4},initialize:function(t){Waymark_L.Util.setOptions(this,t)},geocode:function(t,e,i){var n,a;if((n=t.match(/^([NS])\s*(\d{1,3}(?:\.\d*)?)\W*([EW])\s*(\d{1,3}(?:\.\d*)?)$/))?a=Waymark_L.latLng((/N/i.test(n[1])?1:-1)*parseFloat(n[2]),(/E/i.test(n[3])?1:-1)*parseFloat(n[4])):(n=t.match(/^(\d{1,3}(?:\.\d*)?)\s*([NS])\W*(\d{1,3}(?:\.\d*)?)\s*([EW])$/))?a=Waymark_L.latLng((/N/i.test(n[2])?1:-1)*parseFloat(n[1]),(/E/i.test(n[4])?1:-1)*parseFloat(n[3])):(n=t.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?$/))?a=Waymark_L.latLng((/N/i.test(n[1])?1:-1)*(parseFloat(n[2])+parseFloat(n[3]/60)),(/E/i.test(n[4])?1:-1)*(parseFloat(n[5])+parseFloat(n[6]/60))):(n=t.match(/^(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([NS])\W*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([EW])$/))?a=Waymark_L.latLng((/N/i.test(n[3])?1:-1)*(parseFloat(n[1])+parseFloat(n[2]/60)),(/E/i.test(n[6])?1:-1)*(parseFloat(n[4])+parseFloat(n[5]/60))):(n=t.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?$/))?a=Waymark_L.latLng((/N/i.test(n[1])?1:-1)*(parseFloat(n[2])+parseFloat(n[3]/60+parseFloat(n[4]/3600))),(/E/i.test(n[5])?1:-1)*(parseFloat(n[6])+parseFloat(n[7]/60)+parseFloat(n[8]/3600))):(n=t.match(/^(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]\s*([NS])\W*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\s*([EW])$/))?a=Waymark_L.latLng((/N/i.test(n[4])?1:-1)*(parseFloat(n[1])+parseFloat(n[2]/60+parseFloat(n[3]/3600))),(/E/i.test(n[8])?1:-1)*(parseFloat(n[5])+parseFloat(n[6]/60)+parseFloat(n[7]/3600))):(n=t.match(/^\s*([+-]?\d+(?:\.\d*)?)\s*[\s,]\s*([+-]?\d+(?:\.\d*)?)\s*$/))&&(a=Waymark_L.latLng(parseFloat(n[1]),parseFloat(n[2]))),a){var o=[{name:t,center:a,bbox:a.toBounds(this.options.sizeInMeters)}];e.call(i,o)}else this.options.next&&this.options.next.geocode(t,e,i)}});var m=Waymark_L.Class.extend({options:{serviceUrl:"https://api.mapbox.com/geocoding/v5/mapbox.places/",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(t,e){Waymark_L.setOptions(this,e),this.options.geocodingQueryParams.access_token=t,this.options.reverseQueryParams.access_token=t},geocode:function(t,e,i){var n=this.options.geocodingQueryParams;void 0!==n.proximity&&void 0!==n.proximity.lat&&void 0!==n.proximity.lng&&(n.proximity=n.proximity.lng+","+n.proximity.lat),s(this.options.serviceUrl+encodeURIComponent(t)+".json",n,(function(t){var n,a,o,r=[];if(t.features&&t.features.length)for(var s=0;s<=t.features.length-1;s++){n=t.features[s],a=Waymark_L.latLng(n.center.reverse()),o=n.bbox?Waymark_L.latLngBounds(Waymark_L.latLng(n.bbox.slice(0,2).reverse()),Waymark_L.latLng(n.bbox.slice(2,4).reverse())):Waymark_L.latLngBounds(a,a);for(var l={text:n.text,address:n.address},h=0;h<(n.context||[]).length;h++){l[n.context[h].id.split(".")[0]]=n.context[h].text}r[s]={name:n.place_name,bbox:o,center:a,properties:l}}e.call(i,r)}))},suggest:function(t,e,i){return this.geocode(t,e,i)},reverse:function(t,e,i,n){s(this.options.serviceUrl+encodeURIComponent(t.lng)+","+encodeURIComponent(t.lat)+".json",this.options.reverseQueryParams,(function(t){var e,a,o,r=[];if(t.features&&t.features.length)for(var s=0;s<=t.features.length-1;s++)e=t.features[s],a=Waymark_L.latLng(e.center.reverse()),o=e.bbox?Waymark_L.latLngBounds(Waymark_L.latLng(e.bbox.slice(0,2).reverse()),Waymark_L.latLng(e.bbox.slice(2,4).reverse())):Waymark_L.latLngBounds(a,a),r[s]={name:e.place_name,bbox:o,center:a};i.call(n,r)}))}});var f=Waymark_L.Class.extend({options:{serviceUrl:"https://www.mapquestapi.com/geocoding/v1"},initialize:function(t,e){this._key=decodeURIComponent(t),Waymark_L.Util.setOptions(this,e)},_formatName:function(){var t,e=[];for(t=0;t<arguments.length;t++)arguments[t]&&e.push(arguments[t]);return e.join(", ")},geocode:function(t,e,i){s(this.options.serviceUrl+"/address",{key:this._key,location:t,limit:5,outFormat:"json"},Waymark_L.bind((function(t){var n,a,o=[];if(t.results&&t.results[0].locations)for(var r=t.results[0].locations.length-1;r>=0;r--)n=t.results[0].locations[r],a=Waymark_L.latLng(n.latLng),o[r]={name:this._formatName(n.street,n.adminArea4,n.adminArea3,n.adminArea1),bbox:Waymark_L.latLngBounds(a,a),center:a};e.call(i,o)}),this))},reverse:function(t,e,i,n){s(this.options.serviceUrl+"/reverse",{key:this._key,location:t.lat+","+t.lng,outputFormat:"json"},Waymark_L.bind((function(t){var e,a,o=[];if(t.results&&t.results[0].locations)for(var r=t.results[0].locations.length-1;r>=0;r--)e=t.results[0].locations[r],a=Waymark_L.latLng(e.latLng),o[r]={name:this._formatName(e.street,e.adminArea4,e.adminArea3,e.adminArea1),bbox:Waymark_L.latLngBounds(a,a),center:a};i.call(n,o)}),this))}});var g=Waymark_L.Class.extend({options:{userId:"<insert your userId here>",apiKey:"<insert your apiKey here>",serviceUrl:"https://neutrinoapi.com/"},initialize:function(t){Waymark_L.Util.setOptions(this,t)},geocode:function(t,e,i){s(this.options.serviceUrl+"geocode-address",{apiKey:this.options.apiKey,userId:this.options.userId,address:t.split(/\s+/).join(".")},(function(t){var n,a,o=[];t.locations&&(t.geometry=t.locations[0],n=Waymark_L.latLng(t.geometry.latitude,t.geometry.longitude),a=Waymark_L.latLngBounds(n,n),o[0]={name:t.geometry.address,bbox:a,center:n}),e.call(i,o)}))},suggest:function(t,e,i){return this.geocode(t,e,i)},reverse:function(t,e,i,n){s(this.options.serviceUrl+"geocode-reverse",{apiKey:this.options.apiKey,userId:this.options.userId,latitude:t.lat,longitude:t.lng},(function(e){var a,o,r=[];200==e.status.status&&e.found&&(a=Waymark_L.latLng(t.lat,t.lng),o=Waymark_L.latLngBounds(a,a),r[0]={name:e.address,bbox:o,center:a}),i.call(n,r)}))}});var y=Waymark_L.Class.extend({options:{serviceUrl:"https://nominatim.openstreetmap.org/",geocodingQueryParams:{},reverseQueryParams:{},htmlTemplate:function(t){var e=t.address,i=[];return(e.road||e.building)&&i.push("{building} {road} {house_number}"),(e.city||e.town||e.village||e.hamlet)&&i.push('<span class="'+(i.length>0?"leaflet-control-geocoder-address-detail":"")+'">{postcode} {city} {town} {village} {hamlet}</span>'),(e.state||e.country)&&i.push('<span class="'+(i.length>0?"leaflet-control-geocoder-address-context":"")+'">{state} {country}</span>'),l(i.join("<br/>"),e)}},initialize:function(t){Waymark_L.Util.setOptions(this,t)},geocode:function(t,e,i){s(this.options.serviceUrl+"search",Waymark_L.extend({q:t,limit:5,format:"json",addressdetails:1},this.options.geocodingQueryParams),Waymark_L.bind((function(t){for(var n=[],a=t.length-1;a>=0;a--){for(var o=t[a].boundingbox,r=0;r<4;r++)o[r]=parseFloat(o[r]);n[a]={icon:t[a].icon,name:t[a].display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(t[a]):void 0,bbox:Waymark_L.latLngBounds([o[0],o[2]],[o[1],o[3]]),center:Waymark_L.latLng(t[a].lat,t[a].lon),properties:t[a]}}e.call(i,n)}),this))},reverse:function(t,e,i,n){s(this.options.serviceUrl+"reverse",Waymark_L.extend({lat:t.lat,lon:t.lng,zoom:Math.round(Math.log(e/256)/Math.log(2)),addressdetails:1,format:"json"},this.options.reverseQueryParams),Waymark_L.bind((function(t){var e,a=[];t&&t.lat&&t.lon&&(e=Waymark_L.latLng(t.lat,t.lon),a.push({name:t.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(t):void 0,center:e,bounds:Waymark_L.latLngBounds(e,e),properties:t})),i.call(n,a)}),this))}});var v=Waymark_L.Class.extend({options:{OpenLocationCode:void 0,codeLength:void 0},initialize:function(t){Waymark_L.setOptions(this,t)},geocode:function(t,e,i){try{var n=this.options.OpenLocationCode.decode(t),a={name:t,center:Waymark_L.latLng(n.latitudeCenter,n.longitudeCenter),bbox:Waymark_L.latLngBounds(Waymark_L.latLng(n.latitudeLo,n.longitudeLo),Waymark_L.latLng(n.latitudeHi,n.longitudeHi))};e.call(i,[a])}catch(t){console.warn(t),e.call(i,[])}},reverse:function(t,e,i,n){try{var a={name:this.options.OpenLocationCode.encode(t.lat,t.lng,this.options.codeLength),center:Waymark_L.latLng(t.lat,t.lng),bbox:Waymark_L.latLngBounds(Waymark_L.latLng(t.lat,t.lng),Waymark_L.latLng(t.lat,t.lng))};i.call(n,[a])}catch(t){console.warn(t),i.call(n,[])}}});var k=Waymark_L.Class.extend({options:{serviceUrl:"https://api.opencagedata.com/geocode/v1/json"},initialize:function(t){this._accessToken=t},geocode:function(t,e,i){s(this.options.serviceUrl,{key:this._accessToken,q:t},(function(t){var n,a,o,r=[];if(t.results&&t.results.length)for(var s=0;s<t.results.length;s++)o=t.results[s],n=Waymark_L.latLng(o.geometry),a=o.annotations&&o.annotations.bounds?Waymark_L.latLngBounds(Waymark_L.latLng(o.annotations.bounds.northeast),Waymark_L.latLng(o.annotations.bounds.southwest)):Waymark_L.latLngBounds(n,n),r.push({name:o.formatted,bbox:a,center:n});e.call(i,r)}))},suggest:function(t,e,i){return this.geocode(t,e,i)},reverse:function(t,e,i,n){s(this.options.serviceUrl,{key:this._accessToken,q:[t.lat,t.lng].join(",")},(function(t){var e,a,o,r=[];if(t.results&&t.results.length)for(var s=0;s<t.results.length;s++)o=t.results[s],e=Waymark_L.latLng(o.geometry),a=o.annotations&&o.annotations.bounds?Waymark_L.latLngBounds(Waymark_L.latLng(o.annotations.bounds.northeast),Waymark_L.latLng(o.annotations.bounds.southwest)):Waymark_L.latLngBounds(e,e),r.push({name:o.formatted,bbox:a,center:e});i.call(n,r)}))}});var L=Waymark_L.Class.extend({options:{serviceUrl:"https://api.geocode.earth/v1",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(t,e){Waymark_L.Util.setOptions(this,e),this._apiKey=t,this._lastSuggest=0},geocode:function(t,e,i){var n=this;s(this.options.serviceUrl+"/search",Waymark_L.extend({api_key:this._apiKey,text:t},this.options.geocodingQueryParams),(function(t){e.call(i,n._parseResults(t,"bbox"))}))},suggest:function(t,e,i){var n=this;s(this.options.serviceUrl+"/autocomplete",Waymark_L.extend({api_key:this._apiKey,text:t},this.options.geocodingQueryParams),Waymark_L.bind((function(t){t.geocoding.timestamp>this._lastSuggest&&(this._lastSuggest=t.geocoding.timestamp,e.call(i,n._parseResults(t,"bbox")))}),this))},reverse:function(t,e,i,n){var a=this;s(this.options.serviceUrl+"/reverse",Waymark_L.extend({api_key:this._apiKey,"point.lat":t.lat,"point.lon":t.lng},this.options.reverseQueryParams),(function(t){i.call(n,a._parseResults(t,"bounds"))}))},_parseResults:function(t,e){var i=[];return Waymark_L.geoJson(t,{pointToLayer:function(t,e){return Waymark_L.circleMarker(e)},onEachFeature:function(t,n){var a,o,r={};n.getBounds?o=(a=n.getBounds()).getCenter():n.feature.bbox?(o=n.getLatLng(),a=Waymark_L.latLngBounds(Waymark_L.GeoJSON.coordsToLatLng(n.feature.bbox.slice(0,2)),Waymark_L.GeoJSON.coordsToLatLng(n.feature.bbox.slice(2,4)))):(o=n.getLatLng(),a=Waymark_L.latLngBounds(o,o)),r.name=n.feature.properties.label,r.center=o,r[e]=a,r.properties=n.feature.properties,i.push(r)}}),i}});function w(t,e){return new L(t,e)}var b=L,x=w,W=L,P=w,C=W.extend({options:{serviceUrl:"https://api.openrouteservice.org/geocode"}});var M=Waymark_L.Class.extend({options:{serviceUrl:"https://photon.komoot.de/api/",reverseUrl:"https://photon.komoot.de/reverse/",nameProperties:["name","street","suburb","hamlet","town","city","state","country"]},initialize:function(t){Waymark_L.setOptions(this,t)},geocode:function(t,e,i){var n=Waymark_L.extend({q:t},this.options.geocodingQueryParams);s(this.options.serviceUrl,n,Waymark_L.bind((function(t){e.call(i,this._decodeFeatures(t))}),this))},suggest:function(t,e,i){return this.geocode(t,e,i)},reverse:function(t,e,i,n){var a=Waymark_L.extend({lat:t.lat,lon:t.lng},this.options.reverseQueryParams);s(this.options.reverseUrl,a,Waymark_L.bind((function(t){i.call(n,this._decodeFeatures(t))}),this))},_decodeFeatures:function(t){var e,i,n,a,o,r,s=[];if(t&&t.features)for(e=0;e<t.features.length;e++)n=(i=t.features[e]).geometry.coordinates,a=Waymark_L.latLng(n[1],n[0]),r=(o=i.properties.extent)?Waymark_L.latLngBounds([o[1],o[0]],[o[3],o[2]]):Waymark_L.latLngBounds(a,a),s.push({name:this._decodeFeatureName(i),html:this.options.htmlTemplate?this.options.htmlTemplate(i):void 0,center:a,bbox:r,properties:i.properties});return s},_decodeFeatureName:function(t){return(this.options.nameProperties||[]).map((function(e){return t.properties[e]})).filter((function(t){return!!t})).join(", ")}});var E=Waymark_L.Class.extend({options:{serviceUrl:"https://api.what3words.com/v2/"},initialize:function(t){this._accessToken=t},geocode:function(t,e,i){s(this.options.serviceUrl+"forward",{key:this._accessToken,addr:t.split(/\s+/).join(".")},(function(t){var n,a,o=[];t.geometry&&(n=Waymark_L.latLng(t.geometry.lat,t.geometry.lng),a=Waymark_L.latLngBounds(n,n),o[0]={name:t.words,bbox:a,center:n}),e.call(i,o)}))},suggest:function(t,e,i){return this.geocode(t,e,i)},reverse:function(t,e,i,n){s(this.options.serviceUrl+"reverse",{key:this._accessToken,coords:[t.lat,t.lng].join(",")},(function(t){var e,a,o=[];200==t.status.status&&(e=Waymark_L.latLng(t.geometry.lat,t.geometry.lng),a=Waymark_L.latLngBounds(e,e),o[0]={name:t.words,bbox:a,center:e}),i.call(n,o)}))}});var T=Object.freeze({ArcGis:d,arcgis:function(t,e){return new d(t,e)},Bing:c,bing:function(t){return new c(t)},Google:u,google:function(t,e){return new u(t,e)},HERE:_,here:function(t){return new _(t)},LatLng:p,latLng:function(t){return new p(t)},Mapbox:m,mapbox:function(t,e){return new m(t,e)},MapQuest:f,mapQuest:function(t,e){return new f(t,e)},Neutrino:g,neutrino:function(t){return new g(t)},Nominatim:y,nominatim:function(t){return new y(t)},OpenLocationCode:v,openLocationCode:function(t){return new v(t)},OpenCage:k,opencage:function(t){return new k(t)},Pelias:L,pelias:w,GeocodeEarth:b,geocodeEarth:x,Mapzen:W,mapzen:P,Openrouteservice:C,openrouteservice:function(t,e){return new C(t,e)},Photon:M,photon:function(t){return new M(t)},What3Words:E,what3words:function(t){return new E(t)}}),S=Waymark_L.Control.extend({options:{showUniqueResult:!0,showResultIcons:!1,collapsed:!0,expand:"touch",position:"topright",placeholder:"Search...",errorMessage:"Nothing found.",queryMinLength:1,suggestMinLength:3,suggestTimeout:250,defaultMarkGeocode:!0},includes:Waymark_L.Evented.prototype||Waymark_L.Mixin.Events,initialize:function(t){Waymark_L.Util.setOptions(this,t),this.options.geocoder||(this.options.geocoder=new y),this._requestCount=0},addThrobberClass:function(){Waymark_L.DomUtil.addClass(this._container,"leaflet-control-geocoder-throbber")},removeThrobberClass:function(){Waymark_L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-throbber")},onAdd:function(t){var e,i="leaflet-control-geocoder",n=Waymark_L.DomUtil.create("div",i+" leaflet-bar"),a=Waymark_L.DomUtil.create("button",i+"-icon",n),o=this._form=Waymark_L.DomUtil.create("div",i+"-form",n);return this._map=t,this._container=n,a.innerHTML="&nbsp;",a.type="button",(e=this._input=Waymark_L.DomUtil.create("input","",o)).type="text",e.placeholder=this.options.placeholder,Waymark_L.DomEvent.disableClickPropagation(e),this._errorElement=Waymark_L.DomUtil.create("div",i+"-form-no-error",n),this._errorElement.innerHTML=this.options.errorMessage,this._alts=Waymark_L.DomUtil.create("ul",i+"-alternatives leaflet-control-geocoder-alternatives-minimized",n),Waymark_L.DomEvent.disableClickPropagation(this._alts),Waymark_L.DomEvent.addListener(e,"keydown",this._keydown,this),this.options.geocoder.suggest&&Waymark_L.DomEvent.addListener(e,"input",this._change,this),Waymark_L.DomEvent.addListener(e,"blur",(function(){this.options.collapsed&&!this._preventBlurCollapse&&this._collapse(),this._preventBlurCollapse=!1}),this),this.options.collapsed?"click"===this.options.expand?Waymark_L.DomEvent.addListener(n,"click",(function(t){0===t.button&&2!==t.detail&&this._toggle()}),this):Waymark_L.Browser.touch&&"touch"===this.options.expand?Waymark_L.DomEvent.addListener(n,"touchstart mousedown",(function(t){this._toggle(),t.preventDefault(),t.stopPropagation()}),this):(Waymark_L.DomEvent.addListener(n,"mouseover",this._expand,this),Waymark_L.DomEvent.addListener(n,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):(this._expand(),Waymark_L.Browser.touch?Waymark_L.DomEvent.addListener(n,"touchstart",(function(){this._geocode()}),this):Waymark_L.DomEvent.addListener(n,"click",(function(){this._geocode()}),this)),this.options.defaultMarkGeocode&&this.on("markgeocode",this.markGeocode,this),this.on("startgeocode",this.addThrobberClass,this),this.on("finishgeocode",this.removeThrobberClass,this),this.on("startsuggest",this.addThrobberClass,this),this.on("finishsuggest",this.removeThrobberClass,this),Waymark_L.DomEvent.disableClickPropagation(n),n},_geocodeResult:function(t,e){if(!e&&this.options.showUniqueResult&&1===t.length)this._geocodeResultSelected(t[0]);else if(t.length>0){this._alts.innerHTML="",this._results=t,Waymark_L.DomUtil.removeClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),Waymark_L.DomUtil.addClass(this._container,"leaflet-control-geocoder-options-open");for(var i=0;i<t.length;i++)this._alts.appendChild(this._createAlt(t[i],i))}else Waymark_L.DomUtil.addClass(this._container,"leaflet-control-geocoder-options-error"),Waymark_L.DomUtil.addClass(this._errorElement,"leaflet-control-geocoder-error")},markGeocode:function(t){return t=t.geocode||t,this._map.fitBounds(t.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new Waymark_L.Marker(t.center).bindPopup(t.html||t.name).addTo(this._map).openPopup(),this},_geocode:function(t){var e=this._input.value;if(t||!(e.length<this.options.queryMinLength)){var i=++this._requestCount,n=t?"suggest":"geocode",a={input:e};this._lastGeocode=e,t||this._clearResults(),this.fire("start"+n,a),this.options.geocoder[n](e,(function(e){i===this._requestCount&&(a.results=e,this.fire("finish"+n,a),this._geocodeResult(e,t))}),this)}},_geocodeResultSelected:function(t){this.fire("markgeocode",{geocode:t})},_toggle:function(){Waymark_L.DomUtil.hasClass(this._container,"leaflet-control-geocoder-expanded")?this._collapse():this._expand()},_expand:function(){Waymark_L.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded"),this._input.select(),this.fire("expand")},_collapse:function(){Waymark_L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-expanded"),Waymark_L.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),Waymark_L.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),Waymark_L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-open"),Waymark_L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-error"),this._input.blur(),this.fire("collapse")},_clearResults:function(){Waymark_L.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),this._selection=null,Waymark_L.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),Waymark_L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-open"),Waymark_L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-error")},_createAlt:function(t,e){var i=Waymark_L.DomUtil.create("li",""),n=Waymark_L.DomUtil.create("a","",i),a=this.options.showResultIcons&&t.icon?Waymark_L.DomUtil.create("img","",n):null,o=t.html?void 0:document.createTextNode(t.name);return a&&(a.src=t.icon),i.setAttribute("data-result-index",e),t.html?n.innerHTML=n.innerHTML+t.html:n.appendChild(o),Waymark_L.DomEvent.addListener(i,"mousedown touchstart",(function(e){this._preventBlurCollapse=!0,Waymark_L.DomEvent.stop(e),this._geocodeResultSelected(t),Waymark_L.DomEvent.on(i,"click",(function(){this.options.collapsed?this._collapse():this._clearResults()}),this)}),this),i},_keydown:function(t){var e=this,i=function(t){e._selection&&(Waymark_L.DomUtil.removeClass(e._selection,"leaflet-control-geocoder-selected"),e._selection=e._selection[t>0?"nextSibling":"previousSibling"]),e._selection||(e._selection=e._alts[t>0?"firstChild":"lastChild"]),e._selection&&Waymark_L.DomUtil.addClass(e._selection,"leaflet-control-geocoder-selected")};switch(t.keyCode){case 27:this.options.collapsed?this._collapse():this._clearResults();break;case 38:i(-1);break;case 40:i(1);break;case 13:if(this._selection){var n=parseInt(this._selection.getAttribute("data-result-index"),10);this._geocodeResultSelected(this._results[n]),this._clearResults()}else this._geocode();break;default:return}Waymark_L.DomEvent.preventDefault(t)},_change:function(){var t=this._input.value;t!==this._lastGeocode&&(clearTimeout(this._suggestTimeout),t.length>=this.options.suggestMinLength?this._suggestTimeout=setTimeout(Waymark_L.bind((function(){this._geocode(!0)}),this),this.options.suggestTimeout):this._clearResults())}});return Waymark_L.Util.extend(S,T),Waymark_L.Util.extend(Waymark_L.Control,{Geocoder:S,geocoder:function(t){return new S(t)}}),S}(L),function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(void 0!==e&&e.L?module.exports=t(L):module.exports=t(require("leaflet"))),void 0!==e&&e.L&&(e.Waymark_L.Control.Locate=t(L))}((function(t){var e=function(e,i,n){(n=n.split(" ")).forEach((function(n){t.DomUtil[e].call(this,i,n)}))},i=function(t,i){e("addClass",t,i)},n=function(t,i){e("removeClass",t,i)},a=t.Marker.extend({initialize:function(e,i){t.Util.setOptions(this,i),this._latlng=e,this.createIcon()},createIcon:function(){var e=this.options,i="";void 0!==e.color&&(i+="stroke:"+e.color+";"),void 0!==e.weight&&(i+="stroke-width:"+e.weight+";"),void 0!==e.fillColor&&(i+="fill:"+e.fillColor+";"),void 0!==e.fillOpacity&&(i+="fill-opacity:"+e.fillOpacity+";"),void 0!==e.opacity&&(i+="opacity:"+e.opacity+";");var n=this._getIconSVG(e,i);this._locationIcon=t.divIcon({className:n.className,html:n.svg,iconSize:[n.w,n.h]}),this.setIcon(this._locationIcon)},_getIconSVG:function(t,e){var i=t.radius,n=i+t.weight,a=2*n;return{className:"leaflet-control-locate-location",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="'+a+'" height="'+a+'" version="1.1" viewBox="-'+n+" -"+n+" "+a+" "+a+'"><circle r="'+i+'" style="'+e+'" /></svg>',w:a,h:a}},setStyle:function(e){t.Util.setOptions(this,e),this.createIcon()}}),o=a.extend({initialize:function(e,i,n){t.Util.setOptions(this,n),this._latlng=e,this._heading=i,this.createIcon()},setHeading:function(t){this._heading=t},_getIconSVG:function(t,e){var i=t.radius,n=t.width+t.weight,a=2*(i+t.depth+t.weight),o="M0,0 l"+t.width/2+","+t.depth+" l-"+n+",0 z";return{className:"leaflet-control-locate-heading",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="'+n+'" height="'+a+'" version="1.1" viewBox="-'+n/2+" 0 "+n+" "+a+'" style="transform: rotate('+this._heading+'deg)"><path d="'+o+'" style="'+e+'" /></svg>',w:n,h:a}}}),r=t.Control.extend({options:{position:"topleft",layer:void 0,setView:"untilPanOrZoom",keepCurrentZoomLevel:!1,getLocationBounds:function(t){return t.bounds},flyTo:!1,clickBehavior:{inView:"stop",outOfView:"setView",inViewNotFollowing:"inView"},returnToPrevBounds:!1,cacheLocation:!0,drawCircle:!0,drawMarker:!0,showCompass:!0,markerClass:a,compassClass:o,circleStyle:{className:"leaflet-control-locate-circle",color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:0},markerStyle:{className:"leaflet-control-locate-marker",color:"#fff",fillColor:"#2A93EE",fillOpacity:1,weight:3,opacity:1,radius:9},compassStyle:{fillColor:"#2A93EE",fillOpacity:1,weight:0,color:"#fff",opacity:1,radius:9,width:9,depth:6},followCircleStyle:{},followMarkerStyle:{},followCompassStyle:{},icon:"fa fa-map-marker",iconLoading:"fa fa-spinner fa-spin",iconElementTag:"span",circlePadding:[0,0],metric:!0,createButtonCallback:function(e,i){var n=t.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",e);return n.title=i.strings.title,{link:n,icon:t.DomUtil.create(i.iconElementTag,i.icon,n)}},onLocationError:function(t,e){alert(t.message)},onLocationOutsideMapBounds:function(t){t.stop(),alert(t.options.strings.outsideMapBoundsMsg)},showPopup:!0,strings:{title:"Show me where I am",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:1/0,watch:!0,setView:!1}},initialize:function(e){for(var i in e)"object"==typeof this.options[i]?t.extend(this.options[i],e[i]):this.options[i]=e[i];this.options.followMarkerStyle=t.extend({},this.options.markerStyle,this.options.followMarkerStyle),this.options.followCircleStyle=t.extend({},this.options.circleStyle,this.options.followCircleStyle),this.options.followCompassStyle=t.extend({},this.options.compassStyle,this.options.followCompassStyle)},onAdd:function(e){var i=t.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control");this._layer=this.options.layer||new t.LayerGroup,this._layer.addTo(e),this._event=void 0,this._compassHeading=null,this._prevBounds=null;var n=this.options.createButtonCallback(i,this.options);return this._link=n.link,this._icon=n.icon,t.DomEvent.on(this._link,"click",t.DomEvent.stopPropagation).on(this._link,"click",t.DomEvent.preventDefault).on(this._link,"click",this._onClick,this).on(this._link,"dblclick",t.DomEvent.stopPropagation),this._resetVariables(),this._map.on("unload",this._unload,this),i},_onClick:function(){this._justClicked=!0;var t=this._isFollowing();if(this._userPanned=!1,this._userZoomed=!1,this._active&&!this._event)this.stop();else if(this._active&&void 0!==this._event){var e=this.options.clickBehavior,i=e.outOfView;switch(this._map.getBounds().contains(this._event.latlng)&&(i=t?e.inView:e.inViewNotFollowing),e[i]&&(i=e[i]),i){case"setView":this.setView();break;case"stop":this.stop(),this.options.returnToPrevBounds&&(this.options.flyTo?this._map.flyToBounds:this._map.fitBounds).bind(this._map)(this._prevBounds)}}else this.options.returnToPrevBounds&&(this._prevBounds=this._map.getBounds()),this.start();this._updateContainerStyle()},start:function(){this._activate(),this._event&&(this._drawMarker(this._map),this.options.setView&&this.setView()),this._updateContainerStyle()},stop:function(){this._deactivate(),this._cleanClasses(),this._resetVariables(),this._removeMarker()},stopFollowing:function(){this._userPanned=!0,this._updateContainerStyle(),this._drawMarker()},_activate:function(){this._active||(this._map.locate(this.options.locateOptions),this._active=!0,this._map.on("locationfound",this._onLocationFound,this),this._map.on("locationerror",this._onLocationError,this),this._map.on("dragstart",this._onDrag,this),this._map.on("zoomstart",this._onZoom,this),this._map.on("zoomend",this._onZoomEnd,this),this.options.showCompass&&("ondeviceorientationabsolute"in window?t.DomEvent.on(window,"deviceorientationabsolute",this._onDeviceOrientation,this):"ondeviceorientation"in window&&t.DomEvent.on(window,"deviceorientation",this._onDeviceOrientation,this)))},_deactivate:function(){this._map.stopLocate(),this._active=!1,this.options.cacheLocation||(this._event=void 0),this._map.off("locationfound",this._onLocationFound,this),this._map.off("locationerror",this._onLocationError,this),this._map.off("dragstart",this._onDrag,this),this._map.off("zoomstart",this._onZoom,this),this._map.off("zoomend",this._onZoomEnd,this),this.options.showCompass&&(this._compassHeading=null,"ondeviceorientationabsolute"in window?t.DomEvent.off(window,"deviceorientationabsolute",this._onDeviceOrientation,this):"ondeviceorientation"in window&&t.DomEvent.off(window,"deviceorientation",this._onDeviceOrientation,this))},setView:function(){if(this._drawMarker(),this._isOutsideMapBounds())this._event=void 0,this.options.onLocationOutsideMapBounds(this);else if(this.options.keepCurrentZoomLevel)(e=this.options.flyTo?this._map.flyTo:this._map.panTo).bind(this._map)([this._event.latitude,this._event.longitude]);else{var e=this.options.flyTo?this._map.flyToBounds:this._map.fitBounds;this._ignoreEvent=!0,e.bind(this._map)(this.options.getLocationBounds(this._event),{padding:this.options.circlePadding,maxZoom:this.options.locateOptions.maxZoom}),t.Util.requestAnimFrame((function(){this._ignoreEvent=!1}),this)}},_drawCompass:function(){if(this._event){var t=this._event.latlng;if(this.options.showCompass&&t&&null!==this._compassHeading){var e=this._isFollowing()?this.options.followCompassStyle:this.options.compassStyle;this._compass?(this._compass.setLatLng(t),this._compass.setHeading(this._compassHeading),this._compass.setStyle&&this._compass.setStyle(e)):this._compass=new this.options.compassClass(t,this._compassHeading,e).addTo(this._layer)}!this._compass||this.options.showCompass&&null!==this._compassHeading||(this._compass.removeFrom(this._layer),this._compass=null)}},_drawMarker:function(){void 0===this._event.accuracy&&(this._event.accuracy=0);var e,i,n=this._event.accuracy,a=this._event.latlng;if(this.options.drawCircle){var o=this._isFollowing()?this.options.followCircleStyle:this.options.circleStyle;this._circle?this._circle.setLatLng(a).setRadius(n).setStyle(o):this._circle=t.circle(a,n,o).addTo(this._layer)}if(i=this.options.metric?(e=n.toFixed(0),this.options.strings.metersUnit):(e=(3.2808399*n).toFixed(0),this.options.strings.feetUnit),this.options.drawMarker){var r=this._isFollowing()?this.options.followMarkerStyle:this.options.markerStyle;this._marker?(this._marker.setLatLng(a),this._marker.setStyle&&this._marker.setStyle(r)):this._marker=new this.options.markerClass(a,r).addTo(this._layer)}this._drawCompass();var s=this.options.strings.popup;this.options.showPopup&&s&&this._marker&&this._marker.bindPopup(t.Util.template(s,{distance:e,unit:i}))._popup.setLatLng(a),this.options.showPopup&&s&&this._compass&&this._compass.bindPopup(t.Util.template(s,{distance:e,unit:i}))._popup.setLatLng(a)},_removeMarker:function(){this._layer.clearLayers(),this._marker=void 0,this._circle=void 0},_unload:function(){this.stop(),this._map.off("unload",this._unload,this)},_setCompassHeading:function(e){!isNaN(parseFloat(e))&&isFinite(e)?(e=Math.round(e),this._compassHeading=e,t.Util.requestAnimFrame(this._drawCompass,this)):this._compassHeading=null},_onCompassNeedsCalibration:function(){this._setCompassHeading()},_onDeviceOrientation:function(t){this._active&&(t.webkitCompassHeading?this._setCompassHeading(t.webkitCompassHeading):t.absolute&&t.alpha&&this._setCompassHeading(360-t.alpha))},_onLocationError:function(t){3==t.code&&this.options.locateOptions.watch||(this.stop(),this.options.onLocationError(t,this))},_onLocationFound:function(t){if((!this._event||this._event.latlng.lat!==t.latlng.lat||this._event.latlng.lng!==t.latlng.lng||this._event.accuracy!==t.accuracy)&&this._active){switch(this._event=t,this._drawMarker(),this._updateContainerStyle(),this.options.setView){case"once":this._justClicked&&this.setView();break;case"untilPan":this._userPanned||this.setView();break;case"untilPanOrZoom":this._userPanned||this._userZoomed||this.setView();break;case"always":this.setView()}this._justClicked=!1}},_onDrag:function(){this._event&&!this._ignoreEvent&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_onZoom:function(){this._event&&!this._ignoreEvent&&(this._userZoomed=!0,this._updateContainerStyle(),this._drawMarker())},_onZoomEnd:function(){this._event&&this._drawCompass(),this._event&&!this._ignoreEvent&&this._marker&&!this._map.getBounds().pad(-.3).contains(this._marker.getLatLng())&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_isFollowing:function(){return!!this._active&&("always"===this.options.setView||("untilPan"===this.options.setView?!this._userPanned:"untilPanOrZoom"===this.options.setView?!this._userPanned&&!this._userZoomed:void 0))},_isOutsideMapBounds:function(){return void 0!==this._event&&this._map.options.maxBounds&&!this._map.options.maxBounds.contains(this._event.latlng)},_updateContainerStyle:function(){this._container&&(this._active&&!this._event?this._setClasses("requesting"):this._isFollowing()?this._setClasses("following"):this._active?this._setClasses("active"):this._cleanClasses())},_setClasses:function(t){"requesting"==t?(n(this._container,"active following"),i(this._container,"requesting"),n(this._icon,this.options.icon),i(this._icon,this.options.iconLoading)):"active"==t?(n(this._container,"requesting following"),i(this._container,"active"),n(this._icon,this.options.iconLoading),i(this._icon,this.options.icon)):"following"==t&&(n(this._container,"requesting"),i(this._container,"active following"),n(this._icon,this.options.iconLoading),i(this._icon,this.options.icon))},_cleanClasses:function(){t.DomUtil.removeClass(this._container,"requesting"),t.DomUtil.removeClass(this._container,"active"),t.DomUtil.removeClass(this._container,"following"),n(this._icon,this.options.iconLoading),i(this._icon,this.options.icon)},_resetVariables:function(){this._active=!1,this._justClicked=!1,this._userPanned=!1,this._userZoomed=!1}});return t.control.locate=function(e){return new t.Control.Locate(e)},r}),window),function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";!function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(module.exports=t(require("leaflet"))),void 0!==e&&e.L&&t(e.L)}((function(t){return t.locales={},t.locale=null,t.registerLocale=function(e,i){t.locales[e]=t.Util.extend({},t.locales[e],i)},t.setLocale=function(e){t.locale=e},t.i18n=t._=function(e,i){t.locale&&t.locales[t.locale]&&t.locales[t.locale][e]&&(e=t.locales[t.locale][e]);try{e=t.Util.template(e,i)}catch(t){}return e}}),window),L.Control.Elevation=L.Control.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,options:{autohide:!L.Browser.mobile,autohideMarker:!0,collapsed:!1,controlButton:{iconCssClass:"elevation-toggle-icon",title:"Elevation"},detached:!0,distanceFactor:1,dragging:!L.Browser.mobile,downloadLink:"link",elevationDiv:"#elevation-div",followMarker:!0,forceAxisBounds:!1,gpxOptions:{async:!0,marker_options:{startIconUrl:null,endIconUrl:null,shadowUrl:null,wptIcons:{"":L.divIcon({className:"elevation-waypoint-marker",html:'<i class="elevation-waypoint-icon"></i>',iconSize:[30,30],iconAnchor:[8,30]})}}},height:200,heightFactor:1,hoverNumber:{decimalsX:2,decimalsY:0,formatter:void 0},imperial:!1,interpolation:"curveLinear",lazyLoadJS:!0,legend:!0,loadData:{defer:!1,lazy:!1},marker:"elevation-line",markerIcon:L.divIcon({className:"elevation-position-marker",html:'<i class="elevation-position-icon"></i>',iconSize:[32,32],iconAnchor:[16,16]}),placeholder:!1,position:"topright",polyline:{className:"elevation-polyline",color:"#000",opacity:.75,weight:5,lineCap:"round"},reverseCoords:!1,skipNullZCoords:!1,theme:"lightblue-theme",margins:{top:10,right:20,bottom:30,left:50},responsive:!0,summary:"inline",width:600,xLabel:"km",xTicks:void 0,yAxisMax:void 0,yAxisMin:void 0,yLabel:"m",yTicks:void 0,zFollow:13},__mileFactor:.621371,__footFactor:3.28084,addData:function(t,e){L.Control.Elevation._d3LazyLoader=this._lazyLoadJS("https://unpkg.com/d3@5.15.0/dist/d3.min.js","object"!=typeof d3,L.Control.Elevation._d3LazyLoader).then(function(t,e){this._addData(t),this._container&&this._applyData(),null==e&&t.on&&(e=t),e&&(e._path&&L.DomUtil.addClass(e._path,this.options.polyline.className+" "+this.options.theme),e.on("mousemove",this._mousemoveLayerHandler,this).on("mouseout",this._mouseoutHandler,this)),this.track_info=L.extend({},this.track_info,{distance:this._distance,elevation_max:this._maxElevation,elevation_min:this._minElevation}),this._layers=this._layers||{},this._layers[L.Util.stamp(e)]=e,this._fireEvt("eledata_added",{data:t,layer:e,track_info:this.track_info},!0)}.bind(this,t,e))},addTo:function(t){return this.options.detached?this._appendElevationDiv(t._container).appendChild(this.onAdd(t)):L.Control.prototype.addTo.call(this,t),this},clear:function(){this._clearPath(),this._clearChart(),this._clearData(),this._fireEvt("eledata_clear")},disableDragging:function(){this._draggingEnabled=!1,this._resetDrag()},enableDragging:function(){this._draggingEnabled=!0},fitBounds:function(t){t=t||this._fullExtent,this._map&&t&&this._map.fitBounds(t)},getZFollow:function(){return this._zFollow},hide:function(){this._container.style.display="none"},initialize:function(t){this.options=this._deepMerge({},this.options,t),this.options.imperial?(this._distanceFactor=this.__mileFactor,this._heightFactor=this.__footFactor,this._xLabel="mi",this._yLabel="ft"):(this._distanceFactor=this.options.distanceFactor,this._heightFactor=this.options.heightFactor,this._xLabel=this.options.xLabel,this._yLabel=this.options.yLabel),this._chartEnabled=!0,this._draggingEnabled=this.options.dragging,this._zFollow=this.options.zFollow,this.options.followMarker&&(this._setMapView=L.Util.throttle(this._setMapView,300,this)),this.options.placeholder&&(this.options.loadData.lazy=this.options.loadData.defer=!0),this.on("waypoint_added",(function(t){t.point._popup&&(t.point._popup.options.className="elevation-popup",t.point._popup._content=decodeURI(t.point._popup._content)),t.point._popup&&t.point._popup._content&&t.point.bindTooltip(t.point._popup._content,{direction:"top",sticky:!0,opacity:1,className:"elevation-tooltip"}).openTooltip()}))},load:function(t,e){this.loadData(t,e)},loadChart:function(t){this.addTo(t)},loadData:function(t,e){(e=L.extend({},this.options.loadData,e)).defer?this.loadDefer(t,e):e.lazy?this.loadLazy(t,e):this._isXMLDoc(t)?this.loadGPX(t):this._isJSONDoc(t)?this.loadGeoJSON(t):this.loadFile(t)},loadDefer:function(t,e){(e=L.extend({},this.options.loadData,e)).defer=!1,"complete"!==document.readyState?window.addEventListener("load",L.bind(this.loadData,this,t,e),{once:!0}):this.loadData(t,e)},loadFile:function(t){this._downloadURL=t;try{let e=new XMLHttpRequest;e.responseType="text",e.open("GET",t),e.onload=function(){if(200!==e.status)throw"Error "+e.status+" while fetching remote file: "+t;this.loadData(e.response,{lazy:!1,defer:!1})}.bind(this),e.send()}catch(t){console.warn(t)}},loadGeoJSON:function(t){"string"==typeof t&&(t=JSON.parse(t)),this.layer=this.geojson=L.geoJson(t,{style:function(t){let e=L.extend({},this.options.polyline);return this.options.theme&&(e.className+=" "+this.options.theme),e}.bind(this),pointToLayer:function(t,e){let i=L.marker(e,{icon:this.options.gpxOptions.marker_options.wptIcons[""]}),n=t.properties.desc?t.properties.desc:"",a=t.properties.name?t.properties.name:"";return(a||n)&&i.bindPopup("<b>"+a+"</b>"+(n.length>0?"<br>"+n:"")).openPopup(),this.fire("waypoint_added",{point:i,point_type:"waypoint",element:e}),i}.bind(this),onEachFeature:function(e,i){"Point"!=e.geometry.type&&(this.addData(e,i),this.track_info=L.extend({},this.track_info,{type:"geojson",name:t.name}))}.bind(this)}),this._map?(this._map.once("layeradd",(function(e){this.fitBounds(this.layer.getBounds()),this._fireEvt("eledata_loaded",{data:t,layer:this.layer,name:this.track_info.name,track_info:this.track_info},!0)}),this),this.layer.addTo(this._map)):console.warn("Undefined elevation map object")},loadGPX:function(t){L.Control.Elevation._gpxLazyLoader=this._lazyLoadJS("https://unpkg.com/leaflet-gpx@1.5.0/gpx.js","function"!=typeof L.GPX,L.Control.Elevation._gpxLazyLoader).then(function(t){this.options.gpxOptions.polyline_options=L.extend({},this.options.polyline,this.options.gpxOptions.polyline_options),this.options.theme&&(this.options.gpxOptions.polyline_options.className+=" "+this.options.theme),this.layer=this.gpx=new L.GPX(t,this.options.gpxOptions),this.layer.on("loaded",(function(t){this.fitBounds(t.target.getBounds())}),this),this.layer.on("addpoint",(function(t){this.fire("waypoint_added",t,!0)}),this),this.layer.once("addline",(function(e){this.addData(e.line),this.track_info=L.extend({},this.track_info,{type:"gpx",name:this.layer.get_name()}),this._fireEvt("eledata_loaded",{data:t,layer:this.layer,name:this.track_info.name,track_info:this.track_info},!0)}),this),this._map?this.layer.addTo(this._map):console.warn("Undefined elevation map object")}.bind(this,t))},loadLazy:function(t,e){(e=L.extend({},this.options.loadData,e)).lazy=!1;let i=!1,n=L.bind((function(t){i||(L.Util.requestAnimFrame((function(){this._isVisible(this.placeholder)&&(window.removeEventListener("scroll",n),this.loadData(t,e),this.once("eledata_loaded",(function(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder)}),this)),i=!1}),this),i=!0)}),this,t);window.addEventListener("scroll",n),this.placeholder&&this.placeholder.addEventListener("mouseenter",n,{once:!0}),n()},onAdd:function(t){this._map=t;let e=this._container=L.DomUtil.create("div","elevation-control elevation");if(this.options.detached||L.DomUtil.addClass(e,"leaflet-control"),this.options.theme&&L.DomUtil.addClass(e,this.options.theme),this.options.placeholder&&!this._data){if(this.placeholder=L.DomUtil.create("img","elevation-placeholder"),"string"==typeof this.options.placeholder)this.placeholder.src=this.options.placeholder,this.placeholder.alt="";else for(let t in this.options.placeholder)this.placeholder.setAttribute(t,this.options.placeholder[t]);e.insertBefore(this.placeholder,e.firstChild)}return L.Control.Elevation._d3LazyLoader=this._lazyLoadJS("https://unpkg.com/d3@5.15.0/dist/d3.min.js","object"!=typeof d3,L.Control.Elevation._d3LazyLoader).then(function(t,e){this._initToggle(e),this._initChart(e),this._applyData(),this._map.on("zoom viewreset zoomanim",this._hidePositionMarker,this),this._map.on("resize",this._resetView,this),this._map.on("resize",this._resizeChart,this),this._map.on("mousedown",this._resetDrag,this),this._map.on("eledata_added",this._updateSummary,this),L.DomEvent.on(this._map._container,"mousewheel",this._resetDrag,this),L.DomEvent.on(this._map._container,"touchstart",this._resetDrag,this)}.bind(this,t,e)),e},onRemove:function(t){this._container=null},redraw:function(){this._resizeChart()},setZFollow:function(t){this._zFollow=t},show:function(){this._container.style.display="block"},_addData:function(t){let e=t&&t.geometry,i=t&&"FeatureCollection"===t.type,n=t&&t._latlngs;if(e)switch(e.type){case"LineString":this._addGeoJSONData(e.coordinates);break;case"MultiLineString":e.coordinates.forEach(t=>this._addGeoJSONData(t));break;default:console.warn("Unsopperted GeoJSON feature geometry type:"+e.type)}i&&t.features.forEach(t=>this._addData(t)),n&&this._addGPXdata(t._latlngs)},_addGeoJSONData:function(t){t&&t.forEach(t=>this._addPoint(t[1],t[0],t[2]))},_addGPXdata:function(t){t&&t.forEach(t=>this._addPoint(t.lat,t.lng,t.meta.ele))},_addPoint:function(t,e,i){this.options.reverseCoords&&([t,e]=[e,t]);let n=this._data||[],a=this._maxElevation||-1/0,o=this._minElevation||1/0,r=this._distance||0,s=new L.LatLng(t,e),l=n.length?n[n.length-1].latlng:s,h=s.distanceTo(l)*this._distanceFactor;if(r+=Math.round(h/1e3*1e5)/1e5,!this.options.skipNullZCoords&&n.length>0){let t=n[n.length-1].z;if(isNaN(t)){let e=this._lastValidZ,a=i*this._heightFactor;isNaN(e)||isNaN(a)?isNaN(e)?isNaN(a)||(t=a):t=e:t=(e+a)/2,isNaN(t)?n.splice(n.length-1,1):n[n.length-1].z=t}}i*=this._heightFactor,isNaN(i)||(a=a<i?i:a,o=o>i?i:o,this._lastValidZ=i),n.push({dist:r,x:t,y:e,z:i,latlng:s}),this._data=n,this._distance=r,this._maxElevation=a,this._minElevation=o},_appendChart:function(t){let e=t.append("g").attr("transform","translate("+this.options.margins.left+","+this.options.margins.top+")");this._appendGrid(e),this._appendAreaPath(e),this._appendAxis(e),this._appendFocusRect(e),this._appendMouseFocusG(e),this._appendLegend(e)},_appendElevationDiv:function(t){let e=document.querySelector(this.options.elevationDiv);return e||(e=L.DomUtil.create("div","leaflet-control elevation elevation-div"),this.options.elevationDiv="#elevation-div_"+Math.random().toString(36).substr(2,9),e.id=this.options.elevationDiv.substr(1),t.parentNode.insertBefore(e,t.nextSibling)),this.options.detached&&(L.DomUtil.addClass(e,"elevation-detached"),L.DomUtil.removeClass(e,"leaflet-control")),this.eleDiv=e,this.eleDiv},_appendXaxis:function(t){t.append("g").attr("class","x axis").attr("transform","translate(0,"+this._height()+")").call(d3.axisBottom().scale(this._x).ticks(this.options.xTicks)).append("text").attr("x",this._width()+6).attr("y",30).text(this._xLabel)},_appendXGrid:function(t){t.append("g").attr("class","x grid").attr("transform","translate(0,"+this._height()+")").call(d3.axisBottom().scale(this._x).ticks(this.options.xTicks).tickSize(-this._height()).tickFormat(""))},_appendYaxis:function(t){t.append("g").attr("class","y axis").call(d3.axisLeft().scale(this._y).ticks(this.options.yTicks)).append("text").attr("x",-30).attr("y",3).text(this._yLabel)},_appendYGrid:function(t){t.append("g").attr("class","y grid").call(d3.axisLeft().scale(this._y).ticks(this.options.yTicks).tickSize(-this._width()).tickFormat(""))},_appendAreaPath:function(t){this._areapath=t.append("path").attr("class","area")},_appendAxis:function(t){this._axis=t.append("g").attr("class","axis"),this._appendXaxis(this._axis),this._appendYaxis(this._axis)},_appendFocusRect:function(t){let e=this._focusRect=t.append("rect").attr("width",this._width()).attr("height",this._height()).style("fill","none").style("stroke","none").style("pointer-events","all");L.Browser.mobile&&(e.on("touchmove.drag",this._dragHandler.bind(this)).on("touchstart.drag",this._dragStartHandler.bind(this)).on("touchstart.focus",this._mousemoveHandler.bind(this)).on("touchmove.focus",this._mousemoveHandler.bind(this)),L.DomEvent.on(this._container,"touchend",this._dragEndHandler,this)),e.on("mousemove.drag",this._dragHandler.bind(this)).on("mousedown.drag",this._dragStartHandler.bind(this)).on("mouseenter.focus",this._mouseenterHandler.bind(this)).on("mousemove.focus",this._mousemoveHandler.bind(this)).on("mouseout.focus",this._mouseoutHandler.bind(this)),L.DomEvent.on(this._container,"mouseup",this._dragEndHandler,this)},_appendGrid:function(t){this._grid=t.append("g").attr("class","grid"),this._appendXGrid(this._grid),this._appendYGrid(this._grid)},_appendMouseFocusG:function(t){let e=this._focusG=t.append("g").attr("class","mouse-focus-group");this._mousefocus=e.append("svg:line").attr("class","mouse-focus-line").attr("x2","0").attr("y2","0").attr("x1","0").attr("y1","0"),this._focuslabelrect=e.append("rect").attr("class","mouse-focus-label").attr("x",0).attr("y",0).attr("width",0).attr("height",0).attr("rx",3).attr("ry",3),this._focuslabeltext=e.append("svg:text").attr("class","mouse-focus-label-text"),this._focuslabelY=this._focuslabeltext.append("svg:tspan").attr("class","mouse-focus-label-y").attr("dy","-1em"),this._focuslabelX=this._focuslabeltext.append("svg:tspan").attr("class","mouse-focus-label-x").attr("dy","2em")},_appendLegend:function(t){if(!this.options.legend)return;let e=this._legend=t.append("g").attr("class","legend"),i=this._altitudeLegend=this._legend.append("g").attr("class","legend-altitude");i.append("rect").attr("class","area").attr("x",this._width()/2-50).attr("y",this._height()+this.options.margins.bottom-17).attr("width",50).attr("height",5).attr("opacity",.75),i.append("text").text(L._("Altitude")).attr("x",this._width()/2+5).attr("font-size",10).style("text-decoration-thickness","2px").style("font-weight","700").attr("y",this._height()+this.options.margins.bottom-11),e.on("click",function(){if(this._chartEnabled)this._clearChart(),this._clearPath(),this._chartEnabled=!1;else{this._resizeChart();for(let t in this._layers)L.DomUtil.addClass(this._layers[t]._path,this.options.polyline.className+" "+this.options.theme);this._chartEnabled=!0}}.bind(this))},_appendPositionMarker:function(t){let e=this.options.theme,i=t.select("g");this._mouseHeightFocus=i.append("svg:line").attr("class",e+" height-focus line").attr("x2",0).attr("y2",0).attr("x1",0).attr("y1",0),this._pointG=i.append("g"),this._pointG.append("svg:circle").attr("class",e+" height-focus circle-lower").attr("r",6).attr("cx",0).attr("cy",0),this._mouseHeightFocusLabel=i.append("svg:text").attr("class",e+" height-focus-label").style("pointer-events","none")},_applyData:function(){if(!this._data)return;let t=d3.extent(this._data,t=>t.dist),e=d3.extent(this._data,t=>t.z),i=this.options;void 0!==i.yAxisMin&&(i.yAxisMin<e[0]||i.forceAxisBounds)&&(e[0]=i.yAxisMin),void 0!==i.yAxisMax&&(i.yAxisMax>e[1]||i.forceAxisBounds)&&(e[1]=i.yAxisMax),this._x.domain(t),this._y.domain(e),this._areapath.datum(this._data).attr("d",this._area),this._updateAxis(),this._fullExtent=this._calculateFullExtent(this._data)},_calculateFullExtent:function(t){if(!t||t.length<1)throw new Error("no data in parameters");let e=new L.latLngBounds(t[0].latlng,t[0].latlng);return t.forEach(t=>e.extend(t.latlng)),e},_clearChart:function(){this._resetDrag(),this._areapath&&(this._areapath.attr("d","M0 0"),this._x.domain([0,1]),this._y.domain([0,1]),this._updateAxis()),this._altitudeLegend&&this._altitudeLegend.select("text").style("text-decoration-line","line-through")},_clearData:function(){this._data=null,this._distance=null,this._maxElevation=null,this._minElevation=null,this.track_info=null,this._layers=null},_clearPath:function(){this._hidePositionMarker();for(let t in this._layers)L.DomUtil.removeClass(this._layers[t]._path,this.options.polyline.className),L.DomUtil.removeClass(this._layers[t]._path,this.options.theme)},_collapse:function(){this._container&&(L.DomUtil.removeClass(this._container,"elevation-expanded"),L.DomUtil.addClass(this._container,"elevation-collapsed"))},_deepMerge:function(t,...e){if(!e.length)return t;const i=e.shift();if(this._isObject(t)&&this._isObject(i))for(const e in i)this._isObject(i[e])?(t[e]||Object.assign(t,{[e]:{}}),this._deepMerge(t[e],i[e])):Object.assign(t,{[e]:i[e]});return this._deepMerge(t,...e)},_dragHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!0,this._drawDragRectangle()},_dragEndHandler:function(){if(!this._dragStartCoords||!this._dragCurrentCoords||!this._gotDragged)return this._dragStartCoords=null,this._gotDragged=!1,void(this._draggingEnabled&&this._resetDrag());let t=this._findItemForX(this._dragStartCoords[0]),e=this._findItemForX(this._dragCurrentCoords[0]);t!=e&&(this._hidePositionMarker(),this._fitSection(t,e),this._dragStartCoords=null,this._gotDragged=!1,this._fireEvt("elechart_dragged",{data:{dragstart:this._data[t],dragend:this._data[e]}},!0))},_dragStartHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!1,this._dragStartCoords=d3.mouse(this._focusRect.node())},_drawDragRectangle:function(){if(!this._dragStartCoords||!this._draggingEnabled)return;let t=this._dragCurrentCoords=d3.mouse(this._focusRect.node()),e=Math.min(this._dragStartCoords[0],t[0]),i=Math.max(this._dragStartCoords[0],t[0]);if(this._dragRectangle||this._dragRectangleG)this._dragRectangle.attr("width",i-e).attr("x",e);else{let t=d3.select(this._container).select("svg").select("g");this._dragRectangleG=t.insert("g",".mouse-focus-group"),this._dragRectangle=this._dragRectangleG.append("rect").attr("width",i-e).attr("height",this._height()).attr("x",e).attr("class","mouse-drag").style("pointer-events","none")}},_expand:function(){this._container&&(L.DomUtil.removeClass(this._container,"elevation-collapsed"),L.DomUtil.addClass(this._container,"elevation-expanded"))},_findItemForLatLng:function(t){let e=null,i=1/0;return this._data.forEach(n=>{let a=t.distanceTo(n.latlng);a<i&&(i=a,e=n)}),e},_findItemForX:function(t){let e=this._data?this._data:[0,1];return(0,d3.bisector(t=>t.dist).left)(e,this._x.invert(t))},_fireEvt:function(t,e,i){this.fire&&this.fire(t,e,i),this._map&&this._map.fire(t,e,i)},_fitSection:function(t,e){let i=Math.min(t,e),n=Math.max(t,e),a=this._calculateFullExtent(this._data.slice(i,n));this.fitBounds(a)},_formatter:function(t,e,i){let n=L.Util.formatNum(t,e).toString(),a=n.split(".");if(a[1]){for(let t=e-a[1].length;t>0;t--)a[1]+="0";n=a.join(i||".")}return n},_height:function(){let t=this.options;return t.height-t.margins.top-t.margins.bottom},_hidePositionMarker:function(){this.options.autohideMarker&&(this._selectedItem=null,this._marker&&(this._map&&this._map.removeLayer(this._marker),this._marker=null),this._mouseHeightFocus&&(this._mouseHeightFocus.style("visibility","hidden"),this._mouseHeightFocusLabel.style("visibility","hidden")),this._pointG&&this._pointG.style("visibility","hidden"),this._focusG&&this._focusG.style("visibility","hidden"))},_initChart:function(){let t=this.options;if(t.xTicks=t.xTicks||Math.round(this._width()/75),t.yTicks=t.yTicks||Math.round(this._height()/30),t.hoverNumber.formatter=t.hoverNumber.formatter||this._formatter,t.responsive)if(t.detached){let e=this.eleDiv.offsetWidth,i=this.eleDiv.offsetHeight;t.width=e>0?e:t.width,t.height=i-20>0?i-20:t.height}else{t._maxWidth=t._maxWidth>t.width?t._maxWidth:t.width;let e=this._map._container.clientWidth;t.width=t._maxWidth>e?e-30:t.width}let e=this._x=d3.scaleLinear().range([0,this._width()]),i=this._y=d3.scaleLinear().range([this._height(),0]),n="function"==typeof t.interpolation?t.interpolation:d3[t.interpolation],a=(this._area=d3.area().curve(n).x(t=>t.xDiagCoord=e(t.dist)).y0(this._height()).y1(t=>i(t.z)),this._line=d3.line().x(t=>d3.mouse(o.select("g"))[0]).y(t=>this._height()),d3.select(this._container)),o=a.append("svg").attr("class","background").attr("width",t.width).attr("height",t.height);this.summaryDiv=a.append("div").attr("class","elevation-summary "+(this.options.summary?this.options.summary+"-summary":"")).node();this._appendChart(o),this._updateSummary()},_initToggle:function(t){if(t.setAttribute("aria-haspopup",!0),this.options.detached||L.DomEvent.disableClickPropagation(t),L.Browser.mobile&&L.DomEvent.on(t,"click",L.DomEvent.stopPropagation),L.DomEvent.on(t,"mousewheel",this._mousewheelHandler,this),!this.options.detached){let e="elevation-toggle "+this.options.controlButton.iconCssClass+(this.options.autohide?"":" close-button"),i=this._button=L.DomUtil.create("a",e,t);i.href="#",i.title=this.options.controlButton.title,this.options.collapsed&&(this._collapse(),this.options.autohide?L.DomEvent.on(t,"mouseover",this._expand,this).on(t,"mouseout",this._collapse,this):L.DomEvent.on(i,"click",L.DomEvent.stop).on(i,"click",this._toggle,this),L.DomEvent.on(i,"focus",this._toggle,this),this._map.on("click",this._collapse,this))}},_isObject:function(t){return t&&"object"==typeof t&&!Array.isArray(t)},_isJSONDoc:function(t,e){if(e=void 0===e||e,"string"==typeof t&&e)return 0==(t=t.trim()).indexOf("{")||0==t.indexOf("[");try{JSON.parse(t.toString())}catch(i){return!("object"!=typeof t||!e)||(console.warn(i),!1)}return!0},_isXMLDoc:function(t,e){if(e=void 0===e||e,"string"==typeof t&&e)return 0==(t=t.trim()).indexOf("<");{let e=(t?t.ownerDocument||t:0).documentElement;return!!e&&"HTML"!==e.nodeName}},_isDomVisible:function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},_isVisible:function(t){if(!t)return!1;let e=window.getComputedStyle(t);return!!function(t,e){return"hidden"!==e.visibility&&"none"!==e.display}(0,e)&&!!function(t,e){let i=t.getBoundingClientRect(),n=i.left+1,a=i.right-1,o=i.top+1,r=(i.bottom,!0),s=t.style.pointerEvents;return"none"==e["pointer-events"]&&(t.style.pointerEvents="auto"),document.elementFromPoint(n,o)!==t&&(r=!1),document.elementFromPoint(a,o)!==t&&(r=!1),t.style.pointerEvents=s,r}(t,e)},_lazyLoadJS:function(t,e,i){return!1!==e&&this.options.lazyLoadJS?i instanceof Promise?i:new Promise((e,i)=>{let n=document.createElement("script");n.addEventListener("load",e,{once:!0}),n.src=t,document.head.appendChild(n)}):Promise.resolve()},_mouseenterHandler:function(){this._fireEvt("elechart_enter",null,!0)},_mousemoveHandler:function(t,e,i){if(!this._data||0===this._data.length||!this._chartEnabled)return;let n=d3.mouse(this._focusRect.node())[0],a=this._data[this._findItemForX(n)];this._hidePositionMarker(),this._showDiagramIndicator(a,n),this._showPositionMarker(a),this._setMapView(a),this._map&&this._map._container&&L.DomUtil.addClass(this._map._container,"elechart-hover"),this._fireEvt("elechart_change",{data:a},!0),this._fireEvt("elechart_hover",{data:a},!0)},_mousemoveLayerHandler:function(t){if(!this._data||0===this._data.length)return;let e=t.latlng,i=this._findItemForLatLng(e);if(i){let t=i.xDiagCoord;this._hidePositionMarker(),this._showDiagramIndicator(i,t),this._showPositionMarker(i)}},_mouseoutHandler:function(){this.options.detached||this._hidePositionMarker(),this._map&&this._map._container&&L.DomUtil.removeClass(this._map._container,"elechart-hover"),this._fireEvt("elechart_leave",null,!0)},_mousewheelHandler:function(t){if(this._map.gestureHandling&&this._map.gestureHandling._enabled)return;let e=this._selectedItem?this._selectedItem.latlng:this._map.getCenter(),i=t.deltaY>0?this._map.getZoom()-1:this._map.getZoom()+1;this._resetDrag(),this._map.flyTo(e,i)},_resetDrag:function(){this._dragRectangleG&&(this._dragRectangleG.remove(),this._dragRectangleG=null,this._dragRectangle=null,this._hidePositionMarker())},_resetView:function(){this._map&&this._map._isFullscreen||(this._resetDrag(),this._hidePositionMarker(),this.fitBounds(this._fullExtent))},_resizeChart:function(){if(this.options.responsive)if(this.options.detached){let t=this.eleDiv.offsetWidth;if(t<=0)return;this.options.width=t,this.eleDiv.innerHTML="",this.eleDiv.appendChild(this.onAdd(this._map))}else this._map.removeControl(this._container),this.addTo(this._map)},_saveFile:function(t){let e=document,i=e.createElement("a"),n=e.body;i.href=t,i.target="_new",i.download="",i.style.display="none",n.appendChild(i),i.click(),n.removeChild(i)},_showDiagramIndicator:function(t,e){if(!this._chartEnabled)return;let i=this.options;this._focusG.style("visibility","visible"),this._mousefocus.attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",this._height()).classed("hidden",!1);let n=t.z,a=t.dist,o=(t.latlng,i.hoverNumber.formatter(n,i.hoverNumber.decimalsY)),r=i.hoverNumber.formatter(a,i.hoverNumber.decimalsX);this._focuslabeltext.attr("y",this._y(t.z)).style("font-weight","700"),this._focuslabelX.text(r+" "+this._xLabel).attr("x",e+10),this._focuslabelY.text(o+" "+this._yLabel).attr("x",e+10);let s=this._focuslabeltext.node();if(this._isDomVisible(s)){let t=s.getBBox(),i=2;this._focuslabelrect.attr("x",t.x-i).attr("y",t.y-i).attr("width",t.width+2*i).attr("height",t.height+2*i),e>=this._width()/2&&(this._focuslabelrect.attr("x",this._focuslabelrect.attr("x")-this._focuslabelrect.attr("width")-2*i-10),this._focuslabelX.attr("x",this._focuslabelX.attr("x")-this._focuslabelrect.attr("width")-2*i-10),this._focuslabelY.attr("x",this._focuslabelY.attr("x")-this._focuslabelrect.attr("width")-2*i-10))}},_toggle:function(){L.DomUtil.hasClass(this._container,"elevation-expanded")?this._collapse():this._expand()},_setMapView:function(t){if(!this.options.followMarker||!this._map)return;let e=this._map.getZoom();e=e<this._zFollow?this._zFollow:e,this._map.setView(t.latlng,e,{animate:!0,duration:.25})},_showPositionMarker:function(t){this._selectedItem=t,this._map&&!this._map.getPane("elevationPane")&&(this._map.createPane("elevationPane"),this._map.getPane("elevationPane").style.zIndex=625,this._map.getPane("elevationPane").style.pointerEvents="none"),"elevation-line"==this.options.marker?this._updatePositionMarker(t):"position-marker"==this.options.marker&&this._updateLeafletMarker(t)},_updateAxis:function(){this._grid.selectAll("g").remove(),this._axis.selectAll("g").remove(),this._appendXGrid(this._grid),this._appendYGrid(this._grid),this._appendXaxis(this._axis),this._appendYaxis(this._axis)},_updateHeightIndicator:function(t){let e=this.options,i=e.hoverNumber.formatter(t.z,e.hoverNumber.decimalsY),n=(e.hoverNumber.formatter(t.dist,e.hoverNumber.decimalsX),this._height()/this._maxElevation*t.z),a=t.y-n;this._mouseHeightFocus.attr("x1",t.x).attr("x2",t.x).attr("y1",t.y).attr("y2",a).style("visibility","visible"),this._mouseHeightFocusLabel.attr("x",t.x).attr("y",a).text(i+" "+this._yLabel).style("visibility","visible")},_updateLeafletMarker:function(t){let e=t.latlng;this._marker?this._marker.setLatLng(e):(this._marker=new L.Marker(e,{icon:this.options.markerIcon,zIndexOffset:1e6}),this._marker.addTo(this._map,{pane:"elevationPane"}))},_updatePointG:function(t){this._pointG.attr("transform","translate("+t.x+","+t.y+")").style("visibility","visible")},_updatePositionMarker:function(t){let e=this._map.latLngToLayerPoint(t.latlng),i={dist:t.dist,x:e.x,y:e.y,z:t.z};if(!this._mouseHeightFocus){L.svg({pane:"elevationPane"}).addTo(this._map);let t=d3.select(this._map.getContainer()).select(".leaflet-elevation-pane svg");this._appendPositionMarker(t)}this._updatePointG(i),this._updateHeightIndicator(i)},_updateSummary:function(){this.summaryDiv.innerHTML="",this.track_info=this.track_info||{},this.track_info.distance=this._distance||0,this.track_info.elevation_max=this._maxElevation||0,this.track_info.elevation_min=this._minElevation||0,this.options.summary&&(this.summaryDiv.innerHTML+='<span class="totlen"><span class="summarylabel">'+L._("Total Length: ")+'</span><span class="summaryvalue">'+this.track_info.distance.toFixed(2)+" "+this._xLabel+'</span></span><span class="maxele"><span class="summarylabel">'+L._("Max Elevation: ")+'</span><span class="summaryvalue">'+this.track_info.elevation_max.toFixed(2)+" "+this._yLabel+'</span></span><span class="minele"><span class="summarylabel">'+L._("Min Elevation: ")+'</span><span class="summaryvalue">'+this.track_info.elevation_min.toFixed(2)+" "+this._yLabel+"</span></span>"),this.options.downloadLink&&this._downloadURL&&(this.summaryDiv.innerHTML+='<span class="download"><a href="#">'+L._("Download")+"</a></span>",this.summaryDiv.querySelector(".download a").onclick=function(t){t.preventDefault();let e={confirm:this._saveFile.bind(this,this._downloadURL)},i=this.options.downloadLink;"modal"==i?("function"==typeof CustomEvent&&document.dispatchEvent(new CustomEvent("eletrack_download",{detail:e})),this._fireEvt("eletrack_download",e)):"link"!=i&&!0!==i||e.confirm()}.bind(this))},_width:function(){let t=this.options;return t.width-t.margins.left-t.margins.right}}),L.control.elevation=function(t){return new L.Control.Elevation(t)}})),function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(module.exports=t(require("leaflet"))),void 0!==e&&e.L&&t(e.L)}((function(t){Waymark_L.Editable=Waymark_L.Evented.extend({statics:{FORWARD:1,BACKWARD:-1},options:{zIndex:1e3,polygonClass:Waymark_L.Polygon,polylineClass:Waymark_L.Polyline,markerClass:Waymark_L.Marker,rectangleClass:Waymark_L.Rectangle,circleClass:Waymark_L.Circle,drawingCSSClass:"leaflet-editable-drawing",drawingCursor:"crosshair",editLayer:void 0,featuresLayer:void 0,polylineEditorClass:void 0,polygonEditorClass:void 0,markerEditorClass:void 0,rectangleEditorClass:void 0,circleEditorClass:void 0,lineGuideOptions:{},skipMiddleMarkers:!1},initialize:function(t,e){Waymark_L.setOptions(this,e),this._lastZIndex=this.options.zIndex,this.map=t,this.editLayer=this.createEditLayer(),this.featuresLayer=this.createFeaturesLayer(),this.forwardLineGuide=this.createLineGuide(),this.backwardLineGuide=this.createLineGuide()},fireAndForward:function(t,e){(e=e||{}).editTools=this,this.fire(t,e),this.map.fire(t,e)},createLineGuide:function(){var t=Waymark_L.extend({dashArray:"5,10",weight:1,interactive:!1},this.options.lineGuideOptions);return Waymark_L.polyline([],t)},createVertexIcon:function(t){return Waymark_L.Browser.mobile&&Waymark_L.Browser.touch?new Waymark_L.Editable.TouchVertexIcon(t):new Waymark_L.Editable.VertexIcon(t)},createEditLayer:function(){return this.options.editLayer||(new Waymark_L.LayerGroup).addTo(this.map)},createFeaturesLayer:function(){return this.options.featuresLayer||(new Waymark_L.LayerGroup).addTo(this.map)},moveForwardLineGuide:function(t){this.forwardLineGuide._latlngs.length&&(this.forwardLineGuide._latlngs[1]=t,this.forwardLineGuide._bounds.extend(t),this.forwardLineGuide.redraw())},moveBackwardLineGuide:function(t){this.backwardLineGuide._latlngs.length&&(this.backwardLineGuide._latlngs[1]=t,this.backwardLineGuide._bounds.extend(t),this.backwardLineGuide.redraw())},anchorForwardLineGuide:function(t){this.forwardLineGuide._latlngs[0]=t,this.forwardLineGuide._bounds.extend(t),this.forwardLineGuide.redraw()},anchorBackwardLineGuide:function(t){this.backwardLineGuide._latlngs[0]=t,this.backwardLineGuide._bounds.extend(t),this.backwardLineGuide.redraw()},attachForwardLineGuide:function(){this.editLayer.addLayer(this.forwardLineGuide)},attachBackwardLineGuide:function(){this.editLayer.addLayer(this.backwardLineGuide)},detachForwardLineGuide:function(){this.forwardLineGuide.setLatLngs([]),this.editLayer.removeLayer(this.forwardLineGuide)},detachBackwardLineGuide:function(){this.backwardLineGuide.setLatLngs([]),this.editLayer.removeLayer(this.backwardLineGuide)},blockEvents:function(){this._oldTargets||(this._oldTargets=this.map._targets,this.map._targets={})},unblockEvents:function(){this._oldTargets&&(this.map._targets=Waymark_L.extend(this.map._targets,this._oldTargets),delete this._oldTargets)},registerForDrawing:function(t){this._drawingEditor&&this.unregisterForDrawing(this._drawingEditor),this.blockEvents(),t.reset(),this._drawingEditor=t,this.map.on("mousemove touchmove",t.onDrawingMouseMove,t),this.map.on("mousedown",this.onMousedown,this),this.map.on("mouseup",this.onMouseup,this),Waymark_L.DomUtil.addClass(this.map._container,this.options.drawingCSSClass),this.defaultMapCursor=this.map._container.style.cursor,this.map._container.style.cursor=this.options.drawingCursor},unregisterForDrawing:function(t){this.unblockEvents(),Waymark_L.DomUtil.removeClass(this.map._container,this.options.drawingCSSClass),this.map._container.style.cursor=this.defaultMapCursor,(t=t||this._drawingEditor)&&(this.map.off("mousemove touchmove",t.onDrawingMouseMove,t),this.map.off("mousedown",this.onMousedown,this),this.map.off("mouseup",this.onMouseup,this),t===this._drawingEditor&&(delete this._drawingEditor,t._drawing&&t.cancelDrawing()))},onMousedown:function(t){1==t.originalEvent.which&&(this._mouseDown=t,this._drawingEditor.onDrawingMouseDown(t))},onMouseup:function(t){if(this._mouseDown){var e=this._drawingEditor,i=this._mouseDown;if(this._mouseDown=null,e.onDrawingMouseUp(t),this._drawingEditor!==e)return;var n=Waymark_L.point(i.originalEvent.clientX,i.originalEvent.clientY),a=Waymark_L.point(t.originalEvent.clientX,t.originalEvent.clientY).distanceTo(n);Math.abs(a)<9*(window.devicePixelRatio||1)&&this._drawingEditor.onDrawingClick(t)}},drawing:function(){return this._drawingEditor&&this._drawingEditor.drawing()},stopDrawing:function(){this.unregisterForDrawing()},commitDrawing:function(t){this._drawingEditor&&this._drawingEditor.commitDrawing(t)},connectCreatedToMap:function(t){return this.featuresLayer.addLayer(t)},startPolyline:function(t,e){var i=this.createPolyline([],e);return i.enableEdit(this.map).newShape(t),i},startPolygon:function(t,e){var i=this.createPolygon([],e);return i.enableEdit(this.map).newShape(t),i},startMarker:function(t,e){t=t||this.map.getCenter().clone();var i=this.createMarker(t,e);return i.enableEdit(this.map).startDrawing(),i},startRectangle:function(t,e){var i=t||Waymark_L.latLng([0,0]),n=new Waymark_L.LatLngBounds(i,i),a=this.createRectangle(n,e);return a.enableEdit(this.map).startDrawing(),a},startCircle:function(t,e){t=t||this.map.getCenter().clone();var i=this.createCircle(t,e);return i.enableEdit(this.map).startDrawing(),i},startHole:function(t,e){t.newHole(e)},createLayer:function(t,e,i){var n=new t(e,i=Waymark_L.Util.extend({editOptions:{editTools:this}},i));return this.fireAndForward("editable:created",{layer:n}),n},createPolyline:function(t,e){return this.createLayer(e&&e.polylineClass||this.options.polylineClass,t,e)},createPolygon:function(t,e){return this.createLayer(e&&e.polygonClass||this.options.polygonClass,t,e)},createMarker:function(t,e){return this.createLayer(e&&e.markerClass||this.options.markerClass,t,e)},createRectangle:function(t,e){return this.createLayer(e&&e.rectangleClass||this.options.rectangleClass,t,e)},createCircle:function(t,e){return this.createLayer(e&&e.circleClass||this.options.circleClass,t,e)}}),Waymark_L.extend(Waymark_L.Editable,{makeCancellable:function(t){t.cancel=function(){t._cancelled=!0}}}),Waymark_L.Map.mergeOptions({editToolsClass:Waymark_L.Editable,editable:!1,editOptions:{}}),Waymark_L.Map.addInitHook((function(){this.whenReady((function(){this.options.editable&&(this.editTools=new this.options.editToolsClass(this,this.options.editOptions))}))})),Waymark_L.Editable.VertexIcon=Waymark_L.DivIcon.extend({options:{iconSize:new Waymark_L.Point(8,8)}}),Waymark_L.Editable.TouchVertexIcon=Waymark_L.Editable.VertexIcon.extend({options:{iconSize:new Waymark_L.Point(20,20)}}),Waymark_L.Editable.VertexMarker=Waymark_L.Marker.extend({options:{draggable:!0,className:"leaflet-div-icon leaflet-vertex-icon"},initialize:function(t,e,i,n){this.latlng=t,this.latlngs=e,this.editor=i,Waymark_L.Marker.prototype.initialize.call(this,t,n),this.options.icon=this.editor.tools.createVertexIcon({className:this.options.className}),this.latlng.__vertex=this,this.editor.editLayer.addLayer(this),this.setZIndexOffset(i.tools._lastZIndex+1)},onAdd:function(t){Waymark_L.Marker.prototype.onAdd.call(this,t),this.on("drag",this.onDrag),this.on("dragstart",this.onDragStart),this.on("dragend",this.onDragEnd),this.on("mouseup",this.onMouseup),this.on("click",this.onClick),this.on("contextmenu",this.onContextMenu),this.on("mousedown touchstart",this.onMouseDown),this.on("mouseover",this.onMouseOver),this.on("mouseout",this.onMouseOut),this.addMiddleMarkers()},onRemove:function(t){this.middleMarker&&this.middleMarker.delete(),delete this.latlng.__vertex,this.off("drag",this.onDrag),this.off("dragstart",this.onDragStart),this.off("dragend",this.onDragEnd),this.off("mouseup",this.onMouseup),this.off("click",this.onClick),this.off("contextmenu",this.onContextMenu),this.off("mousedown touchstart",this.onMouseDown),this.off("mouseover",this.onMouseOver),this.off("mouseout",this.onMouseOut),Waymark_L.Marker.prototype.onRemove.call(this,t)},onDrag:function(t){t.vertex=this,this.editor.onVertexMarkerDrag(t);var e=Waymark_L.DomUtil.getPosition(this._icon),i=this._map.layerPointToLatLng(e);this.latlng.update(i),this._latlng=this.latlng,this.editor.refresh(),this.middleMarker&&this.middleMarker.updateLatLng();var n=this.getNext();n&&n.middleMarker&&n.middleMarker.updateLatLng()},onDragStart:function(t){t.vertex=this,this.editor.onVertexMarkerDragStart(t)},onDragEnd:function(t){t.vertex=this,this.editor.onVertexMarkerDragEnd(t)},onClick:function(t){t.vertex=this,this.editor.onVertexMarkerClick(t)},onMouseup:function(t){Waymark_L.DomEvent.stop(t),t.vertex=this,this.editor.map.fire("mouseup",t)},onContextMenu:function(t){t.vertex=this,this.editor.onVertexMarkerContextMenu(t)},onMouseDown:function(t){t.vertex=this,this.editor.onVertexMarkerMouseDown(t)},onMouseOver:function(t){t.vertex=this,this.editor.onVertexMarkerMouseOver(t)},onMouseOut:function(t){t.vertex=this,this.editor.onVertexMarkerMouseOut(t)},delete:function(){var t=this.getNext();this.latlngs.splice(this.getIndex(),1),this.editor.editLayer.removeLayer(this),this.editor.onVertexDeleted({latlng:this.latlng,vertex:this}),this.latlngs.length||this.editor.deleteShape(this.latlngs),t&&t.resetMiddleMarker(),this.editor.refresh()},getIndex:function(){return this.latlngs.indexOf(this.latlng)},getLastIndex:function(){return this.latlngs.length-1},getPrevious:function(){if(!(this.latlngs.length<2)){var t=this.getIndex(),e=t-1;0===t&&this.editor.CLOSED&&(e=this.getLastIndex());var i=this.latlngs[e];return i?i.__vertex:void 0}},getNext:function(){if(!(this.latlngs.length<2)){var t=this.getIndex(),e=t+1;t===this.getLastIndex()&&this.editor.CLOSED&&(e=0);var i=this.latlngs[e];return i?i.__vertex:void 0}},addMiddleMarker:function(t){this.editor.hasMiddleMarkers()&&(t=t||this.getPrevious())&&!this.middleMarker&&(this.middleMarker=this.editor.addMiddleMarker(t,this,this.latlngs,this.editor))},addMiddleMarkers:function(){if(this.editor.hasMiddleMarkers()){var t=this.getPrevious();t&&this.addMiddleMarker(t);var e=this.getNext();e&&e.resetMiddleMarker()}},resetMiddleMarker:function(){this.middleMarker&&this.middleMarker.delete(),this.addMiddleMarker()},split:function(){this.editor.splitShape&&this.editor.splitShape(this.latlngs,this.getIndex())},continue:function(){if(this.editor.continueBackward){var t=this.getIndex();0===t?this.editor.continueBackward(this.latlngs):t===this.getLastIndex()&&this.editor.continueForward(this.latlngs)}}}),Waymark_L.Editable.mergeOptions({vertexMarkerClass:Waymark_L.Editable.VertexMarker}),Waymark_L.Editable.MiddleMarker=Waymark_L.Marker.extend({options:{opacity:.5,className:"leaflet-div-icon leaflet-middle-icon",draggable:!0},initialize:function(t,e,i,n,a){this.left=t,this.right=e,this.editor=n,this.latlngs=i,Waymark_L.Marker.prototype.initialize.call(this,this.computeLatLng(),a),this._opacity=this.options.opacity,this.options.icon=this.editor.tools.createVertexIcon({className:this.options.className}),this.editor.editLayer.addLayer(this),this.setVisibility()},setVisibility:function(){var t=this._map.latLngToContainerPoint(this.left.latlng),e=this._map.latLngToContainerPoint(this.right.latlng),i=Waymark_L.point(this.options.icon.options.iconSize);t.distanceTo(e)<3*i.x?this.hide():this.show()},show:function(){this.setOpacity(this._opacity)},hide:function(){this.setOpacity(0)},updateLatLng:function(){this.setLatLng(this.computeLatLng()),this.setVisibility()},computeLatLng:function(){var t=this.editor.map.latLngToContainerPoint(this.left.latlng),e=this.editor.map.latLngToContainerPoint(this.right.latlng),i=(t.y+e.y)/2,n=(t.x+e.x)/2;return this.editor.map.containerPointToLatLng([n,i])},onAdd:function(t){Waymark_L.Marker.prototype.onAdd.call(this,t),Waymark_L.DomEvent.on(this._icon,"mousedown touchstart",this.onMouseDown,this),t.on("zoomend",this.setVisibility,this)},onRemove:function(t){delete this.right.middleMarker,Waymark_L.DomEvent.off(this._icon,"mousedown touchstart",this.onMouseDown,this),t.off("zoomend",this.setVisibility,this),Waymark_L.Marker.prototype.onRemove.call(this,t)},onMouseDown:function(t){var e=Waymark_L.DomUtil.getPosition(this._icon);if(t={originalEvent:t,latlng:this.editor.map.layerPointToLatLng(e)},0!==this.options.opacity&&(Waymark_L.Editable.makeCancellable(t),this.editor.onMiddleMarkerMouseDown(t),!t._cancelled)){this.latlngs.splice(this.index(),0,t.latlng),this.editor.refresh();var i=this._icon,n=this.editor.addVertexMarker(t.latlng,this.latlngs);this.editor.onNewVertex(n);var a=n._icon.parentNode;a.removeChild(n._icon),n._icon=i,a.appendChild(n._icon),n._initIcon(),n._initInteraction(),n.setOpacity(1),Waymark_L.Draggable._dragging=!1,n.dragging._draggable._onDown(t.originalEvent),this.delete()}},delete:function(){this.editor.editLayer.removeLayer(this)},index:function(){return this.latlngs.indexOf(this.right.latlng)}}),Waymark_L.Editable.mergeOptions({middleMarkerClass:Waymark_L.Editable.MiddleMarker}),Waymark_L.Editable.BaseEditor=Waymark_L.Handler.extend({initialize:function(t,e,i){Waymark_L.setOptions(this,i),this.map=t,this.feature=e,this.feature.editor=this,this.editLayer=new Waymark_L.LayerGroup,this.tools=this.options.editTools||t.editTools},addHooks:function(){this.isConnected()?this.onFeatureAdd():this.feature.once("add",this.onFeatureAdd,this),this.onEnable(),this.feature.on(this._getEvents(),this)},removeHooks:function(){this.feature.off(this._getEvents(),this),this.feature.dragging&&this.feature.dragging.disable(),this.editLayer.clearLayers(),this.tools.editLayer.removeLayer(this.editLayer),this.onDisable(),this._drawing&&this.cancelDrawing()},drawing:function(){return!!this._drawing},reset:function(){},onFeatureAdd:function(){this.tools.editLayer.addLayer(this.editLayer),this.feature.dragging&&this.feature.dragging.enable()},hasMiddleMarkers:function(){return!this.options.skipMiddleMarkers&&!this.tools.options.skipMiddleMarkers},fireAndForward:function(t,e){(e=e||{}).layer=this.feature,this.feature.fire(t,e),this.tools.fireAndForward(t,e)},onEnable:function(){this.fireAndForward("editable:enable")},onDisable:function(){this.fireAndForward("editable:disable")},onEditing:function(){this.fireAndForward("editable:editing")},onStartDrawing:function(){this.fireAndForward("editable:drawing:start")},onEndDrawing:function(){this.fireAndForward("editable:drawing:end")},onCancelDrawing:function(){this.fireAndForward("editable:drawing:cancel")},onCommitDrawing:function(t){this.fireAndForward("editable:drawing:commit",t)},onDrawingMouseDown:function(t){this.fireAndForward("editable:drawing:mousedown",t)},onDrawingMouseUp:function(t){this.fireAndForward("editable:drawing:mouseup",t)},startDrawing:function(){this._drawing||(this._drawing=Waymark_L.Editable.FORWARD),this.tools.registerForDrawing(this),this.onStartDrawing()},commitDrawing:function(t){this.onCommitDrawing(t),this.endDrawing()},cancelDrawing:function(){Waymark_L.Draggable._dragging=!1,this.onCancelDrawing(),this.endDrawing()},endDrawing:function(){this._drawing=!1,this.tools.unregisterForDrawing(this),this.onEndDrawing()},onDrawingClick:function(t){this.drawing()&&(Waymark_L.Editable.makeCancellable(t),this.fireAndForward("editable:drawing:click",t),t._cancelled||(this.isConnected()||this.connect(t),this.processDrawingClick(t)))},isConnected:function(){return this.map.hasLayer(this.feature)},connect:function(){this.tools.connectCreatedToMap(this.feature),this.tools.editLayer.addLayer(this.editLayer)},onMove:function(t){this.fireAndForward("editable:drawing:move",t)},onDrawingMouseMove:function(t){this.onMove(t)},_getEvents:function(){return{dragstart:this.onDragStart,drag:this.onDrag,dragend:this.onDragEnd,remove:this.disable}},onDragStart:function(t){this.onEditing(),this.fireAndForward("editable:dragstart",t)},onDrag:function(t){this.onMove(t),this.fireAndForward("editable:drag",t)},onDragEnd:function(t){this.fireAndForward("editable:dragend",t)}}),Waymark_L.Editable.MarkerEditor=Waymark_L.Editable.BaseEditor.extend({onDrawingMouseMove:function(t){Waymark_L.Editable.BaseEditor.prototype.onDrawingMouseMove.call(this,t),this._drawing&&this.feature.setLatLng(t.latlng)},processDrawingClick:function(t){this.fireAndForward("editable:drawing:clicked",t),this.commitDrawing(t)},connect:function(t){t&&(this.feature._latlng=t.latlng),Waymark_L.Editable.BaseEditor.prototype.connect.call(this,t)}}),Waymark_L.Editable.PathEditor=Waymark_L.Editable.BaseEditor.extend({CLOSED:!1,MIN_VERTEX:2,addHooks:function(){return Waymark_L.Editable.BaseEditor.prototype.addHooks.call(this),this.feature&&this.initVertexMarkers(),this},initVertexMarkers:function(t){if(this.enabled())if(t=t||this.getLatLngs(),l(t))this.addVertexMarkers(t);else for(var e=0;e<t.length;e++)this.initVertexMarkers(t[e])},getLatLngs:function(){return this.feature.getLatLngs()},reset:function(){this.editLayer.clearLayers(),this.initVertexMarkers()},addVertexMarker:function(t,e){return new this.tools.options.vertexMarkerClass(t,e,this)},onNewVertex:function(t){this.fireAndForward("editable:vertex:new",{latlng:t.latlng,vertex:t})},addVertexMarkers:function(t){for(var e=0;e<t.length;e++)this.addVertexMarker(t[e],t)},refreshVertexMarkers:function(t){t=t||this.getDefaultLatLngs();for(var e=0;e<t.length;e++)t[e].__vertex.update()},addMiddleMarker:function(t,e,i){return new this.tools.options.middleMarkerClass(t,e,i,this)},onVertexMarkerClick:function(t){if(Waymark_L.Editable.makeCancellable(t),this.fireAndForward("editable:vertex:click",t),!(t._cancelled||this.tools.drawing()&&this.tools._drawingEditor!==this)){var e,i=t.vertex.getIndex();t.originalEvent.ctrlKey?this.onVertexMarkerCtrlClick(t):t.originalEvent.altKey?this.onVertexMarkerAltClick(t):t.originalEvent.shiftKey?this.onVertexMarkerShiftClick(t):t.originalEvent.metaKey?this.onVertexMarkerMetaKeyClick(t):i===t.vertex.getLastIndex()&&this._drawing===Waymark_L.Editable.FORWARD?i>=this.MIN_VERTEX-1&&(e=!0):0===i&&this._drawing===Waymark_L.Editable.BACKWARD&&this._drawnLatLngs.length>=this.MIN_VERTEX||0===i&&this._drawing===Waymark_L.Editable.FORWARD&&this._drawnLatLngs.length>=this.MIN_VERTEX&&this.CLOSED?e=!0:this.onVertexRawMarkerClick(t),this.fireAndForward("editable:vertex:clicked",t),e&&this.commitDrawing(t)}},onVertexRawMarkerClick:function(t){this.fireAndForward("editable:vertex:rawclick",t),t._cancelled||this.vertexCanBeDeleted(t.vertex)&&t.vertex.delete()},vertexCanBeDeleted:function(t){return t.latlngs.length>this.MIN_VERTEX},onVertexDeleted:function(t){this.fireAndForward("editable:vertex:deleted",t)},onVertexMarkerCtrlClick:function(t){this.fireAndForward("editable:vertex:ctrlclick",t)},onVertexMarkerShiftClick:function(t){this.fireAndForward("editable:vertex:shiftclick",t)},onVertexMarkerMetaKeyClick:function(t){this.fireAndForward("editable:vertex:metakeyclick",t)},onVertexMarkerAltClick:function(t){this.fireAndForward("editable:vertex:altclick",t)},onVertexMarkerContextMenu:function(t){this.fireAndForward("editable:vertex:contextmenu",t)},onVertexMarkerMouseDown:function(t){this.fireAndForward("editable:vertex:mousedown",t)},onVertexMarkerMouseOver:function(t){this.fireAndForward("editable:vertex:mouseover",t)},onVertexMarkerMouseOut:function(t){this.fireAndForward("editable:vertex:mouseout",t)},onMiddleMarkerMouseDown:function(t){this.fireAndForward("editable:middlemarker:mousedown",t)},onVertexMarkerDrag:function(t){this.onMove(t),this.feature._bounds&&this.extendBounds(t),this.fireAndForward("editable:vertex:drag",t)},onVertexMarkerDragStart:function(t){this.fireAndForward("editable:vertex:dragstart",t)},onVertexMarkerDragEnd:function(t){this.fireAndForward("editable:vertex:dragend",t)},setDrawnLatLngs:function(t){this._drawnLatLngs=t||this.getDefaultLatLngs()},startDrawing:function(){this._drawnLatLngs||this.setDrawnLatLngs(),Waymark_L.Editable.BaseEditor.prototype.startDrawing.call(this)},startDrawingForward:function(){this.startDrawing()},endDrawing:function(){this.tools.detachForwardLineGuide(),this.tools.detachBackwardLineGuide(),this._drawnLatLngs&&this._drawnLatLngs.length<this.MIN_VERTEX&&this.deleteShape(this._drawnLatLngs),Waymark_L.Editable.BaseEditor.prototype.endDrawing.call(this),delete this._drawnLatLngs},addLatLng:function(t){this._drawing===Waymark_L.Editable.FORWARD?this._drawnLatLngs.push(t):this._drawnLatLngs.unshift(t),this.feature._bounds.extend(t);var e=this.addVertexMarker(t,this._drawnLatLngs);this.onNewVertex(e),this.refresh()},newPointForward:function(t){this.addLatLng(t),this.tools.attachForwardLineGuide(),this.tools.anchorForwardLineGuide(t)},newPointBackward:function(t){this.addLatLng(t),this.tools.anchorBackwardLineGuide(t)},push:function(t){if(!t)return console.error("Waymark_L.Editable.PathEditor.push expect a valid latlng as parameter");this._drawing===Waymark_L.Editable.FORWARD?this.newPointForward(t):this.newPointBackward(t)},removeLatLng:function(t){t.__vertex.delete(),this.refresh()},pop:function(){var t;if(!(this._drawnLatLngs.length<=1))return t=this._drawing===Waymark_L.Editable.FORWARD?this._drawnLatLngs[this._drawnLatLngs.length-1]:this._drawnLatLngs[0],this.removeLatLng(t),this._drawing===Waymark_L.Editable.FORWARD?this.tools.anchorForwardLineGuide(this._drawnLatLngs[this._drawnLatLngs.length-1]):this.tools.anchorForwardLineGuide(this._drawnLatLngs[0]),t},processDrawingClick:function(t){t.vertex&&t.vertex.editor===this||(this._drawing===Waymark_L.Editable.FORWARD?this.newPointForward(t.latlng):this.newPointBackward(t.latlng),this.fireAndForward("editable:drawing:clicked",t))},onDrawingMouseMove:function(t){Waymark_L.Editable.BaseEditor.prototype.onDrawingMouseMove.call(this,t),this._drawing&&(this.tools.moveForwardLineGuide(t.latlng),this.tools.moveBackwardLineGuide(t.latlng))},refresh:function(){this.feature.redraw(),this.onEditing()},newShape:function(t){var e=this.addNewEmptyShape();e&&(this.setDrawnLatLngs(e[0]||e),this.startDrawingForward(),this.fireAndForward("editable:shape:new",{shape:e}),t&&this.newPointForward(t))},deleteShape:function(t,e){var i={shape:t};if(Waymark_L.Editable.makeCancellable(i),this.fireAndForward("editable:shape:delete",i),!i._cancelled)return t=this._deleteShape(t,e),this.ensureNotFlat&&this.ensureNotFlat(),this.feature.setLatLngs(this.getLatLngs()),this.refresh(),this.reset(),this.fireAndForward("editable:shape:deleted",{shape:t}),t},_deleteShape:function(t,e){if((e=e||this.getLatLngs()).length){var i=this,n=function(t,e){return t.splice(t.indexOf(e),1),t.length||i._deleteShape(t),e};if(e===t)return function(t,e){return t.splice(0,Number.MAX_VALUE)}(e);for(var a=0;a<e.length;a++){if(e[a]===t)return n(e,t);if(-1!==e[a].indexOf(t))return n(e[a],t)}}},deleteShapeAt:function(t){var e=this.feature.shapeAt(t);if(e)return this.deleteShape(e)},appendShape:function(t){this.insertShape(t)},prependShape:function(t){this.insertShape(t,0)},insertShape:function(t,e){this.ensureMulti(),t=this.formatShape(t),void 0===e&&(e=this.feature._latlngs.length),this.feature._latlngs.splice(e,0,t),this.feature.redraw(),this._enabled&&this.reset()},extendBounds:function(t){this.feature._bounds.extend(t.vertex.latlng)},onDragStart:function(t){this.editLayer.clearLayers(),Waymark_L.Editable.BaseEditor.prototype.onDragStart.call(this,t)},onDragEnd:function(t){this.initVertexMarkers(),Waymark_L.Editable.BaseEditor.prototype.onDragEnd.call(this,t)}}),Waymark_L.Editable.PolylineEditor=Waymark_L.Editable.PathEditor.extend({startDrawingBackward:function(){this._drawing=Waymark_L.Editable.BACKWARD,this.startDrawing()},continueBackward:function(t){this.drawing()||(t=t||this.getDefaultLatLngs(),this.setDrawnLatLngs(t),t.length>0&&(this.tools.attachBackwardLineGuide(),this.tools.anchorBackwardLineGuide(t[0])),this.startDrawingBackward())},continueForward:function(t){this.drawing()||(t=t||this.getDefaultLatLngs(),this.setDrawnLatLngs(t),t.length>0&&(this.tools.attachForwardLineGuide(),this.tools.anchorForwardLineGuide(t[t.length-1])),this.startDrawingForward())},getDefaultLatLngs:function(t){return!(t=t||this.feature._latlngs).length||t[0]instanceof Waymark_L.LatLng?t:this.getDefaultLatLngs(t[0])},ensureMulti:function(){this.feature._latlngs.length&&l(this.feature._latlngs)&&(this.feature._latlngs=[this.feature._latlngs])},addNewEmptyShape:function(){if(this.feature._latlngs.length){var t=[];return this.appendShape(t),t}return this.feature._latlngs},formatShape:function(t){return l(t)?t:t[0]?this.formatShape(t[0]):void 0},splitShape:function(t,e){if(e&&!(e>=t.length-1)){this.ensureMulti();var i=this.feature._latlngs.indexOf(t);if(-1!==i){var n=t.slice(0,e+1),a=t.slice(e);a[0]=Waymark_L.latLng(a[0].lat,a[0].lng,a[0].alt),this.feature._latlngs.splice(i,1,n,a),this.refresh(),this.reset()}}}}),Waymark_L.Editable.PolygonEditor=Waymark_L.Editable.PathEditor.extend({CLOSED:!0,MIN_VERTEX:3,newPointForward:function(t){Waymark_L.Editable.PathEditor.prototype.newPointForward.call(this,t),this.tools.backwardLineGuide._latlngs.length||this.tools.anchorBackwardLineGuide(t),2===this._drawnLatLngs.length&&this.tools.attachBackwardLineGuide()},addNewEmptyHole:function(t){this.ensureNotFlat();var e=this.feature.shapeAt(t);if(e){var i=[];return e.push(i),i}},newHole:function(t){var e=this.addNewEmptyHole(t);e&&(this.setDrawnLatLngs(e),this.startDrawingForward(),t&&this.newPointForward(t))},addNewEmptyShape:function(){if(this.feature._latlngs.length&&this.feature._latlngs[0].length){var t=[];return this.appendShape(t),t}return this.feature._latlngs},ensureMulti:function(){this.feature._latlngs.length&&l(this.feature._latlngs[0])&&(this.feature._latlngs=[this.feature._latlngs])},ensureNotFlat:function(){this.feature._latlngs.length&&!l(this.feature._latlngs)||(this.feature._latlngs=[this.feature._latlngs])},vertexCanBeDeleted:function(t){var e=this.feature.parentShape(t.latlngs);return Waymark_L.Util.indexOf(e,t.latlngs)>0||Waymark_L.Editable.PathEditor.prototype.vertexCanBeDeleted.call(this,t)},getDefaultLatLngs:function(){return this.feature._latlngs.length||this.feature._latlngs.push([]),this.feature._latlngs[0]},formatShape:function(t){return!l(t)||t[0]&&0===t[0].length?t:[t]}}),Waymark_L.Editable.RectangleEditor=Waymark_L.Editable.PathEditor.extend({CLOSED:!0,MIN_VERTEX:4,options:{skipMiddleMarkers:!0},extendBounds:function(t){var e=t.vertex.getIndex(),i=t.vertex.getNext(),n=t.vertex.getPrevious(),a=(e+2)%4,o=t.vertex.latlngs[a],r=new Waymark_L.LatLngBounds(t.latlng,o);n.latlng.update([t.latlng.lat,o.lng]),i.latlng.update([o.lat,t.latlng.lng]),this.updateBounds(r),this.refreshVertexMarkers()},onDrawingMouseDown:function(t){Waymark_L.Editable.PathEditor.prototype.onDrawingMouseDown.call(this,t),this.connect();var e=this.getDefaultLatLngs();3===e.length&&e.push(t.latlng);var i=new Waymark_L.LatLngBounds(t.latlng,t.latlng);this.updateBounds(i),this.updateLatLngs(i),this.refresh(),this.reset(),t.originalEvent._simulated=!1,this.map.dragging._draggable._onUp(t.originalEvent),e[3].__vertex.dragging._draggable._onDown(t.originalEvent)},onDrawingMouseUp:function(t){this.commitDrawing(t),t.originalEvent._simulated=!1,Waymark_L.Editable.PathEditor.prototype.onDrawingMouseUp.call(this,t)},onDrawingMouseMove:function(t){t.originalEvent._simulated=!1,Waymark_L.Editable.PathEditor.prototype.onDrawingMouseMove.call(this,t)},getDefaultLatLngs:function(t){return t||this.feature._latlngs[0]},updateBounds:function(t){this.feature._bounds=t},updateLatLngs:function(t){for(var e=this.getDefaultLatLngs(),i=this.feature._boundsToLatLngs(t),n=0;n<e.length;n++)e[n].update(i[n])}}),Waymark_L.Editable.CircleEditor=Waymark_L.Editable.PathEditor.extend({MIN_VERTEX:2,options:{skipMiddleMarkers:!0},initialize:function(t,e,i){Waymark_L.Editable.PathEditor.prototype.initialize.call(this,t,e,i),this._resizeLatLng=this.computeResizeLatLng()},computeResizeLatLng:function(){var t=(this.feature._radius||this.feature._mRadius)*Math.cos(Math.PI/4),e=this.map.project(this.feature._latlng);return this.map.unproject([e.x+t,e.y-t])},updateResizeLatLng:function(){this._resizeLatLng.update(this.computeResizeLatLng()),this._resizeLatLng.__vertex.update()},getLatLngs:function(){return[this.feature._latlng,this._resizeLatLng]},getDefaultLatLngs:function(){return this.getLatLngs()},onVertexMarkerDrag:function(t){1===t.vertex.getIndex()?this.resize(t):this.updateResizeLatLng(t),Waymark_L.Editable.PathEditor.prototype.onVertexMarkerDrag.call(this,t)},resize:function(t){var e=this.feature._latlng.distanceTo(t.latlng);this.feature.setRadius(e)},onDrawingMouseDown:function(t){Waymark_L.Editable.PathEditor.prototype.onDrawingMouseDown.call(this,t),this._resizeLatLng.update(t.latlng),this.feature._latlng.update(t.latlng),this.connect(),t.originalEvent._simulated=!1,this.map.dragging._draggable._onUp(t.originalEvent),this._resizeLatLng.__vertex.dragging._draggable._onDown(t.originalEvent)},onDrawingMouseUp:function(t){this.commitDrawing(t),t.originalEvent._simulated=!1,Waymark_L.Editable.PathEditor.prototype.onDrawingMouseUp.call(this,t)},onDrawingMouseMove:function(t){t.originalEvent._simulated=!1,Waymark_L.Editable.PathEditor.prototype.onDrawingMouseMove.call(this,t)},onDrag:function(t){Waymark_L.Editable.PathEditor.prototype.onDrag.call(this,t),this.feature.dragging.updateLatLng(this._resizeLatLng)}});var e={createEditor:function(t){t=t||this._map;var e=(this.options.editOptions||{}).editTools||t.editTools;if(!e)throw Error("Unable to detect Editable instance.");return new(this.options.editorClass||this.getEditorClass(e))(t,this,this.options.editOptions)},enableEdit:function(t){return this.editor||this.createEditor(t),this.editor.enable(),this.editor},editEnabled:function(){return this.editor&&this.editor.enabled()},disableEdit:function(){this.editor&&(this.editor.disable(),delete this.editor)},toggleEdit:function(){this.editEnabled()?this.disableEdit():this.enableEdit()},_onEditableAdd:function(){this.editor&&this.enableEdit()}},i={getEditorClass:function(t){return t&&t.options.polylineEditorClass?t.options.polylineEditorClass:Waymark_L.Editable.PolylineEditor},shapeAt:function(t,e){var i=null;if(!(e=e||this._latlngs).length)return i;if(l(e)&&this.isInLatLngs(t,e))i=e;else for(var n=0;n<e.length;n++)if(this.isInLatLngs(t,e[n]))return e[n];return i},isInLatLngs:function(t,e){if(!e)return!1;var i,n,a,o,r=[],s=this._clickTolerance();if(this._projectLatlngs(e,r,this._pxBounds),r=r[0],o=this._map.latLngToLayerPoint(t),!this._pxBounds.contains(o))return!1;for(i=1,a=r.length,n=0;i<a;n=i++)if(Waymark_L.LineUtil.pointToSegmentDistance(o,r[n],r[i])<=s)return!0;return!1}},n={getEditorClass:function(t){return t&&t.options.polygonEditorClass?t.options.polygonEditorClass:Waymark_L.Editable.PolygonEditor},shapeAt:function(t,e){var i=null;if(!(e=e||this._latlngs).length)return i;if(l(e)&&this.isInLatLngs(t,e))i=e;else if(l(e[0])&&this.isInLatLngs(t,e[0]))i=e;else for(var n=0;n<e.length;n++)if(this.isInLatLngs(t,e[n][0]))return e[n];return i},isInLatLngs:function(t,e){var i,n,a,o,r,s=!1;for(a=0,o=(r=e.length)-1;a<r;o=a++)i=e[a],n=e[o],i.lat>t.lat!=n.lat>t.lat&&t.lng<(n.lng-i.lng)*(t.lat-i.lat)/(n.lat-i.lat)+i.lng&&(s=!s);return s},parentShape:function(t,e){if(e=e||this._latlngs){var i=Waymark_L.Util.indexOf(e,t);if(-1!==i)return e;for(var n=0;n<e.length;n++)if(-1!==(i=Waymark_L.Util.indexOf(e[n],t)))return e[n]}}},a={getEditorClass:function(t){return t&&t.options.markerEditorClass?t.options.markerEditorClass:Waymark_L.Editable.MarkerEditor}},o={getEditorClass:function(t){return t&&t.options.rectangleEditorClass?t.options.rectangleEditorClass:Waymark_L.Editable.RectangleEditor}},r={getEditorClass:function(t){return t&&t.options.circleEditorClass?t.options.circleEditorClass:Waymark_L.Editable.CircleEditor}},s=function(){this.on("add",this._onEditableAdd)},l=Waymark_L.LineUtil.isFlat||Waymark_L.LineUtil._flat||Waymark_L.Polyline._flat;Waymark_L.Polyline&&(Waymark_L.Polyline.include(e),Waymark_L.Polyline.include(i),Waymark_L.Polyline.addInitHook(s)),Waymark_L.Polygon&&(Waymark_L.Polygon.include(e),Waymark_L.Polygon.include(n)),Waymark_L.Marker&&(Waymark_L.Marker.include(e),Waymark_L.Marker.include(a),Waymark_L.Marker.addInitHook(s)),Waymark_L.Rectangle&&(Waymark_L.Rectangle.include(e),Waymark_L.Rectangle.include(o)),Waymark_L.Circle&&(Waymark_L.Circle.include(e),Waymark_L.Circle.include(r)),Waymark_L.LatLng.prototype.update=function(t){t=Waymark_L.latLng(t),this.lat=t.lat,this.lng=t.lng}}),window),Waymark_L.FeatureGroup.SubGroup=Waymark_L.FeatureGroup.extend({initialize:function(t,e){Waymark_L.FeatureGroup.prototype.initialize.call(this,e),this.setParentGroup(t)},setParentGroup:function(t){var e=t instanceof Waymark_L.LayerGroup;return this._parentGroup=t,this.onAdd=e?"function"==typeof t.addLayers?this._onAddToGroupBatch:this._onAddToGroup:this._onAddToMap,this.onRemove=e?"function"==typeof t.removeLayers?this._onRemoveFromGroupBatch:this._onRemoveFromGroup:this._onRemoveFromMap,this.addLayer=e?this._addLayerToGroup:this._addLayerToMap,this.removeLayer=e?this._removeLayerFromGroup:this._removeLayerFromMap,this},setParentGroupSafe:function(t){var e=this._map;return e&&e.removeLayer(this),this.setParentGroup(t),e&&e.addLayer(this),this},getParentGroup:function(){return this._parentGroup},_onAddToGroupBatch:function(t){var e=this.getLayers();this._map=t,this._parentGroup.addLayers(e)},_onRemoveFromGroupBatch:function(){var t=this.getLayers();this._parentGroup.removeLayers(t),this._map=null},_onAddToGroup:function(t){var e=this._parentGroup;this._map=t,this.eachLayer(e.addLayer,e)},_onRemoveFromGroup:function(){var t=this._parentGroup;this.eachLayer(t.removeLayer,t),this._map=null},_onAddToMap:Waymark_L.FeatureGroup.prototype.onAdd,_onRemoveFromMap:Waymark_L.FeatureGroup.prototype.onRemove,_addLayerToGroup:function(t){if(this.hasLayer(t))return this;t.addEventParent(this);var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._parentGroup.addLayer(t),this.fire("layeradd",{layer:t})},_removeLayerFromGroup:function(t){if(!this.hasLayer(t))return this;var e=t in this._layers?t:this.getLayerId(t);return(t=this._layers[e]).removeEventParent(this),this._map&&t&&this._parentGroup.removeLayer(t),delete this._layers[e],this.fire("layerremove",{layer:t})},_addLayerToMap:Waymark_L.FeatureGroup.prototype.addLayer,_removeLayerFromMap:Waymark_L.FeatureGroup.prototype.removeLayer}),Waymark_L.featureGroup.subGroup=function(t,e){return new Waymark_L.FeatureGroup.SubGroup(t,e)},function(t){var e;if("function"==typeof define&&define.amd)define(["leaflet"],t);else if("undefined"!=typeof module)e=require("leaflet"),module.exports=t(e);else{if(void 0===window.L)throw new Error("Leaflet must be loaded first");t(window.L)}}((function(t){Waymark_L.Control.Fullscreen=Waymark_L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(t){var e=Waymark_L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=Waymark_L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",e),this.link.href="#",this._map=t,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),Waymark_L.DomEvent.on(this.link,"click",this._click,this),e},_click:function(t){Waymark_L.DomEvent.stopPropagation(t),Waymark_L.DomEvent.preventDefault(t),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}}),Waymark_L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(t){var e=this.getContainer();this.isFullscreen()?t&&t.pseudoFullscreen?this._disablePseudoFullscreen(e):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(e):t&&t.pseudoFullscreen?this._enablePseudoFullscreen(e):e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen?e.msRequestFullscreen():this._enablePseudoFullscreen(e)},_enablePseudoFullscreen:function(t){Waymark_L.DomUtil.addClass(t,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(t){Waymark_L.DomUtil.removeClass(t,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(t){this._isFullscreen=t;var e=this.getContainer();t?Waymark_L.DomUtil.addClass(e,"leaflet-fullscreen-on"):Waymark_L.DomUtil.removeClass(e,"leaflet-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(t){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;e!==this.getContainer()||this._isFullscreen?e!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange")):(this._setFullscreen(!0),this.fire("fullscreenchange"))}}),Waymark_L.Map.mergeOptions({fullscreenControl:!1}),Waymark_L.Map.addInitHook((function(){var t;if(this.options.fullscreenControl&&(this.fullscreenControl=new Waymark_L.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl)),"onfullscreenchange"in document?t="fullscreenchange":"onmozfullscreenchange"in document?t="mozfullscreenchange":"onwebkitfullscreenchange"in document?t="webkitfullscreenchange":"onmsfullscreenchange"in document&&(t="MSFullscreenChange"),t){var e=Waymark_L.bind(this._onFullscreenChange,this);this.whenReady((function(){Waymark_L.DomEvent.on(document,t,e)})),this.on("unload",(function(){Waymark_L.DomEvent.off(document,t,e)}))}})),Waymark_L.control.fullscreen=function(t){return new Waymark_L.Control.Fullscreen(t)}})),Waymark_L.Control.SleepMapControl=Waymark_L.Control.extend({initialize:function(t){Waymark_L.setOptions(this,t)},options:{position:"topright",prompt:"disable map",styles:{backgroundColor:"white",padding:"5px",border:"2px solid gray"}},buildContainer:function(){var t=this,e=Waymark_L.DomUtil.create("p","sleep-button"),i=this._nonBoundEvent.bind(this);return e.appendChild(document.createTextNode(this.options.prompt)),Waymark_L.DomEvent.addListener(e,"click",i),Waymark_L.DomEvent.addListener(e,"touchstart",i),Object.keys(this.options.styles).map((function(i){e.style[i]=t.options.styles[i]})),this._container=e},onAdd:function(){return this._container||this.buildContainer()},_nonBoundEvent:function(t){return Waymark_L.DomEvent.stop(t),this._map&&this._map.sleep._sleepMap(),!1}}),Waymark_L.Control.sleepMapControl=function(){return new Waymark_L.Control.SleepMapControl},Waymark_L.Map.mergeOptions({sleep:!0,sleepTime:750,wakeTime:750,wakeMessageTouch:"Touch to Wake",sleepNote:!0,hoverToWake:!0,sleepOpacity:.7,sleepButton:Waymark_L.Control.sleepMapControl}),Waymark_L.Map.Sleep=Waymark_L.Handler.extend({addHooks:function(){this.sleepNote=Waymark_L.DomUtil.create("p","sleep-note",this._map._container),this._enterTimeout=null,this._exitTimeout=null,this._sleepButton=this._map.options.sleepButton(),this._map.tap&&this._map.addControl(this._sleepButton);var t=this._map._container.style;t.WebkitTransition+="opacity .5s",t.MozTransition+="opacity .5s",this._setSleepNoteStyle(),this._sleepMap()},removeHooks:function(){this._map.scrollWheelZoom.enabled()||this._map.scrollWheelZoom.enable(),this._map.tap&&!this._map.tap.enabled()&&(this._map.touchZoom.enable(),this._map.dragging.enable(),this._map.tap.enable()),Waymark_L.DomUtil.setOpacity(this._map._container,1),Waymark_L.DomUtil.setOpacity(this.sleepNote,0),this._removeSleepingListeners(),this._removeAwakeListeners()},_setSleepNoteStyle:function(){var t="",e=this.sleepNote.style;if(t=this._map.tap?this._map.options.wakeMessageTouch:this._map.options.wakeMessage?this._map.options.wakeMessage:this._map.options.hoverToWake?"click or hover to wake":"click to wake",this._map.options.sleepNote&&(this.sleepNote.appendChild(document.createTextNode(t)),e.pointerEvents="none",e.maxWidth="150px",e.transitionDuration=".2s",e.zIndex=5e3,e.opacity=".6",e.margin="auto",e.textAlign="center",e.borderRadius="4px",e.top="50%",e.position="relative",e.padding="5px",e.border="solid 2px black",e.background="white",this._map.options.sleepNoteStyle)){var i=this._map.options.sleepNoteStyle;Object.keys(i).map((function(t){e[t]=i[t]}))}},_wakeMap:function(t){this._stopWaiting(),this._map.scrollWheelZoom.enable(),this._map.tap&&(this._map.touchZoom.enable(),this._map.dragging.enable(),this._map.tap.enable(),this._map.addControl(this._sleepButton)),Waymark_L.DomUtil.setOpacity(this._map._container,1),this.sleepNote.style.opacity=0,this._addAwakeListeners()},_sleepMap:function(){this._stopWaiting(),this._map.scrollWheelZoom.disable(),this._map.tap&&(this._map.touchZoom.disable(),this._map.dragging.disable(),this._map.tap.disable(),this._map.removeControl(this._sleepButton)),Waymark_L.DomUtil.setOpacity(this._map._container,this._map.options.sleepOpacity),this.sleepNote.style.opacity=.4,this._addSleepingListeners()},_wakePending:function(){if(this._map.once("mousedown",this._wakeMap,this),this._map.options.hoverToWake){var t=this;this._map.once("mouseout",this._sleepMap,this),t._enterTimeout=setTimeout((function(){t._map.off("mouseout",t._sleepMap,t),t._wakeMap()}),t._map.options.wakeTime)}},_sleepPending:function(){var t=this;t._map.once("mouseover",t._wakeMap,t),t._exitTimeout=setTimeout((function(){t._map.off("mouseover",t._wakeMap,t),t._sleepMap()}),t._map.options.sleepTime)},_addSleepingListeners:function(){this._map.once("mouseover",this._wakePending,this),this._map.tap&&this._map.once("click",this._wakeMap,this)},_addAwakeListeners:function(){this._map.once("mouseout",this._sleepPending,this)},_removeSleepingListeners:function(){this._map.options.hoverToWake&&this._map.off("mouseover",this._wakePending,this),this._map.off("mousedown",this._wakeMap,this),this._map.tap&&this._map.off("click",this._wakeMap,this)},_removeAwakeListeners:function(){this._map.off("mouseout",this._sleepPending,this)},_stopWaiting:function(){this._removeSleepingListeners(),this._removeAwakeListeners();this._enterTimeout&&clearTimeout(this._enterTimeout),this._exitTimeout&&clearTimeout(this._exitTimeout),this._enterTimeout=null,this._exitTimeout=null}}),Waymark_L.Map.addInitHook("addHandler","sleep",Waymark_L.Map.Sleep);var toGeoJSON=function(){var t,e=/\s*/g,i=/^\s*|\s*$/g,n=/\s+/;function a(t){if(!t||!t.length)return 0;for(var e=0,i=0;e<t.length;e++)i=(i<<5)-i+t.charCodeAt(e)|0;return i}function o(t,e){return t.getElementsByTagName(e)}function r(t,e){return t.getAttribute(e)}function s(t,e){return parseFloat(r(t,e))}function l(t,e){var i=o(t,e);return i.length?i[0]:null}function h(t){for(var e=0,i=[];e<t.length;e++)i[e]=parseFloat(t[e]);return i}function d(t){return t&&function(t){t.normalize&&t.normalize()}(t),t&&t.textContent||""}function c(t,e){var i,n,a={};for(n=0;n<e.length;n++)(i=l(t,e[n]))&&(a[e[n]]=d(i));return a}function u(t,e){for(var i in e)t[i]=e[i]}function _(t){return h(t.replace(e,"").split(","))}function p(t){for(var e=t.replace(i,"").split(n),a=[],o=0;o<e.length;o++)a.push(_(e[o]));return a}function m(t){var e,i=[s(t,"lon"),s(t,"lat")],n=l(t,"ele"),a=l(t,"gpxtpx:hr")||l(t,"hr"),o=l(t,"time");return n&&(e=parseFloat(d(n)),isNaN(e)||i.push(e)),{coordinates:i,time:o?d(o):null,heartRate:a?parseFloat(d(a)):null}}if("undefined"!=typeof XMLSerializer)t=new XMLSerializer;else{var f="object"==typeof process&&!process.browser,g="object"==typeof Titanium;if("object"!=typeof exports||!f&&!g)throw new Error("Unable to initialize serializer");t=new(require("xmldom").XMLSerializer)}function y(e){return void 0!==e.xml?e.xml:t.serializeToString(e)}return{kml:function(t){for(var e={type:"FeatureCollection",features:[]},i={},n={},s={},c=["Polygon","LineString","Point","Track","gx:Track"],u=o(t,"Placemark"),m=o(t,"Style"),f=o(t,"StyleMap"),g=0;g<m.length;g++){var v=a(y(m[g])).toString(16);i["#"+r(m[g],"id")]=v,n[v]=m[g]}for(var k=0;k<f.length;k++){i["#"+r(f[k],"id")]=a(y(f[k])).toString(16);for(var L=o(f[k],"Pair"),w={},b=0;b<L.length;b++)w[d(l(L[b],"key"))]=d(l(L[b],"styleUrl"));s["#"+r(f[k],"id")]=w}for(var x=0;x<u.length;x++)e.features=e.features.concat(M(u[x]));function W(t){var e,i;return"#"===(t=t||"").substr(0,1)&&(t=t.substr(1)),6!==t.length&&3!==t.length||(e=t),8===t.length&&(i=parseInt(t.substr(0,2),16)/255,e="#"+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)),[e,isNaN(i)?void 0:i]}function P(t){return h(t.split(" "))}function C(t){var e=o(t,"coord"),i=[],n=[];0===e.length&&(e=o(t,"gx:coord"));for(var a=0;a<e.length;a++)i.push(P(d(e[a])));for(var r=o(t,"when"),s=0;s<r.length;s++)n.push(d(r[s]));return{coords:i,times:n}}function M(t){var e,a=function t(e){var i,n,a,r,s,h=[],u=[];if(l(e,"MultiGeometry"))return t(l(e,"MultiGeometry"));if(l(e,"MultiTrack"))return t(l(e,"MultiTrack"));if(l(e,"gx:MultiTrack"))return t(l(e,"gx:MultiTrack"));for(a=0;a<c.length;a++)if(n=o(e,c[a]))for(r=0;r<n.length;r++)if(i=n[r],"Point"===c[a])h.push({type:"Point",coordinates:_(d(l(i,"coordinates")))});else if("LineString"===c[a])h.push({type:"LineString",coordinates:p(d(l(i,"coordinates")))});else if("Polygon"===c[a]){var m=o(i,"LinearRing"),f=[];for(s=0;s<m.length;s++)f.push(p(d(l(m[s],"coordinates"))));h.push({type:"Polygon",coordinates:f})}else if("Track"===c[a]||"gx:Track"===c[a]){var g=C(i);h.push({type:"LineString",coordinates:g.coords}),g.times.length&&u.push(g.times)}return{geoms:h,coordTimes:u}}(t),h={},u=d(l(t,"name")),m=d(l(t,"address")),f=d(l(t,"styleUrl")),g=d(l(t,"description")),y=l(t,"TimeSpan"),v=l(t,"TimeStamp"),k=l(t,"ExtendedData"),L=l(t,"LineStyle"),w=l(t,"PolyStyle"),b=l(t,"visibility");if(!a.geoms.length)return[];if(u&&(h.name=u),m&&(h.address=m),f){"#"!==f[0]&&(f="#"+f),h.styleUrl=f,i[f]&&(h.styleHash=i[f]),s[f]&&(h.styleMapHash=s[f],h.styleHash=i[s[f].normal]);var x=n[h.styleHash];if(x){L||(L=l(x,"LineStyle")),w||(w=l(x,"PolyStyle"));var P=l(x,"IconStyle");if(P){var M=l(P,"Icon");if(M){var E=d(l(M,"href"));E&&(h.icon=E)}}}}if(g&&(h.description=g),y){var T=d(l(y,"begin")),S=d(l(y,"end"));h.timespan={begin:T,end:S}}if(v&&(h.timestamp=d(l(v,"when"))),L){var D=W(d(l(L,"color"))),z=D[0],j=D[1],O=parseFloat(d(l(L,"width")));z&&(h.stroke=z),isNaN(j)||(h["stroke-opacity"]=j),isNaN(O)||(h["stroke-width"]=O)}if(w){var B=W(d(l(w,"color"))),A=B[0],F=B[1],I=d(l(w,"fill")),N=d(l(w,"outline"));A&&(h.fill=A),isNaN(F)||(h["fill-opacity"]=F),I&&(h["fill-opacity"]="1"===I?h["fill-opacity"]||1:0),N&&(h["stroke-opacity"]="1"===N?h["stroke-opacity"]||1:0)}if(k){var Z=o(k,"Data"),R=o(k,"SimpleData");for(e=0;e<Z.length;e++)h[Z[e].getAttribute("name")]=d(l(Z[e],"value"));for(e=0;e<R.length;e++)h[R[e].getAttribute("name")]=d(R[e])}b&&(h.visibility=d(b)),a.coordTimes.length&&(h.coordTimes=1===a.coordTimes.length?a.coordTimes[0]:a.coordTimes);var U={type:"Feature",geometry:1===a.geoms.length?a.geoms[0]:{type:"GeometryCollection",geometries:a.geoms},properties:h};return r(t,"id")&&(U.id=r(t,"id")),[U]}return e},gpx:function(t){var e,i,n=o(t,"trk"),a=o(t,"rte"),s=o(t,"wpt"),h={type:"FeatureCollection",features:[]};for(e=0;e<n.length;e++)(i=f(n[e]))&&h.features.push(i);for(e=0;e<a.length;e++)(i=g(a[e]))&&h.features.push(i);for(e=0;e<s.length;e++)h.features.push(y(s[e]));function _(t,e){for(var i=0;i<e;i++)t.push(null);return t}function p(t,e){var i=o(t,e),n=[],a=[],r=[],s=i.length;if(s<2)return{};for(var l=0;l<s;l++){var h=m(i[l]);n.push(h.coordinates),h.time&&a.push(h.time),(h.heartRate||r.length)&&(r.length||_(r,l),r.push(h.heartRate||null))}return{line:n,times:a,heartRates:r}}function f(t){for(var e,i=o(t,"trkseg"),n=[],a=[],r=[],s=0;s<i.length;s++)if((e=p(i[s],"trkpt"))&&(e.line&&n.push(e.line),e.times&&e.times.length&&a.push(e.times),r.length||e.heartRates&&e.heartRates.length)){if(!r.length)for(var h=0;h<s;h++)r.push(_([],n[h].length));e.heartRates&&e.heartRates.length?r.push(e.heartRates):r.push(_([],e.line.length||0))}if(0!==n.length){var d=k(t);return u(d,v(l(t,"extensions"))),a.length&&(d.coordTimes=1===n.length?a[0]:a),r.length&&(d.heartRates=1===n.length?r[0]:r),{type:"Feature",properties:d,geometry:{type:1===n.length?"LineString":"MultiLineString",coordinates:1===n.length?n[0]:n}}}}function g(t){var e=p(t,"rtept");if(e.line){var i=k(t);return u(i,v(l(t,"extensions"))),{type:"Feature",properties:i,geometry:{type:"LineString",coordinates:e.line}}}}function y(t){var e=k(t);return u(e,c(t,["sym"])),{type:"Feature",properties:e,geometry:{type:"Point",coordinates:m(t).coordinates}}}function v(t){var e={};if(t){var i=l(t,"line");if(i){var n=d(l(i,"color")),a=parseFloat(d(l(i,"opacity"))),o=parseFloat(d(l(i,"width")));n&&(e.stroke=n),isNaN(a)||(e["stroke-opacity"]=a),isNaN(o)||(e["stroke-width"]=96*o/25.4)}}return e}function k(t){var e=c(t,["name","cmt","desc","type","time","keywords"]),i=o(t,"link");i.length&&(e.links=[]);for(var n,a=0;a<i.length;a++)u(n={href:r(i[a],"href")},c(i[a],["text","type"])),e.links.push(n);return e}return h}}}();"undefined"!=typeof module&&(module.exports=toGeoJSON),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).togpx=t()}}((function(){return function t(e,i,n){function a(r,s){if(!i[r]){if(!e[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(o)return o(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var d=i[r]={exports:{}};e[r][0].call(d.exports,(function(t){var i=e[r][1][t];return a(i||t)}),d,d.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)a(n[r]);return a}({1:[function(t,e,i){var n=t("jxon");n.config({attrPrefix:"@"}),e.exports=function(t,e){if("string"==typeof(e=function(t,e){for(var i in t)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}({creator:"togpx",metadata:void 0,featureTitle:function t(e){if(!e)return"";if("object"==typeof e.tags){var i=t(e.tags);if(""!==i)return i}return e.name?e.name:e.ref?e.ref:e.id?e.id:""},featureDescription:function t(e){if(!e)return"";if("object"==typeof e.tags)return t(e.tags);var i="";for(var n in e)"object"!=typeof e[n]&&(i+=n+"="+e[n]+"\n");return i.substr(0,i.length-1)},featureLink:void 0,featureCoordTimes:function(t){return t.properties&&(t.properties.times||t.properties.coordTimes)||null}},e||{})).featureCoordTimes){var i=e.featureCoordTimes;e.featureCoordTimes=function(t){return t.properties[i]}}function a(t,i){e.featureLink&&(t.link={"@href":e.featureLink(i.properties)})}var r={gpx:{"@xmlns":"http://www.topografix.com/GPX/1/1","@xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","@xsi:schemaLocation":"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd","@version":"1.1",metadata:null,wpt:[],trk:[]}};return e.creator&&(r.gpx["@creator"]=e.creator),e.metadata?r.gpx.metadata=e.metadata:delete e.metadata,("FeatureCollection"===t.type?t.features:"Feature"===t.type?[t]:[{type:"Feature",properties:{},geometry:t}]).forEach((function t(i){switch(i.geometry.type){case"Point":case"MultiPoint":var n=i.geometry.coordinates;"Point"==i.geometry.type&&(n=[n]),n.forEach((function(t){o={"@lat":t[1],"@lon":t[0],name:e.featureTitle(i.properties),desc:e.featureDescription(i.properties)},void 0!==t[2]&&(o.ele=t[2]),a(o,i),r.gpx.wpt.push(o)}));break;case"LineString":case"MultiLineString":n=i.geometry.coordinates;var s=e.featureCoordTimes(i);"LineString"==i.geometry.type&&(n=[n]),o={name:e.featureTitle(i.properties),desc:e.featureDescription(i.properties)},a(o,i),o.trkseg=[],n.forEach((function(t){var e={trkpt:[]};t.forEach((function(t,i){var n={"@lat":t[1],"@lon":t[0]};void 0!==t[2]&&(n.ele=t[2]),s&&s[i]&&(n.time=s[i]),e.trkpt.push(n)})),o.trkseg.push(e)})),r.gpx.trk.push(o);break;case"Polygon":case"MultiPolygon":o={name:e.featureTitle(i.properties),desc:e.featureDescription(i.properties)},a(o,i),o.trkseg=[];n=i.geometry.coordinates,s=e.featureCoordTimes(i);"Polygon"==i.geometry.type&&(n=[n]),n.forEach((function(t){t.forEach((function(t){var e={trkpt:[]},i=0;t.forEach((function(t){var n={"@lat":t[1],"@lon":t[0]};void 0!==t[2]&&(n.ele=t[2]),s&&s[i]&&(n.time=s[i]),i++,e.trkpt.push(n)})),o.trkseg.push(e)}))})),r.gpx.trk.push(o);break;case"GeometryCollection":i.geometry.geometries.forEach((function(e){var n={properties:i.properties,geometry:e};t(n)}));break;default:console.log("warning: unsupported geometry type: "+i.geometry.type)}})),gpx_str=n.stringify(r),gpx_str}},{jxon:2}],2:[function(t,e,i){var n,a;n=this,a=function(t,e){var i,n={valueKey:"_",attrKey:"$",attrPrefix:"$",lowerCaseTags:!1,trueIsEmpty:!1,autoDate:!1,ignorePrefixedNodes:!1,parseValues:!1},a=[],o=/^\s*$/,r=/^(?:true|false)$/i;return new function(){function s(t){return n.parseValues?o.test(t)?null:r.test(t)?"true"===t.toLowerCase():isFinite(t)?parseFloat(t):n.autoDate&&isFinite(Date.parse(t))?new Date(t):t:t}function l(){}function h(t,e,i,o){var r,d,c=a.length,u=t.hasChildNodes(),_=t.nodeType===t.ELEMENT_NODE&&t.hasAttributes(),p=Boolean(2&e),m=0,f="",g=p?{}:!!n.trueIsEmpty||"";if(u)for(var y,v=0;v<t.childNodes.length;v++)4===(y=t.childNodes.item(v)).nodeType?f+=y.nodeValue:3===y.nodeType?f+=y.nodeValue.trim():1!==y.nodeType||n.ignorePrefixedNodes&&y.prefix||a.push(y);var k,L=a.length,w=s(f);p||!u&&!_||(g=0===e?null===(k=w)?new l:k instanceof Object?k:new k.constructor(k):{});for(var b=c;b<L;b++)r=a[b].nodeName,n.lowerCaseTags&&(r=r.toLowerCase()),d=h(a[b],e,i,o),g.hasOwnProperty(r)?(g[r].constructor!==Array&&(g[r]=[g[r]]),g[r].push(d)):(g[r]=d,m++);if(_){for(var x,W,P=t.attributes.length,C=o?"":n.attrPrefix,M=o?{}:g,E=0;E<P;m++,E++)W=(x=t.attributes.item(E)).name,n.lowerCaseTags&&(W=W.toLowerCase()),M[C+W]=s(x.value.trim());o&&(i&&Object.freeze(M),g[n.attrKey]=M,m-=P-1)}return 3===e||(2===e||1===e&&m>0)&&f?g[n.valueKey]=w:!p&&0===m&&f&&(g=w),i&&(p||m>0)&&Object.freeze(g),a.length=c,g}this.config=function(e){for(var a in e)n[a]=e[a];n.parserErrorHandler&&(i=new t.DOMParser({errorHandler:n.parserErrorHandler,locator:{}}))},l.prototype.toString=function(){return"null"},l.prototype.valueOf=function(){return null},this.xmlToJs=this.build=function(t,e,i,n){var a=arguments.length>1&&"number"==typeof e?3&e:1;return h(t,a,i||!1,arguments.length>3?n:3===a)},this.jsToXml=this.unbuild=function(i,a,o,r){var s=(t.document&&t.document.implementation||new t.DOMImplementation).createDocument(a||null,o||"",r||null);return function t(i,a,o){var r,s,l;if(o.constructor===String||o.constructor===Number||o.constructor===Boolean){if(a.appendChild(i.createTextNode(o.toString())),o===o.valueOf())return}else o.constructor===Date&&a.appendChild(i.createTextNode(o.toISOString()));for(var h in o)if(void 0!==(r=o[h])&&(null===r&&(r={}),!(isFinite(h)||r instanceof Function)))if(h===n.valueKey)null!==r&&!0!==r&&a.appendChild(i.createTextNode(r.constructor===Date?r.toISOString():String(r)));else if(h===n.attrKey)for(var d in r)a.setAttribute(d,r[d]);else if(h===n.attrPrefix+"xmlns")e&&a.setAttribute(h.slice(1),r);else if(h.charAt(0)===n.attrPrefix)a.setAttribute(h.slice(1),r);else if(r.constructor===Array)for(var c in r)r.hasOwnProperty(c)&&(s=(l=r[c]&&r[c][n.attrPrefix+"xmlns"]||a.namespaceURI)?i.createElementNS(l,h):i.createElement(h),t(i,s,r[c]||{}),a.appendChild(s));else s=(l=(r||{})[n.attrPrefix+"xmlns"]||a.namespaceURI)?i.createElementNS(l,h):i.createElement(h),r instanceof Object?t(i,s,r):null===r||!0===r&&n.trueIsEmpty||s.appendChild(i.createTextNode(r.toString())),a.appendChild(s)}(s,s.documentElement||s,i),s},this.stringToXml=function(e){return i||(i=new t.DOMParser),i.parseFromString(e,"application/xml")},this.xmlToString=function(e){return void 0!==e.xml?e.xml:(new t.XMLSerializer).serializeToString(e)},this.stringToJs=function(t){var e=this.stringToXml(t);return this.xmlToJs(e)},this.jsToString=this.stringify=function(t,e,i,n){return this.xmlToString(this.jsToXml(t,e,i,n))},this.each=function(t,e,i){t instanceof Array?t.forEach(e,i):[t].forEach(e,i)}}},"object"==typeof i?"object"==typeof window&&window.DOMImplementation&&window.XMLSerializer&&window.DOMParser?e.exports=a(window):e.exports=a(t("xmldom"),!0):n.JXON=a(window)},{xmldom:3}],3:[function(t,e,i){},{}]},{},[1])(1)})),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).tokml=t()}}((function(){return function t(e,i,n){function a(r,s){if(!i[r]){if(!e[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(o)return o(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var d=i[r]={exports:{}};e[r][0].call(d.exports,(function(t){return a(e[r][1][t]||t)}),d,d.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)a(n[r]);return a}({1:[function(t,e,i){var n=t("xml-escape"),a=t("strxml").tag;function o(t,e){return function(i){if(!i.properties||!r.valid(i.geometry))return"";var o=r.any(i.geometry);if(!o)return"";var s="",d="";if(t.simplestyle){var c=function(t){var e="";t["marker-symbol"]&&(e=e+"ms"+t["marker-symbol"]);t["marker-color"]&&(e=e+"mc"+t["marker-color"].replace("#",""));t["marker-size"]&&(e=e+"ms"+t["marker-size"]);t.stroke&&(e=e+"s"+t.stroke.replace("#",""));t["stroke-width"]&&(e=e+"sw"+t["stroke-width"].toString().replace(".",""));t["stroke-opacity"]&&(e=e+"mo"+t["stroke-opacity"].toString().replace(".",""));t.fill&&(e=e+"f"+t.fill.replace("#",""));t["fill-opacity"]&&(e=e+"fo"+t["fill-opacity"].toString().replace(".",""));return e}(i.properties);c&&(r.isPoint(i.geometry)&&function(t){return!!(t["marker-size"]||t["marker-symbol"]||t["marker-color"])}(i.properties)?(-1===e.indexOf(c)&&(s=function(t,e){return a("Style",{id:e},a("IconStyle",a("Icon",a("href",function(t){var e=t["marker-size"]||"medium",i=t["marker-symbol"]?"-"+t["marker-symbol"]:"",n=(t["marker-color"]||"7e7e7e").replace("#","");return"https://api.tiles.mapbox.com/v3/marker/pin-"+e.charAt(0)+i+"+"+n+".png"}(t))))+a("hotSpot",{xunits:"fraction",yunits:"fraction",x:"0.5",y:"0.5"},""))}(i.properties,c),e.push(c)),d=a("styleUrl","#"+c)):(r.isPolygon(i.geometry)||r.isLine(i.geometry))&&function(t){for(var e in t)if({stroke:!0,"stroke-opacity":!0,"stroke-width":!0,fill:!0,"fill-opacity":!0}[e])return!0}(i.properties)&&(-1===e.indexOf(c)&&(s=function(t,e){var i=a("LineStyle",a("color",h(t.stroke,t["stroke-opacity"])||"ff555555")+a("width",{},void 0===t["stroke-width"]?2:t["stroke-width"])),n="";(t.fill||t["fill-opacity"])&&(n=a("PolyStyle",a("color",{},h(t.fill,t["fill-opacity"])||"88555555")));return a("Style",{id:e},i+n)}(i.properties,c),e.push(c)),d=a("styleUrl","#"+c)))}var u={};return i.id&&(u.id=i.id),s+a("Placemark",u,function(t,e){return t[e.name]?a("name",n(t[e.name])):""}(i.properties,t)+function(t,e){return t[e.description]?a("description",n(t[e.description])):""}(i.properties,t)+function(t){return a("ExtendedData",{},function(t){var e=[];for(var i in t)t[i]?e.push([i,t[i]]):e.push([i,""]);return e}(t).map(l).join(""))}(i.properties)+function(t,e){return t[e.timestamp]?a("TimeStamp",a("when",n(t[e.timestamp]))):""}(i.properties,t)+o+d)}}e.exports=function(t,e){return'<?xml version="1.0" encoding="UTF-8"?>'+a("kml",{xmlns:"http://www.opengis.net/kml/2.2"},a("Document",function(t){return void 0!==t.documentName?a("name",t.documentName):""}(e=e||{documentName:void 0,documentDescription:void 0,name:"name",description:"description",simplestyle:!1,timestamp:"timestamp"})+function(t){return void 0!==t.documentDescription?a("description",t.documentDescription):""}(e)+function(t,e){if(!t.type)return"";var i=[];switch(t.type){case"FeatureCollection":return t.features?t.features.map(o(e,i)).join(""):"";case"Feature":return o(e,i)(t);default:return o(e,i)({type:"Feature",geometry:t,properties:{}})}}(t,e)))};var r={Point:function(t){return a("Point",a("coordinates",t.coordinates.join(",")))},LineString:function(t){return a("LineString",a("coordinates",s(t.coordinates)))},Polygon:function(t){if(!t.coordinates.length)return"";var e=t.coordinates[0],i=t.coordinates.slice(1),n=a("outerBoundaryIs",a("LinearRing",a("coordinates",s(e)))),o=i.map((function(t){return a("innerBoundaryIs",a("LinearRing",a("coordinates",s(t))))})).join("");return a("Polygon",n+o)},MultiPoint:function(t){return t.coordinates.length?a("MultiGeometry",t.coordinates.map((function(t){return r.Point({coordinates:t})})).join("")):""},MultiPolygon:function(t){return t.coordinates.length?a("MultiGeometry",t.coordinates.map((function(t){return r.Polygon({coordinates:t})})).join("")):""},MultiLineString:function(t){return t.coordinates.length?a("MultiGeometry",t.coordinates.map((function(t){return r.LineString({coordinates:t})})).join("")):""},GeometryCollection:function(t){return a("MultiGeometry",t.geometries.map(r.any).join(""))},valid:function(t){return t&&t.type&&(t.coordinates||"GeometryCollection"===t.type&&t.geometries&&t.geometries.every(r.valid))},any:function(t){return r[t.type]?r[t.type](t):""},isPoint:function(t){return"Point"===t.type||"MultiPoint"===t.type},isPolygon:function(t){return"Polygon"===t.type||"MultiPolygon"===t.type},isLine:function(t){return"LineString"===t.type||"MultiLineString"===t.type}};function s(t){return t.map((function(t){return t.join(",")})).join(" ")}function l(t){return a("Data",{name:t[0]},a("value",{},n(t[1]?t[1].toString():"")))}function h(t,e){if("string"!=typeof t)return"";if(3===(t=t.replace("#","").toLowerCase()).length)t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2];else if(6!==t.length)return"";var i=t[0]+t[1],n=t[2]+t[3],a=t[4]+t[5],o="ff";return"number"==typeof e&&e>=0&&e<=1&&((o=(255*e).toString(16)).indexOf(".")>-1&&(o=o.substr(0,o.indexOf("."))),o.length<2&&(o="0"+o)),o+a+n+i}},{strxml:2,"xml-escape":3}],2:[function(t,e,i){var n=t("xml-escape");function a(t){return Object.keys(t).length?" "+Object.keys(t).map((function(e){return e+'="'+n(t[e])+'"'})).join(" "):""}e.exports.attr=a,e.exports.tagClose=function(t,e){return"<"+t+a(e)+"/>"},e.exports.tag=function(t,e,i){(Array.isArray(e)||"string"==typeof e)&&(i=e,e={});Array.isArray(i)&&(i="\n"+i.map((function(t){return"  "+t})).join("\n")+"\n");return"<"+t+a(e)+">"+i+"</"+t+">"}},{"xml-escape":3}],3:[function(t,e,i){(e.exports=function t(e,i){var n;if(null!=e)return i=(i||"").replace(/[^&"<>\']/g,""),n="([&\"<>'])".replace(new RegExp("["+i+"]","g"),""),e.replace(new RegExp(n,"g"),(function(e,i){return t.map[i]}))}).map={">":"&gt;","<":"&lt;","'":"&apos;",'"':"&quot;","&":"&amp;"}},{}]},{},[1])(1)}));var waymark_js_localize={action_fullscreen_activate:"View Fullscreen",action_fullscreen_deactivate:"Exit Fullscreen",action_locate_activate:"Show me where I am",action_zoom_in:"Zoom in",action_zoom_out:"Zoom out",label_total_length:"Total Length: ",label_max_elevation:"Max. Elevation: ",label_min_elevation:"Min. Elevation: ",add_line_title:"Draw a Line",add_photo_title:"Upload an Image",add_marker_title:"Place a Marker",add_rectangle_title:"Draw a Rectangle",add_polygon_title:"Draw a Polygon",add_circle_title:"Draw a Circle",upmap_file_title:"Read Lines and Markers from file (GPX/KML/GeoJSON supported, which most apps should Export to)",action_duplicate:"Duplicate",action_delete:"Delete",action_edit:"Edit",action_edit_done:"Finish editing",action_upload_image:"Upload Image",object_title_placeholder:"Title",object_image_placeholder:"Image URL",object_description_placeholder:"Description",object_type_label:"Type",marker_latlng_label:"Lat,Lng",action_delete_confirm:"Are you sure you want to delete this",action_search_placeholder:"Search...",object_label_marker:"Marker",object_label_line:"Line",object_label_shape:"Shape",object_label_marker_plural:"Markers",object_label_line_plural:"Lines",object_label_shape_plural:"Shapes",error_message_prefix:"Waymark Error",info_message_prefix:"Waymark Info",error_file_type:"This file type is not supported.",error_file_conversion:"Could not convert this file to GeoJSON.",error_file_upload:"File upload error.",error_photo_meta:"Could not retrieve Image metadata.",info_exif_yes:"Image location metadata (EXIF) detected!",info_exif_no:"Image location metadata (EXIF) NOT detected.",error_no_wpmedia:"WordPress Media Library not found.",error_no_container:"Map container not found."};if(void 0===waymark_js)var waymark_js={lang:{}};for(key in waymark_js_localize)void 0===waymark_js.lang[key]&&(waymark_js.lang[key]=waymark_js_localize[key]);function Waymark_Map(){this.fallback_latlng=[51.38436,-68.74923],this.fallback_zoom=9,this.init=function(t){for(config_key in Waymark=this,Waymark.mode="view",Waymark.config={map_div_id:"waymark-map",map_options:{show_type_labels:1,button_position:"bottomright"},map_height:400,map_width:null,map_init_zoom:void 0,map_init_latlng:void 0,map_init_basemap:void 0,show_gallery:0,show_filter:0,show_elevation:0,elevation_div_id:"waymark-elevation",elevation_units:"metric",elevation_initial:1,tile_layers:{},line_types:{},shape_types:{},marker_types:{},marker_data_defaults:{title:void 0,type:void 0,image_thumbnail_url:void 0,image_medium_url:void 0,image_large_url:void 0,description:void 0},line_data_defaults:{type:void 0,title:void 0,image_thumbnail_url:void 0,image_medium_url:void 0,image_large_url:void 0,description:void 0},shape_data_defaults:{type:void 0,title:void 0,image_thumbnail_url:void 0,image_medium_url:void 0,image_large_url:void 0,description:void 0},editor_options:{confirm_delete:1},handle_content_callback:void 0,handle_delete_callback:void 0,handle_edit_callback:void 0,handle_custom_type_callback:void 0,media_library_sizes:["thumbnail","medium","large","full"]},Waymark.config)void 0!==t[config_key]&&(Waymark.config[config_key]=t[config_key]);if(Waymark.jq_map_container=jQuery("#"+Waymark.config.map_div_id),!Waymark.jq_map_container.length)return Waymark.debug(waymark_js.lang.error_no_container),!1;var e=Waymark.get_type("line"),i=Waymark.make_key(e.line_title);Waymark.config.line_data_defaults.type=i;var n=Waymark.get_type("shape"),a=Waymark.make_key(n.shape_title);Waymark.config.shape_data_defaults.type=a;var o=Waymark.get_type("marker"),r=Waymark.make_key(o.marker_title);Waymark.config.marker_data_defaults.type=r,Waymark.marker_parent_group=Waymark_L.layerGroup(),Waymark.marker_sub_groups={},Waymark.line_parent_group=Waymark_L.layerGroup(),Waymark.line_sub_groups={},Waymark.shape_parent_group=Waymark_L.layerGroup(),Waymark.shape_sub_groups={},Waymark.setup_map(),Waymark.handle_resize(),Waymark.init_done()},this.get_property=function(t,...e){return e.reduce((t,e)=>t&&t[e],t)},this.debug=function(t){1==this.get_property(waymark_settings,"misc","advanced","debug_mode")&&("string"==typeof t?console.log("["+waymark_js.lang.info_message_prefix+"] "+t):(console.log("["+waymark_js.lang.info_message_prefix+"] ..."),console.log(t)))},this.message=function(t=null,e="info"){if(t){var i="";switch(e){case"error":i=waymark_js.lang.error_message_prefix;break;default:case"info":i=waymark_js.lang.info_message_prefix}i&&(i="["+i+"] "),alert(i+t)}},this.title_case=function(t){return t.replace(/(?:^|\s)\w/g,(function(t){return t.toUpperCase()}))},this.transliterate=function(t){var e={"Ё":"YO","Й":"I","Ц":"TS","У":"U","К":"K","Е":"E","Н":"N","Г":"G","Ш":"SH","Щ":"SCH","З":"Z","Х":"H","Ъ":"'","ё":"yo","й":"i","ц":"ts","у":"u","к":"k","е":"e","н":"n","г":"g","ш":"sh","щ":"sch","з":"z","х":"h","ъ":"'","Ф":"F","Ы":"I","В":"V","А":"a","П":"P","Р":"R","О":"O","Л":"L","Д":"D","Ж":"ZH","Э":"E","ф":"f","ы":"i","в":"v","а":"a","п":"p","р":"r","о":"o","л":"l","д":"d","ж":"zh","э":"e","Я":"Ya","Ч":"CH","С":"S","М":"M","И":"I","Т":"T","Ь":"'","Б":"B","Ю":"YU","я":"ya","ч":"ch","с":"s","м":"m","и":"i","т":"t","ь":"'","б":"b","ю":"yu"};return t.split("").map((function(t){return e[t]||t})).join("")},this.make_key=function(t){return t?t=(t=(t=this.transliterate(t)).replace(/[^a-z0-9+]+/gi,"")).toLowerCase():t},this.make_hash=function(t){for(var e=0,i=0;i<t.length;i++){e=(e<<5)-e+t.charCodeAt(i),e&=e}return(e=e+2147483647+1).toString()},this.get_feature_overlay_type=function(t){if(void 0===t.geometry.type)return!1;switch(t.geometry.type){case"Point":return t.properties.radius?"shape":"marker";case"LineString":case"MultiLineString":return"line";case"Polygon":return"shape"}return!1},this.setup_map=function(){Waymark=this,Waymark.jq_map_container.addClass("waymark-map-container"),Waymark.jq_map_container.css("height",Waymark.config.map_height+"px"),Waymark.config.map_width=Waymark.jq_map_container.width(),Waymark.map=Waymark_L.map(Waymark.config.map_div_id,{fullscreenControl:!1,attributionControl:!1,editable:!0,zoomControl:!1,wakeTime:2e3,sleepNote:!1,sleepOpacity:1}),Waymark_L.control.attribution({prefix:'<a href="https://wordpress.org/plugins/waymark" title="Share your way">Waymark</a> | <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'}).addTo(Waymark.map),Waymark.jq_map_container.data("Waymark",Waymark),void 0!==Waymark.config.map_init_latlng?Waymark.map.setView(Waymark.config.map_init_latlng):Waymark.map.setView(Waymark.fallback_latlng),void 0!==Waymark.config.map_init_zoom?Waymark.map.setZoom(Waymark.config.map_init_zoom):Waymark.map.setZoom(Waymark.fallback_zoom),Waymark_L.Path.mergeOptions({color:"#b42714"}),Waymark_L.control.zoom({position:Waymark.config.map_options.button_position,zoomInTitle:waymark_js.lang.action_zoom_in,zoomOutTitle:waymark_js.lang.action_zoom_out}).addTo(Waymark.map),Waymark_L.control.locate({position:"bottomright",icon:"ion ion-android-locate",drawCircle:!1,strings:{title:waymark_js.lang.action_locate_activate},locateOptions:{enableHighAccuracy:!0}}).addTo(Waymark.map),Waymark_L.control.fullscreen({position:Waymark.config.map_options.button_position,title:{false:waymark_js.lang.action_fullscreen_activate,true:waymark_js.lang.action_fullscreen_deactivate}}).addTo(Waymark.map),Waymark.marker_parent_group.addTo(Waymark.map),Waymark.line_parent_group.addTo(Waymark.map),Waymark.shape_parent_group.addTo(Waymark.map),Waymark.setup_layers(),Waymark.create_data_layers(),Waymark.create_buttons()},this.setup_map_data_feature=function(t,e){switch(Waymark=this,t.geometry.type){case"Point":if(t.properties.radius){t.properties=Waymark.parse_layer_data("shape",t.properties);var i=Waymark.get_type("shape",t.properties.type);e.setStyle({color:i.shape_colour,fillOpacity:i.fill_opacity}),Waymark.info_window("shape",t,e),Waymark.tooltip("shape",t,e),Waymark.add_to_group("shape",e)}else{t.properties=Waymark.parse_layer_data("marker",t.properties);i=Waymark.get_type("marker",t.properties.type);e.setIcon(L.divIcon(Waymark.build_icon_data(i))),void 0!==Waymark.gallery_images&&Waymark.add_to_gallery(e),Waymark.info_window("marker",t,e),Waymark.tooltip("marker",t,e),Waymark.add_to_group("marker",e)}break;case"LineString":case"MultiLineString":t.properties=Waymark.parse_layer_data("line",t.properties);i=Waymark.get_type("line",t.properties.type);e.setStyle({color:i.line_colour,weight:i.line_weight,opacity:"0.7"}),Waymark.info_window("line",t,e),Waymark.tooltip("line",t,e),Waymark.add_to_group("line",e);break;case"Polygon":t.properties=Waymark.parse_layer_data("shape",t.properties),t.properties.rectangle;i=Waymark.get_type("shape",t.properties.type);e.setStyle({color:i.shape_colour,fillOpacity:i.fill_opacity}),Waymark.info_window("shape",t,e),Waymark.tooltip("shape",t,e),Waymark.add_to_group("shape",e)}},this.create_data_layers=function(){Waymark=this,Waymark.map_data=Waymark_L.geoJSON(null,{pointToLayer:function(t,e){return void 0!==t.properties&&t.properties.radius?new Waymark_L.Circle(e,parseFloat(t.properties.radius)):Waymark.create_marker(e)},onEachFeature:function(t,e){Waymark.setup_map_data_feature(t,e)}}),Waymark.queries_data=[],Waymark.query_data_group=new Waymark_L.featureGroup},this.setup_layers=function(){Waymark=this,Waymark.layer_control=Waymark_L.control.layers();var t=[],e=0;if(void 0!==Waymark.config.map_init_basemap)for(i in Waymark.config.tile_layers){Waymark.config.map_init_basemap.toUpperCase()===Waymark.config.tile_layers[i].layer_name.toUpperCase()&&(e=i)}for(i in Waymark.config.tile_layers){void 0!==Waymark.config.tile_layers[i].append&&(Waymark.config.tile_layers[i].layer_url+=Waymark.config.tile_layers[i].append);var n=Waymark.config.tile_layers[i].layer_name.replace(/ /g,""),a=Waymark_L.tileLayer(Waymark.config.tile_layers[i].layer_url,{id:n,attribution:Waymark.config.tile_layers[i].layer_attribution});t[Waymark.config.tile_layers[i].layer_name]=a,i==e&&a.addTo(Waymark.map)}if(i>=1)for(basemap_name in Waymark.layer_control.addTo(Waymark.map),t)Waymark.layer_control.addBaseLayer(t[basemap_name],basemap_name)},this.get_type=function(t,e){Waymark=this;var n=null;for(i in Waymark.config[t+"_types"]){0==i&&(n=Waymark.config[t+"_types"][i]);var a=Waymark.config[t+"_types"][i][t+"_title"];a&&Waymark.make_key(e)==Waymark.make_key(a)&&(n=Waymark.config[t+"_types"][i])}return n=Waymark.parse_type(n,t)},this.parse_type=function(t,e){if(Waymark=this,"object"!=typeof t)return t;switch(e){case"line":var n=[{key:"line_colour",default:"#b42714"},{key:"line_weight",default:"3"}];for(i in n)"string"!=typeof t[n[i].key]&&(t[n[i].key]=n[i].default)}return t.type_key=Waymark.make_key(t[e+"_title"]),t},this.handle_resize=function(){Waymark=this,jQuery(window).on("resize",(function(){Waymark.config.map_height=Waymark.jq_map_container.height(),Waymark.config.map_width=Waymark.jq_map_container.width(),"function"==typeof Waymark.size_gallery&&Waymark.size_gallery()}))},this.tooltip=function(t,e,i){Waymark=this;var n="";if("1"==Waymark.config.map_options.show_type_labels){var a=Waymark.get_type(t,e.properties.type);if(a){var o=a[t+"_title"];o&&(n="["+o+"] ")}}e.properties.title&&(n+=e.properties.title),n&&(i.bindTooltip(n),i.on("mouseover",(function(t){var e=t.target.getTooltip();e.setLatLng(t.latlng),e.openTooltip()})),i.on("mousemove",(function(t){t.target.getTooltip().setLatLng(t.latlng)})))},this.get_data_defaults=function(t){return Object.assign({},Waymark.config[t+"_data_defaults"])},this.parse_layer_data=function(t,e){Waymark=this;var i=Waymark.get_data_defaults(t);if("object"==typeof e)for(key in i)void 0!==e[key]&&e[key]&&(i[key]=e[key]);for(key in e)if(e[key])switch(key){case"osm_id":i.osm_id=e[key];break;case"name":i.title=e[key];break;case"desc":case"notes":i.description=e[key];break;case"radius":i[key]=parseFloat(e[key])}return i},this.add_to_group=function(t,e){var i=e.feature;if(void 0!==i.properties.type){var n=i.properties.type,a=Waymark.get_type(t,n);if(void 0===Waymark[t+"_sub_groups"][a.type_key]){var o=Waymark_L.featureGroup.subGroup(Waymark[t+"_parent_group"]);Waymark[t+"_sub_groups"][a.type_key]=o,"view"==Waymark.mode&&void 0!==a[t+"_display"]?"1"==a[t+"_display"]&&o.addTo(Waymark.map):o.addTo(Waymark.map)}if(e.addTo(Waymark[t+"_sub_groups"][a.type_key]),Waymark.config.show_filter&&"view"==Waymark.mode)for(key in Waymark.layer_control.addTo(Waymark.map),Waymark.layer_control.removeLayer(Waymark[t+"_parent_group"]),Waymark.layer_control.addOverlay(Waymark[t+"_parent_group"],"<b>"+waymark_js_localize["object_label_"+t+"_plural"]+"</b>"),Waymark_L.stamp(Waymark[t+"_parent_group"]),Waymark[t+"_sub_groups"]){var r=Waymark.get_type(t,key);o=Waymark[t+"_sub_groups"][key];Waymark.layer_control.removeLayer(o),Waymark.layer_control.addOverlay(o,Waymark.type_to_text(t,r))}}else e.addTo(Waymark[t+"_parent_group"])},this.type_to_text=function(t,e,i="span"){var n="waymark-type-text waymark-"+t+"-type",a="";switch(t){case"marker":a+="color:"+e.icon_colour+";",a+="background:"+Waymark.get_marker_background(e.marker_colour);break;case"line":a+="color:"+e.line_colour+";box-shadow:inset 0 0 0 1px "+e.line_colour;break;case"shape":a+="background:"+e.shape_colour}return"<"+i+' class="'+n+'" style="'+a+'">'+e[t+"_title"]+"</"+i+">"},this.create_marker=function(t,e={}){return Waymark_L.marker(t,e)},this.build_icon_data=function(t){var e={className:"waymark-marker waymark-marker-"+t.type_key};if(void 0!==t.marker_shape&&void 0!==t.marker_size){switch(e.className+=" waymark-marker-"+t.marker_shape,e.className+=" waymark-marker-"+t.marker_size,t.marker_shape){case"rectangle":case"circle":case"marker":switch(t.marker_size){case"small":e.iconSize=[16,16];break;case"medium":e.iconSize=[25,25];break;default:case"large":e.iconSize=[32,32]}}"marker"==t.marker_shape&&(e.iconAnchor=[e.iconSize[0]/2,1.25*e.iconSize[1]])}var i="background:"+Waymark.get_marker_background(t.marker_colour)+";",n="color:"+t.icon_colour+";";e.html='<div class="waymark-marker-background" style="'+i+'"></div>';var a="waymark-marker-icon";switch(t.icon_type){case"text":a+=" waymark-icon-text",e.html+='<div style="'+n+'" class="'+a+'">'+t.marker_icon+"</div>";break;case"html":a+=" waymark-icon-html";var o=jQuery("<div/>").html(t.marker_icon).text();e.html+='<div class="'+a+'">'+o+"</div>";break;case"icon":default:a+=" waymark-icon-icon",0===t.marker_icon.indexOf("ion-")?(a+=" ion ",a+=" "+t.marker_icon):0===t.marker_icon.indexOf("fa-")?(a+=" fa",a+=" "+t.marker_icon):(a+=" ion",a+=" ion-"+t.marker_icon),e.html+='<i style="'+n+'" class="'+a+'"></i>'}return e},this.get_marker_background=function(t){if(["red","darkred","orange","green","darkgreen","blue","purple","darkpurple","cadetblue","white","black"].includes(t))switch(t){case"red":return"#da3d20";case"darkred":return"#a43233";case"orange":return"#f9960a";case"green":return"#70af00";case"darkgreen":return"#72820d";case"blue":return"#2aabe1";case"purple":return"#d553bd";case"darkpurple":return"#5c3a6e";case"cadetblue":return"#416979";case"white":return"#fbfbfb";case"black":return"#303030"}return t},this.create_marker_json=function(t,e={}){var i=Object.assign({},Waymark.config.marker_data_defaults,e);return{geometry:{type:"Point",coordinates:[t.lng,t.lat]},type:"Feature",properties:i}},this.get_exif_latlng=function(t){return t.GPSLatitudeNum&&!isNaN(t.GPSLatitudeNum)&&t.GPSLongitudeNum&&!isNaN(t.GPSLongitudeNum)?(Waymark.debug(waymark_js.lang.info_exif_yes),L.latLng(t.GPSLatitudeNum,t.GPSLongitudeNum)):(Waymark.debug(waymark_js.lang.info_exif_no),!1)},this.get_image_sizes=function(t,e){Waymark=this;var n={};for(i in Waymark.config.media_library_sizes)n["image_"+Waymark.config.media_library_sizes[i]+"_url"]=e,void 0!==t[Waymark.config.media_library_sizes[i]]&&void 0!==t[Waymark.config.media_library_sizes[i]].url&&(n["image_"+Waymark.config.media_library_sizes[i]+"_url"]=t[Waymark.config.media_library_sizes[i]].url);return n},this.polygon_array_to_string=function(t,e=",",n=" "){if("object"==typeof t){t=t.flat();for(i in t)t[i]=t[i].lat+n+t[i].lng;return t.join(e)}},this.string_to_polygon_array=function(t,e=",",n=" "){if("string"==typeof t&&-1!=t.indexOf(e)&&-1!=t.indexOf(n)){Waymark=this;var a=t.split(e);for(i in a)a[i]=Waymark.string_to_latlng_array(a[i]," ");return a}},this.latlng_to_string=function(t,e=","){if("object"==typeof t){if(void 0!==typeof t.lat&&void 0!==typeof t.lat)return t.lat+e+t.lng;if(void 0!==typeof t[0]&&void 0!==typeof t[1])return t[0]+e+t[1]}},this.string_to_latlng_array=function(t,e=","){if("string"==typeof t){var i=t.split(e);return 2==i.length?i:null}},this.string_to_bounds_array=function(t,e=","){if("string"==typeof t){var i=t.split(e);if(4==i.length)return[[i[1],i[0]],[i[3],i[2]]]}},this.bounds_to_string=function(t){if("object"==typeof t&&"function"==typeof t.toBBoxString)return t.toBBoxString()},this.draw_latlng_selector=function(t){if(Waymark=this,Waymark.undraw_selectors(),t){var e=t.val();if(e){var i=Waymark.string_to_latlng_array(e);if("object"==typeof i){var n=Waymark.get_type("marker");Waymark.latlng_selector_layer=Waymark.create_marker(i,{draggable:!0,icon:L.divIcon(Waymark.build_icon_data(n))}),Waymark.latlng_selector_layer.addTo(Waymark.map),Waymark.latlng_selector_layer.on("dragend",(function(e){var i=e.target.getLatLng();t.val(Waymark.latlng_to_string(i))}))}}}},this.get_default_bounds=function(){return Waymark=this,Waymark.map.getBounds().pad(-.1)},this.is_bounds_editing=function(){return void 0!==Waymark.bounds_selector_edit_active&&1==Waymark.bounds_selector_edit_active},this.draw_bounds_selector=function(t,e){if(Waymark=this,!Waymark.is_bounds_editing()&&(Waymark.undraw_selectors(),"string"==typeof t&&"string"==typeof e)){switch(Waymark.bounds_selector_edit_active=!1,t){case"bounds":if("object"!=typeof(i=Waymark.string_to_bounds_array(e))||!i)var i=Waymark.get_default_bounds();Waymark.bounds_selector_layer=L.rectangle(i,{color:"red",weight:1}).addTo(Waymark.map);break;case"polygon":if("object"!=typeof(i=Waymark.string_to_polygon_array(e))||!i){i=Waymark.get_default_bounds();i=Waymark.latlng_bounds_to_latlng_array(i)}Waymark.bounds_selector_layer=L.polygon(i,{color:"blue",weight:1}).addTo(Waymark.map)}if("object"==typeof i)return Waymark.map.fitBounds(i),Waymark.bounds_selector_layer}},this.edit_bounds_selector=function(){Waymark=this,Waymark.is_bounds_editing()&&Waymark.unedit_bounds_selector(),"object"==typeof Waymark.bounds_selector_layer&&(Waymark.bounds_selector_edit_active=!0,Waymark.bounds_selector_layer.enableEdit())},this.unedit_bounds_selector=function(){Waymark=this,Waymark.bounds_selector_edit_active=!1,void 0!==Waymark.bounds_selector_layer&&Waymark.bounds_selector_layer&&Waymark.bounds_selector_layer.disableEdit()},this.undraw_selectors=function(){Waymark=this,Waymark.is_bounds_editing()||(Waymark.unedit_bounds_selector(),void 0!==Waymark.latlng_selector_layer&&Waymark.latlng_selector_layer&&(Waymark.map.removeLayer(Waymark.latlng_selector_layer),Waymark.latlng_selector_layer=null),void 0!==Waymark.bounds_selector_layer&&Waymark.bounds_selector_layer&&(Waymark.bounds_selector_layer.disableEdit(),Waymark.map.removeLayer(Waymark.bounds_selector_layer),Waymark.bounds_selector_layer=null))},this.latlng_bounds_to_latlng_array=function(t){Waymark=this;var e=t.getCenter(),i=[];return i.push(t.getSouthWest()),i.push({lat:t.getSouth(),lng:e.lng}),i.push(t.getSouthEast()),i.push({lat:e.lat,lng:t.getEast()}),i.push(t.getNorthEast()),i.push({lat:t.getNorth(),lng:Waymark.map.getCenter().lng}),i.push(t.getNorthWest()),i.push({lat:Waymark.map.getCenter().lat,lng:t.getWest()}),i},this.setup_query_data_feature=function(t,e){switch(Waymark=this,t.geometry.type){case"Point":if(t.properties.radius){t.properties=Waymark.parse_layer_data("shape",t.properties);var i=Waymark.get_type("shape",t.properties.type);e.setStyle({color:i.shape_colour,fillOpacity:i.fill_opacity}),Waymark.info_window("shape",t,e,"query_data"),Waymark.tooltip("shape",t,e),Waymark.add_to_group("shape",e)}else{t.properties=Waymark.parse_layer_data("marker",t.properties);i=Waymark.get_type("marker",t.properties.type);e.setIcon(L.divIcon(Waymark.build_icon_data(i))),void 0!==Waymark.gallery_images&&Waymark.add_to_gallery(e),Waymark.info_window("marker",t,e,"query_data"),Waymark.tooltip("marker",t,e),Waymark.add_to_group("marker",e)}break;case"LineString":case"MultiLineString":t.properties=Waymark.parse_layer_data("line",t.properties);i=Waymark.get_type("line",t.properties.type);e.setStyle({color:i.line_colour,weight:i.line_weight,opacity:"0.7"}),Waymark.info_window("line",t,e,"query_data"),Waymark.tooltip("line",t,e),Waymark.add_to_group("line",e);break;case"Polygon":t.properties=Waymark.parse_layer_data("shape",t.properties),t.properties.rectangle;i=Waymark.get_type("shape",t.properties.type);e.setStyle({color:i.shape_colour,fillOpacity:i.fill_opacity}),Waymark.info_window("shape",t,e,"query_data"),Waymark.tooltip("shape",t,e),Waymark.add_to_group("shape",e)}},this.init_done=function(){},this.info_window=function(t,e,i){},this.build_content=function(t,e){}}function Waymark_Map_Viewer(){this.gallery_images=[],this.init_done=function(){Waymark=this,Waymark.setup_gallery(),Waymark.setup_elevation(),jQuery(Waymark.map.getContainer()).addClass("waymark-is-viewer")},this.create_buttons=function(){},this.load_json=function(t,e=!0){if(Waymark=this,"object"==typeof t&&void 0!==t.features&&(Waymark.map_data.addData(t),e))if(void 0===Waymark.config.map_init_latlng&&void 0===Waymark.config.map_init_zoom){var i=Waymark.map_data.getBounds();i.isValid()&&Waymark.map.fitBounds(i)}else void 0!==Waymark.config.map_init_latlng&&void 0!==Waymark.config.map_init_zoom?Waymark.map.setView(Waymark.config.map_init_latlng,Waymark.config.map_init_zoom):(void 0!==Waymark.config.map_init_latlng&&(Waymark.map.setView(Waymark.config.map_init_latlng),Waymark.map.setZoom(Waymark.map.getBoundsZoom(Waymark.map_data.getBounds()))),void 0!==Waymark.config.map_init_zoom&&(Waymark.map.setZoom(Waymark.config.map_init_zoom),Waymark.map.setView(Waymark.map_data.getBounds().getCenter())))},this.build_content=function(t,e){Waymark=this;var i=jQuery("<div />"),n=jQuery("<ul />").addClass("waymark-info waymark-"+t+"-info");for(key in Waymark.config[t+"_data_defaults"]){var a=null;switch(key){case"title":e.properties.title?a=jQuery("<strong />").html(e.properties.title):(a=jQuery("<strong />").html("&nbsp;"),n.addClass("waymark-no-title"));break;case"type":if("1"!=Waymark.config.map_options.show_type_labels)break;var o=Waymark.get_type(t,e.properties.type);o&&(a=Waymark.type_to_text(t,o,"small"));break;case"description":var r=e.properties.description;r?a=0===r.indexOf("<")?r:jQuery("<p />").html(r):n.addClass("waymark-no-description");break;case"image_large_url":if(void 0!==e.properties.image_large_url){var s=e.properties.image_large_url;if(void 0!==e.properties.image_medium_url)s=e.properties.image_medium_url;a=jQuery("<a />").attr({href:e.properties.image_large_url,target:"_blank",style:"background-image:url("+s+")"})}else n.addClass("waymark-no-image")}a&&n.append(jQuery("<li />").addClass("waymark-info-"+key+" waymark-"+t+"-info-"+key).append(a))}return n.children().length&&i.append(n),i},this.info_window=function(t,e,i){if(Waymark=this,Waymark.config.show_elevation&&"line"==t&&(Waymark.config.elevation_initial&&Waymark.line_has_elevation_data(e)&&!Waymark.elevation_container.is(":visible")&&(Waymark.elevation_container.show(),Waymark.elevation_control.loadData(e)),i.on("click",(function(t){var e=t.target.feature;Waymark.elevation_control.clear(),void 0!==Waymark.elevation_control.layer&&Waymark.elevation_control.layer.removeFrom(Waymark.map),Waymark.elevation_container.hide(),Waymark.line_has_elevation_data(e)&&(Waymark.elevation_container.show(),Waymark.elevation_control.loadData(e))}))),void 0!==e.properties.description||void 0!==e.properties.image_large_url){var n=Waymark.build_content(t,e,i),a=e.properties.title;"function"==typeof Waymark.config.handle_content_callback?i.on("click",(function(){Waymark.config.handle_content_callback(n.get(0),a,Waymark.mode)})):i.bindPopup(n.get(0)).openPopup()}},this.line_has_elevation_data=function(t){if("MultiLineString"==t.geometry.type){for(i in t.geometry.coordinates)for(j in t.geometry.coordinates[i])if(3==t.geometry.coordinates[i][j].length)return!0}else for(j in t.geometry.coordinates)if(3==t.geometry.coordinates[i].length)return!0;return!1},this.setup_elevation=function(){if(Waymark=this,Waymark.config.show_elevation){Waymark_L.registerLocale("waymark",{"Total Length: ":waymark_js.lang.label_total_length,"Max Elevation: ":waymark_js.lang.label_max_elevation,"Min Elevation: ":waymark_js.lang.label_min_elevation}),Waymark_L.setLocale("waymark");var t={theme:"magenta-theme",detached:!0,followMarker:!1,width:Waymark.config.map_width};if(void 0!==Waymark.config.elevation_div_id){t.elevationDiv="#"+Waymark.config.elevation_div_id,Waymark.elevation_container=jQuery(t.elevationDiv),Waymark.elevation_container.hide();var e=jQuery("<span />").addClass("waymark-elevation-close").text("x").on("click",{W:Waymark},(function(t){var e=t.data.W;e.elevation_control.clear(),e.elevation_control.layer.removeFrom(e.map),e.elevation_container.hide()}));Waymark.elevation_container.append(e)}void 0!==Waymark.config.elevation_units&&"imperial"==Waymark.config.elevation_units&&(t.imperial=!0),Waymark.elevation_control=Waymark_L.control.elevation(t).addTo(Waymark.map)}},this.setup_gallery=function(){if(Waymark=this,Waymark.config.show_gallery){Waymark.gallery=jQuery("<div />").attr("id",Waymark.config.gallery_div_id).css("width",Waymark.config.map_width).addClass("waymark-gallery-container").html(""),Waymark_L.DomEvent.disableClickPropagation(Waymark.gallery.get(0)),jQuery(Waymark.map.getContainer()).append(Waymark.gallery),Waymark.size_gallery();var t=Waymark;Waymark.map.on("moveend",(function(){t.render_gallery()}),{W:t}),Waymark.map.on("layerremove layeradd",(function(){t.render_gallery()}),{W:t})}},this.size_gallery=function(){if(Waymark=this,void 0!==Waymark.gallery&&Waymark.gallery.length){gallery_padding=Waymark.gallery.css("paddingRight"),gallery_padding=gallery_padding.replace("px",""),gallery_padding=parseInt(gallery_padding);var t=Waymark.config.map_width-2*gallery_padding;Waymark.gallery.css("width",t)}},this.add_to_gallery=function(t){if(Waymark=this,void 0===t.feature.properties.image_thumbnail_url||void 0===t.feature.properties.image_large_url)return!1;var e=Object.assign({},t.feature.properties);e.latlng=t.feature.geometry.coordinates,e.marker=t,Waymark.gallery_images.push(e)},this.render_gallery=function(){Waymark=this;var t=0;if(void 0!==Waymark.gallery&&Waymark.gallery.length&&(Waymark.gallery.html(""),Waymark.gallery.hide(),jQuery(Waymark.map.getContainer()).removeClass("waymark-has-gallery"),Waymark.gallery_images.length)){for(i=0;i<Waymark.gallery_images.length;i++){var e=Waymark.gallery_images[i];if(Waymark.map.getBounds().contains(e.marker.getLatLng())&&Waymark.map.hasLayer(e.marker)){t++;var n=jQuery("<div />").addClass("waymark-image").on("click",{marker:e.marker},(function(t){t.data.marker.openPopup()})),a=jQuery("<img />").attr({src:e.image_thumbnail_url});n.append(a),Waymark.gallery.append(n)}}t&&(Waymark.gallery.show(),jQuery(Waymark.map.getContainer()).addClass("waymark-has-gallery"))}},this.load_query_json=function(t,e=1){Waymark=this,"object"==typeof t&&(Waymark.queries_data[e]=Waymark_L.geoJSON(null,{pointToLayer:function(t,e){return Waymark.create_marker(e,{draggable:!1})},onEachFeature:function(t,e){Waymark.setup_query_data_feature(t,e)}}),Waymark.queries_data[e].addData(t),Waymark.queries_data[e].addTo(Waymark.map))}}function Waymark_Map_Editor(){this.init_done=function(){Waymark=this,Waymark.mode="edit",jQuery(Waymark.map.getContainer()).addClass("waymark-is-editor"),Waymark.jq_map_container.append(jQuery("<div />").attr({id:"waymark-loading"}).html('<div class="waymark-spinner"></div>')),Waymark.map.on("editable:drawing:commit",(function(t){switch(layer=t.layer,void 0===layer.feature&&(layer.feature={type:"Feature",properties:{}}),!0){case layer instanceof Waymark_L.Circle:layer.feature.properties=Waymark.config.shape_data_defaults,layer.feature.properties.radius=layer.getRadius();break;case layer instanceof Waymark_L.Rectangle:layer.feature.properties=Waymark.config.shape_data_defaults,layer.feature.properties.rectangle=!0;break;case layer instanceof Waymark_L.Polygon:layer.feature.properties=Waymark.config.shape_data_defaults;break;case layer instanceof Waymark_L.Polyline:layer.feature.properties=Waymark.config.line_data_defaults}Waymark.map_data.addData(layer.toGeoJSON()),Waymark.map.removeLayer(layer),Waymark.save_data_layer(),Waymark.map_was_edited()})),Waymark.map.on("editable:editing",(function(t){layer=t.layer,void 0!==layer.feature&&layer.feature.properties.radius&&(layer.feature.properties.radius=layer.getRadius()),Waymark.save_data_layer(),Waymark.map_was_edited()})),Waymark.map.on("popupopen",(function(t){var e=t.popup._source.feature;setTimeout((function(){wp.editor.initialize("waymark-info-description",{tinymce:{toolbar1:"styleselect | bullist numlist | link image",setup:function(t){t.on("change",(function(t){e.properties.description=wp.editor.getContent("waymark-info-description"),Waymark.save_data_layer(),Waymark.map_was_edited()}))}}})}),250)})),Waymark.map.on("popupclose",(function(t){wp.editor.remove("waymark-info-description"),jQuery("#waymark-info-description").show()}))},this.create_marker=function(t,e={draggable:!0}){Waymark=this;var i=Waymark_L.marker(t,e);return void 0!==e.draggable&&1==e.draggable&&i.on("moveend",(function(t){var e=t.target,i=e.feature;i.geometry.coordinates=[e._latlng.lng.toFixed(6),e._latlng.lat.toFixed(6)],Waymark.info_window("marker",i,e),Waymark.save_data_layer(),Waymark.map_was_edited()})),i},this.save_data_layer=function(){Waymark=this;var t=jQuery(".waymark-input-map_data").first(),e=JSON.stringify(Waymark.map_data.toGeoJSON());t.html(e);var i=jQuery(".waymark-input-map_data_bounds").first();if(i&&Waymark.map_data.getBounds().isValid()){var n=Waymark.map_data.getBounds();i.html(n.toBBoxString())}},this.map_was_edited=function(){},this.loading_start=function(){Waymark=this,Waymark.jq_map_container.addClass("waymark-loading")},this.loading_stop=function(){Waymark=this,Waymark.jq_map_container.removeClass("waymark-loading")},this.create_buttons=function(){Waymark=this;var t=Waymark_L.Control.geocoder({position:"bottomright",defaultMarkGeocode:!1,placeholder:waymark_js.lang.action_search_placeholder});t.on("markgeocode",(function(t){Waymark.map.fitBounds(t.geocode.bbox)})),t.addTo(Waymark.map);var e=Waymark_L.Control.extend({options:{position:"bottomleft"},onAdd:function(t){var e=Waymark_L.DomUtil.create("div","leaflet-bar leaflet-control waymark-leaflet-control waymark-edit-toolbar");if((n=Waymark_L.DomUtil.create("a","waymark-icon waymark-edit-button waymark-edit-line",e)).setAttribute("title",waymark_js.lang.add_line_title),n.onclick=function(){Waymark.map.editTools.startPolyline()},(n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-image",e)).innerHTML='<i class="ion ion-image"></i>',n.setAttribute("title",waymark_js.lang.add_photo_title),n.onclick=function(){if(void 0!==wp.media)return wp.media.editor.send.attachment=function(t,e){if(Waymark.debug(e),void 0===e.url)return!1;var i=new FormData;i.append("waymark_security",waymark_security),i.append("action","waymark_get_attatchment_meta"),i.append("attachment_id",e.id),jQuery.ajax({type:"POST",url:waymark_js.ajaxurl,data:i,dataType:"json",processData:!1,contentType:!1,success:function(t){if(Waymark.debug(t),null!==t){var i=Waymark.map.getCenter();(latlng=Waymark.get_exif_latlng(t))&&(i=latlng,Waymark.map.setView(i));var n=Waymark.get_image_sizes(e.sizes,e.url),a=Waymark.create_marker_json(i,n);Waymark.map_data.addData(a),Waymark.save_data_layer(),Waymark.map_was_edited()}else Waymark.message(waymark_js.lang.error_photo_meta,"error")}})},wp.media.editor.open(),!1;var t=jQuery("<input />").attr({type:"file",name:"add_photo"}).css("display","none").change((function(){Waymark.handle_file_upload(jQuery(this))}));jQuery("#waymark-edit-toolbar").append(t),t.trigger("click")},(n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-marker",e)).innerHTML='<i class="ion ion-location"></i>',n.setAttribute("title",waymark_js.lang.add_marker_title),n.onclick=function(){var t=Waymark.create_marker_json(Waymark.map.getCenter());Waymark.map_data.addData(t),Waymark.save_data_layer(),Waymark.map_was_edited()},(n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-rectangle",e)).innerHTML='<i class="ion ion-android-checkbox-outline-blank"></i>',n.setAttribute("title",waymark_js.lang.add_rectangle_title),n.onclick=function(){Waymark.map.editTools.startRectangle()},(n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-polygon",e)).innerHTML='<i class="ion ion-android-star-outline"></i>',n.setAttribute("title",waymark_js.lang.add_polygon_title),n.onclick=function(){Waymark.map.editTools.startPolygon()},(n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-circle",e)).innerHTML='<i class="ion ion-ios-circle-outline"></i>',n.setAttribute("title",waymark_js.lang.add_circle_title),n.onclick=function(){Waymark.map.editTools.startCircle()},void 0!==wp.media&&1==Waymark.get_property(waymark_settings,"misc","editor_options","media_library_uploads")){(n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-upload",e)).innerHTML='<i class="ion ion-document"></i><i class="ion ion-arrow-up-c"></i>',n.setAttribute("title",waymark_js.lang.upload_file_title),n.onclick=function(){return wp.media.editor.send.attachment=function(t,e){Waymark.debug(e),jQuery.ajax({type:"GET",url:e.url,dataType:"text",success:function(t){switch(e.mime){case"application/gpx+xml":Waymark.load_file_contents(t,"gpx");break;case"application/vnd.google-earth.kml+xml":Waymark.load_file_contents(t,"kml");break;case"application/geo+json":Waymark.load_file_contents(t,"geojson");break;default:Waymark.message(waymark_js.lang.error_file_upload)}}})},wp.media.editor.open(),!1}}else{var i=jQuery("<input />").attr({type:"file",name:"add_file"}).css("display","none").change((function(){Waymark.handle_file_upload(jQuery(this))})),n=Waymark_L.DomUtil.create("a","waymark-edit-button waymark-edit-upload",e);jQuery("#waymark-edit-toolbar").append(i),n.innerHTML='<i class="ion ion-document"></i><i class="ion ion-arrow-up-c"></i>',n.setAttribute("title",waymark_js.lang.upload_file_title),n.onclick=function(){i.trigger("click"),Waymark.map.editTools.stopDrawing()}}return e}});Waymark.map.addControl(new e)},this.handle_file_upload=function(t,e={}){Waymark=this,Waymark.loading_start();var i=new FormData;i.append("waymark_security",waymark_security),i.append("action","waymark_read_file"),i.append(t.attr("name"),t[0].files[0]),jQuery.ajax({type:"POST",url:waymark_js.ajaxurl,data:i,dataType:"json",processData:!1,contentType:!1,success:function(i){if(Waymark.debug(i),null===i)return Waymark.message(waymark_js.lang.error_file_upload,"error"),Waymark.loading_stop(),!1;if(i.error)return Waymark.message(i.error,"error"),Waymark.loading_stop(),!1;switch(t.attr("name")){case"add_file":Waymark.load_file_contents(i.file_contents,i.file_type);break;case"add_photo":if(void 0===i.url)return!1;var n=Waymark.map.getCenter();(latlng=Waymark.get_exif_latlng(i))&&(n=latlng,Waymark.map.setView(n));var a=Waymark.get_image_sizes(i.sizes,i.url),o=Waymark.create_marker_json(n,a);Waymark.map_data.addData(o),
//!!! To-do - move this into Waymark.map_was_edited()	  	  
Waymark.save_data_layer();break;case"marker_photo":if(void 0===i.url)return!1;a=Waymark.get_image_sizes(i.sizes,i.url);e.feature.properties=Object.assign({},e.feature.properties,a),e.img_view.attr("href",e.feature.properties.image_large_url),jQuery("img",e.img_view).attr("src",e.feature.properties.image_thumbnail_url),e.img_input.val(e.feature.properties.image_large_url),
//!!! To-do - move this into Waymark.map_was_edited()	  	  
Waymark.save_data_layer()}Waymark.map_was_edited(),Waymark.loading_stop()}})},this.build_content=function(t,e,n,a="map_data"){Waymark=this;var o=jQuery("<div />");switch(a){default:case"map_data":var r=jQuery("<ul />").addClass("waymark-info");if("line"==t||"shape"==t){var s=jQuery("<button />").html('<i class="ion-edit"></i>').addClass("button").attr("title",waymark_js.lang.action_edit+" "+Waymark.title_case(waymark_js.lang["object_label_"+t])).on("click",(function(e){e.preventDefault();var i=jQuery(this),a=jQuery("i",i);return n.editEnabled()?(n.disableEdit(),i.attr("title",waymark_js.lang.action_edit+" "+Waymark.title_case(waymark_js.lang["object_label_"+t])),a.attr("class","ion-edit"),"function"==typeof Waymark.config.handle_edit_callback&&Waymark.config.handle_edit_callback(!1)):(n.enableEdit(),n.closePopup(),i.attr("title",waymark_js.lang.action_edit_done),a.attr("class","ion-android-done"),"function"==typeof Waymark.config.handle_edit_callback&&Waymark.config.handle_edit_callback(!0)),!1}));r.append(jQuery("<li />").addClass("waymark-info-button waymark-info-edit waymark-"+t+"-edit").append(s))}s=jQuery("<button />").html('<i class="ion-ios-copy"></i>').addClass("button").attr("title",waymark_js.lang.action_duplicate+" "+Waymark.title_case(waymark_js.lang["object_label_"+t])).on("click",(function(t){return t.preventDefault(),Waymark.load_json(Object.assign({},n.feature)),Waymark.map_was_edited(),!1}));r.append(jQuery("<li />").addClass("waymark-info-button waymark-info-delete waymark-"+t+"-delete").append(s));s=jQuery("<button />").html('<i class="ion-trash-a"></i>').addClass("button").attr("title",waymark_js.lang.action_delete+" "+Waymark.title_case(waymark_js.lang["object_label_"+t])).on("click",(function(i){return i.preventDefault(),!("1"==Waymark.config.editor_options.confirm_delete&&!confirm(waymark_js.lang.action_delete_confirm+" "+Waymark.title_case(waymark_js.lang["object_label_"+t])+"?"))&&(Waymark.map.removeLayer(n),Waymark.map_data.removeLayer(n),Waymark.save_data_layer(),Waymark.map_was_edited(),"function"==typeof Waymark.config.handle_delete_callback&&Waymark.config.handle_delete_callback(e),!1)}));r.append(jQuery("<li />").addClass("waymark-info-button waymark-info-delete waymark-"+t+"-delete").append(s));var l=Waymark.config[t+"_types"];s=jQuery("<select />");for(i in s.append(jQuery("<option />").attr({disabled:"disabled"}).text(Waymark.title_case(waymark_js.lang["object_label_"+t])+" "+waymark_js.lang.object_type_label+":")),l){var h=Waymark.make_key(l[i][t+"_title"]);s.append(jQuery("<option />").val(h).text(l[i][t+"_title"]))}if("function"==typeof Waymark.config.handle_custom_type_callback){s.append(jQuery("<option />").attr("disabled","disabled").text("──────────"));var d=jQuery("<option />").attr("id","custom_type").val("{}").text("Custom");s.append(d)}for(key in s.change((function(){var i=jQuery("option:selected",jQuery(this));if("custom_type"==i.attr("id"))"function"==typeof Waymark.config.handle_custom_type_callback&&Waymark.config.handle_custom_type_callback(t,n,i);else{"function"==typeof Waymark.config.handle_custom_type_callback&&Waymark.config.handle_custom_type_callback(t,n,i,"hide");var a=jQuery(this).val();if(e.properties.type=a,"object"!=typeof a)var o=Waymark.get_type(t,e.properties.type);switch(t){case"line":n.setStyle({color:o.line_colour,weight:o.line_weight});break;case"shape":n.setStyle({color:o.shape_colour,fillOpacity:o.fill_opacity});break;case"marker":n.setIcon(L.divIcon(Waymark.build_icon_data(o)))}Waymark.save_data_layer(),Waymark.map_was_edited()}})),r.append(jQuery("<li />").addClass("waymark-info-type waymark-"+t+"-type").append(s)),"object"==typeof e.properties.type?"function"==typeof Waymark.config.handle_custom_type_callback&&(Waymark.config.handle_custom_type_callback(t,n,d,"show"),d.attr("selected","selected")):("function"==typeof Waymark.config.handle_custom_type_callback&&Waymark.config.handle_custom_type_callback(t,n,d,"hide"),jQuery("option",s).filter((function(){return jQuery(this).val()==Waymark.make_key(e.properties.type)})).attr("selected","selected")),Waymark.config[t+"_data_defaults"]){s=null;switch(key){case"title":s=jQuery("<input />").attr({type:"text",value:e.properties.title,placeholder:Waymark.title_case(waymark_js.lang["object_label_"+t])+" "+waymark_js.lang.object_title_placeholder}).on("change",(function(){e.properties.title=jQuery(this).val(),Waymark.save_data_layer(),Waymark.map_was_edited()}));break;case"description":s=jQuery("<textarea />").attr({id:"waymark-info-description",class:"wp-editor",placeholder:Waymark.title_case(waymark_js.lang["object_label_"+t])+" "+waymark_js.lang.object_description_placeholder}).val(e.properties.description).on("change",(function(){e.properties.description=jQuery(this).val(),Waymark.save_data_layer(),Waymark.map_was_edited()}));break;case"image_large_url":var c=jQuery("<input />").attr({value:e.properties.image_large_url,placeholder:waymark_js.lang.object_image_placeholder}).on("change",(function(){e.properties.image_large_url=jQuery(this).val(),Waymark.save_data_layer(),Waymark.map_was_edited()}));if(void 0!==e.properties.image_thumbnail_url)var u=e.properties.image_thumbnail_url;else u=e.properties.image_large_url;var _=jQuery("<img />").attr({src:u,width:160});c.on("change",(function(){_.attr("src",jQuery(this).val())}));var p=jQuery("<a />").attr({href:e.properties.image_large_url,target:"_blank"}).append(_).hover((function(){jQuery(this).addClass("waymark-hover")}),(function(){jQuery(this).removeClass("waymark-hover")})),m=jQuery("<button />").text(waymark_js.lang.action_upload_image).attr({type:"submit",name:"add_photo",class:"waymark-input button button-small",id:"add_photo"}).on("click",(function(t){if(t.preventDefault(),void 0!==wp.media)return wp.media.editor.send.attachment=function(t,i){if(Waymark.debug(i),void 0===i.url)return!1;var n=Waymark.get_image_sizes(i.sizes,i.url);e.properties=Object.assign({},e.properties,n),p.attr("href",e.properties.image_large_url),jQuery("img",p).attr("src",e.properties.image_thumbnail_url),c.val(e.properties.image_large_url),Waymark.save_data_layer(),Waymark.map_was_edited()},wp.media.editor.open(),!1;var i=jQuery("<input />").attr({type:"file",name:"marker_photo"}).css("display","none").change((function(){Waymark.handle_file_upload(jQuery(this),{feature:e,img_view:p,img_input:c})}));jQuery("#waymark-edit-toolbar").append(i),i.trigger("click")}));s=jQuery("<div />").append(p,c,m)}s&&r.append(jQuery("<li />").addClass("waymark-info-"+key+" waymark-"+t+"-info-"+key).append(s))}if("marker"==t&&void 0!==n.feature.geometry.coordinates){n.feature.geometry.coordinates;var f=n.feature.geometry.coordinates[1],g=n.feature.geometry.coordinates[0];"number"==typeof f&&(g=g.toFixed(6),f=f.toFixed(6)),s=jQuery("<small>").html("<b>"+waymark_js.lang.marker_latlng_label+"</b>: "+f+","+g),r.append(jQuery("<li />").addClass("waymark-info-latlng waymark-marker-info-latlng").append(s))}r.children().length&&o.append(r);break;case"query_data":r=jQuery("<ul />").addClass("waymark-info waymark-query-info waymark-"+t+"-info");for(key in Waymark.config[t+"_data_defaults"]){s=null;switch(key){case"title":e.properties.title?s=jQuery("<strong />").html(e.properties.title):(s=jQuery("<strong />").html("&nbsp;"),r.addClass("waymark-no-title"));break;case"type":if("1"!=Waymark.config.map_options.show_type_labels)break;var y=Waymark.get_type(t,e.properties.type);y&&(s=Waymark.type_to_text(t,y,"small"));break;case"description":var v=e.properties.description;v?s=0===v.indexOf("<")?v:jQuery("<p />").html(v):r.addClass("waymark-no-description");break;case"image_large_url":if(void 0!==e.properties.image_large_url){u=e.properties.image_large_url;if(void 0!==e.properties.image_medium_url)u=e.properties.image_medium_url;s=jQuery("<a />").attr({href:e.properties.image_large_url,target:"_blank",style:"background-image:url("+u+")"})}else r.addClass("waymark-no-image")}s&&r.append(jQuery("<li />").addClass("waymark-info-"+key+" waymark-"+t+"-info-"+key).append(s))}r.children().length&&o.append(r)}return o},this.info_window=function(t,e,i,n="map_data"){Waymark=this;var a=Waymark.title_case(waymark_js.lang.action_edit+" "+t);if("function"==typeof Waymark.config.handle_content_callback)i.on("click",(function(){var o=Waymark.build_content(t,e,i,n);Waymark.config.handle_content_callback(o.get(0),a,Waymark.mode)}));else{var o=Waymark.build_content(t,e,i,n).get(0);i.bindPopup(o,{}).openPopup().on("click",(function(){}))}},this.load_file_contents=function(t,e){switch(Waymark=this,t=t.trim(),e){case"gpx":var i=(new DOMParser).parseFromString(t,"text/xml"),n=toGeoJSON.gpx(i);break;case"kml":var a=(new DOMParser).parseFromString(t,"text/xml");n=toGeoJSON.kml(a);break;case"json":case"geojson":n=JSON.parse(t);break;default:Waymark.message(waymark_js.lang.error_file_type,"error")}void 0!==n?this.load_json(n):Waymark.message(waymark_js.lang.error_file_conversion,"error")},this.load_json=function(t){if(Waymark=this,"object"==typeof t){Waymark.map_data.addData(t),Waymark.save_data_layer();var e=Waymark.map_data.getBounds();e.isValid()&&Waymark.map.fitBounds(e)}},this.load_query_json=function(t,e=1){if(Waymark=this,"object"==typeof t){void 0!==Waymark.queries_data[e]&&(Waymark.map.removeLayer(Waymark.queries_data[e]),Waymark.query_data_group.removeLayer(Waymark.queries_data[e])),Waymark.queries_data[e]=Waymark_L.geoJSON(null,{pointToLayer:function(t,e){return Waymark.create_marker(e,{draggable:!1})},onEachFeature:function(t,e){Waymark.setup_query_data_feature(t,e)}}),Waymark.queries_data[e].addData(t),Waymark.queries_data[e].addTo(Waymark.map),Waymark.query_data_group.addLayer(Waymark.queries_data[e]);var i=Waymark.query_data_group.getBounds();i.isValid()&&Waymark.map.fitBounds(i),Waymark.save_query_data()}},this.save_query_data=function(){var t=jQuery(".waymark-input-query_data").first(),e=JSON.stringify(Waymark.query_data_group.toGeoJSON());t.html(e)}}function Waymark_Map_Factory(){this.instances=[],this.viewer=function(){var t=Object.assign(new Waymark_Map,new Waymark_Map_Viewer);return this.instances.push(t),t},this.editor=function(){var t=Object.assign(new Waymark_Map,new Waymark_Map_Editor);return this.instances.push(t),t}}window.Waymark_Map_Factory=new Waymark_Map_Factory;